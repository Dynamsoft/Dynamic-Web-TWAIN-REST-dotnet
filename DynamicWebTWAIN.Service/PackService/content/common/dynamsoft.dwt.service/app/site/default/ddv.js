/*! 
* 20241126123417
* Dynamsoft JavaScript Library
* Product: Dynamsoft Document Viewer
* Web Site: https://www.dynamsoft.com
*
* Copyright 2024, Dynamsoft Corporation
* Author: Dynamsoft Support Team
* Version: 2.1.0
*/

(function (exports, dynamsoftCore) {
	'use strict';

	function i(t,e,i){return (e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(t,"string");return "symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function n(t,e){return h(t,o(t,e,"get"))}function s(t,e,i){return d(t,o(t,e,"set"),i),i}function o(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function r(t,e,i){return c(t,e),u(i,"get"),h(t,i)}function a(t,e,i,n){return c(t,e),u(i,"set"),d(t,i,n),n}function l(t,e,i){return c(t,e),i}function h(t,e){return e.get?e.get.call(t):e.value}function d(t,e,i){if(e.set)e.set.call(t,i);else {if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i;}}function c(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}function u(t,e){if(void 0===t)throw new TypeError("attempted to "+e+" private static field before its declaration")}function p(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function g(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(t,e,i){g(t,e),e.set(t,i);}function y(t,e){g(t,e),e.add(t);}function m(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t));}catch(t){o(t);}}function a(t){try{l(n.throw(t));}catch(t){o(t);}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e);}))).then(r,a);}l((n=n.apply(t,e||[])).next());}))}function v(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function x(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i}var w,b,C,S,P,A,T,k,D,E,I,R,M,B,L,U,O,N,_,W,F,H,V,z,j,$,G,X,Y,q,J,Z,Q,K,tt,et,it,nt,st,ot,rt,at,lt,ht,dt,ct,ut,pt,gt,ft,yt,mt,vt,xt,wt,bt,Ct,St,Pt,At,Tt,kt,Dt,Et,It,Rt,Mt,Bt,Lt,Ut,Ot,Nt,_t,Wt,Ft,Ht,Vt,zt,jt,$t,Gt,Xt,Yt,qt,Jt,Zt,Qt,Kt,te,ee,ie,ne,se,oe,re,ae,le,he,de,ce,ue,pe,ge,fe,ye,me,ve,xe,we,be,Ce,Se,Pe,Ae,Te,ke,De,Ee,Ie,Re,Me,Be,Le,Ue,Oe,Ne,_e,We,Fe,He,Ve,ze,je,$e,Ge,Xe,Ye,qe,Je,Ze,Qe,Ke,ti,ei,ii,ni,si,oi,ri,ai,li,hi,di,ci,ui,pi,gi,fi,yi,mi,vi,xi,wi,bi,Ci,Si,Pi;"function"==typeof SuppressedError&&SuppressedError,function(t){t.logInfo="logInfo",t.logDebug="logDebug",t.logAll="logAll",t.imgIO="imgIO",t.core="imgCore",t.imgProc="imgProc",t.pdfR="pdfReader",t.pdfW="pdfWriter",t.crypto="crypto",t.binaryBlobType="application/octet-stream",t.wasmExtension=".wasm";}(w||(w={})),function(t){t.core="ddv-core",t.reader="ddv-reader",t.detector="ddv-detector",t.loader="ddv-loader";}(b||(b={})),function(t){t.pending="pending",t.ready="ready",t.failed="failed",t.destroyed="destroyed",t.init="init";}(C||(C={})),function(t){t.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",t.TIMEOUT="Timeout no Response = ",t.FILE_STREAM_ERROR="File Stream Error = ",t.WASM_EXCEPTION_ERROR="An WASM exception occurred.";}(S||(S={})),function(t){t[t.LONG_KEY=0]="LONG_KEY",t[t.DLS_KEY=1]="DLS_KEY";}(P||(P={})),function(t){t[t.wasmSucceed=0]="wasmSucceed",t[t.wasmBase=-4e3]="wasmBase",t[t.wasmException=-4001]="wasmException",t[t.wasmNoModule=-4002]="wasmNoModule",t[t.wasmJsBase=-4100]="wasmJsBase",t[t.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",t[t.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",t[t.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",t[t.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",t[t.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",t[t.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",t[t.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",t[t.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",t[t.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",t[t.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",t[t.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",t[t.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed";}(A||(A={})),function(t){t[t.IT_DIB=-1]="IT_DIB",t[t.IT_RGBA=-2]="IT_RGBA",t[t.IT_BGRA=-3]="IT_BGRA",t[t.IT_BMP=0]="IT_BMP",t[t.IT_JPG=1]="IT_JPG",t[t.IT_PNG=3]="IT_PNG",t[t.IT_ALL=5]="IT_ALL";}(T||(T={})),function(t){t[t.RT_AUTO=-1]="RT_AUTO",t[t.RT_BINARY=1]="RT_BINARY",t[t.RT_BASE64=2]="RT_BASE64";}(k||(k={})),function(t){t[t.SF_DEF=0]="SF_DEF",t[t.SF_ENABLE=1]="SF_ENABLE",t[t.SF_DISABLE=2]="SF_DISABLE";}(D||(D={})),function(t){t.imgIOVer="2.1.0",t.coreVer="2.1.0",t.imgProcVer="2.1.0",t.pdfRVer="2.1.0",t.pdfWVer="2.1.0",t.cryptoVer="2.1.0";}(at||(at={}));class Ai{static setLogFunc(t,e,i){x(this,E,t,"f",I),x(this,E,e,"f",R),x(this,E,i,"f",M);}static get level(){return v(this,E,"f",I)}static get func(){return v(this,E,"f",R)}static get context(){return v(this,E,"f",M)}static logAll(t){this.log(w.logAll,t);}static logD(t){this.log(w.logDebug,t);}static log(t,e){v(this,E,"f",R)&&v(this,E,"f",I)===t&&v(this,E,"f",R).call(this,e,v(this,E,"f",M));}}E=Ai,I={value:""},R={value:void 0},M={value:null};class Ti{static unload(){x(this,B,"","f",L),x(this,B,"","f",O),x(this,B,null,"f",N),x(this,B,{name:w.imgIO,workerName:b.core,autoLoad:!1,ver:at.imgIOVer,prefixName:Ti.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli},"f",et),x(this,B,{name:w.crypto,workerName:b.core,autoLoad:!1,ver:at.cryptoVer,prefixName:Ti.CryptoPrefixName,dependencyModules:[w.imgIO],fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli},"f",it),x(this,B,{name:w.pdfR,workerName:b.reader,autoLoad:!1,ver:at.pdfRVer,prefixName:Ti.PdfReaderPrefixName,dependencyModules:[w.imgIO,w.core],fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli},"f",nt),x(this,B,{name:w.core,workerName:b.core,autoLoad:!1,ver:at.coreVer,prefixName:Ti.ImagecorePrefixName,dependencyModules:[w.imgIO],fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli},"f",st),x(this,B,{name:w.imgProc,workerName:b.core,autoLoad:!1,ver:at.imgProcVer,prefixName:Ti.ImageProcPrefixName,dependencyModules:[w.imgIO,w.core],useSimd:Ti.UseSimd,useBrotli:Ti.UseBrotli},"f",ot),Ai.setLogFunc("",void 0,null);}static get UseSimd(){return v(this,B,"f",W)}static set UseSimd(t){x(this,B,t,"f",W);}static get UseBrotli(){return v(this,B,"f",F)}static set UseBrotli(t){x(this,B,t,"f",F);}static get License(){return v(this,B,"f",L)}static set License(t){x(this,B,t,"f",L);}static get LicMode(){return v(this,B,"f",U)}static set LicMode(t){x(this,B,t,"f",U),v(this,B,"m",V).call(this);}static get UUID(){return v(this,B,"f",O)}static set UUID(t){x(this,B,t,"f",O);}static get NavInfo(){return v(this,B,"f",N)}static set NavInfo(t){x(this,B,t,"f",N);}static get Mobile(){return v(this,B,"f",_)}static set Mobile(t){x(this,B,t,"f",_);}static get DefHeapSize(){return v(this,B,"f",z)}static set DefHeapSize(t){x(this,B,t,"f",z);}static get MaxHeapSize(){return v(this,B,"f",j)}static get HeapConfig(){return v(this,B,"m",G).call(this),Object.assign({},v(this,B,"f",$))}static getWorkerHeap(t){return void 0!==v(this,B,"f",$)[t]?v(this,B,"f",$)[t]:{maxHeapSize:v(this,B,"f",j),initHeapSize:v(this,B,"f",z)}}static UpdateHeapConfig(t,e,i){v(this,B,"m",G).call(this),e&&void 0!==v(this,B,"f",$)[t]&&(v(this,B,"f",$)[t].maxHeapSize=e),i&&void 0!==v(this,B,"f",$)[t]&&(v(this,B,"f",$)[t].initHeapSize=i);}static get FileReadModeSize(){return v(this,B,"f",X)}static set FileReadModeSize(t){x(this,B,t,"f",X);}static get FontUseFileReadMode(){return {load:v(this,B,"f",Y),save:v(this,B,"f",q)}}static set FontUseFileReadMode(t){"boolean"==typeof t.load&&x(this,B,t.load,"f",Y),"boolean"==typeof t.save&&x(this,B,t.save,"f",q);}static get ImageIOWorkerJS(){return "ddv-imageio.worker.js?v="+at.imgIOVer}static get PdfReaderWorkerJS(){return "dynamsoft.pdfReader_wasm-"+at.pdfRVer+".js"}static get ImageIOPrefixName(){return "ddv-imageio"}static get ImagecorePrefixName(){return "ddv-imagecore"}static get ImageProcPrefixName(){return "ddv-imageproc"}static get PdfReaderPrefixName(){return "ddv-pdfreader"}static get CryptoPrefixName(){return "ddv-crypto"}static get ImageIOResource(){return v(this,B,"f",Q)}static set ImageIOResource(t){x(this,B,v(this,B,"m",J).call(this,t),"f",Q),v(this,B,"m",tt).call(this,v(this,B,"f",Q),v(this,B,"f",et)),v(this,B,"m",tt).call(this,v(this,B,"f",Q),v(this,B,"f",it)),v(this,B,"m",tt).call(this,v(this,B,"f",Q),v(this,B,"f",st)),v(this,B,"m",tt).call(this,v(this,B,"f",Q),v(this,B,"f",ot));}static get PdfReaderResource(){return v(this,B,"f",K)}static set PdfReaderResource(t){t.useFastCompEdition=!1,x(this,B,v(this,B,"m",J).call(this,t),"f",K),v(this,B,"m",tt).call(this,v(this,B,"f",K),v(this,B,"f",nt)),this.PdfReaderModule.singleInstance=!0;}static get ImageIOModule(){return v(this,B,"f",et)}static get CryptoModule(){return v(this,B,"f",it)}static get PdfReaderModule(){return v(this,B,"f",nt)}static get ImagecoreModule(){return v(this,B,"f",st)}static get ImageReadereModule(){const t=Object.assign({},v(this,B,"f",st));return t.workerName=b.reader,t}static get ImageProcModule(){return v(this,B,"f",ot)}static get DetectorModule(){return x(this,B,Object.assign({},v(this,B,"f",ot)),"f",rt),v(this,B,"f",rt).workerName=b.detector,v(this,B,"f",rt)}static get PdfWriterModule(){const t=Object.assign({},v(this,B,"f",nt));return t.workerName=b.core,t}static setLogFunc(t,e,i){Ai.setLogFunc(t,e,i);}static hasLogFunc(){return void 0!==Ai.func}}B=Ti,H=function(t){this.LicMode==P.DLS_KEY&&t.dependencyModules&&-1!=t.dependencyModules.indexOf(w.imgIO)&&-1==t.dependencyModules.indexOf(w.crypto)&&t.dependencyModules.push(w.crypto);},V=function(){v(this,B,"m",H).call(this,v(this,B,"f",st)),v(this,B,"m",H).call(this,v(this,B,"f",ot)),v(this,B,"m",H).call(this,v(this,B,"f",nt));},G=function(){0===Object.keys(v(this,B,"f",$)).length&&(v(this,B,"f",$)[b.core]={},v(this,B,"f",$)[b.core].maxHeapSize=v(this,B,"f",j),v(this,B,"f",$)[b.core].initHeapSize=v(this,B,"f",z),v(this,B,"f",$)[b.reader]={},v(this,B,"f",$)[b.reader].maxHeapSize=v(this,B,"f",j),v(this,B,"f",$)[b.reader].initHeapSize=v(this,B,"f",z),v(this,B,"f",$)[b.detector]={},v(this,B,"f",$)[b.detector].maxHeapSize=v(this,B,"f",j),v(this,B,"f",$)[b.detector].initHeapSize=v(this,B,"f",z));},J=function(t){var e,i,n,s;let o={crossScript:!1,resourceDir:t.resourceDir,workerScript:t.workerScript,useFastCompEdition:null!==(e=t.useFastCompEdition)&&void 0!==e&&e,useSimd:null!==(i=t.useSimd)&&void 0!==i?i:v(this,B,"f",W),fetchOptions:null!==(n=t.fetchOptions)&&void 0!==n?n:v(this,B,"f",Z),useBrotli:null!==(s=t.useBrotli)&&void 0!==s?s:v(this,B,"f",F)};return o.workerScript=t.resourceDir+t.workerScript,o.workerScript.startsWith("http://")||o.workerScript.startsWith("https://")||o.workerScript.includes("://")?(o.resourceDir=t.resourceDir,o.workerScript.startsWith(location.origin)||(o.crossScript=!0)):t.resourceDir.startsWith("/")?null!=location.origin&&(o.resourceDir=location.origin+t.resourceDir):null!=location.href&&(o.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+t.resourceDir),o.resourceDir.endsWith("/")||(o.resourceDir+="/"),t.useFastCompEdition&&(o.resourceDir+="fastcomp/",o.workerScript=o.resourceDir+t.workerScript),o},tt=function(t,e){e.resourceDir=t.resourceDir,e.crossScript=t.crossScript,e.name===w.imgProc?e.useSimd=t.useSimd:e.useSimd=!1,e.script=t.workerScript,e.fetchOptions=t.fetchOptions,e.useBrotli=t.useBrotli;},L={value:""},U={value:P.LONG_KEY},O={value:""},N={value:null},_={value:!1},W={value:!1},F={value:!1},z={value:32},j={value:200},$={value:Object.create(null)},X={value:20},Y={value:!0},q={value:!1},Z={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}},Q={value:{resourceDir:"",workerScript:Ti.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli}},K={value:{resourceDir:"",workerScript:Ti.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli}},et={value:{name:w.imgIO,workerName:b.core,autoLoad:!1,ver:at.imgIOVer,prefixName:Ti.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli}},it={value:{name:w.crypto,workerName:b.core,autoLoad:!1,ver:at.cryptoVer,prefixName:Ti.CryptoPrefixName,dependencyModules:[w.imgIO],fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli}},nt={value:{name:w.pdfR,workerName:b.reader,autoLoad:!1,ver:at.pdfRVer,prefixName:Ti.PdfReaderPrefixName,dependencyModules:[w.imgIO,w.core],fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli}},st={value:{name:w.core,workerName:b.core,autoLoad:!1,ver:at.coreVer,prefixName:Ti.ImagecorePrefixName,dependencyModules:[w.imgIO],fetchOptions:v(Ti,B,"f",Z),useBrotli:Ti.UseBrotli}},ot={value:{name:w.imgProc,workerName:b.core,autoLoad:!1,ver:at.imgProcVer,prefixName:Ti.ImageProcPrefixName,dependencyModules:[w.imgIO,w.core],useSimd:Ti.UseSimd,useBrotli:Ti.UseBrotli}},rt={value:void 0};class ki{static read(t){return new Promise((function(e,i){let n=Object.prototype.toString.call(t);if("[object String]"===n){if(0===t.indexOf("blob:")||t.indexOf(".jpg")>0||t.indexOf(".jpeg")>0||t.indexOf(".png")>0||t.indexOf(".bmp")>0||t.indexOf(".dib")>0||t.indexOf(".pdf")>0||t.indexOf(".tiff")>0||t.indexOf(".tif")>0)return fetch(t,{mode:"cors"}).then((function(t){return t.arrayBuffer()})).then((function(t){return e(t)})).catch((function(t){return Promise.reject(t)}));i("Error url: Can not read the file URL");}else if("[object Blob]"===n||"[object FileList]"===n||"[object File]"===n){let s=t;"[object FileList]"!==n&&"[object File]"!==n||(s=t[0]?t[0]:t),v(ki,lt,"m",ht).call(ki,s,e,i);}else "[object ArrayBuffer]"===n||"[object Uint8ClampedArray]"===n?e(t):i("Not support source type: "+n);}))}}lt=ki,ht=function(t,e,i){let n,s,o=0;try{n=new ArrayBuffer(t.size),s=new Uint8Array(n);}catch(t){i(t);}!function r(){const a=new FileReader;a.onload=function(a){var l;if(null===(l=null==a?void 0:a.target)||void 0===l?void 0:l.result){const i=a.target.result;s.set(new Uint8Array(i),o),o+=i.byteLength,o<t.size?r():e(n);}else i(a);},a.onerror=function(t){i(t);},a.onabort=function(t){i(t);};const l=Math.min(o+1048576,t.size),h=t.slice(o,l);a.readAsArrayBuffer(h);}();};class Di{static fetchRetry(t,e,i,n){let s=e.retries,o=e.retryDelay;return new Promise((function(r,a){const l=function(h){return fetch(t,e).then((function(t){r(t);})).catch((function(t){h<s?function(t,e,s){i&&i(e,n),setTimeout((function(){l(++t);}),o);}(h,t):a(t);}))};return l(0)}))}}class Ei{constructor(t,e,i,n,s,o){dt.add(this),ct.set(this,void 0),ut.set(this,void 0),pt.set(this,void 0),gt.set(this,void 0),ft.set(this,void 0),yt.set(this,void 0),mt.set(this,void 0),vt.set(this,void 0),xt.set(this,void 0),wt.set(this,void 0),bt.set(this,void 0),Ct.set(this,void 0),St.set(this,void 0),Pt.set(this,0),At.set(this,{}),Tt.set(this,null),x(this,ct,t,"f"),x(this,xt,n,"f"),x(this,St,i,"f"),x(this,pt,[],"f"),x(this,gt,!1,"f"),x(this,ft,!1,"f"),x(this,Pt,e,"f"),x(this,Tt,Object.create(null),"f"),v(this,At,"f").modulesInfo=[],x(this,bt,Object.create(null),"f"),x(this,vt,null,"f"),x(this,wt,0,"f"),x(this,Ct,0,"f"),x(this,ut,v(this,dt,"m",Dt).call(this,v(this,ct,"f")),"f"),v(this,ut,"f").on("message",v(this,dt,"m",It),this),v(this,ut,"f").on("error",v(this,dt,"m",Et),this),v(this,ut,"f").on("exit",(function(e,i,n){let s="Worker #terminated Unexpectedly\n";s+=" exitCode: `"+e+"`\n",s+=" signalCode: `"+i+"`\n",s+=" #script: `"+t+"`\n",v(n,dt,"m",Et).call(n,new Error(s),n);}),this);}get WorkerScript(){return v(this,xt,"f")}get id(){return v(this,Pt,"f")}get Module(){return v(this,At,"f")}get Instances(){return v(this,Tt,"f")}get WorkerName(){return v(this,St,"f")}execTask(t,e,i){i||((i={}).promise=new Promise((function(t,e){i.resolve=t,i.reject=e;})));let n=x(this,Ct,+v(this,Ct,"f")+1,"f");v(this,bt,"f")[n]={id:n,insId:e.insId,resolver:i,cost:e.cost},delete e.cost;let s={id:n,func:t,params:e};return Ai.logD("["+e.insId+"] "+t+" send"),v(this,ft,"f")?i.reject(new Error("Worker is #terminated")):v(this,gt,"f")?i.reject(new Error("Worker is #terminating")):v(this,ut,"f").wasmReady||v(this,ut,"f").ready&&"loadWasm"===t?v(this,ut,"f").send(s):v(this,pt,"f").push(s),i.promise}get memSize(){return v(this,wt,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(v(this,bt,"f")).length}get alive(){return !v(this,gt,"f")&&!v(this,ft,"f")}terminate(t,e){if(Ai.logD("["+this.id+"] worker terminate "+t),t&&v(this,dt,"m",Mt).call(this,"Worker has been #terminated"),"function"==typeof e&&x(this,vt,e,"f"),this.busy)x(this,gt,!0,"f");else {if(v(this,ut,"f")){if("function"!=typeof v(this,ut,"f").terminate)throw new Error("Failed to terminate worker");Ai.logD("["+this.id+"] will be terminated"),v(this,ut,"f").terminate(),x(this,ut,null,"f");}x(this,gt,!1,"f"),x(this,ft,!0,"f"),v(this,vt,"f")&&v(this,vt,"f").call(this,this);}}hasInstance(t){if(t){const e=v(this,Tt,"f")[t];if(e)return 0!=Object.keys(e).length}else {const t=Object.keys(v(this,Tt,"f"));for(const e of t)if(0!=Object.keys(v(this,Tt,"f")[e]).length)return !0}return !1}exceedMaxMemory(){const t=1024*Ti.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return !!(v(this,wt,"f")&&v(this,wt,"f")>t&&0!=t)&&(Ai.logD("[w-"+this.id+"] current memSize="+v(this,wt,"f")+", max="+t),!0)}shouldBeFreed(){return !(!this.exceedMaxMemory()||this.hasInstance(void 0)||(Ai.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,gt=new WeakMap,ft=new WeakMap,yt=new WeakMap,mt=new WeakMap,vt=new WeakMap,xt=new WeakMap,wt=new WeakMap,bt=new WeakMap,Ct=new WeakMap,St=new WeakMap,Pt=new WeakMap,At=new WeakMap,Tt=new WeakMap,dt=new WeakSet,kt=function(t){let e=new Error(""),i=Object.keys(t);for(let n=0;n<i.length;n++)e[i[n]]=t[i[n]];return e},Dt=function(t){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let e=new Worker(t,{name:this.WorkerName});return e.on=function(t,e,i){this.addEventListener(t,(function(n){"exit"===t?e(n.data,"",i):e(n.data,i);}));},e.send=function(t){if(null!=t&&null!=t.params&&null!=t.params.input){let e=Object.prototype.toString.call(t.params.input);if("[object Array]"===Object.prototype.toString.call(t.params.input)){if(e=Object.prototype.toString.call(t.params.input[0]),"[object ArrayBuffer]"===e||"[object Uint8ClampedArray]"===e||"[object Uint8Array]"===e)return void this.postMessage(t,[null!=t.params.input[0].buffer?t.params.input[0].buffer:t.params.input[0]])}else if("[object ArrayBuffer]"===e||"[object Uint8ClampedArray]"===e||"[object Uint8Array]"===e)return void this.postMessage(t,[null!=t.params.input.buffer?t.params.input.buffer:t.params.input])}this.postMessage(t);},e},Et=function(t,e){x(e,ft,!0,"f"),Ai.logD("[js]["+e.id+"] worker error "+JSON.stringify(t)),v(e,gt,"f")&&v(e,vt,"f")&&v(e,vt,"f").call(e,e),x(e,gt,!1,"f"),v(e,dt,"m",Mt).call(e);},It=function(t,e){let i=t.id,n=v(e,bt,"f")[i];if(t&&t.cost&&n&&n.cost){const e=n.cost;e.exec=t.cost;const i=Date.now();e.total=i-e.ctime,e.msgQueue=t.ctime-e.time;const s=i-t.time;delete e.time,delete e.ctime,t.cost=e,t.cost.receive=s,delete t.ctime,delete t.time;}if(Ai.logD(t.log?t.log:t),"string"==typeof t&&"ready"===t)v(e,ut,"f").ready=!0,setTimeout((()=>{v(e,dt,"m",Rt).call(e);}),0);else if(!t.log){if("object"==typeof t){let i=t.result;"object"==typeof i?(null!=i.errorCode&&(i.code=i.errorCode,delete i.errorCode),null!=i.errorMessage&&(i.message=i.errorMessage,delete i.errorMessage)):"string"==typeof i&&(i=i.replace('"errorCode"','"code"'),i=i.replace("'errorCode'","'code'"),i=i.replace('"errorMessage"','"message"'),i=i.replace("'errorMessage'","'message'"),t.result=i),null!=t.memSize&&x(e,wt,t.memSize,"f");}if(void 0!==n){const s=n.insId;delete v(e,bt,"f")[i],Ai.logD("["+s+"] "+t.func+" received"),!0===v(e,gt,"f")&&e.terminate(),"loadWasm"===t.func&&null!=t.result&&(v(e,ut,"f").wasmReady=!0,setTimeout((()=>{v(e,dt,"m",Rt).call(e);}),0)),t.error?n.resolver.reject(v(e,dt,"m",kt).call(e,t.error)):t.result&&n.resolver.resolve(t.result);}}},Rt=function(){this.alive&&(v(this,pt,"f").forEach(v(this,ut,"f").send.bind(v(this,ut,"f"))),x(this,pt,[],"f"));},Mt=function(t){for(let e in v(this,bt,"f"))void 0!==v(this,bt,"f")[e]&&v(this,bt,"f")[e].resolver.reject(new Error(t));x(this,bt,Object.create(null),"f");};class Ii{constructor(){Bt.add(this),Ot.set(this,[]),Nt.set(this,4),_t.set(this,60),Wt.set(this,!1),Ft.set(this,0),Vt.set(this,!1);}static get Instance(){return v(this,Lt,"f",Ut)||x(this,Lt,new Ii,"f",Ut),v(this,Lt,"f",Ut)}get Terminated(){return v(this,Wt,"f")}getModuleLoadedError(t){for(let e of v(Ii,Lt,"f",Ht))if(e.name==t)return e.error}getModuleStatus(t){for(let e of v(Ii,Lt,"f",Ht))if(e.name==t)return e.status;return ""}addModules(t,e){let i=!1;if(v(Ii,Lt,"f",Ht).forEach((function(e,n,s){e.name==t.name&&(e.ver==t.ver?i=!0:s.splice(n,1));})),!i){let i=t;i.status=e||"",i.wasmModule=null,v(Ii,Lt,"f",Ht).push(i);}}loadModule(t,e){return m(this,void 0,void 0,(function*(){null==e&&(e=0!=v(this,Bt,"m",Jt).call(this,t).length),this.addModules(t);for(let e of t.dependencyModules)e===w.imgIO?(this.addModules(Ti.ImageIOModule,C.pending),Ti.LicMode===P.DLS_KEY&&t.name!=w.crypto&&this.addModules(Ti.CryptoModule,C.pending)):e===w.core&&this.addModules(Ti.ImagecoreModule,C.pending);let i,n;for(let s of v(Ii,Lt,"f",Ht))if(s.name===t.name){if(s.status===C.pending)return !1;if(s.wasmModule){if(e)return !0;i=s.wasmModule,n=s.wasmBinary;break}break}let s=null;if(i)s=t,s.wasmModule=i,s.wasmBinary=n,s.status=C.pending;else if(s=t,""===s.status)s.status=C.pending,s.wasmModule=null;else {if(s.status===C.pending)return !1;e||(s.error={code:0,message:""},s.status=C.pending);}return v(this,Bt,"m",zt).call(this,s)}))}get busy(){v(this,Bt,"m",te).call(this);let t=v(this,Ot,"f");for(let e of t)if(e.busy)return !0;return !1}getWorker(t,e){return m(this,void 0,void 0,(function*(){if(v(this,Bt,"m",Zt).call(this,t.name))return v(this,Bt,"m",Kt).call(this),{worker:null,workers:0};let i=v(this,Bt,"m",Jt).call(this,t,!0);return 0!=i.length?{worker:v(this,Bt,"m",ee).call(this,i,e,t),workers:i.length}:(yield this.loadModule(t,!1),{worker:null,workers:0})}))}removeInstanceInWorker(t,e,i,n){if(v(this,Bt,"m",ie).call(this,e,t.name,i),n&&e&&e.shouldBeFreed()){let t=v(this,Ot,"f").indexOf(e);-1!==t&&v(this,Ot,"f").splice(t,1);}}terminate(t){x(Ii,Lt,null,"f",Ut),Ai.logD("worker pool terminate "+t),x(this,Wt,!0,"f");let e=[];return v(this,Ot,"f").splice(0).forEach((function(i){let n={};n.promise=new Promise((function(t,e){n.resolve=t,n.reject=e;})),e.push(n.promise),i.terminate(t,(function(t){n.resolve(t);}));})),Promise.all(e)}static unload(){x(Ii,Lt,new Array,"f",Ht);}terminateWorker(t){v(this,Ot,"f").splice(0,v(this,Ot,"f").length,...v(this,Ot,"f").filter((e=>e.WorkerName!==t||(e.terminate(!0),!1))));}getMemoryUsed(){let t=v(this,Ot,"f"),e=[],i=0;for(let n of t)n&&null!=n.memSize&&(e[i]={},e[i].size=n.memSize,e[i].limit=1024*Ti.getWorkerHeap(n.WorkerName).maxHeapSize*1024,e[i].name=n.WorkerName,e[i].id=n.id,i+=1);return e}}Lt=Ii,Ot=new WeakMap,Nt=new WeakMap,_t=new WeakMap,Wt=new WeakMap,Ft=new WeakMap,Vt=new WeakMap,Bt=new WeakSet,zt=function(t){return m(this,void 0,void 0,(function*(){let e=this,i=yield v(this,Bt,"m",Yt).call(this,t);if(i){let n={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:t.fetchOptions}};if(n.params.resourceDir=t.resourceDir,n.params.initMemory=Ti.getWorkerHeap(t.workerName).initHeapSize,n.params.module){for(let e of v(Ii,Lt,"f",Ht))for(let i of t.dependencyModules)i==e.name&&n.params.module.modulesInfo.push(e);n.params.module.modulesInfo.push(t);}yield v(this,Bt,"m",$t).call(this,i,n),x(e,Nt,v(e,Bt,"m",Xt).call(e),"f"),t.status===C.pending&&(t.status="");}else t.status="",t.wasmModule=null;}))},jt=function(t,e,i,n){for(let s of v(Ii,Lt,"f",Ht))if(s.name===t){s.status=e,s.wasmModule=i.wasmModule,s.wasmBinary=i.wasmBinary,s.error=n;break}},$t=function(t,e,i){return m(this,void 0,void 0,(function*(){let n=this;try{const i=yield t.execTask(e.func,e.params);let s=!1;return void 0===i.code||i.modules?s=v(n,Bt,"m",Gt).call(n,i,t):Ai.logD(i),s}catch(n){return Ai.logD(n),!1}finally{i&&i();}}))},Gt=function(t,e){if(Ai.logD("handleWasmLoad:"),Ai.logD(t),v(this,Wt,"f"))return e.terminate(),!1;if(("object"!=typeof t||null==t.modules)&&"object"==typeof t)return !1;let i=!1;for(const n of t.modules)t.code?(v(this,Bt,"m",jt).call(this,n.name,C.failed,null,{code:t.code,message:t.message}),e.Module.modulesInfo[n.name]=!1):(v(this,Bt,"m",jt).call(this,n.name,C.ready,n.wasmResource,void 0),e.Module.modulesInfo[n.name]=!0,i=!0);return i},Xt=function(){let t=2;return "hardwareConcurrency"in self.navigator&&(t=self.navigator.hardwareConcurrency),Math.max(Math.min(v(this,Nt,"f"),Math.max(v(this,Nt,"f"),t/2)),1)},Yt=function(t){return m(this,void 0,void 0,(function*(){v(this,Bt,"m",te).call(this);let e=v(this,Ot,"f");for(let i of e)if(i.WorkerName===t.workerName)return i.busy?null:i;return v(this,Bt,"m",qt).call(this,t)}))},qt=function(t){var e;return m(this,void 0,void 0,(function*(){let i=this,n=v(i,Ot,"f");if(n.length<v(i,Nt,"f")&&!v(i,Vt,"f")){x(i,Vt,!0,"f");let s=t.script;t.crossScript&&(s=yield Di.fetchRetry(t.script,t.fetchOptions,Ai.func,i).then((t=>t.blob())).then((t=>URL.createObjectURL(t))).catch((t=>(Ai.logD("get new worker fetch failed: "),Ai.logD(t),x(i,Vt,!1,"f"),null))));let o=new Ei(s,x(e=i,Ft,+v(e,Ft,"f")+1,"f"),t.workerName,t.script,Ai.func,Ai.context);return n.push(o),x(i,Vt,!1,"f"),Ai.logAll(n),Ai.logD("[wl-"+v(i,Ot,"f").length+"] got new worker w-"+o.id+"("+o.WorkerName+") succeed!"),o}return null}))},Jt=function(t,e){v(this,Bt,"m",te).call(this);let i=v(this,Ot,"f");Ai.logAll(i);let n=[];for(let s of i)if(s.Module.modulesInfo[t.name]){let i=!0;if(t.dependencyModules.forEach((t=>{s.Module.modulesInfo[t]||(i=!1);})),!i)continue;if(e&&s.WorkerName!==t.workerName)continue;n.push(s);}return Ai.logAll("[wl-"+i.length+"] got workers for module "+t.name),Ai.logAll(n),n},Zt=function(t){for(let e of v(Ii,Lt,"f",Ht))if(e.name===t&&e.status===C.pending)return !0;return !1},Qt=function(){return m(this,void 0,void 0,(function*(){this.terminate(!0);for(let t of v(Ii,Lt,"f",Ht))yield v(this,Bt,"m",zt).call(this,t);}))},Kt=function(){v(this,Bt,"m",te).call(this),0==v(this,Ot,"f").length&&0!=v(Ii,Lt,"f",Ht).length&&(Ai.logD("no worker ready, reinit"),v(this,Bt,"m",Qt).call(this));},te=function(){v(this,Ot,"f").splice(0,v(this,Ot,"f").length,...v(this,Ot,"f").filter((function(t){return t.alive})));},ee=function(t,e,i){Ai.logAll("[wl-"+v(this,Ot,"f").length+"] getWorkerByIntanceId"),Ai.logAll(t);let n,s=9007199254740991;for(let o of t){if(i.singleInstance&&o.hasInstance(i.name)&&!o.Instances[i.name][e])continue;const t=o.Instances[i.name];if(!t||void 0!==t[e]){n=o;break}{let t=o.howManyTasks;t<s&&(n=o,s=t);}}if(n){if(n.shouldBeFreed())return null;const s=n.Instances[i.name];if(s)s[e]="";else {const t=Object.create(null);t[e]="",n.Instances[i.name]=t;}return Ai.logAll(t),Ai.logD("[wl-"+t.length+"]["+e+"] got worker w-"+n.id),n}return Ai.logAll("#getWorkerByIntanceId: no suitable worker"),null},ie=function(t,e,i){let n=v(this,Ot,"f");Ai.logAll("removeInstanceInWorkerInner"),Ai.logAll(n);for(let s of n)if(s===t){const o=s.Instances[e];if(o){if(null!=o[i]){delete o[i],Ai.logAll(n),Ai.logD("[w-"+s.id+"] removeInstanceInWorkerInner "+i+" in "+t.id+" succeed!");break}Ai.logD("[w-"+s.id+"] not found instance "+i);}}},Ut={value:null},Ht={value:new Array};class Ri{static buildWasmFileName(t,e,i,n,s){return t+(n?"-simd":"")+i+"?v="+e}static base64DecToArr(t,e){let i=t.replace(/[^A-Za-z0-9\+\/]/g,""),n=i.length,s=e?Math.ceil((3*n+1>>>2)/e)*e:3*n+1>>>2,o=new Uint8Array(s);for(let t,e,r=0,a=0,l=0;l<n;l++)if(e=3&l,r|=v(this,ne,"m",se).call(this,i.charCodeAt(l))<<18-6*e,3===e||n-l==1){for(t=0;t<3&&a<s;t++,a++)o[a]=r>>>(16>>>t&24)&255;r=0;}return o}static isWasmSupport(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){let t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return !1}static random(){return (Date.now()%10086).toString(36).slice(2)+Math.random().toString(36).slice(2)}static newBlobInChunks(t,e,i){var n;let s;const o=i||t.byteLength,r=8388608,a=[];for(let e=0;e<o;e+=r)a.push(new Blob([new Uint8Array(null!==(n=t.buffer)&&void 0!==n?n:t,e,Math.min(o-e,r))]));return s=null!=e?new Blob(a,{type:e}):new Blob(a),s}}ne=Ri,se=function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0};class Mi{constructor(t,e){var i,n,s,o;oe.add(this),le.set(this,void 0),this._outputType=T.IT_JPG,this._inputType=T.IT_ALL,this._jpegQuality=80,he.set(this,null!==(i=Ti.License)&&void 0!==i?i:""),de.set(this,[]),ce.set(this,null),ue.set(this,0),pe.set(this,x(o=Mi,re,+v(o,re,"f",ae)+1,"f",ae)),ge.set(this,null),fe.set(this,JSON.parse(JSON.stringify(Ti.NavInfo))),ye.set(this,Ti.Mobile),me.set(this,location.origin),ve.set(this,""),xe.set(this,C.init),we.set(this,!1),be.set(this,null!==(n=Ti.LicMode)&&void 0!==n?n:P.LONG_KEY),Ce.set(this,null!==(s=Ti.UUID)&&void 0!==s?s:""),Se.set(this,0),Pe.set(this,!1),Ae.set(this,!1),this._handleBooleanResult=function(t,e){return !0},x(this,le,t,"f"),x(this,he,null!=e?e:Ti.License,"f");}_prepareModule(t){}get workerId(){return v(this,ce,"f")&&v(this,ce,"f").alive?v(this,ce,"f").id:0}get id(){return v(this,pe,"f")}hasTask(){return v(this,de,"f").length>0}_canTerminateWork(){return !1}_makeSureWorkerMemoryNotExceed(){return !(v(this,ce,"f")&&v(this,ce,"f").alive&&this._canTerminateWork()&&v(this,ce,"f").exceedMaxMemory()&&(Ai.logD(`[${this.id}] try to termiate worker [${v(this,ce,"f").id}]`),v(this,ce,"f").terminate(!0),x(this,ce,null,"f"),x(this,xe,C.init,"f"),1))}_workerChanged(t){}_handleBasicResult(t,e){return delete t.code,delete t.message,t}_handleImageData(t,e){var i,n,s;if("object"==typeof t.imageData)if(null!=t.imageCount&&t.imageCount>1)for(let n=0;n<t.imageCount;n++)t.imageData[n]=v(i=e.context,oe,"m",De).call(i,t.imageData[n],t.blobType,e.params.returnBlob,t.imageDataSize);else t.imageData=v(n=e.context,oe,"m",De).call(n,t.imageData,t.blobType,e.params.returnBlob,t.imageDataSize);return "object"==typeof t.pdfData&&(t.pdfData=v(s=e.context,oe,"m",De).call(s,t.pdfData,t.blobType,e.params.returnBlob,t.pdfDataSize)),t}_handleResult(t,e){var i,n;let s=v(n=e.context,oe,"m",Ee).call(n,t);if(void 0===s.code||!s.code&&"Successful."===s.message)s=e.handleResult(s,e),setTimeout((()=>{var t;v(t=e.context,oe,"m",ke).call(t);}),0),(0, e.resolve)(s);else {let t={code:s.code,message:s.code===A.wasmException?S.WASM_EXCEPTION_ERROR+"("+(null===(i=e.params)||void 0===i?void 0:i.moduleName)+":"+e.func+":"+s.message+")":s.message};e.context.terminated?e.resolve(t):e.reject(t);}}_execTask(t){let e=this,i=v(e,ce,"f");if(Ai.logAll(t),i)try{if(t.params.cost){const e=t.params.cost.time;t.params.cost.time=Date.now(),t.params.cost.taskQueue=t.params.cost.time-e;}i.execTask(t.func,t.params).then((function(i){e._handleResult(v(e,oe,"m",Ee).call(e,i),t);})).catch((function(i){Ai.logD(i),setTimeout((()=>{v(e,oe,"m",ke).call(e);}),0);let n=i;"object"==typeof i&&null!=i.message&&(n=i.message);let s={code:A.wasmJsWorkerRunFailed,message:n};v(e,we,"f")?t.resolve(s):t.reject(s);}));}catch(i){setTimeout((()=>{v(e,oe,"m",ke).call(e);}),0),Ai.logD(i);let n={code:A.wasmJsWorkerRunException,message:i.message,stack:i.stack};v(e,we,"f")?t.resolve(n):t.reject(n);}}_cancelAllTasks(t,e){for(let i of v(this,de,"f"))if(void 0!==i){let n={code:t,message:e};v(this,we,"f")?i.resolve(n):i.reject(n);}x(this,de,[],"f");}_createTask(t,e,i){let n={moduleName:v(this,le,"f").name,insId:v(this,pe,"f")},s={id:x(this,ue,+v(this,ue,"f")+1,"f"),func:t,params:n};return s.promise=new Promise((function(t,e){s.resolve=t,s.reject=e;})),s.func=t,s.context=this,s.handleResult=void 0!==i&&i?i:this._handleBasicResult,s.params.input=void 0!==e&&e?e:"",s.params.returnType=k.RT_AUTO,s.params.returnBlob=!0,s.params.logLevel=Ai.level,s.params.cost={},s.params.cost.ctime=Date.now(),s.params.cost.time=s.params.cost.ctime,s}_addTask(t,e){if(t.params.cost){const e=t.params.cost.time;t.params.cost.time=Date.now(),t.params.cost.create=t.params.cost.time-e;}return v(this,xe,"f")===C.destroyed?t.reject({code:A.wasmJsObjectNotInit,message:v(this,we,"f")?"object has been disposed":"object not init"}):v(this,xe,"f")===C.failed?t.reject({code:A.wasmJsObjectInitFailed,message:v(this,ve,"f")}):(e?v(this,de,"f").unshift(t):v(this,de,"f").push(t),v(this,oe,"m",ke).call(this)),t.promise}terminate(t){let e=this;v(e,Pe,"f")?x(e,we,!0,"f"):(x(this,Ae,!0,"f"),v(e,oe,"m",Re).call(e).then((function(t){Ai.logD("["+e.id+"] "+v(e,le,"f").name+" destroy return: "),Ai.logD(t);})).catch((function(t){Ai.logD(v(e,le,"f").name+" destroy failed"),Ai.logD(t);})).finally((()=>{Ii.Instance&&Ii.Instance.removeInstanceInWorker(v(e,le,"f"),v(e,ce,"f"),v(e,pe,"f"),null==t||t),x(e,ce,null,"f"),x(e,we,!0,"f"),x(e,Ae,!1,"f");}))),x(e,xe,"","f");}_readFile(t){return ki.read(t).catch((function(t){let e=t;return "object"!=typeof e&&(e={},e.code=A.wasmJsReadFileFailed,e.message=t),Promise.reject(e)}))}updateLicense(t,e,i){return m(this,void 0,void 0,(function*(){x(this,he,t,"f"),x(this,be,null!=e?e:P.LONG_KEY,"f"),x(this,Ce,null!=i?i:"","f");let n=this,s=n._createTask("UpdateLicense");return s.params.input=[v(n,he,"f"),v(n,be,"f"),v(n,Ce,"f")],n._addTask(s),s.promise}))}}re=Mi,le=new WeakMap,he=new WeakMap,de=new WeakMap,ce=new WeakMap,ue=new WeakMap,pe=new WeakMap,ge=new WeakMap,fe=new WeakMap,ye=new WeakMap,me=new WeakMap,ve=new WeakMap,xe=new WeakMap,we=new WeakMap,be=new WeakMap,Ce=new WeakMap,Se=new WeakMap,Pe=new WeakMap,Ae=new WeakMap,oe=new WeakSet,Te=function t(e){let i=null!=e?e:this;return v(i,ge,"f")&&clearTimeout(v(i,ge,"f")),v(i,we,"f")?(Ai.logD(`[${i.id}] has been termiated.(getWorker)`),i._cancelAllTasks(A.wasmJsObjectTerminated,`Instance [${i.id}] has been termiated.`),v(i,ce,"f")):v(i,ce,"f")&&v(i,ce,"f").alive?v(i,ce,"f"):void(Ii.Instance?Ii.Instance.getWorker(v(i,le,"f"),v(i,pe,"f")).then((e=>{var n;if(x(i,ce,e.worker,"f"),v(i,ce,"f")&&v(i,ce,"f").alive)v(i,Se,"f")!=v(i,ce,"f").id&&(0!==v(i,Se,"f")&&i._workerChanged(v(i,ce,"f").id),x(i,Se,v(i,ce,"f").id,"f")),v(i,de,"f").length>0&&setTimeout((()=>{v(i,oe,"m",ke).call(i);}),0);else {let e=null===(n=Ii.Instance)||void 0===n?void 0:n.getModuleLoadedError(v(i,le,"f").name);if(null==e?void 0:e.code)return i._cancelAllTasks(A.wasmJsNotLoaded,e.message),v(i,ce,"f");v(i,de,"f").length>0&&x(i,ge,setTimeout(v(i,oe,"m",t),50,i),"f");}return v(i,ce,"f")})).catch((t=>v(i,ce,"f"))):i._cancelAllTasks(A.wasmJsNotLoaded,"wasm env not loaded or unloaded"))},ke=function(){if(Ai.logAll(v(this,de,"f")),v(this,xe,"f")!=C.init)if(v(this,ce,"f")&&v(this,ce,"f").alive){if(v(this,de,"f").length>0&&(v(this,xe,"f")===C.ready||"init"===v(this,de,"f")[0].func)){const t=v(this,de,"f").shift();this._execTask(t);}}else {if(v(this,ce,"f")&&!v(this,ce,"f").alive&&v(this,de,"f").length>0&&"init"!=v(this,de,"f")[0].func)return x(this,ce,null,"f"),void v(this,oe,"m",Ie).call(this);v(this,de,"f").length>0&&v(this,le,"f").script&&v(this,oe,"m",Te).call(this,this);}else v(this,oe,"m",Ie).call(this);},De=function(t,e,i,n){return i?Ri.newBlobInChunks(t,e,n):void 0===n||n===t.byteLength?t:t.slice(0,n)},Ee=function(t){try{return "string"==typeof t?JSON.parse(t):t}catch(e){return t}},Ie=function(){let t=this;t._prepareModule(v(this,le,"f"));let e=this._createTask("init");e.params.key=v(this,he,"f"),e.params.uuid=v(this,Ce,"f"),e.params.licMode=v(this,be,"f"),e.params.val={nv:v(this,fe,"f"),mb:v(this,ye,"f"),dm:v(this,me,"f")},e.handleResult=function(t,e){return x(e.context,xe,C.ready,"f"),t},x(this,xe,C.pending,"f"),this._addTask(e,!0),e.promise.then((function(e){Ai.logD("["+t.id+"] "+v(t,le,"f").name+" init return: "),Ai.logD(e),x(t,Pe,!1,"f");})).catch((function(e){x(t,xe,C.failed,"f"),x(t,ve,e.message,"f"),Ai.logD(v(t,le,"f").name+" init failed"),Ai.logD(e),t._cancelAllTasks(A.wasmJsObjectInitFailed,e.message);}));},Re=function(){if(v(this,xe,"f")==C.pending||v(this,xe,"f")==C.ready){let t=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(t),t.promise}return Promise.resolve(!0)},ae={value:0};class Bi extends Mi{constructor(t,e){super(t,e);}_prepareModule(t){let e=Ii.Instance;e.addModules(Ti.ImageIOModule),Ti.LicMode===P.DLS_KEY&&e.addModules(Ti.CryptoModule),v(Bi,Me,"m",Be).call(Bi,Ti.ImageIOModule,t),e.addModules(t);}}Me=Bi,Be=function(t,e){e.resourceDir=t.resourceDir,e.crossScript=t.crossScript,e.script=t.script,e.useSimd=t.useSimd,e.name===w.imgProc?e.useSimd=Ti.UseSimd:e.useSimd=!1,e.fetchOptions=t.fetchOptions;};class Li extends Bi{constructor(t){super(Ti.ImagecoreModule,t),Le.add(this),Ue.set(this,0);}getImageFormat(t){return m(this,void 0,void 0,(function*(){let e=this,i=e._createTask("GetImageFormat");const n=yield e._readFile(t);return i.params.input=n,e._addTask(i),i.promise}))}readImageInfo(t){return m(this,void 0,void 0,(function*(){let e=this,i=e._createTask("ReadImageInfo");const n=yield e._readFile(t);return i.params.input=n,e._addTask(i),i.promise}))}getMD5(t){return m(this,void 0,void 0,(function*(){let e=this,i=e._createTask("GetMD5");const n=yield e._readFile(t);return i.params.input=n,i.handleResult=function(t,e){return t.MD5},e._addTask(i),i.promise}))}getLicenseInfo(){return m(this,void 0,void 0,(function*(){return this._addTask(this._createTask("GetLicenseInfo"))}))}getAesResult(t){return m(this,void 0,void 0,(function*(){return t=null!=t?t:"",this._addTask(this._createTask("GetAesResult",[t]))}))}saveImage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){return (s=null!=s&&s)?v(this,Le,"m",Oe).call(this,t,void 0,void 0,void 0,1,void 0,void 0,e,i,n):v(this,Le,"m",Oe).call(this,t,void 0,void 0,void 0,void 0,void 0,void 0,e,i,n)}))}readImage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){e=null!=e?e:this._outputType,i=null!=i?i:this._jpegQuality,n=null!=n&&n,s=null!=s&&s;let o=this,r=o._createTask("ReadImage");const a=yield o._readFile(t);r.params.input=[a,e,i,s],r.params.returnType=n?k.RT_BASE64:k.RT_AUTO,r.params.returnBlob=!n,r.handleResult=o._handleImageData,o._addTask(r);const l=yield r.promise;if(l.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete l.srcBuffer;}return l}))}openTiff(t,e){return m(this,void 0,void 0,(function*(){let i=this,n=i._createTask("LoadTiff");e=null!=e&&e;const s=yield i._readFile(t);n.params.input=[s,e],i._addTask(n);const o=yield n.promise;if(o.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete o.srcBuffer;}return o}))}readTiff(t,e,i,n){t=null!=t?t:0,e=null!=e?e:this._outputType,i=null!=i&&i,n=null!=n&&n;let s=this._createTask("ReadTiffPage");return s.params.input=[t,e,n],s.params.returnType=i?k.RT_BASE64:k.RT_AUTO,s.params.returnBlob=!i,s.handleResult=this._handleImageData,this._addTask(s)}readTiffInfos(t){let e=this._createTask("GetTiffPageInfos");return e.params.input=[t],this._addTask(e)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){e=null!=e?e:this._inputType,i=null!=i?i:v(this,Ue,"f"),n=null!=n?n:this._jpegQuality,s=null!=s&&s;let o=this,r=o._createTask("AppendImageToTiff");const a=yield o._readFile(t);return r.params.input=[a,e,i,n,s],r.handleResult=o._handleBooleanResult,o._addTask(r),r.promise}))}addTag(t,e,i){return i=null!=i&&i,this._addTask(this._createTask("AddTagToNextPage",[t,e,i],this._handleBooleanResult))}getTiff(t){let e=this._createTask("GetTiffStream");return e.handleResult=this._handleImageData,e.params.returnType=null!=t?t:k.RT_AUTO,e.params.returnBlob=t!=k.RT_AUTO,this._addTask(e)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,(function(t,e){return t.memoryUsed})))}getMultiPartFile(t,e){return this._addTask(this._createTask("ds_get_file",[t,e],(function(t,e){return t})))}}Ue=new WeakMap,Le=new WeakSet,Oe=function(t,e,i,n,s,o,r,a,l,h){return m(this,void 0,void 0,(function*(){let d=this;e=null!=e?e:this._inputType,i=null!=i?i:0,n=null!=n?n:0,s=null!=s?s:24,o=null!=o?o:96,r=null!=r?r:96,a=null!=a?a:this._outputType,l=null!=l?l:this._jpegQuality,h=null!=h?h:k.RT_AUTO;let c=d._createTask("SaveImage");const u=yield d._readFile(t);return c.params.input=[u,e,i,n,s,o,r,a,l],c.params.returnType=h,c.params.returnBlob=h!=k.RT_BASE64,c.handleResult=d._handleImageData,d._addTask(c),c.promise}))};class Ui extends Bi{constructor(t){super(Ti.ImageReadereModule,t),Ne.add(this),_e.set(this,0),We.set(this,!1),Fe.set(this,null),He.set(this,void 0),Ve.set(this,0),ze.set(this,void 0),je.set(this,void 0);}workerChanged(t){x(this,We,!1,"f"),t&&(Ai.logD("["+this.id+"] worker changed to "+t),x(this,Ve,t,"f"));}setExternalWorkerChanged(t,e){x(this,ze,t,"f"),x(this,je,e,"f");}_workerChanged(t){this.workerChanged(t),v(this,ze,"f")&&v(this,ze,"f").call(this,v(this,je,"f"),this,t);}_canTerminateWork(){return !0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(x(this,We,!1,"f"),v(this,ze,"f")&&v(this,ze,"f").call(this,v(this,je,"f"),this));}getImageFormat(t){return m(this,void 0,void 0,(function*(){let e=this,i=e._createTask("GetImageFormat");const n=yield e._readFile(t.fileSource);return i.params.input=n,e._addTask(i),i.promise}))}readImageInfo(t){return m(this,void 0,void 0,(function*(){let e=this,i=e._createTask("ReadImageInfo");const n=yield e._readFile(t.fileSource);return i.params.input=n,e._addTask(i),i.promise}))}readImage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){e=null!=e?e:this._outputType,i=null!=i?i:this._jpegQuality,n=null!=n&&n,s=null!=s&&s;let o=this,r=o._createTask("ReadImage");const a=yield o._readFile(t.fileSource);r.params.input=[a,e,i,s],r.params.returnType=n?k.RT_BASE64:k.RT_AUTO,r.params.returnBlob=!n,r.handleResult=o._handleImageData,o._addTask(r);const l=yield r.promise;if(l.srcBuffer){let e=Object.prototype.toString.call(t.fileSource);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete l.srcBuffer;}return l}))}openTiff(t,e){return m(this,void 0,void 0,(function*(){e=null!=e&&e;let i,n=this,s=n._createTask("LoadTiff");t!=v(this,Fe,"f")&&(t instanceof Blob?x(n,Fe,t,"f"):(i=yield n._readFile(t),x(n,Fe,Ri.newBlobInChunks(i),"f"))),v(n,Fe,"f").size>1024*Ti.FileReadModeSize*1024?s.params.input=[v(n,Fe,"f"),e]:(i||(i=yield n._readFile(v(n,Fe,"f"))),s.params.input=[i,e]),n._addTask(s);const o=yield s.promise;if(x(n,We,!0,"f"),o.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete o.srcBuffer;}return x(n,He,{pageCount:o.pageCount},"f"),o}))}readTiffPage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){yield v(this,Ne,"m",$e).call(this,t.fileSource),e=null!=e?e:0,i=null!=i?i:this._outputType,n=null!=n&&n,s=null!=s&&s;let o=this._createTask("ReadTiffPage");return o.params.input=[e,i,s],o.params.returnType=n?k.RT_BASE64:k.RT_AUTO,o.params.returnBlob=!n,o.handleResult=this._handleImageData,this._addTask(o)}))}getTiffInfo(t,e){return m(this,void 0,void 0,(function*(){return yield v(this,Ne,"m",$e).call(this,t.fileSource),v(this,He,"f")}))}getTiffPageInfos(t,e){return m(this,void 0,void 0,(function*(){yield v(this,Ne,"m",$e).call(this,t.fileSource);let i=this._createTask("GetTiffPageInfos");return i.params.input=[e],this._addTask(i)}))}}_e=new WeakMap,We=new WeakMap,Fe=new WeakMap,He=new WeakMap,Ve=new WeakMap,ze=new WeakMap,je=new WeakMap,Ne=new WeakSet,$e=function(t){return m(this,void 0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),v(this,We,"f")){if(v(this,Fe,"f")===t)return void Ai.logD("["+this.id+"] already opened in "+this.workerId);yield v(this,Ne,"m",Ge).call(this);}Ai.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(t,!1);}))},Ge=function(){if(x(this,Fe,null,"f"),v(this,We,"f"))return x(this,We,!1,"f"),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))};class Oi{static decode(t){const e={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function i(t){let e,i,n,s,o,r,a,l=[],h=t.length;for(e=0;e<h;e++)s=t.charCodeAt(e),s>>7&255?6==(s>>5&255)?(o=t.charCodeAt(++e),i=(31&s)<<6,n=63&o,a=i|n,l.push(String.fromCharCode(a))):14==(s>>4&255)&&(o=t.charCodeAt(++e),r=t.charCodeAt(++e),i=s<<4|o>>2&15,n=(3&o)<<6|63&r,a=(255&i)<<8|n,l.push(String.fromCharCode(a))):l.push(t.charAt(e));return l.join("")}return function(t){let n,s,o,r,a=[],l=0,h=t.length;for(;l<h;){do{n=e.decodeChars[255&t.charCodeAt(l++)];}while(l<h&&-1==n);if(-1==n)break;do{s=e.decodeChars[255&t.charCodeAt(l++)];}while(l<h&&-1==s);if(-1==s)break;a.push(String.fromCharCode(n<<2|(48&s)>>4));do{if(o=255&t.charCodeAt(l++),61==o)return i(a.join(""));o=e.decodeChars[o];}while(l<h&&-1==o);if(-1==o)break;a.push(String.fromCharCode((15&s)<<4|(60&o)>>2));do{if(r=255&t.charCodeAt(l++),61==r)return i(a.join(""));r=e.decodeChars[r];}while(l<h&&-1==r);if(-1==r)break;a.push(String.fromCharCode((3&o)<<6|r));}return i(a.join(""))}(t)}}!function(t){t[t.render=1]="render",t[t.extractImageOnly=2]="extractImageOnly",t[t.auto=3]="auto",t[t.renderWithAnnot=4]="renderWithAnnot";}(ui||(ui={}));class Ni extends Mi{constructor(t){super(Ti.PdfReaderModule,t),Xe.add(this),Je.set(this,void 0),Ze.set(this,void 0),Ke.set(this,0),ti.set(this,200),ei.set(this,3),ii.set(this,!1),ni.set(this,void 0),si.set(this,null),oi.set(this,""),this._outputType=T.IT_ALL;}static get fonts(){return v(this,Ye,"f",qe)}static addPdfFont(t,e){return m(this,void 0,void 0,(function*(){return v(this,Ye,"m",Qe).call(this,t,e)}))}static getPdfFonts(){return this.fonts?Object.keys(this.fonts):[]}static removeFont(){x(this,Ye,Object.create(null),"f",qe);}workerChanged(t){x(this,ii,!1,"f"),t&&(Ai.logD("["+this.id+"] worker changed to "+t),x(this,Ke,t,"f"));}setExternalWorkerChanged(t,e){x(this,Je,t,"f"),x(this,Ze,e,"f");}_workerChanged(t){this.workerChanged(t),v(this,Je,"f")&&v(this,Je,"f").call(this,v(this,Ze,"f"),this,t);}_canTerminateWork(){return !0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(x(this,ii,!1,"f"),v(this,Je,"f")&&v(this,Je,"f").call(this,v(this,Ze,"f"),this));}getPdfInfo(t){return m(this,void 0,void 0,(function*(){return yield v(this,Xe,"m",ri).call(this,t),v(this,ni,"f")}))}readPage(t,e,i,n,s,o,r,a){return m(this,void 0,void 0,(function*(){return this.readPageEx(t,e,{convertMode:n,renderOptions:{resolution:i}},s,o,r,a)}))}readPageEx(t,e,i,n,s,o,r){return m(this,void 0,void 0,(function*(){yield v(this,Xe,"m",ri).call(this,t),e=null!=e?e:0,n=null!=n?n:this._outputType,o=null!=o&&o,s=null!=s&&s,r=null!=r&&r;let a=i?JSON.stringify(i):"{}",l=this._createTask("ReadPdfPageEx");return l.params.input=[e,a,n,s,r],l.params.returnType=o?k.RT_BASE64:k.RT_AUTO,l.params.returnBlob=!o,l.handleResult=this._handleImageData,this._addTask(l)}))}readPageImageInfos(t,e,i,n){return m(this,void 0,void 0,(function*(){yield v(this,Xe,"m",ri).call(this,t),n=null!=n?n:this._outputType;let s=i?JSON.stringify(i):"{}",o=this._createTask("ReadPageImageInfos");return o.params.input=[e,s,n],this._addTask(o)}))}readPageAnnot(t,e){return m(this,void 0,void 0,(function*(){yield v(this,Xe,"m",ri).call(this,t),e=null!=e?e:0;let i=this._createTask("GetPageAnnot",[e]);return this._addTask(i)}))}findText(t,e,i,n){return m(this,void 0,void 0,(function*(){yield v(this,Xe,"m",ri).call(this,t);let s=0;return n&&(n.matchCase&&(s|=1),n.matchWholeWord&&(s|=2),n.consecutive&&(s|=4)),this._addTask(this._createTask("SearchText",[e,i,s]))}))}getCharInfos(t,e){return m(this,void 0,void 0,(function*(){return yield v(this,Xe,"m",ri).call(this,t),this._addTask(this._createTask("GetPageCharInfos",[e]))}))}getPageInfos(t,e){return m(this,void 0,void 0,(function*(){return yield v(this,Xe,"m",ri).call(this,t),this._addTask(this._createTask("GetPdfPageInfos",[e]))}))}getPdfPageType(t,e){return m(this,void 0,void 0,(function*(){return yield v(this,Xe,"m",ri).call(this,t),this._addTask(this._createTask("GetPageContentType",[e]))}))}UnloadPage(t){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("UnloadPdfPage",[t]))}))}}Ye=Ni,Je=new WeakMap,Ze=new WeakMap,Ke=new WeakMap,ti=new WeakMap,ei=new WeakMap,ii=new WeakMap,ni=new WeakMap,si=new WeakMap,oi=new WeakMap,Xe=new WeakSet,Qe=function(t,e){return m(this,void 0,void 0,(function*(){if("string"==typeof t&&0!==t.length||Promise.reject("The 'name' should be a valid string"),void 0===v(this,Ye,"f",qe)[t])if(e instanceof Blob)v(this,Ye,"f",qe)[t]=e;else {const i=yield ki.read(e);v(this,Ye,"f",qe)[t]=Ri.newBlobInChunks(i);}}))},ri=function(t){var e,i;return m(this,void 0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),v(this,ii,"f")){if(v(this,si,"f")===t.fileSource)return void Ai.logD("["+this.id+"] already opened in "+this.workerId);yield v(this,Xe,"m",ci).call(this);}Ai.logD("["+this.id+"] reopen in worker "+this.workerId),yield v(this,Xe,"m",di).call(this,null!==(e=t.fileSource)&&void 0!==e?e:v(this,si,"f"),null!==(i=t.password)&&void 0!==i?i:v(this,oi,"f"));}))},ai=function(){return m(this,void 0,void 0,(function*(){if(0===v(this,Ke,"f")||v(this,Ke,"f")!==this.workerId){if(Ai.logD("["+this.id+"] load font in worker "+this.workerId),Ti.FontUseFileReadMode.load)return yield v(this,Xe,"m",li).call(this);const t=Ni.fonts,e=Object.keys(t);for(let i of e){const e=t[i],n=yield ki.read(e);n&&(yield v(this,Xe,"m",hi).call(this,i,n));}}}))},li=function(){return m(this,void 0,void 0,(function*(){return this._addTask(this._createTask("SetSystemFonts",[Ni.fonts]))}))},hi=function(t,e){return m(this,void 0,void 0,(function*(){return this._addTask(this._createTask("AddSystemFont",[t,e]))}))},di=function(t,e){return m(this,void 0,void 0,(function*(){yield v(this,Xe,"m",ai).call(this),e=null!=e?e:"";let i,n=this,s=n._createTask("LoadPdf");return t!==v(n,si,"f")||e!==v(n,oi,"f")?(t instanceof Blob?x(n,si,t,"f"):(i=yield n._readFile(t),x(n,si,Ri.newBlobInChunks(i),"f")),x(n,oi,e,"f")):e=v(n,oi,"f"),v(n,si,"f").size>1024*Ti.FileReadModeSize*1024?s.params.input=[v(n,si,"f"),e]:(i||(i=yield n._readFile(v(n,si,"f"))),s.params.input=[i,e]),s.handleResult=function(e,i){if(e.srcBuffer){let i=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=i&&"[object Uint8ClampedArray]"!=i&&delete e.srcBuffer;}let s=Oi.decode(e.infoBase64);try{let t;try{s.replace(new RegExp("\\\\","gi"),"\\\\"),t=JSON.parse(s);}catch(e){t=s;}let i={PdfCount:e.pageCount,PdfInfo:t,isTextBased:e.isTextBased};return e.srcBuffer&&(i.srcBuffer=e.srcBuffer,delete e.srcBuffer),x(n,ii,!0,"f"),x(n,ni,i,"f"),i}catch(e){i.reject({code:A.wasmJsInvalidJson,message:e.message,stack:e.stack});}},n._addTask(s)}))},ci=function(){return m(this,void 0,void 0,(function*(){if(x(this,si,null,"f"),x(this,oi,"","f"),v(this,ii,"f"))return x(this,ii,!1,"f"),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))}))},qe={value:Object.create(null)};const _i=["readPdfPage","readTiffPage","readImage"];class Wi{constructor(t){this.items=[],t&&(this.items=t);}push(t){this.items.push(t);}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(t){let e;-1!==_i.indexOf(t.api)&&this.push(t);for(let i of this.items)i.api===t.api&&i.params[0]===t.params[0]&&i.params[1]===t.params[1]&&(e=i);e?(e.resolves=[...e.resolves,...t.resolves],e.rejects=[...e.rejects,...t.rejects]):this.push(t);}remove(t){-1!==_i.indexOf(t.api)&&this.items.forEach(((e,i)=>{e.api===t.api&&e.params[0]===t.params[0]&&e.params[1]===t.params[1]&&this.items.splice(i,1).forEach((t=>{null==t||t.resolves.forEach((t=>{t(null);}));}));}));}}class Fi{static unload(){if(x(this,pi,[],"f",gi),x(this,pi,new Wi,"f",fi),x(this,pi,!1,"f",vi),Ni.removeFont(),v(this,pi,"f",yi)){Ai.logD("pdfReader destroy");const t=v(this,pi,"f",yi);x(this,pi,null,"f",yi),t.terminate();}if(v(this,pi,"f",mi)){Ai.logD("imageReader destroy");const t=v(this,pi,"f",mi);x(this,pi,null,"f",mi),t.terminate();}}static updateLicense(t,e,i){return m(this,void 0,void 0,(function*(){let n=[];return v(this,pi,"f",yi)&&n.push(v(this,pi,"f",yi).updateLicense(t,e,i)),v(this,pi,"f",mi)&&n.push(v(this,pi,"f",mi).updateLicense(t,e,i)),Promise.all(n)}))}static add(t){return m(this,void 0,void 0,(function*(){v(this,pi,"f",gi).push(t),v(this,pi,"f",yi)||(x(this,pi,new Ni,"f",yi),v(this,pi,"f",yi).setExternalWorkerChanged(v(Fi,pi,"m",bi),this),this.initPdfReaderFunctionMap()),v(this,pi,"f",mi)||(x(this,pi,new Ui,"f",mi),v(this,pi,"f",mi).setExternalWorkerChanged(v(Fi,pi,"m",bi),this),this.initImageReaderFunctionMap());}))}static addFont(t,e){return m(this,void 0,void 0,(function*(){Ni.addPdfFont(t,e);}))}static getFonts(){return Ni.getPdfFonts()}static delete(t){const e=v(this,pi,"f",gi).indexOf(t);if(e>=0&&(v(this,pi,"f",gi).splice(e,1),0===v(this,pi,"f",gi).length&&!v(this,pi,"f",vi))){if(v(this,pi,"f",yi)){Ai.logD("pdfReader destroy");const t=v(this,pi,"f",yi);x(this,pi,null,"f",yi),t.terminate();}if(v(this,pi,"f",mi)){Ai.logD("imageReader destroy");const t=v(this,pi,"f",mi);x(this,pi,null,"f",mi),t.terminate();}}}static createTask(t,e){const i={api:t,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const t of e)i.params.push(t);const n=new Promise((function(t,e){i.resolves.push(t),i.rejects.push(e);}));return i.promise.push(n),v(this,pi,"m",Ci).call(this,i),n}static cancelTask(t,e){if(-1!==_i.indexOf(t)){const i={api:t,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const t of e)i.params.push(t);v(this,pi,"f",fi).remove(i);}}static initPdfReaderFunctionMap(){var t,e,i,n,s,o,r,a;v(this,pi,"f",xi).findPdfText=null===(t=v(this,pi,"f",yi))||void 0===t?void 0:t.findText,v(this,pi,"f",xi).getPdfPageInfos=null===(e=v(this,pi,"f",yi))||void 0===e?void 0:e.getPageInfos,v(this,pi,"f",xi).getPdfInfo=null===(i=v(this,pi,"f",yi))||void 0===i?void 0:i.getPdfInfo,v(this,pi,"f",xi).readPdfPageAnnot=null===(n=v(this,pi,"f",yi))||void 0===n?void 0:n.readPageAnnot,v(this,pi,"f",xi).readPdfPage=null===(s=v(this,pi,"f",yi))||void 0===s?void 0:s.readPageEx,v(this,pi,"f",xi).readPdfPageImageInfos=null===(o=v(this,pi,"f",yi))||void 0===o?void 0:o.readPageImageInfos,v(this,pi,"f",xi).getPdfCharInfos=null===(r=v(this,pi,"f",yi))||void 0===r?void 0:r.getCharInfos,v(this,pi,"f",xi).getPdfPageType=null===(a=v(this,pi,"f",yi))||void 0===a?void 0:a.getPdfPageType;}static initImageReaderFunctionMap(){var t,e,i,n,s,o;v(this,pi,"f",wi).readImage=null===(t=v(this,pi,"f",mi))||void 0===t?void 0:t.readImage,v(this,pi,"f",wi).getImageFormat=null===(e=v(this,pi,"f",mi))||void 0===e?void 0:e.getImageFormat,v(this,pi,"f",wi).readImageInfo=null===(i=v(this,pi,"f",mi))||void 0===i?void 0:i.readImageInfo,v(this,pi,"f",wi).getTiffInfo=null===(n=v(this,pi,"f",mi))||void 0===n?void 0:n.getTiffInfo,v(this,pi,"f",wi).readTiffPage=null===(s=v(this,pi,"f",mi))||void 0===s?void 0:s.readTiffPage,v(this,pi,"f",wi).getTiffPageInfos=null===(o=v(this,pi,"f",mi))||void 0===o?void 0:o.getTiffPageInfos;}}pi=Fi,bi=function(t,e,i){let n=null!=t?t:this;v(n,pi,"f",yi)&&v(n,pi,"f",yi)!==e&&v(n,pi,"f",yi).workerChanged(i),v(n,pi,"f",mi)&&v(n,pi,"f",mi)!==e&&v(n,pi,"f",mi).workerChanged(i);},Ci=function(t){v(this,pi,"f",fi).add(t),v(this,pi,"f",vi)||(x(this,pi,!0,"f",vi),v(this,pi,"m",Pi).call(this));},Si=function(){try{v(this,pi,"f",mi)&&v(this,pi,"f",mi).makeSureWorkerMemoryNotExceed(),v(this,pi,"f",yi)&&v(this,pi,"f",yi).makeSureWorkerMemoryNotExceed();}catch(t){}},Pi=function(){return m(this,void 0,void 0,(function*(){do{if(v(this,pi,"f",fi).isEmpty()||!v(this,pi,"f",yi)||!v(this,pi,"f",mi))break;const t=v(this,pi,"f",fi).pop();if(t)try{let e,i=v(this,pi,"f",xi)[t.api];i?(e=yield v(this,pi,"f",xi)[t.api].apply(v(this,pi,"f",yi),t.params),v(this,pi,"f",yi).makeSureWorkerMemoryNotExceed()):(i=v(this,pi,"f",wi)[t.api],i&&(e=yield v(this,pi,"f",wi)[t.api].apply(v(this,pi,"f",mi),t.params),v(this,pi,"f",mi).makeSureWorkerMemoryNotExceed())),null==t||t.resolves.forEach((t=>{t(e);}));}catch(e){Ai.logD(e),t.retry<1?(t.retry+=1,v(this,pi,"m",Si).call(this),v(this,pi,"f",fi).push(t)):null==t||t.rejects.forEach((t=>{t(e);}));}}while(!v(this,pi,"f",fi).isEmpty());x(this,pi,!1,"f",vi);}))},gi={value:[]},fi={value:new Wi},yi={value:void 0},mi={value:void 0},vi={value:!1},xi={value:Object.create(null)},wi={value:Object.create(null)};class Hi{constructor(){Fi.add(this);}destroy(){Fi.delete(this);}readImage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){return Fi.createTask("readImage",[t,e,i,n,s])}))}getImageFormat(t){return m(this,void 0,void 0,(function*(){return Fi.createTask("getImageFormat",[t])}))}readImageInfo(t){return m(this,void 0,void 0,(function*(){return Fi.createTask("readImageInfo",[t])}))}cancelReadImage(t,e){return Fi.cancelTask("readImage",[t,e])}getTiffInfo(t){return m(this,void 0,void 0,(function*(){return Fi.createTask("getTiffInfo",[t,!1])}))}readTiffPage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){return Fi.createTask("readTiffPage",[t,e,i,n,s])}))}cancelReadTiffPage(t,e){return Fi.cancelTask("readTiffPage",[t,e])}getTiffPageInfos(t,e){return m(this,void 0,void 0,(function*(){return Fi.createTask("getTiffPageInfos",[t,e])}))}}var Vi,zi,ji,$i,Gi,Xi,Yi,qi,Ji,Zi,Qi,Ki,tn,en,nn,sn,on,rn,an,ln;!function(t){t[t.NearestNeighbour=1]="NearestNeighbour",t[t.Bilinear=2]="Bilinear",t[t.Bicublic=3]="Bicublic",t[t.BestQuality=5]="BestQuality";}(ji||(ji={}));class hn extends Bi{constructor(t){super(Ti.ImageProcModule,t),Vi.add(this);}initImage(t,e,i,n,s){return m(this,void 0,void 0,(function*(){e=null!=e&&e,i=null!=i?i:0,n=null!=n?n:0,s=null!=s&&s;let o=this,r=o._createTask("InitImageObject");if(r.params.input=[t,i,n],e||s)e?r.params.input.push(T.IT_RGBA):r.params.input.push(T.IT_BGRA),o._addTask(r);else {const e=yield o._readFile(t);r.params.input[0]=e,r.params.input.push(T.IT_ALL),o._addTask(r);}const a=yield r.promise;if(a.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete a.srcBuffer;}return a}))}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(t,e,i){var n,s,o,r,a,l,h,d,c,u;let p=this;e=null!=e?e:{},i=null!=i?i:{};let g=p._createTask("Filter");if(g.params.input=[],g.params.input.push(t),"toBW"===t)g.params.input.push(JSON.stringify(v(p,Vi,"m",zi).call(p,e)));else if("toGray"===t)g.params.input.push(JSON.stringify(v(p,Vi,"m",zi).call(p,e)));else if("removeShadow"===t)g.params.input.push(JSON.stringify(v(p,Vi,"m",zi).call(p,e)));else if("enhance"===t)g.params.input.push(JSON.stringify(v(p,Vi,"m",zi).call(p,e)));else if("invert"===t)g.params.input.push(JSON.stringify(v(p,Vi,"m",zi).call(p,e)));else if("brightnessAndContrast"===t){let t=null!==(n=e.brightness)&&void 0!==n?n:0,i=null!==(s=e.contrast)&&void 0!==s?s:0;g.params.input.push(t),g.params.input.push(i);}let f=null!==(o=i.returnType)&&void 0!==o?o:T.IT_JPG,y=null!==(r=i.jpegQuality)&&void 0!==r?r:this._jpegQuality,m=null!==(a=i.bRGBA)&&void 0!==a&&a,x=null!==(l=i.bitDepth)&&void 0!==l?l:0,w=null!==(h=i.xdpi)&&void 0!==h?h:0,b=null!==(d=i.ydpi)&&void 0!==d?d:0,C=null===(c=i.returnBlob)||void 0===c||c;f=m&&null==f?T.IT_JPG:null!=f?f:T.IT_ALL;let S=null!==(u=i.is1BitTo8Bit)&&void 0!==u&&u;return g.params.input.push([f,x,w,b,!1,y,!1,S]),g.params.returnBlob=C,g.handleResult=this._handleImageData,p._addTask(g),g.promise}rotate(t,e,i,n){return t=null!=t?t:0,i=null!=i&&i,n=null!=n?n:ji.Bicublic,e=null!=e?e:"FFFFFF",(t<0||t>360)&&(t%=360)<0&&(t+=360),this._addTask(this._createTask("RotateEx",[t,i,n,e],this._handleBooleanResult))}flip(t){t=null!=t?t:1;let e=this._createTask("");return e.handleResult=this._handleBooleanResult,1===t?e.func="Flip":-1===t&&(e.func="Mirror"),this._addTask(e),e.promise}erase(t,e,i,n,s){let o=this,r=o._createTask("Erase");return r.handleResult=this._handleBooleanResult,r.params.input=[t,e,i,n,JSON.stringify(v(o,Vi,"m",zi).call(o,s))],o._addTask(r),r.promise}crop(t,e,i,n){return this._addTask(this._createTask("Crop",[t,e,i,n],this._handleBooleanResult))}resize(t,e,i){return i=null!=i?i:ji.BestQuality,this._addTask(this._createTask("ChangeImageSize",[t,e,i],this._handleBooleanResult))}toGrayscaleLevel(t){(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let e={};return 2===t?(e.clean=!0,e.sigma=3,e.scaleLimit=720,e.alpha=1.05):3===t&&(e.clean=!0,e.sigma=5,e.scaleLimit=1080,e.alpha=1.05),this.toGrayscale(e)}toGrayscale(t){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(v(this,Vi,"m",zi).call(this,t)),this._handleBooleanResult))}toBinaryLevel(t,e){(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let i={};return null!=t&&(t?i.method="adaptiveThreshold":(i.method="threshold",2===e?(i.clean=!0,i.sigma=3,i.scaleLimit=720,i.alpha=1.05):3===e&&(i.clean=!0,i.sigma=5,i.scaleLimit=1080,i.alpha=1.05))),this.toBinary(i)}toBinary(t){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(v(this,Vi,"m",zi).call(this,t)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(t,e){return this._addTask(this._createTask("SetImageWidth",[t,JSON.stringify(v(this,Vi,"m",zi).call(this,e))],this._handleBooleanResult))}setImageHeight(t,e){return this._addTask(this._createTask("SetImageHeight",[t,JSON.stringify(v(this,Vi,"m",zi).call(this,e))],this._handleBooleanResult))}setDPI(t,e,i,n,s,o){return s=null!=s&&s,o=null!=o?o:ji.Bilinear,this._addTask(this._createTask("SetDPI",[t,e,i,n,s,o],this._handleBooleanResult))}getImage(t,e,i,n,s,o,r,a,l){t=null!=t?t:this._jpegQuality,e=null==e||e,n=null!=n?n:0,s=null!=s?s:0,o=null!=o?o:0,r=null==r||r,a=(i=null!=i&&i)&&null==a?T.IT_JPG:null!=a?a:T.IT_ALL,l=null!=l&&l;let h=this._createTask("GetCurrentImage");return h.params.input=[a,n,s,o,!1,t,e,l],h.params.returnBlob=r,h.handleResult=this._handleImageData,this._addTask(h)}getSkewAngle(t){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(v(this,Vi,"m",zi).call(this,t))],(function(t,e){return t.skewAngle})))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(t,e,i,n,s){return t=null!=t?t:ji.Bilinear,e=null!=e?e:75,i=null!=i?i:100,n=null!=n?n:0,s=null!=s?s:"",this._addTask(this._createTask("DocumentDetect",[t,e/100,i,n/255,s,"1"]))}perspective(t,e,i,n,s,o,r,a){return this._addTask(this._createTask("Perspective",[t,e,i,n,s,o,r,a],this._handleBooleanResult))}changeBrightness(t,e){return t=null!=t?t:0,0!=(e=null!=e?e:1)&&1!=e&&(e=0),1===e?this._addTask(this._createTask("ChangeBrightnessAndContrast",[t,0],this._handleBooleanResult)):this._addTask(this._createTask("ChangeBrightness",[Math.floor(t/1e3*255)],this._handleBooleanResult))}changeContrast(t,e){return t=null!=t?t:0,0!=(e=null!=e?e:1)&&1!=e&&(e=0),1===e?this._addTask(this._createTask("ChangeBrightnessAndContrast",[0,t],this._handleBooleanResult)):this._addTask(this._createTask("ChangeContrast",[1+t/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(t,e){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("ChangeBrightnessAndContrast",[t,e],this._handleBooleanResult))}removeShadowLevel(t,e){e=null!=e?e:1.05,(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let i={};return 1===t&&(i.sigma=3,i.scaleLimit=720,i.alpha=e),2===t?(i.sigma=5,i.scaleLimit=1080,i.alpha=e):3===t&&(i.sigma=10,i.scaleLimit=0,i.alpha=e),this.removeShadow(i)}removeShadow(t){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(v(this,Vi,"m",zi).call(this,t))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],(function(t,e){return t.blurryScore})))}drawQuadrangle(t,e,i,n,s,o,r,a,l){return this._addTask(this._createTask("DrawQuadrangle",[t,e,i,n,s,o,r,a,JSON.stringify(v(this,Vi,"m",zi).call(this,l))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}Vi=new WeakSet,zi=function(t){let e={};if(null!=t&&"object"==typeof t)for(let i in t)e[i]=t[i];return e};class dn{constructor(){Fi.add(this);}destroy(){Fi.delete(this);}static addPdfFont(t,e){return m(this,void 0,void 0,(function*(){return Fi.addFont(t,e)}))}static getPdfFonts(){return Fi.getFonts()}getPdfInfo(t){return m(this,void 0,void 0,(function*(){return Fi.createTask("getPdfInfo",[t])}))}getPdfPageType(t,e){return m(this,void 0,void 0,(function*(){return Fi.createTask("getPdfPageType",[t,e])}))}readPage(t,e,i,n,s,o,r,a){return m(this,void 0,void 0,(function*(){return this.readPageEx(t,e,{convertMode:n,renderOptions:{resolution:i}},s,o,r,a)}))}readPageEx(t,e,i,n,s,o,r){return m(this,void 0,void 0,(function*(){return Fi.createTask("readPdfPage",[t,e,i,n,s,o,r])}))}cancelReadPage(t,e){return Fi.cancelTask("readPdfPage",[t,e])}readPageImageInfos(t,e,i,n,s,o,r){return m(this,void 0,void 0,(function*(){return Fi.createTask("readPdfPageImageInfos",[t,e,i,n,s,o,r])}))}readPageAnnot(t,e){return m(this,void 0,void 0,(function*(){return Fi.createTask("readPdfPageAnnot",[t,e])}))}findText(t,e,i,n){return m(this,void 0,void 0,(function*(){return Fi.createTask("findPdfText",[t,e,i,n])}))}getCharInfos(t,e){return m(this,void 0,void 0,(function*(){return Fi.createTask("getPdfCharInfos",[t,e])}))}getPageInfos(t,e){return m(this,void 0,void 0,(function*(){return Fi.createTask("getPdfPageInfos",[t,e])}))}}!function(t){t[t.auto=0]="auto",t[t.store=1]="store";}(qi||(qi={}));class cn extends Bi{constructor(t){super(Ti.PdfWriterModule,t),$i.add(this);}initPdfSetting(t){return m(this,void 0,void 0,(function*(){let e=this,i=e._createTask("CreateDocument");return i.params.input=[JSON.stringify(v(e,$i,"m",Yi).call(e,t))],i.handleResult=this._handleBooleanResult,yield v(this,$i,"m",Gi).call(this),e._addTask(i)}))}appendPage(t,e){return m(this,void 0,void 0,(function*(){let i=this,n=i._createTask("InsertImagePage");e=null!=e&&e;const s=yield i._readFile(t);return n.params.input=[s,-1,e],n.handleResult=i._handleBooleanResult,i._addTask(n),n.promise}))}insertPage(t,e,i){return m(this,void 0,void 0,(function*(){let n=this,s=n._createTask("InsertImagePage");i=null!=i&&i;const o=yield n._readFile(t);return s.params.input=[o,e,i],s.handleResult=n._handleBooleanResult,n._addTask(s),s.promise}))}writePdf(t){return m(this,void 0,void 0,(function*(){let e=this._createTask("GetCurrentPdf");return e.params.returnType=null!=t?t:k.RT_AUTO,e.params.returnBlob=t!=k.RT_AUTO,e.handleResult=this._handleImageData,this._addTask(e)}))}insertBlankPage(t,e,i){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:595,i=null!=i?i:842,this._addTask(this._createTask("InsertBlankPage",[t,e,i]))}))}deletePage(t){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("DeletePdfPage",[t],this._handleBooleanResult))}))}pageSetRotation(t,e){return m(this,void 0,void 0,(function*(){t=null!=t?t:0,0!=(e=((e=null!=e?e:0)%360+360)%360)&&90!==e&&180!==e&&270!==e&&(e=0);let i=this._createTask("SetPageRotation");return i.params.input=[t,e],i.handleResult=this._handleBooleanResult,this._addTask(i)}))}pageSetCropBox(t,e,i,n,s){return m(this,void 0,void 0,(function*(){t=null!=t?t:0,e=null!=e?e:0,i=null!=i?i:0,(n=null!=n?n:e)<e&&(n=e),(s=null!=s?s:i)<i&&(s=i);let o=this._createTask("SetPageCropBox");return o.params.input=[t,e,i,n,s],o.handleResult=this._handleBooleanResult,this._addTask(o)}))}pageSetMediaBox(t,e,i,n,s){return m(this,void 0,void 0,(function*(){t=null!=t?t:0,e=null!=e?e:0,i=null!=i?i:0,(n=null!=n?n:e)<e&&(n=e),(s=null!=s?s:i)<i&&(s=i);let o=this._createTask("SetPageMediaBox");return o.params.input=[t,e,i,n,s],o.handleResult=this._handleBooleanResult,this._addTask(o)}))}pageAddImage(t,e,i,n,s,o){return m(this,void 0,void 0,(function*(){o=null!=o&&o;let r=this,a=r._createTask("PageAddImage"),l=JSON.stringify(v(r,$i,"m",Yi).call(r,i));const h=yield r._readFile(t);return a.params.input=[h,e,l,n,s,o],a.handleResult=r._handleBooleanResult,r._addTask(a),a.promise}))}pageAddText(t,e){return m(this,void 0,void 0,(function*(){let i=JSON.stringify(e);return this._addTask(this._createTask("PageAddText",[t,i],this._handleBooleanResult))}))}pageAddPath(t,e){return m(this,void 0,void 0,(function*(){let i=JSON.stringify(e);return this._addTask(this._createTask("PageAddPath",[t,i],this._handleBooleanResult))}))}pageClearObjects(t){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("PageClearObjects",[t],this._handleBooleanResult))}))}pageSetAnnot(t,e){return m(this,void 0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t);})),i+="]"):i=JSON.stringify(e),this._addTask(this._createTask("SetPageAnnot",[t,i],this._handleBooleanResult))}))}pageFlattenAnnot(t,e){return m(this,void 0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t);})),i+="]"):i=JSON.stringify(e),this._addTask(this._createTask("FlattenPageAnnot",[t,i],this._handleBooleanResult))}))}getFontFromTextObject(t){return t.fontName?t.fontName:""}getFontFromAnnot(t){let e=[];t&&t.normalAppearance&&t.normalAppearance.objs&&t.normalAppearance.objs.forEach((t=>{if("text"===t.type){const i=t,n=this.getFontFromTextObject(i);n&&e.push(n);}}));const i=new Set(e);return e=[...i],e}getFontFromAnnots(t){let e=[];Array.isArray(t)?t.forEach((t=>{const i=this.getFontFromAnnot(t);e=e.concat(i);})):e=this.getFontFromAnnot(t);const i=new Set(e);return e=[...i],e}pageAddAnnot(t,e){return m(this,void 0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t);})),i+="]"):i=JSON.stringify(e),this._addTask(this._createTask("PageAddAnnot",[t,i],this._handleBooleanResult))}))}pageDeleteAnnot(t,e){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("DeletePageAnnot",[t,e],this._handleBooleanResult))}))}pageDeleteAnnotByTypes(t,e){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:"",this._addTask(this._createTask("DeletePageAnnotByTypes",[t,e],this._handleBooleanResult))}))}pageDeleteAnnotByNames(t,e){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:"",this._addTask(this._createTask("DeletePageAnnotByNames",[t,e],this._handleBooleanResult))}))}mergePdf(t,e,i,n,s){return m(this,void 0,void 0,(function*(){n=null!=n?n:-1,i=null!=i?i:[],e=null!=e?e:"",s=null!=s&&s;let o,r=this,a=r._createTask("MergePdfPages");return o=t instanceof Blob?t:yield r._readFile(t),a.params.input=[o,n,e,i,s],a.handleResult=r._handleBooleanResult,r._addTask(a),a.promise}))}pageFlatten(t,e){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("PageFlatten",[t,e],this._handleBooleanResult))}))}GetFontInfo(t){return m(this,void 0,void 0,(function*(){const e=yield this._readFile(t);return this._addTask(this._createTask("GetFontInfo",[e]))}))}IfFontsExist(t){return m(this,void 0,void 0,(function*(){let e=JSON.stringify(t);return yield v(this,$i,"m",Gi).call(this),this._addTask(this._createTask("IfFontsExist",[e]))}))}UnloadPage(t){return m(this,void 0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("UnloadPdfPage",[t]))}))}}$i=new WeakSet,Gi=function(){return m(this,void 0,void 0,(function*(){if(Ai.logD("["+this.id+"] load font in worker "+this.workerId),0===Object.keys(Ni.fonts).length)return null;if(Ti.FontUseFileReadMode.save)return this._addTask(this._createTask("LoadFonts",[Ni.fonts]));const t=Ni.fonts,e=Object.keys(t);for(let i of e){const e=t[i],n=yield ki.read(e);n&&(yield v(this,$i,"m",Xi).call(this,i,n));}}))},Xi=function(t,e){return m(this,void 0,void 0,(function*(){return this._addTask(this._createTask("LoadFont",[e,t]))}))},Yi=function(t){let e={};if(null!=t&&"object"==typeof t)for(let i in t)e[i]=t[i];return e},function(t){t.Text="Text",t.Link="Link",t.FreeText="FreeText",t.Line="Line",t.Square="Square",t.Circle="Circle",t.Polygon="Polygon",t.PolyLine="PolyLine",t.Hignlight="Highlight",t.Underline="Underline",t.Squiggly="Squiggly",t.StrikeOut="StrikeOut",t.Stamp="Stamp",t.Caret="Caret",t.Ink="Ink",t.Popup="Popup";}(Ji||(Ji={})),function(t){t.None="none",t.Invisible="invisible",t.Hidden="hidden",t.Print="print",t.NoZoom="nozoom",t.NoRotate="norotate",t.NoView="noview",t.ReadOnly="readonly",t.Locked="locked",t.ToggleNoView="togglenoview",t.LockedContents="lockedcontents";}(Zi||(Zi={})),function(t){t.Solid="S",t.Dashed="D",t.Beveled="B",t.Insert="I",t.Underline="U";}(Qi||(Qi={})),function(t){t.NoEffect="S",t.Cloudy="C";}(Ki||(Ki={})),function(t){t.Comment="Comment",t.Key="Key",t.Note="Note",t.Help="Help",t.NewParagraph="NewParagraph",t.Paragraph="Paragraph",t.Insert="Insert";}(tn||(tn={})),function(t){t.Marked="Marked",t.Review="Review";}(en||(en={})),function(t){t.Accepted="Accepted",t.Rejected="Rejected",t.Cancelled="Cancelled",t.Completed="Completed",t.None="None";}(nn||(nn={})),function(t){t.None="None",t.Square="Square",t.Circle="Circle",t.Diamond="Diamond",t.OpenArrow="OpenArrow",t.ClosedArrow="ClosedArrow",t.Butt="Butt",t.ROpenArrow="ROpenArrow",t.RClosedArrow="RClosedArrow",t.Slash="Slash";}(sn||(sn={})),function(t){t[t.LeftJustified=0]="LeftJustified",t[t.Centered=1]="Centered",t[t.RightJustified=2]="RightJustified";}(on||(on={})),function(t){t.FreeText="FreeText",t.FreeTextCallout="FreeTextCallout",t.FreeTextTypeWriter="FreeTextTypeWriter";}(rn||(rn={})),function(t){t.LineArrow="LineArrow",t.LineDimension="LineDimension";}(an||(an={})),function(t){t.Approved="Approved",t.Experimental="Experimental",t.NotApproved="NotApproved",t.Asls="Asls",t.Expired="Expired",t.NotForPublicRelease="NotForPublicRelease",t.Confidential="Confidential",t.Final="Final",t.Sold="Sold",t.Departmental="Departmental",t.ForComment="ForComment",t.TopSecret="TopSecret",t.Draft="Draft",t.ForPublicRelease="ForPublicRelease";}(ln||(ln={}));const un="undefined"==typeof self,pn=un?{}:self;let gn,fn,yn,mn,vn;"undefined"!=typeof navigator&&(gn=navigator,fn=gn.userAgent,yn=gn.platform,mn=gn.mediaDevices),function(){if(!un){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:gn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:yn,search:"Win"},Mac:{str:yn},Linux:{str:yn}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||fn,r=s.search||e,a=s.verStr||fn,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||fn,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=fn.indexOf("Windows NT")&&(s="HarmonyOS"),vn={browser:i,version:n,OS:s};}un&&(vn={browser:"ssr",version:0,OS:"ssr"});}(),mn&&mn.getUserMedia;const xn="Chrome"===vn.browser&&vn.version>66||"Safari"===vn.browser&&vn.version>13||"OPR"===vn.browser&&vn.version>43||"Edge"===vn.browser&&vn.version>15,wn="\\s*([+-]?\\d+)\\s*",bn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sn=/^#([0-9a-f]{3,8})$/,Pn=new RegExp(`^rgb\\(${wn},${wn},${wn}\\)$`),An=new RegExp(`^rgb\\(${Cn},${Cn},${Cn}\\)$`),Tn=new RegExp(`^rgba\\(${wn},${wn},${wn},${bn}\\)$`),kn=new RegExp(`^rgba\\(${Cn},${Cn},${Cn},${bn}\\)$`),Dn=new RegExp(`^hsl\\(${bn},${Cn},${Cn}\\)$`),En=new RegExp(`^hsla\\(${bn},${Cn},${Cn},${bn}\\)$`),In={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let Rn=class{constructor(t,e,n,s){i(this,"r",void 0),i(this,"g",void 0),i(this,"b",void 0),i(this,"opacity",void 0),this.r=t,this.g=e,this.b=n,this.opacity=s;}};function Mn(t){return new Rn(t>>16&255,t>>8&255,255&t,1)}function Bn(t,e,i,n){return n<=0&&(t=NaN,e=NaN,i=NaN),new Rn(t,e,i,n)}function Ln(t,e,i,n){return n<=0?(t=NaN,e=NaN,i=NaN):i<=0||i>=1?(t=NaN,e=NaN):e<=0&&(t=NaN),{h:t,s:e,l:i,opacity:n}}function Un(t,e,i){return t<60?(e+(i-e)*t)/60*255:t<180?255*i:t<240?(e+(i-e)*(240-t))/60*255:255*e}function On(t){const e=t.h<0?t.h%360+360:t.h%360,i=Number.isNaN(e)||Number.isNaN(t.s)?0:t.s,{l:n}=t,s=n+(n<.5?n:1-n)*i,o=2*n-s;return new Rn(Un(e>=240?e-240:e+120,o,s),Un(e,o,s),Un(e<120?e+240:e-120,o,s),t.opacity)}const Nn=t=>{let e,i;if(t=`${t}`.trim().toLowerCase(),Sn.exec(t))switch(e=Sn.exec(t),i=e[1].length,e=parseInt(e[1],16),i){case 6:return Mn(e);case 3:return new Rn(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1);case 8:return Bn(e>>24&255,e>>16&255,e>>8&255,(255&e)/255);case 4:return Bn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255);default:return null}return Pn.exec(t)?(e=Pn.exec(t),new Rn(e[1],e[2],e[3],1)):An.exec(t)?(e=An.exec(t),new Rn(255*e[1]/100,255*e[2]/100,255*e[3]/100,1)):Tn.exec(t)?(e=Tn.exec(t),Bn(e[1],e[2],e[3],e[4])):kn.exec(t)?(e=kn.exec(t),Bn(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4])):Dn.exec(t)?(e=Dn.exec(t),On(Ln(e[1],e[2]/100,e[3]/100,1))):En.exec(t)?(e=En.exec(t),On(Ln(e[1],e[2]/100,e[3]/100,e[4]))):In.hasOwnProperty(t)?Mn(In[t]):"transparent"===t?new Rn(NaN,NaN,NaN,0):null},_n=t=>t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)),Wn=t=>Object.prototype.toString.call(t),Fn=t=>Array.isArray?Array.isArray(t):"[object Array]"===Wn(t),Hn=t=>null!==t&&"[object Object]"===Wn(t),Vn=t=>{let e=null;return Fn(t)&&(e||(e=[]),t.forEach((t=>{e.push(Vn(t));}))),Hn(t)&&(e||(e={}),Object.keys(t).forEach((i=>{e[i]=Vn(t[i]);}))),e||t},zn=t=>void 0===t,jn=(t,e)=>{var i;t=null!==(i=t)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";const n=zn(e)?new Date:new Date(e),s={"M+":(n.getMonth()+1).toString(),"d+":n.getDate().toString(),"h+":n.getHours().toString(),"m+":n.getMinutes().toString(),"s+":n.getSeconds().toString(),"q+":Math.floor((n.getMonth()+3)/3).toString(),S:n.getMilliseconds().toString()};return /(y+)/.test(t)&&(t=t.replace(RegExp.$1,`${n.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(s).forEach((e=>{new RegExp(`(${e})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?s[e]:`00${s[e]}`.substring(`${s[e]}`.length)));})),t},$n=t=>"[object ArrayBuffer]"===Wn(t),Gn=t=>"[object Blob]"===Wn(t),Xn=t=>"[object Boolean]"===Wn(t),Yn=t=>"function"==typeof t,qn=()=>"ontouchstart"in document.documentElement,Jn=t=>"number"==typeof t&&!Number.isNaN(t),Zn=t=>"string"==typeof t,Qn=(t,e,i)=>Math.min(Math.max(t,e),i);let Kn=0;const ts=()=>(Kn+=1,`${(new Date).getTime().toString(36)}${Kn.toString(36)}`),es=t=>{const e=window.URL||window.webkitURL;let i="string";return Zn(t)?i="string":Gn(t)?(i="blob",t=e.createObjectURL(t)):($n(t)||Fn(t))&&(i="blob",t=e.createObjectURL(new Blob([t]))),{type:i,data:t}};function is(t){return "object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}let ns=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i(this,"prefix",void 0),i(this,"postfix",void 0),i(this,"isDestroyed",!1),i(this,"uid",ts()),i(this,"cacheEvents",void 0),i(this,"events",void 0),i(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=t,this.postfix=e;}static create(e,i){return new t(e,i)}save(){this.isCached=!0;}restore(){this.isCached=!1,this.cacheEvents.forEach((t=>{let{eventName:e,param:i}=t;this.emit(e,...i);})),this.cacheEvents.length=0;}destroy(){if(!this.isDestroyed){for(const t in this.events)if(Object.prototype.hasOwnProperty.call(this.events,t)){const e=this.events[t];e&&e.slice().forEach((t=>{let{name:e,fn:i,context:n,once:s}=t;this.off(e,i,n,s);}));}this.events={},this.isDestroyed=!0;}}on(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:s}=this,o={name:t=this.format(t),uid:ts(),context:i,once:n,fn:e};return s[t]||(s[t]=[]),s[t].indexOf(o)<0&&s[t].push(o),o}once(t,e,i){return this.on(t,e,i,!0)}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(this.isCached)return this.cacheEvents.push({eventName:t,param:i}),!0;const{events:s}=this,o=s[t=this.format(t)];return !(!o||!o.length||(o.slice().forEach((t=>{let{fn:e,context:n}=t;e.call(n||null,...i);})),o.slice().forEach((e=>{let{fn:i,context:n,once:s}=e;s&&this.off(t,i,n,s);})),0))}off(t,e,i,n){const{events:s}=this,o=s[t=this.format(t)];if(!o)return !1;if(!arguments.length)return o.length=0,!0;for(let t=o.length-1;t>=0;t--){const s=o[t];e&&s.fn!==e||i&&s.context!==i||n&&s.once!==n||o.splice(t,1);}return !0}removeAllEventListeners(t){if(t){t=this.format(t);const e=this.cacheEvents.findIndex((e=>e.eventName===t));e>-1&&this.cacheEvents.splice(e,1),this.events[t]&&delete this.events[t];}else this.cacheEvents=[],this.events={};}getAllEvents(){return this.events}format(t){return `${this.prefix||""}${t}${this.postfix||""}`}};const ss="default";let os=class t{constructor(){i(this,"emitter",new ns);}static create(){return new t}on(t){this.emitter.on(ss,t);}emit(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.emitter.emit(ss,...e);}off(t){this.emitter.off(ss,t);}};function rs(){return new os}class as{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,"x",void 0),i(this,"y",void 0),i(this,"z",void 0),this.x=t,this.y=e,this.z=n;}static fromPoint(t){return new as(t.x,t.y,t.z)}static fromTwoPoint(t,e){var i,n,s,o,r,a;return new as((null!==(i=e.x)&&void 0!==i?i:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(s=e.y)&&void 0!==s?s:0)-(null!==(o=t.y)&&void 0!==o?o:0),(null!==(r=e.z)&&void 0!==r?r:0)-(null!==(a=t.z)&&void 0!==a?a:0))}static fromValue(t,e,i){return new as(t,e,i)}setFromVector(t){var e;this.x=t.x,this.y=t.y,this.z=null!==(e=t.z)&&void 0!==e?e:0;}clone(){return new as(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(t){var e;return this.x*t.x+this.y*t.y+this.z*(null!==(e=t.z)&&void 0!==e?e:0)}projectionTo(t){const e=Math.hypot(t.x,t.y,t.z);return this.dot(t)/e}angle(t){const e=this.norm()*Math.hypot(t.x,t.y,t.z),i=e&&this.dot(t)/e;return Math.acos(Qn(i,-1,1))}equals(t){var e;return this.x===t.x&&this.y===t.y&&this.z===(null!==(e=t.z)&&void 0!==e?e:0)}distance(t){var e;return Math.hypot(this.x-t.x,this.y-t.y,this.z-(null!==(e=t.z)&&void 0!==e?e:0))}lerp(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:n,y:s,z:o}=this;return new as(n+i*(t.x-n),s+i*(t.y-s),o+i*((null!==(e=t.z)&&void 0!==e?e:0)-o))}normalize(){const t=this,e=t.norm();return t.x/=e,t.y/=e,t.z/=e,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(t){const e=this;return {x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}}function ls(t,e){return as.fromTwoPoint(t,e)}class hs{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,"x",void 0),i(this,"y",void 0),i(this,"z",void 0),this.x=t,this.y=e,this.z=n;}static fromPoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new hs(t.x,t.y,t.z)}matrixTransform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:e,y:i,z:n}=this,{m11:s,m21:o,m31:r,m41:a,m12:l,m22:h,m32:d,m42:c,m13:u,m23:p,m33:g,m43:f,m14:y,m24:m,m34:v,m44:x}=t,w=y*e+m*i+v*n+x;return ds({x:(s*e+o*i+r*n+a)/w,y:(l*e+h*i+d*n+c)/w,z:(u*e+p*i+g*n+f)/w})}setFromPoint(t){return this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this}clone(){return ds(this)}equals(t){const{x:e=0,y:i=0,z:n=0}=t,s=this;return s.x===e&&s.y===i&&s.z===n}distanceTo(t){const{x:e=0,y:i=0,z:n=0}=t,s=this;return Math.hypot(s.x-e,s.y-i,s.z-n)}lerpTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i=0,y:n=0,z:s=0}=t,o=this;return ds({x:o.x+e*(i-o.x),y:o.y+e*(n-o.y),z:o.z+e*(s-o.z)})}footPointInSegment(t,e){const i=ls(t,this),n=ls(t,e),s=n.norm(),o=ds(t);if(0===s)return o;const r=i.projectionTo(n)/s;return o.lerpTo(e,r)}perpendicularToSegment(t,e){const i=this.footPointInSegment(t,e);return this.distanceTo(i)}}function ds(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Jn(t)?new hs(t,e,i):new hs(t.x,t.y,t.z)}function cs(t,e){return ((t.x-e.x)**2+(t.y-e.y)**2)**.5}class us{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;i(this,"x",0),i(this,"y",0),i(this,"left",0),i(this,"top",0),i(this,"right",0),i(this,"bottom",0),i(this,"width",0),i(this,"height",0),this.update(t,e,n,s);}update(t,e,i,n){this.x=t,this.y=e,this.left=t,this.top=e,this.right=t+i,this.bottom=e+n,this.width=i,this.height=n;}toJSON(){}}const ps=new class{constructor(){i(this,"tasks",[]);}createTimer(t,e){const i=ts();return this.tasks.push({uid:i,callback:t,time:e}),this.executeTimer(i),i}executeTimer(t){const e=this.tasks.find((e=>e.uid===t));if(!e)return;const i=()=>{e.callback(),null!==e.timer&&(e.timer=setTimeout(i,e.time));};e.timer=setTimeout(i,e.time);}clearTimer(t){const e=this.tasks.findIndex((e=>e.uid===t));e>-1&&(clearTimeout(this.tasks[e].timer),this.tasks[e].timer=null,this.tasks.splice(e,1));}};function gs(t,e,i,n){if(function(t,e,i,n){return Math.min(t[0],e[0])<=Math.max(i[0],n[0])&&Math.min(i[0],n[0])<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=Math.max(i[1],n[1])&&Math.min(i[1],n[1])<=Math.max(t[1],e[1])}(t,e,i,n)&&function(t,e,i,n){let s=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return !((s^o)>=0&&0!==s&&0!==o||(s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),o=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),(s^o)>=0&&0!==s&&0!==o))}(t,e,i,n)){let s=(n[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-n[1]),o=(t[1]-i[1])*(e[0]-t[0])*(n[0]-i[0])+i[0]*(n[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(n[0]-i[0]);if(0===s||0===o){const s=fs(t,e),o=fs(i,n),r=s[0],a=s[1],l=o[0],h=o[1];if(a[0]===l[0]&&a[1]===l[1])return a;if(r[0]===h[0]&&r[1]===h[1])return r;if(ys(a,o)&&ys(l,s))return [l,a];if(ys(r,o)&&ys(h,s))return [r,h];if(ys(r,o)&&ys(a,o))return [r,a];if(ys(l,o)&&ys(h,o))return [l,h]}const r=o/s;return s=(t[0]-e[0])*(n[1]-i[1])-(e[1]-t[1])*(i[0]-n[0]),o=e[1]*(t[0]-e[0])*(n[1]-i[1])+(n[0]-e[0])*(n[1]-i[1])*(t[1]-e[1])-n[1]*(i[0]-n[0])*(e[1]-t[1]),[r,o/s]}return !1}function fs(t,e){return t[0]===e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]}function ys(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]}function ms(t){const e=[];let i=null;const n=t.slice(0,8).concat(t[0],t[1]);for(let t=0;t<4;t++){const s=n[2*(t+1)+1]-n[2*t+1],o=n[2*(t+1)]-n[2*t];i=0===s&&0===o?0:s/o,e.push(i);}return e}function vs(t){const[e,i,n,s,o,r,a,l]=t,h=(a-e)*(s-i)-(l-i)*(n-e),d=(e-n)*(r-s)-(i-s)*(o-n),c=(n-o)*(l-r)-(s-r)*(a-o),u=(o-a)*(i-l)-(r-l)*(e-a);if(h*d*c*u<0)return !1;const p=t.slice().concat(t.slice(0,2)),g=ms(t);if(g.length)for(let t=0;t<2;t++)if(g[t]!==g[t+2]&&gs(p.slice(2*t,2*(t+1)),p.slice(2*(t+1),2*(t+2)),p.slice(2*(t+2),2*(t+3)),p.slice(2*(t+3),2*(t+4))))return !1;return h*d*c*u>0}function xs(t,e){return ((t.x-e.x)**2+(t.y-e.y)**2)**.5}function ws(t){const{type:e,value:i}=t;return "hex"===e?`#${i}`:"literal"===e?i:"rgb"===e?`rgb(${i.join(",")})`:`rgba(${i.join(",")})`}const bs=function(){const t={linearGradient:/^(linear\-gradient)/i,repeatingLinearGradient:/^(repeating\-linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,repeatingRadialGradient:/^(repeating\-radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let e="";function i(t){throw new Error(`${e}: ${t}`)}function n(){return s("linear-gradient",t.linearGradient,r)||s("repeating-linear-gradient",t.repeatingLinearGradient,r)||s("radial-gradient",t.radialGradient,a)||s("repeating-radial-gradient",t.repeatingRadialGradient,a)||s("conic-gradient",t.conicGradient,a)}function s(e,n,s){return o(n,(n=>{const o=s();return o&&(v(t.comma)||i("Missing comma before color stops")),{type:e,orientation:o,colorStops:u(p)}}))}function o(e,n){const s=v(e);if(s){v(t.startCall)||i("Missing (");const e=n(s);return v(t.endCall)||i("Missing )"),e}}function r(){return m("directional",t.sideOrCorner,1)||m("angular",t.angleValue,1)}function a(){let i,n,s=l();return s&&(i=[],i.push(s),n=e,v(t.comma)&&(s=l(),s?i.push(s):e=n)),i}function l(){let t=function(){const t=m("shape",/^(circle)/i,0);return t&&(t.style=y()||h()),t}()||function(){const t=m("shape",/^(ellipse)/i,0);return t&&(t.style=f()||h()),t}();if(t)t.at=d();else {const e=h();if(e){t=e;const i=d();i&&(t.at=i);}else {const e=c();e&&(t={type:"default-radial",at:e});}}return t}function h(){return m("extent-keyword",t.extentKeywords,1)}function d(){if(m("position",/^at/,0)){const t=c();return t||i("Missing positioning value"),t}}function c(){const t={x:f(),y:f()};if(t.x||t.y)return {type:"position",value:t}}function u(e){let n=e();const s=[];if(n)for(s.push(n);v(t.comma);)n=e(),n?s.push(n):i("One extra comma");return s}function p(){const e=m("hex",t.hexColor,1)||o(t.rgbaColor,(()=>({type:"rgba",value:u(g)})))||o(t.rgbColor,(()=>({type:"rgb",value:u(g)})))||m("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=f(),e}function g(){return v(t.number)[1]}function f(){return m("%",t.percentageValue,1)||m("position-keyword",t.positionKeywords,1)||y()}function y(){return m("px",t.pixelValue,1)||m("em",t.emValue,1)}function m(t,e,i){const n=v(e);if(n)return {type:t,value:n[i]}}function v(t){const i=/^[\n\r\t\s]+/.exec(e);i&&x(i[0].length);const n=t.exec(e);return n&&x(n[0].length),n}function x(t){e=e.substring(t);}return function(t){return e=t,function(){const t=u(n);return e.length>0&&i("Invalid input not EOF"),t}()}}();const Cs={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'"',"&#x27;":"'"},Ss={};let Ps;function As(t,e){const i=Object.keys(t);let n=0;for(;n<i.length;n++){const s=i[n];if(!1===e.call(null,t[s],s,t))break}}As(Cs,((t,e)=>{Ss[t]=e;}));const Ts=t=>{const{parentNode:e}=t,{children:i}=e;for(let e=0;e<i.length;e++)if(i[e]===t)return e;return -1},ks=(t,e,i)=>{try{void 0===e?i.appendChild(t):i.insertBefore(t,e);}catch(t){}},Ds=()=>{const t=window;if(t){if(t.devicePixelRatio)return t.devicePixelRatio;if(t.screen.deviceXDPI&&t.screen.logicalXDPI)return t.screen.deviceXDPI/t.screen.logicalXDPI}return 1};function Es(t){let e="0px",i="",n="solid";if(!zn(t)&&""!==t){const s=document.createElement("div");s.style.border=t;const{borderWidth:o,borderColor:r,borderStyle:a}=s.style;"initial"!==o&&""!==o&&(e=o),"initial"!==r&&""!==r&&(i=r),"initial"!==a&&""!==a&&(n=a);}return {borderWidth:e,borderColor:i,borderStyle:n}}const Is=t=>{const{pointerType:e}=t;return "touch"===e||"pen"===e||void 0===e};let Rs;function Ms(t){return void 0===Rs&&(Rs=/Mac OS/.test(navigator.userAgent)),Os(t,Rs?3:2)}function Bs(t){return Os(t,5)}function Ls(t){return Os(t,1)}function Us(t){return Os(t,0)}function Os(t,e){const{ctrlKey:i,metaKey:n,altKey:s,shiftKey:o}=t;switch(e){case 0:return i||n||s||o;case 1:return !(i||n||s||o);case 2:return i&&!n&&!s&&!o;case 3:return !i&&n&&!s&&!o;case 4:return !i&&!n&&s&&!o;case 5:return !i&&!n&&!s&&o;default:return !1}}const Ns=function(t,e){const i=t.indexOf(e);return !(i<0||(t.splice(i,1),0))},_s=function(t,e,i){if(Jn(i)){let n=[],s=[];if(e.includes(i)){const t=e.length;if(t>1){const o=e.indexOf(i);0===o?s=e.slice(1):o===t-1?n=e.slice(0,-1):(n=e.slice(0,o),s=e.slice(o+1));}}else n=e;const o=t[i],r=n.map((e=>t[e])),a=s.map((e=>t[e]));r.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1);})),a.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1);}));const l=t.indexOf(o);t.splice(l+1,0,...a),t.splice(l,0,...r);}else e.map((e=>t[e])).forEach((e=>{const i=t.indexOf(e);t.splice(i,1),t.push(e);}));return !0},Ws=function(t,e,i){if(e===i)return !0;const n=t[e];return t[e]=t[i],t[i]=n,!0},Fs=function(t,e){const i=e.length;return !(t.length!==i||!i||(e.every(((t,e)=>t===e))||e.map((e=>t[e])).forEach(((e,i)=>{t[i]=e;})),0))};function Hs(t){return null==t}const Vs=(t,e)=>t in e,zs=(t,e)=>{const i=[];for(;t;){const n=t.match(e);if(!n)break;i.push(n),t=t.substring(n.index+n[0].length);}return i};function js(t,e){return Object.keys(t).forEach((i=>{(function(t){return "__proto__"===t||"constructor"===t||"prototype"===t})(i)||(zn(e[i])?e[i]=t[i]:Hn(t[i])?js(t[i],e[i]):e[i]=t[i]);})),e}class $s{static read(t){return new Promise(((e,i)=>{const n=Object.prototype.toString.call(t);if("[object String]"===n){if(0===t.indexOf("blob:")||t.indexOf(".jpg")>0||t.indexOf(".jpeg")>0||t.indexOf(".png")>0||t.indexOf(".bmp")>0||t.indexOf(".dib")>0||t.indexOf(".pdf")>0||t.indexOf(".tiff")>0||t.indexOf(".tif")>0)return fetch(t,{mode:"cors"}).then((t=>t.arrayBuffer())).then((t=>e(t))).catch((t=>Promise.reject(t)));i("Error url: Can not read the file URL");}else if("[object Blob]"===n||"[object FileList]"===n||"[object File]"===n){let s=t;"[object FileList]"!==n&&"[object File]"!==n||(s=t[0]?t[0]:t),l($s,$s,Gs).call($s,s,e,i);}else "[object ArrayBuffer]"===n||"[object Uint8ClampedArray]"===n?e(t):i(`Not support source type: ${n}`);}))}}function Gs(t,e,i){let n,s,o=0;try{n=new ArrayBuffer(t.size),s=new Uint8Array(n);}catch(t){i(t);}!function r(){const a=new FileReader;a.onload=function(a){var l;if(null!=a&&null!==(l=a.target)&&void 0!==l&&l.result){const i=a.target.result;s.set(new Uint8Array(i),o),o+=i.byteLength,o<t.size?r():e(n);}else i(a);},a.onerror=function(t){i(t);},a.onabort=function(t){i(t);};const l=Math.min(o+1048576,t.size),h=t.slice(o,l);a.readAsArrayBuffer(h);}();}async function Xs(t){let e;if(t instanceof ArrayBuffer)t.byteLength>12&&(e=new Uint8Array(t.slice(0,12)));else if(t instanceof Blob&&t.size>12){const i=t.slice(0,12),n=await $s.read(i);e=new Uint8Array(n);}if(e){if(function(t){return 37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]}(e))return "application/pdf";if(function(t){return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]}(e))return "image/png";if(function(t){return 255===t[0]&&216===t[1]}(e))return "image/jpeg";if(function(t){return 66===t[0]&&77===t[1]}(e))return "image/bmp";if(function(t){return 73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]}(e))return "image/tiff";if(function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&12===t[3]&&106===t[4]&&80===t[5]&&32===t[6]&&32===t[7]||255===t[0]&&79===t[1]&&255===t[2]&&81===t[3]}(e))return "image/jp2";if(function(t){return 82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]}(e))return null;if(t instanceof Blob&&("application/pdf"===t.type||"image/bmp"===t.type||"image/jp2"===t.type||"image/jpeg"===t.type||"image/png"===t.type||"image/tiff"===t.type||"image/rgba"===t.type))return t.type}return t instanceof Blob&&"application/ddv-blank-image"===t.type?t.type:null}function Ys(t,e,i){return e===i?t:Jn(t)?t/e*i:Fn(t)?t.map((t=>Fn(t)?[t[0]/e*i,t[1]/e*i]:t/e*i)):(t={...t},Object.keys(t).forEach((n=>{t[n]=t[n]/e*i;})),t)}function qs(t,e){return t.every(((t,i)=>{let[n,s]=t;const[o,r]=e[i];return n===o&&s===r}))}function Js(t,e){return Number.parseFloat(t.toFixed(e))}class Zs{constructor(){i(this,"disposed",!1),i(this,"toDispose",new Set);}get isDisposed(){return this.disposed}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this.disposed||this.toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this.toDispose.delete(t),t.dispose();}}dispose(){this.disposed||(this.disposed=!0,this.clear());}clear(){try{for(const t of this.toDispose)if(t)try{t.dispose();}catch(t){throw new Error("can not dispose an object")}}finally{this.toDispose.clear();}}}class Qs{constructor(){i(this,"store",new Zs);}dispose(){this.store.dispose();}register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this.store.add(t)}}class Ks{static create(t){return new Ks(t)}constructor(t){i(this,"isDisposed",!1),i(this,"listeners",void 0),i(this,"options",void 0),this.options=t,this.listeners=[];}dispose(){this.isDisposed||(this.isDisposed=!0,this.listeners&&(this.listeners=null));}on(t,e,i){var n,s,o,r;if(this.isDisposed)return {dispose:()=>{}};const a={uid:ts(),callback:t,context:e};this.listeners.length?this.listeners.push(a):(null!==(n=this.options)&&void 0!==n&&null!==(s=n.beforeAddFirstListener)&&void 0!==s&&s.call(n,this),this.listeners.push(a),null===(o=this.options)||void 0===o||null===(r=o.afterAddFirstListener)||void 0===r||r.call(o,this));const l={dispose:()=>{this.remove(a);}};return i instanceof Zs?i.add(l):Array.isArray(i)?i.push(l):i instanceof Qs&&i.register(l),l}remove(t){var e,i,n,s;if(null!==(e=this.options)&&void 0!==e&&null!==(i=e.beforeRemoveListener)&&void 0!==i&&i.call(e,this),!this.listeners)return;if(1===this.listeners.length)return this.listeners=[],void(null===(n=this.options)||void 0===n||null===(s=n.afterRemoveLastListener)||void 0===s||s.call(n,this));const o=this.listeners.indexOf(t);if(o<0)throw new Error("Attempted to dispose unknown listener.");this.listeners.splice(o,1);}off(t){if(this.isDisposed||!this.listeners)return;const e=this.listeners.findIndex((e=>e.callback===t));e>-1&&this.listeners.splice(e,1);}emit(t){this.listeners&&this.listeners.length&&this.listeners.slice().forEach((e=>{try{e.context?e.callback.call(e.context,t):e.callback(t);}catch(e){}}));}}function to(t,e,i){return {on:(n,s)=>{const o=new Ks({beforeAddFirstListener:()=>{t.addEventListener(e,n,s);},afterRemoveLastListener:()=>{t.removeEventListener(e,n);}});i.register(o.on((()=>{}))),i.register(o);}}}function eo(t){const e=t.register(new Ks);return {on:(i,n)=>e.on(i,t,n),emit:t=>{e.emit(t);}}}var io,no;!function(t){t.core="ddv-core",t.reader="ddv-reader",t.detector="ddv-detector",t.loader="ddv-loader";}(no||(no={}));class so{static get isApple(){return r(this,so,mo)}static get version(){return Ti.CryptoModule.ver}static enableDebugOutput(t,e){if(t){const t=t=>{var i,n,s;let o=Vn(t);o.srcBuffer&&(o.srcBuffer=l(this,so,oo).call(this,o.srcBuffer)),null!==(i=o.result)&&void 0!==i&&i.srcBuffer&&(o.result.srcBuffer=l(this,so,oo).call(this,o.result.srcBuffer)),null!==(n=o.result)&&void 0!==n&&n.imageData&&(o.result.imageData=l(this,so,oo).call(this,o.result.imageData)),null!==(s=o.result)&&void 0!==s&&s.pdfData&&(o.result.pdfData=l(this,so,oo).call(this,o.result.pdfData)),o.imageData&&(o.imageData=l(this,so,oo).call(this,o.imageData)),e&&(Zn(o)&&(o=`[${Date.now()}]${o}`),e(o));};Ti.setLogFunc("logDebug",t);}else Ti.setLogFunc("",void 0);}static hasDebugOutput(){return Ti.hasLogFunc()}static get blobReadModeSettings(){const{FontUseFileReadMode:t}=Ti;return {minBlobSize:Ti.FileReadModeSize,fontForLoad:t.load,fontForSave:t.save}}static set blobReadModeSettings(t){"number"==typeof t.minBlobSize&&(Ti.FileReadModeSize=t.minBlobSize),Ti.FontUseFileReadMode={load:t.fontForLoad,save:t.fontForSave};}static getMemoryUsed(){return Ii.Instance.getMemoryUsed()}static get heapConfig(){return Ti.HeapConfig}static updateHeapConfig(t,e,i){Ti.UpdateHeapConfig(t,e,i),r(this,so,xo)[t]||(r(this,so,xo)[t]={}),e&&(r(this,so,xo)[t].maxHeapSize=e),i&&(r(this,so,xo)[t].initHeapSize=i);}static async getLicenseInfo(t,e,i){this.Init(t,e,i),e&&await Ii.Instance.loadModule(Ti.CryptoModule),await Ii.Instance.loadModule(Ti.ImageIOModule),await Fi.updateLicense(r(this,so,lo),r(this,so,ho),r(this,so,co));const n=new Li(r(this,so,lo));try{return await n.getLicenseInfo()}finally{n.terminate();}}static Init(t,e,i){var n;a(this,so,lo,null!=t?t:r(this,so,lo)),void 0!==e&&a(this,so,ho,e?1:0),a(this,so,co,null!=i?i:r(this,so,co));const s={bMac:"Mac"===vn.OS,biPhone:"iPhone"===vn.OS,biPad:"iPad"===vn.OS};a(this,so,mo,s.bMac||s.biPhone||s.biPad),Ti.NavInfo=s,Ti.License=r(this,so,lo),Ti.UUID=r(this,so,co),Ti.LicMode=r(this,so,ho),l(this,so,ao).call(this),Ti.UpdateHeapConfig(no.detector,null!==(n=l(this,so,ro).call(this,no.detector))&&void 0!==n?n:100);}static async isResourceDirValid(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;l(this,so,ao).call(this);let i=0;for(;i<t;){try{const t=Ti.PdfReaderModule;if(r(this,so,vo)===t.script)return !0;const e={...t.fetchOptions};e.method="HEAD";if((await fetch(t.script,e)).ok)return a(this,so,vo,t.script),!0}catch(t){}await new Promise((t=>setTimeout(t,e))),i+=1;}return !1}static async loadPdfReader(t,e,i){return this.Init(t,e,i),r(this,so,fo)||(await Ii.Instance.loadModule(Ti.ImageProcModule),a(this,so,fo,Ii.Instance.loadModule(Ti.PdfReaderModule)),await r(this,so,fo)),r(this,so,fo)}static async loadMain(t,e,i){return this.Init(t,e,i),r(this,so,yo)||(a(this,so,yo,Ii.Instance.loadModule(Ti.ImagecoreModule)),await r(this,so,yo),Ii.Instance.loadModule(Ti.ImageProcModule)),r(this,so,yo)}static async load(t,e,i){Ii.Instance.terminate(!0),this.Init(t,e,i),await this.loadMain(t,e,i);}static async preloadModule(t){let e;const i={...Ti.PdfReaderModule},n={...Ti.ImageProcModule};switch(t){case"core":if(r(this,so,yo)){e=r(this,so,yo);break}a(this,so,yo,Ii.Instance.loadModule(Ti.ImagecoreModule)),e=r(this,so,yo),await r(this,so,yo);break;case"pdf":case"proc":if(r(this,so,fo)){e=r(this,so,fo);break}n.workerName=no.loader,a(this,so,fo,Ii.Instance.loadModule(n)),e=r(this,so,fo),await r(this,so,fo),i.workerName=no.loader,a(this,so,fo,Ii.Instance.loadModule(i)),e=r(this,so,fo),await r(this,so,fo),Ii.Instance.terminateWorker(i.workerName);}return e}static unloadMainWorker(){a(this,so,yo,void 0),Ii.Instance.terminateWorker(Ti.ImageIOModule.workerName);}static unloadPdfReaderWorker(){a(this,so,fo,void 0),Ii.Instance.terminateWorker(Ti.PdfReaderModule.workerName);}static unloadDocumentDetectorWorker(){Ii.Instance.terminateWorker(Ti.DetectorModule.workerName);}static async unloadWorker(){a(this,so,yo,void 0),a(this,so,fo,void 0),await Ii.Instance.terminate(!0);}static async unload(){Ii.unload(),Fi.unload(),Ti.unload(),a(this,so,yo,void 0),a(this,so,fo,void 0);try{await Ii.Instance.terminate(!0);}catch(t){}}static getUseSimd(){if(this.enableSimd){var t;const e=navigator;if(null!==(t=e.userAgentData)&&void 0!==t&&t.brands)for(const{brand:t,version:i}of e.userAgentData.brands)if(t&&("Chromium"===t||"Google Chrome"===t)&&i&&parseInt(i,10)>=94)return !0}return !1}static getPdfFonts(){return dn.getPdfFonts()}static async getPdfInfo(t,e){let i;try{i=new dn;const n=await i.getPdfInfo({fileSource:t,password:e});return i.destroy(),n}catch(t){return null}finally{i&&i.destroy();}}}function oo(t){return t instanceof ArrayBuffer?{type:"ArrayBuffer",length:t.byteLength}:t instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:t.byteLength}:{type:Object.prototype.toString.call(t)}}function ro(t){return void 0!==r(this,io,xo)[t]?r(this,io,xo)[t].maxHeapSize:null}function ao(){this.enableSimd?Ti.UseSimd=this.getUseSimd():Ti.UseSimd=!1,Ti.UseBrotli=this.enableWasmCompression;const t={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:Ti.UseSimd,fetchOptions:this.fetchOptions,useBrotli:Ti.UseBrotli};t.workerScript=Ti.ImageIOWorkerJS,Ti.ImageIOResource=t;const e={...t};e.workerScript=Ti.ImageIOWorkerJS,Ti.PdfReaderResource=e;}io=so,i(so,"resourceDir","");var lo={writable:!0,value:""},ho={writable:!0,value:P.LONG_KEY},co={writable:!0,value:""};i(so,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),i(so,"enableSimd",!0),i(so,"enableWasmCompression",!1);exports.EnumImageDataType = void 0;var po,go,fo={writable:!0,value:void 0},yo={writable:!0,value:void 0},mo={writable:!0,value:!1},vo={writable:!0,value:void 0},xo={writable:!0,value:Object.create(null)};class wo{constructor(){i(this,"processor",void 0),this.processor=new hn;}async initImage(t){return this.processor.initImage(t.source,t.isRGBA,t.width,t.height,t.isBGRA)}async getImage(t){return await this.processor.getImage(t.jpegQuality,t.ifDeleteObject,t.isRGBA,t.bitDepth,t.xDpi,t.yDpi,t.returnBlob,t.returnType,so.isApple)}async getImageInfo(){return await this.processor.getImageInfo()}async freeReservedData(){this.processor.freeReservedData();}async toBinaryLevel(t,e){return this.processor.toBinaryLevel(t,e)}async toGrayscale(t){return this.processor.toGrayscale(t)}async removeShadowLevel(t,e){return this.processor.removeShadowLevel(t,e)}async brighten(){return this.processor.brighten()}async invert(){return this.processor.invert()}async changeBrightnessAndContrast(t,e){return this.processor.changeBrightnessAndContrast(t,e)}async perspective(t){return this.processor.perspective(t[0][0],t[0][1],t[1][0],t[1][1],t[2][0],t[2][1],t[3][0],t[3][1])}async getSkewAngle(t){return this.processor.getSkewAngle(t)}async rotate(t){return this.processor.rotate(t.angle,t.fillColor,t.keepSize,t.mode)}async flip(){return this.processor.flip()}async resize(t,e,i){return this.processor.resize(t,e,i)}async resizeWidth(t,e){return this.processor.setImageWidth(t,e)}async resizeHeight(t,e){return this.processor.setImageHeight(t,e)}async crop(t){return this.processor.crop(t.left,t.top,t.left+t.width,t.top+t.height)}async erase(t,e){return this.processor.erase(t.left,t.top,t.left+t.width,t.top+t.height,e)}async setDpi(t){return this.processor.setDPI(t.rawResolutionX,t.rawResolutionY,t.resolutionX,t.resolutionY,t.resample,t.mode)}async drawQuadrangle(t){return this.processor.drawQuadrangle(t.location[0][0],t.location[0][1],t.location[1][0],t.location[1][1],t.location[2][0],t.location[2][1],t.location[3][0],t.location[3][1],t)}async filter(t,e,i){return this.processor.filter(t,e,i)}async setImageWidth(t,e){return this.processor.setImageWidth(t,e)}async setImageHeight(t,e){return this.processor.setImageHeight(t,e)}terminate(t){return this.processor.terminate(t)}}class bo{constructor(){i(this,"reader",void 0),this.reader=new Hi;}async readImage(t){return await this.reader.readImage(t.source,t.outputType,t.jpegQuality,t.returnBase64,so.isApple)}async readImageInfo(t){return await this.reader.readImageInfo(t)}cancelReadImage(t,e){this.reader.cancelReadImage(t,e);}async readTiffPage(t){return await this.reader.readTiffPage(t.source,t.index,t.outputType,t.returnBase64,so.isApple)}async readTiffPageInfo(t,e){const{imageInfos:i}=await this.reader.getTiffPageInfos(t,e);return i}async getTiffPageCount(t){return (await this.reader.getTiffInfo(t)).pageCount}cancelReadTiffPage(t,e){this.reader.cancelReadTiffPage(t,e);}destroy(){var t;null===(t=this.reader)||void 0===t||t.destroy(),this.reader=void 0;}}!function(t){t[t.RGBA=1]="RGBA",t[t.BGRA=2]="BGRA",t[t.JPEG=3]="JPEG",t[t.PNG=4]="PNG";}(exports.EnumImageDataType||(exports.EnumImageDataType={})),function(t){t[t.IT_DIB=-1]="IT_DIB",t[t.IT_RGBA=-2]="IT_RGBA",t[t.IT_BGRA=-3]="IT_BGRA",t[t.IT_BMP=0]="IT_BMP",t[t.IT_JPG=1]="IT_JPG",t[t.IT_PNG=3]="IT_PNG",t[t.IT_ALL=5]="IT_ALL";}(po||(po={})),function(t){t[t.RT_AUTO=-1]="RT_AUTO",t[t.RT_BINARY=1]="RT_BINARY",t[t.RT_BASE64=2]="RT_BASE64";}(go||(go={}));class Co{constructor(){i(this,"writer",void 0),this.writer=new Li;}terminate(){var t;null===(t=this.writer)||void 0===t||t.terminate(),this.writer=void 0;}createTiff(){return this.writer.createTiff()}addTiffTag(t,e,i){return this.writer.addTag(t,e,i)}async appendImage(t,e){var i;e=null!==(i=e)&&void 0!==i?i:{};return await this.writer.appendImage(t,e.inputType,e.tiffFormat,e.jpegQuality,e.is1Bit)}async getTiff(){return (await this.writer.getTiff(go.RT_BINARY)).imageData}async saveImage(t,e){var i;e=null!==(i=e)&&void 0!==i?i:{};return (await this.writer.saveImage(t,e.outputType,e.jpegQuality,e.returnType,e.is1Bit)).imageData}}class So{constructor(){i(this,"reader",void 0),this.reader=new dn;}initFonts(t){var e;const i=null==t||null===(e=t.renderOptions)||void 0===e?void 0:e.fonts;if(i)for(const t of i)t.name&&t.data&&So.addPdfFont(t.name,t.data);}static addPdfFont(t,e){dn.addPdfFont(t,e);}async readPageImageInfos(t){await this.initFonts(t.readOptions);const{imageInfos:e}=await this.reader.readPageImageInfos(t.source,t.indices,t.readOptions,t.outputType,t.isInfoOnly,t.returnBase64,so.isApple);return e}async readPage(t){await this.initFonts(t.readOptions);return await this.reader.readPageEx(t.source,t.index,t.readOptions,t.outputType,t.isInfoOnly,t.returnBase64,so.isApple)}cancelReadPage(t,e){this.reader.cancelReadPage(t,e);}async getPdfPageCount(t,e){await this.initFonts(e);return (await this.reader.getPdfInfo(t)).PdfCount}async getPdfPageContentType(t,e){const i=await this.reader.getPdfPageType(t,e);return 1===i.pageContentType?"application/pdf/text":2===i.pageContentType?"application/pdf/image":"application/pdf"}async readAnnotations(t,e){const{annot:{annots:i}}=await this.reader.readPageAnnot(t,e);return i}async findText(t,e,i,n){return await this.reader.findText(t,e,i,n)}async getCharInfos(t,e){return (await this.reader.getCharInfos(t,e)).pageCharInfos}destroy(){this.reader.destroy(),this.reader=null;}}class Po{constructor(){i(this,"writer",void 0),this.writer=new cn;}terminate(){var t;null===(t=this.writer)||void 0===t||t.terminate(),this.writer=null;}async initPdfSetting(t){return this.writer.initPdfSetting(t)}async insertBlankPage(t,e,i){return this.writer.insertBlankPage(t,e,i)}async appendPage(t,e){return this.writer.appendPage(t,e)}async addImageToPages(t,e,i,n,s,o){return this.writer.pageAddImage(t,e,i,n,s,o)}async mergeRawPdfPages(t,e,i){return this.writer.mergePdf(t,e,i)}async setPageRotation(t,e){return this.writer.pageSetRotation(t,e)}async clearPageObjects(t){return this.writer.pageClearObjects(t)}async setPageCropBox(t,e,i,n,s){return this.writer.pageSetCropBox(t,e,i,n,s)}async setPageMediaBox(t,e,i,n,s){return this.writer.pageSetMediaBox(t,e,i,n,s)}async setPageAnnotations(t,e){return this.writer.pageSetAnnot(t,e)}async addAnnotationsToPage(t,e){return this.writer.pageAddAnnot(t,e)}async flattenPageAnnotations(t,e){return this.writer.pageFlattenAnnot(t,e)}async deletePageAnnotationsByTypes(t,e){return this.writer.pageDeleteAnnotByTypes(t,e)}async deletePageAnnotations(t){return this.writer.pageDeleteAnnot(t)}async flattenPage(t,e){return this.writer.pageFlatten(t,e)}async getPdf(t){return (await this.writer.writePdf(t)).pdfData}async getFontInfo(t){return await this.writer.GetFontInfo(t)}async ifFontsExist(t){return (await this.writer.IfFontsExist(t)).fontsExist}async unloadPage(t){var e,i;await(null===(e=(i=this.writer).UnloadPage)||void 0===e?void 0:e.call(i,t));}}class Ao{constructor(t){i(this,"items",[]),t&&(this.items=t);}push(t){this.items.push(t);}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(t){"filter"===t.api&&this.items.forEach(((e,i)=>{if(e.api===t.api&&e.params[0]===t.params[0]&&e.params[1]===t.params[1]&&e.params[2]===t.params[2]){this.items.splice(i,1).forEach((t=>{null==t||t.resolve(null);}));}}));}}const To={[exports.EnumImageDataType.BGRA]:po.IT_BGRA,[exports.EnumImageDataType.RGBA]:po.IT_RGBA,[exports.EnumImageDataType.PNG]:po.IT_PNG,[exports.EnumImageDataType.JPEG]:po.IT_JPG},ko={[po.IT_BGRA]:exports.EnumImageDataType.BGRA,[po.IT_RGBA]:exports.EnumImageDataType.RGBA,[po.IT_PNG]:exports.EnumImageDataType.PNG,[po.IT_JPG]:exports.EnumImageDataType.JPEG},Do={displayResolution:96,dataResolution:72,pdfResolution:72,enableResolution:!0,autoReleaseImg:qn(),autoReleaseBlob:!0};class Eo{constructor(){i(this,"db",void 0),this.db=new Map;}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}getSaverConstructor(t){return this.db.get(t)}setSaverConstructor(t,e){this.db.set(t,e);}deleteSaverConstructor(t){this.db.delete(t);}clear(){this.db.clear();}}const Io=new Eo,Ro=new Eo;const Mo=new class{constructor(t,e){i(this,"saverConstructorRepo",void 0),i(this,"customSaverConstructorRepo",void 0),this.saverConstructorRepo=t,this.customSaverConstructorRepo=e;}execute(t){let e=this.customSaverConstructorRepo.getSaverConstructor(t);e||(e=this.saverConstructorRepo.getSaverConstructor(t));return new e}}(Io,Ro),Bo=new class{constructor(t){i(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=t;}execute(t){let{mime:e,saverConstructor:i}=t;this.saverConstructorRepo.setSaverConstructor(e,i);}}(Io),Lo=new class{constructor(t){i(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=t;}execute(t){this.saverConstructorRepo.deleteSaverConstructor(t);}}(Io);exports.EnumTIFFCompressionType = void 0;exports.EnumPDFCompressionType = void 0;exports.EnumPDFPageType = void 0;var _o;!function(t){t.TIFF_AUTO="tiff/auto",t.TIFF_FAX3="tiff/fax3",t.TIFF_FAX4="tiff/fax4",t.TIFF_LZW="tiff/lzw",t.TIFF_JPEG="tiff/jpeg";}(exports.EnumTIFFCompressionType||(exports.EnumTIFFCompressionType={})),function(t){t.PDF_AUTO="pdf/auto",t.PDF_FAX4="pdf/fax4",t.PDF_LZW="pdf/lzw",t.PDF_JPEG="pdf/jpeg",t.PDF_JP2000="pdf/jp2000",t.PDF_JBIG2="pdf/jbig2";}(exports.EnumPDFCompressionType||(exports.EnumPDFCompressionType={})),function(t){t.PAGE_DEFAULT="page/default",t.PAGE_A4="page/a4",t.PAGE_A4_REVERSE="page/a4reverse",t.PAGE_A3="page/a3",t.PAGE_A3_REVERSE="page/a3reverse",t.PAGE_LETTER="page/letter",t.PAGE_LETTER_REVERSE="page/letterreverse",t.PAGE_LEGAL="page/legal",t.PAGE_LEGAL_REVERSE="page/legalreverse";}(exports.EnumPDFPageType||(exports.EnumPDFPageType={})),function(t){t.PRINT="print",t.MODIFY_CONTENTS="modify_contents",t.COPY_CONTENTS="copy_contents",t.EXTRACT_CONTENTS="extract_contents",t.MODIFY_ANNOTATIONS="modify_annotations",t.FILL_IN="fill_in",t.ASSEMBLY="assembly",t.DEGRADED_PRINT="degraded_print";}(_o||(_o={})),new Map([[_o.PRINT,2052],[_o.MODIFY_CONTENTS,8],[_o.COPY_CONTENTS,16],[_o.MODIFY_ANNOTATIONS,32],[_o.FILL_IN,256],[_o.EXTRACT_CONTENTS,512],[_o.ASSEMBLY,1024],[_o.DEGRADED_PRINT,4]]);const Wo=new Map([[exports.EnumPDFPageType.PAGE_DEFAULT,0],[exports.EnumPDFPageType.PAGE_A4,2],[exports.EnumPDFPageType.PAGE_A4_REVERSE,3],[exports.EnumPDFPageType.PAGE_A3,4],[exports.EnumPDFPageType.PAGE_A3_REVERSE,5],[exports.EnumPDFPageType.PAGE_LETTER,6],[exports.EnumPDFPageType.PAGE_LETTER_REVERSE,7],[exports.EnumPDFPageType.PAGE_LEGAL,8],[exports.EnumPDFPageType.PAGE_LEGAL_REVERSE,9]]),Fo=new Map([[exports.EnumPDFCompressionType.PDF_AUTO,0],[exports.EnumPDFCompressionType.PDF_FAX4,2],[exports.EnumPDFCompressionType.PDF_LZW,3],[exports.EnumPDFCompressionType.PDF_JPEG,5],[exports.EnumPDFCompressionType.PDF_JP2000,6],[exports.EnumPDFCompressionType.PDF_JBIG2,7]]),Ho=new Map([[exports.EnumTIFFCompressionType.TIFF_AUTO,0],[exports.EnumTIFFCompressionType.TIFF_FAX3,1],[exports.EnumTIFFCompressionType.TIFF_FAX4,2],[exports.EnumTIFFCompressionType.TIFF_LZW,3],[exports.EnumTIFFCompressionType.TIFF_JPEG,5]]);var Vo=new WeakMap,zo=new WeakMap,jo=new WeakMap;class $o{constructor(){f(this,Vo,{writable:!0,value:void 0}),f(this,zo,{writable:!0,value:void 0}),f(this,jo,{writable:!0,value:void 0}),s(this,Vo,new Po),s(this,zo,new Map);}destroy(){var t;null===(t=n(this,Vo))||void 0===t||t.terminate(),s(this,Vo,void 0);}convertPageSize(t,e){let i=0,n=0,s=0,o=0,r=0,a=0,l=0,h=0;const{pdfResolution:d,displayResolution:c}=Do;switch(t){case exports.EnumPDFPageType.PAGE_A4:s=210/25.4*d,o=297/25.4*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_A4_REVERSE:s=297/25.4*d,o=210/25.4*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_A3:s=297/25.4*d,o=420/25.4*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_A3_REVERSE:s=420/25.4*d,o=297/25.4*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_LETTER:s=8.5*d,o=11*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_LETTER_REVERSE:s=11*d,o=8.5*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_LEGAL:s=8.5*d,o=14*d,l=s,a=o;break;case exports.EnumPDFPageType.PAGE_LEGAL_REVERSE:s=14*d,o=8.5*d,l=s,a=o;break;default:i=e.mediaBox.left/c*d,n=e.mediaBox.top/c*d,s=e.mediaBox.width/c*d,o=e.mediaBox.height/c*d,r=e.cropBox.left/c*d,a=2*n+o-e.cropBox.top/c*d,l=Math.max(r+e.cropBox.width/c*d,r+1),h=Math.min(a-e.cropBox.height/c*d,a-1);}return {left:i,top:n,width:s,height:o,cropLeft:r,cropTop:a,cropRight:l,cropBottom:h}}convertPdfSettings(t){const e={};return e.author=null==t?void 0:t.author,e.compression=null!=t&&t.compression?Fo.get(t.compression):void 0,e.creationDate=null==t?void 0:t.creationDate,e.creator=null==t?void 0:t.creator,e.keyWords=null==t?void 0:t.keyWords,e.modifiedDate=null==t?void 0:t.modifiedDate,e.pageType=null!=t&&t.pageType?Wo.get(t.pageType):void 0,e.producer=null==t?void 0:t.producer,e.quality=null==t?void 0:t.quality,e.subject=null==t?void 0:t.subject,e.title=null==t?void 0:t.title,e.version=null==t?void 0:t.version,null!=t&&t.password&&(e.encryptOptions={},e.encryptOptions.enabled=!0,e.encryptOptions.userPassword=t.password),e}async init(t){s(this,jo,t||{});const e=this.convertPdfSettings(t);await n(this,Vo).initPdfSetting(e);}async appendImagePage(t,e){const{mediaBox:i}=e,s=this.convertPageSize(n(this,jo).pageType,e);let o=await n(this,Vo).insertBlankPage(-1,s.left+s.width,s.top+s.height);const{pageIndex:r}=o;await n(this,Vo).setPageMediaBox(r,s.left,s.top,s.left+s.width,s.top+s.height),e.rotation&&await n(this,Vo).setPageRotation(r,e.rotation);const{displayResolution:a,pdfResolution:l}=Do;let h=s.width,d=s.height,c=0,u=0;if(n(this,jo).pageType&&n(this,jo).pageType!==exports.EnumPDFPageType.PAGE_DEFAULT){const t={width:i.width/a*l,height:i.height/a*l},e=s.width/t.width,o=s.height/t.height;if(e<o){const i=t.height*e;u=(s.height-i)/2,h=s.width,d=i;}else {const e=t.width*o;c=(s.width-e)/2,h=e,d=s.height;}n(this,zo).set(r,[h/t.width,0,0,d/t.height,c,u]);}c+=s.left,u+=s.top;let p=e.width,g=e.height,f=t;if(n(this,jo).imageScaleFactor){let i=Math.floor(e.width*n(this,jo).imageScaleFactor+.5),s=Math.floor(e.height*n(this,jo).imageScaleFactor+.5);if(i<1&&(i=1),s<1&&(s=1),i!==p&&s!==g){const e=new wo;await e.initImage({source:t}),await e.resize(i,s);f=(await e.getImage({})).imageData,p=i,g=s,await e.freeReservedData();}}return o=await n(this,Vo).addImageToPages(f,[r],{type:"image",imageWidth:h,imageHeight:d,position:[c,u]},p,g,1===e.bitDepth),await n(this,Vo).setPageCropBox(r,s.cropLeft,s.cropBottom,s.cropRight,s.cropTop),await n(this,Vo).unloadPage(r),o}async appendRawPdfPages(t,e,i){await n(this,Vo).mergeRawPdfPages(t,e,i);}async changePageImage(t,e,i){const s=this.convertPageSize(exports.EnumPDFPageType.PAGE_DEFAULT,i);await n(this,Vo).clearPageObjects(t);return await n(this,Vo).addImageToPages(e,[t],{type:"image",imageWidth:s.width,imageHeight:s.height,position:[s.left,s.top]},i.width,i.height)}async setPageInfo(t){for(const[e,i]of t){const t=this.convertPageSize(exports.EnumPDFPageType.PAGE_DEFAULT,i),{rotation:s}=i;await n(this,Vo).setPageCropBox(e,t.cropLeft,t.cropBottom,t.cropRight,t.cropTop),await n(this,Vo).setPageRotation(e,(s%360+360)%360);}}async setPageRotation(t){for(const[e,i]of t){const t=(i%360+360)%360;await n(this,Vo).setPageRotation(e,t);}}async getPdf(t){return n(this,Vo).getPdf(t)}updateAnnotPoint(t,e){return [t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}fixAnnotationPosition(t,e){n(this,zo).has(t)&&e.forEach((e=>{const i=this.updateAnnotPoint([e.rect[0],e.rect[1]],n(this,zo).get(t)),s=this.updateAnnotPoint([e.rect[2],e.rect[3]],n(this,zo).get(t));if(e.rect=[i[0],i[1],s[0],s[1]],"Highlight"===e.type||"StrikeOut"===e.type||"Underline"===e.type||"Squiggly"===e.type)e.quadPoints.forEach((e=>{const i=this.updateAnnotPoint([e[0],e[1]],n(this,zo).get(t)),s=this.updateAnnotPoint([e[2],e[3]],n(this,zo).get(t)),o=this.updateAnnotPoint([e[4],e[5]],n(this,zo).get(t)),r=this.updateAnnotPoint([e[6],e[7]],n(this,zo).get(t));e=[i[0],i[1],s[0],s[1],o[0],o[1],r[0],r[1]];}));else if("Line"===e.type){const i=this.updateAnnotPoint([e.line[0],e.line[1]],n(this,zo).get(t)),s=this.updateAnnotPoint([e.line[2],e.line[3]],n(this,zo).get(t));e.line=[i[0],i[1],s[0],s[1]];}else if("Ink"===e.type)e.inkList.forEach((e=>{for(let i=0;i<e.length;i+=2){const[s,o]=this.updateAnnotPoint([e[i],e[i+1]],n(this,zo).get(t));e[i]=s,e[i+1]=o;}}));else if("Polygon"===e.type||"PolyLine"===e.type)for(let i=0;i<e.vertices.length;i+=2){const[s,o]=this.updateAnnotPoint([e.vertices[i],e.vertices[i+1]],n(this,zo).get(t));e.vertices[i]=s,e.vertices[i+1]=o;}}));}async removePageAnnotations(t){await n(this,Vo).deletePageAnnotationsByTypes(t,"");}async setPageAnnotations(t,e,i){let s;return e&&e.length>0&&this.fixAnnotationPosition(t,e),i?e&&e.length>0&&(s=await n(this,Vo).addAnnotationsToPage(t,e)):s=await n(this,Vo).setPageAnnotations(t,e),s}async flattenPageAnnotations(t,e){e&&e.length>0&&this.fixAnnotationPosition(t,e);return await n(this,Vo).flattenPageAnnotations(t,e)}async flattenPage(t){return await n(this,Vo).flattenPage(t)}async getFontInfo(t){return await n(this,Vo).getFontInfo(t)}async ifFontsExist(t){return await n(this,Vo).ifFontsExist(t)}}class Go{constructor(){i(this,"imageWriter",void 0),this.imageWriter=new Co;}destroy(){var t;null===(t=this.imageWriter)||void 0===t||t.terminate(),this.imageWriter=void 0;}async save(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.imageWriter.saveImage(t,{outputType:e.outputType,jpegQuality:e.jpegQuality,returnType:e.returnType,is1Bit:e.is1Bit})}}class Xo{constructor(){i(this,"imageWriter",void 0),i(this,"tiffCompression",void 0),i(this,"tiffQuality",void 0),this.imageWriter=new Co,this.tiffCompression=Ho.get(exports.EnumTIFFCompressionType.TIFF_AUTO);}destroy(){var t;null===(t=this.imageWriter)||void 0===t||t.terminate(),this.imageWriter=void 0;}async init(t){if(await this.imageWriter.createTiff(),t&&(this.tiffQuality=t.quality,t.compression&&(this.tiffCompression=Ho.get(t.compression)),t.customTag))for(let e=0;e<t.customTag.length;e++)await this.imageWriter.addTiffTag(t.customTag[e].id,t.customTag[e].content,t.customTag[e].contentIsBase64);}async appendPage(t,e){await this.imageWriter.appendImage(t,{inputType:void 0,tiffFormat:this.tiffCompression,jpegQuality:this.tiffQuality,is1Bit:null==e?void 0:e.is1Bit});}async getTiff(){return this.imageWriter.getTiff()}}class Yo{constructor(t){i(this,"uid",void 0),this.uid=t||ts();}equals(t){return null!=t&&void 0!==t&&(this===t||!!function(t){return t instanceof Yo}(t)&&this.uid===t.uid)}}class qo extends Yo{}let Jo=class{constructor(t){i(this,"type",void 0),i(this,"uid",void 0),this.type=t,this.uid=ts();}};class Zo{constructor(t){i(this,"bubbles",!0),i(this,"cancelBubble",!0),i(this,"cancelable",!1),i(this,"composed",!1),i(this,"currentTarget",void 0),i(this,"defaultPrevented",!1),i(this,"eventPhase",Zo.prototype.NONE),i(this,"isTrusted",void 0),i(this,"returnValue",void 0),i(this,"srcElement",void 0),i(this,"target",void 0),i(this,"timeStamp",void 0),i(this,"type",void 0),i(this,"detail",void 0),i(this,"view",void 0),i(this,"which",void 0),i(this,"path",void 0),i(this,"immediatePropagationStopped",!1),i(this,"propagationStopped",!1),i(this,"nativeEvent",void 0),i(this,"originalEvent",void 0),i(this,"eventService",void 0),i(this,"NONE",0),i(this,"CAPTURING_PHASE",1),i(this,"AT_TARGET",2),i(this,"BUBBLING_PHASE",3),this.eventService=t;}initUIEvent(t,e,i,n,s){}composedPath(){const{path:t,eventService:e,target:i}=this;return !e||t&&t[this.path.length-1]===i||(this.path=i?e.getPropagationPath(i):[]),this.path}bindEvents(t,e,i){}preventDefault(){const{nativeEvent:t}=this;t instanceof Event&&t.cancelable&&t.preventDefault(),this.defaultPrevented=!0;}stopImmediatePropagation(){this.immediatePropagationStopped=!0;}stopPropagation(){this.propagationStopped=!0;}}function Qo(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which;}class Ko extends Zo{constructor(t,e){super(null),this.type=t,this.detail=e;}}class tr{constructor(){i(this,"pubsub",ns.create());}addEventListener(t,e,i){let n,s=Xn(i)&&i;Hn(i)&&(s=i.capture,n=i.once),t=s?`${t}:capture`:t,e=Yn(e)?e:e.handleEvent,this.pubsub.on(t,e,this,n);}dispatchEvent(t){const e=this.ownerDocument||this.document;var i;e&&(t.eventService=(null===(i=e.defaultView)||void 0===i?void 0:i.eventService)||null,t.defaultPrevented=!1,t.path=[],t.target=this,ir(t));return !t.defaultPrevented}removeEventListener(t,e,i){let n=Xn(i)&&i;Hn(i)&&(n=i.capture),t=n?`${t}:capture`:t,e=Yn(e)?e:e.handleEvent,this.pubsub.off(t,e);}removeAllEventListeners(){this.pubsub.removeAllEventListeners();}getAllEvents(){return this.pubsub.getAllEvents()}}function er(t,e){const i=t.currentTarget.getAllEvents()[e]||[];for(let e=0,n=i.length;e<n;e++){if(t.immediatePropagationStopped)return;const{context:n,fn:s}=i[e];s.call(n,t);}}function ir(t,e){var i;if(e=null!==(i=e)&&void 0!==i?i:t.type,t.propagationStopped=!1,t.immediatePropagationStopped=!1,!t.target)return;const n=t.composedPath(),s=n.length;t.eventPhase=t.CAPTURING_PHASE;for(let i=0;i<s-1;i++){t.currentTarget=n[i];if(er(t,`${e}:capture`),nr(t))return}if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,er(t,e),!nr(t)){t.eventPhase=t.BUBBLING_PHASE;for(let i=s-2;i>=0;i--)if(t.currentTarget=n[i],er(t,e),nr(t))return}}function nr(t){return t.propagationStopped||t.immediatePropagationStopped}const sr=t=>t/180*Math.PI,or=t=>t/Math.PI*180;class rr{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,"x",0),i(this,"y",0),this.x=t,this.y=e;}static fromValue(t,e){return new rr(t,e)}static fromPoint(t){return new rr(t.x,t.y)}static fromTwoPoint(t,e){var i,n,s,o;return new rr((null!==(i=e.x)&&void 0!==i?i:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(s=e.y)&&void 0!==s?s:0)-(null!==(o=t.y)&&void 0!==o?o:0))}static create(){return new rr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)}setFromVector(t){this.x=t.x,this.y=t.y;}clone(){return new rr(this.x,this.y)}norm(){return Math.hypot(this.x,this.y)}dot(t){return this.x*t.x+this.y*t.y}projectionTo(t){const e=Math.hypot(t.x,t.y);return this.dot(t)/e}angle(t){const e=this.norm()*Math.hypot(t.x,t.y);return Math.acos(this.dot(t)/e)}equals(t){return this.x===t.x&&this.y===t.y}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i,y:n}=this;return new rr(i+(t.x-i)*e,n+(t.y-n)*e)}normalize(){const t=this.norm();return this.x/=t,this.y/=t,this}negate(){return this.x*=-1,this.y*=-1,this}cross(t){return this.x*t.y-this.y*t.x}add(t){return new rr(this.x+t.x,this.y+t.y)}addSelf(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return new rr(this.x-t.x,this.y-t.y)}subSelf(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return new rr(this.x*t.x,this.y*t.y)}multiplySelf(t){return this.x*=t.x,this.y*=t.y,this}}class ar{constructor(t){i(this,"a",1),i(this,"b",0),i(this,"c",0),i(this,"d",1),i(this,"e",0),i(this,"f",0),i(this,"m11",1),i(this,"m12",0),i(this,"m13",0),i(this,"m21",0),i(this,"m22",1),i(this,"m23",0),i(this,"m31",0),i(this,"m32",0),i(this,"m33",1),t&&this.setFromMatrix(t);}static compose(t,e,i){const n=sr(i),s=Math.cos(n),o=Math.sin(n),r=e.x*s,a=e.x*o,l=-e.y*o,h=e.y*s,d=t.x,c=t.y;return ar.fromMatrix({m11:r,m21:l,m31:d,m12:a,m22:h,m32:c,m13:0,m23:0,m33:1})}static create(t){return new ar(t)}static fromMatrix(t){return (new ar).setFromMatrix(t)}static createRotationMatrix(t,e){const i=cr(t,e);return ar.fromMatrix(i)}static createTranslationMatrix(t){const e=hr(t.x,t.y);return ar.fromMatrix(e)}static createScaleMatrix(t){const e=dr(t.x,t.y);return ar.fromMatrix(e)}setFromMatrix(t){if(Array.isArray(t)){const[e,i,n,s,o,r]=t;this.m11=e,this.m12=i,this.m13=0,this.m21=n,this.m22=s,this.m23=0,this.m31=o,this.m32=r,this.m33=1;}else {var e,i,n,s,o,r,a,l,h,d,c,u,p,g,f;this.m11=null!==(e=null!==(i=t.m11)&&void 0!==i?i:t.a)&&void 0!==e?e:1,this.m12=null!==(n=null!==(s=t.m12)&&void 0!==s?s:t.b)&&void 0!==n?n:0,this.m13=null!==(o=t.m13)&&void 0!==o?o:0,this.m21=null!==(r=null!==(a=t.m21)&&void 0!==a?a:t.c)&&void 0!==r?r:0,this.m22=null!==(l=null!==(h=t.m22)&&void 0!==h?h:t.d)&&void 0!==l?l:1,this.m23=null!==(d=t.m23)&&void 0!==d?d:0,this.m31=null!==(c=null!==(u=t.m31)&&void 0!==u?u:t.e)&&void 0!==c?c:0,this.m32=null!==(p=null!==(g=t.m32)&&void 0!==g?g:t.f)&&void 0!==p?p:0,this.m33=null!==(f=t.m33)&&void 0!==f?f:1;}return this.a=this.m11,this.b=this.m12,this.c=this.m21,this.d=this.m22,this.e=this.m31,this.f=this.m32,this}clone(){return ar.fromMatrix(this)}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().translateSelf(t,e)}translateSelf(){const t=hr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);return this.multiplySelf(t)}multiplySelf(){const t=lr(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(t)}preMultiplySelf(){const t=lr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(t)}multiply(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.clone().multiplySelf(t)}scaleSelf(t,e,i,n){var s,o;void 0===e&&(e=t),null!==(s=i)&&void 0!==s||(i=0),null!==(o=n)&&void 0!==o||(n=0),0===i&&0===n||this.translateSelf(i,n);const r=dr(t,e);return this.multiplySelf(r)}scale(t,e,i,n){return this.clone().scaleSelf(t,e,i,n)}rotateSelf(t,e,i){var n,s;null!==(n=e)&&void 0!==n||(e=0),null!==(s=i)&&void 0!==s||(i=0);const o=cr(t,{x:e,y:i});return this.multiplySelf(o)}rotate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().rotateSelf(t)}invertSelf(){const t=function(t){const{m11:e,m21:i,m31:n,m12:s,m22:o,m32:r}=t,a=1/(e*o-s*i);return {m11:o*a,m21:-i*a,m31:(i*r-o*n)*a,m12:-s*a,m22:e*a,m32:(s*n-e*r)*a,m13:0,m23:0,m33:1}}(this);return this.setFromMatrix(t)}inverse(){return this.clone().invertSelf()}getScaling(){const t=Math.hypot(this.m11,this.m12),e=Math.hypot(this.m21,this.m22);return new rr(t,e)}getScaleMatrix(){const t=this.getScaling(),e=dr(t.x,t.y);return ar.fromMatrix(e)}getTranslation(){return new rr(this.m31,this.m32)}getRotationMatrix(){const t=this.getScaling(),e={m11:this.m11/t.x,m12:this.m12/t.x,m13:0,m21:this.m21/t.y,m22:this.m22/t.y,m23:0,m31:0,m32:0,m33:1};return ar.fromMatrix(e)}getRotation(){const t=Math.atan2(this.m12,this.m11);return or(t)}decompose(){let{m11:t,m12:e,m21:i,m22:n}=this;const s={x:this.m31,y:this.m32},o={x:Math.hypot(t,e),y:Math.hypot(i,n)};t*n-e*i<0&&(t<n?o.x=-o.x:o.y=-o.y),o.x&&(t/=o.x,e/=o.x),o.y&&(i/=o.y,n/=o.y);const r=Math.atan2(e,t);return {translation:s,scale:o,rotation:or(r)}}transformPoint(t){const{m11:e,m12:i,m21:n,m22:s,m31:o,m32:r}=this;return {x:t.x*e+t.y*n+o,y:t.x*i+t.y*s+r}}}function lr(t,e){const i={},{m11:n,m21:s,m31:o,m12:r,m22:a,m32:l,m13:h,m23:d,m33:c}=t,{m11:u,m21:p,m31:g,m12:f,m22:y,m32:m,m13:v,m23:x,m33:w}=e;return i.m11=n*u+s*f+o*v,i.m21=n*p+s*y+o*x,i.m31=n*g+s*m+o*w,i.m12=r*u+a*f+l*v,i.m22=r*p+a*y+l*x,i.m32=r*g+a*m+l*w,i.m13=h*u+d*f+c*v,i.m23=h*p+d*y+c*x,i.m33=h*g+d*m+c*w,i}function hr(){return {m11:1,m21:0,m31:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m12:0,m22:1,m32:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m13:0,m23:0,m33:1}}function dr(){return {m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m13:0,m23:0,m33:1}}function cr(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};const e=sr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0),i=Math.cos(e),n=Math.sin(e),{x:s,y:o}=t;return {m11:i,m21:-n,m31:s-s*i+o*n,m12:n,m22:i,m32:o-s*n-o*i,m13:0,m23:0,m33:1}}const ur=new class{recursiveUpdateHierarchy(t){const{transform:e,childNodes:i}=t;e.frozen||(e.frozen=!0,(e.localDirty||e.worldDirty)&&this.updateHierarchy(t),i.forEach((t=>{this.recursiveUpdateHierarchy(t);})));}querySelector(t,e){return t.startsWith("#")?e.find((e=>e.id===t.substring(1))):null}querySelectorAll(t,e){return []}append(t,e,i){t.parentNode&&this.remove(t),t.parentNode=e;const{childNodes:n,sortable:s}=e;void 0!==i?n.splice(i,0,t):n.push(t),s&&(s.dirty=!0);const{transform:o}=t;o&&this.dirtyWorld(t,o),o.frozen&&this.unfreezeParentToRoot(t);}remove(t){const{parentNode:e}=t;let i=!0;if(!e)return i=!1,i;const{sortable:n}=e;n&&(n.dirty=!0);const{childNodes:s}=e,o=s.indexOf(t);o>-1?(i=!0,s.splice(o,1)):i=!1;const{transform:r}=t;return r&&this.dirtyWorld(t,r),t.parentNode=null,i}isChildExist(t){const{parentNode:e}=t;if(!e)return !1;const{childNodes:i}=e;return !(i.indexOf(t)<0)}setOrigin(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Jn(e)&&(e=rr.fromValue(e,i));const{transform:n}=t;n.origin.equals(e)||(n.origin.setFromVector(e),this.dirtyLocal(t,n));}getOrigin(t){return t.transform.origin.clone()}setPosition(t,e){const{transform:i}=t,n=this.getPosition(t);if(n.equals(e))return;let s=this.getWorldTransform(t);if(i.position.setFromVector(e),t.hasParentTransform()){s=ar.create().translateSelf(e.x-n.x,e.y-n.y).multiply(s);const{worldTransform:o}=t.parentNode.transform,r=this.getWorldTransform(t);r.m31=e.x,r.m32=e.y;const a=o.inverse().multiply(s),l=this.getOrigin(t),h=a.getScaleMatrix().inverse(),d=a.translate(l.x,l.y).multiply(h),c=d.getRotationMatrix().inverse(),u=d.multiply(c).getTranslation();u.subSelf(l),i.localPosition.setFromVector(u);}else i.localPosition.setFromVector(e);this.dirtyLocal(t,i);}setLocalPosition(t,e){const{transform:i}=t;i.localPosition.equals(e)||(i.localPosition.setFromVector(e),this.dirtyLocal(t,i));}getPosition(t){const e=this.getWorldTransform(t),{transform:i}=t,n=e.getTranslation();return i.position.setFromVector(n),t.transform.position.clone()}getLocalPosition(t){return t.transform.localPosition.clone()}translate(t,e){if(0===e.x&&0===e.y)return;const i=this.getPosition(t);i.addSelf(e),this.setPosition(t,i);}translateLocal(t,e){const{transform:i}=t;if(0===e.x&&0===e.y)return;const n=rr.fromPoint(e).multiplySelf(i.localScale),s=ar.createRotationMatrix(i.localRotation).transformPoint(n);i.localPosition.addSelf(s),this.dirtyLocal(t,i);}scaleLocal(t,e){const{transform:i}=t;i.localScale.multiplySelf(e),this.dirtyLocal(t,i);}setLocalScale(t,e){const{transform:i}=t;i.localScale.equals(e)||(i.localScale.setFromVector(e),this.dirtyLocal(t,i));}getScale(t){const{transform:e}=t,i=this.getWorldTransform(t).getScaling();return e.scale.setFromVector(i),e.scale.clone()}getLocalScale(t){return t.transform.localScale.clone()}getRotation(t){const{transform:e}=t,i=this.getWorldTransform(t).getRotation();return e.rotation=i,i}getLocalRotation(t){return t.transform.localRotation}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e)return;const{transform:i}=t;if(t.hasParentTransform()){const n=this.getRotation(t),s=-this.getRotation(t.parentNode)+e+n;i.localRotation=s,this.dirtyLocal(t,i);}else this.rotateLocal(t,e);}rotateLocal(t,e){const{transform:i}=t;i.localRotation+=e,this.dirtyLocal(t,i);}setAngle(t,e){const{transform:i}=t;if(t.hasParentTransform()){const n=this.getRotation(t.parentNode);i.localRotation=-n+e,this.dirtyLocal(t,i);}else this.setLocalAngle(t,e);}setLocalAngle(t,e){const{transform:i}=t;i.localRotation=e,this.dirtyLocal(t,i);}getAngle(t){return this.getWorldTransform(t).getRotation()}getLocalAngle(t){return this.getLocalRotation(t)}setLocalTransform(t,e){const i=this.getOrigin(t),{rotation:n,scale:s}=e.decompose(),o=ar.createScaleMatrix(s).inverse(),r=e.translate(i.x,i.y).multiply(o).getTranslation();r.subSelf(i),this.setLocalPosition(t,r),this.setLocalAngle(t,n),this.setLocalScale(t,s);}resetLocalTransform(t){this.setLocalScale(t,new rr(1,1)),this.setLocalPosition(t,new rr(0,0)),this.setLocalAngle(t,0);}getWorldTransform(t){const{transform:e}=t;if(!e.worldDirty&&!e.localDirty)return e.worldTransform;const{parentNode:i}=t;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(t),e.worldTransform.clone()}getLocalTransform(t){const{transform:e}=t;return e.localDirty&&e.updateLocalTransform(),e.localTransform.clone()}getBounds(t,e){const{renderable:i,childNodes:n}=t;if(e&&!i.renderBoundsDirty&&i)return i.renderBounds;if(!e&&!i.boundsDirty&&i.bounds)return i.bounds;let s=this.getTransformedGeometryBounds(t,e);n.forEach((t=>{const i=this.getBounds(t,e);i&&(s?s.addBounds(i):s=el.fromBounds(i));}));const{clipPath:o}=t.style;if(o){const e=this.getTransformedGeometryBounds(o,!0);let i=null;e&&(i=el.create(),i.setFromTransformedBounds(this.getWorldTransform(t),e)),s?i&&(s=i.intersection(s)):s=i;}return e?(i.renderBoundsDirty=!1,s&&(i.renderBounds=s)):(i.boundsDirty=!1,s&&(i.bounds=s)),s||el.create()}getLocalBounds(t){const{parentNode:e}=t;if(e){let i=ar.create();if(e.transform){i=this.getWorldTransform(e).inverse();}const n=this.getBounds(t);if(!el.isEmpty(n)){const t=el.create();return t.setFromTransformedBounds(i,n),t}}return this.getBounds(t)}getGeometryBounds(t,e){const{geometry:i}=t;return (e?i.renderBounds:i.contentBounds)||el.create()}getBoundingClientRect(t){var e;let i;const n=this.getGeometryBounds(t);el.isEmpty(n)||(i=el.create(),i.setFromTransformedBounds(this.getWorldTransform(t),n));const s=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==s?void 0:s.left)||0),y:i.minY+((null==s?void 0:s.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==s?void 0:s.left)||0,y:(null==s?void 0:s.top)||0,width:0,height:0}}updateHierarchy(t){const{transform:e}=t;if(e.localDirty&&e.updateLocalTransform(),e.worldDirty){var i;let n=null==t||null===(i=t.parentNode)||void 0===i?void 0:i.transform;t.parentNode&&n||(n=new yr),e.updateWorldTransform(n);}}getTransformedGeometryBounds(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.getGeometryBounds(t,e);if(!el.isEmpty(i)){const e=el.create();return e.setFromTransformedBounds(this.getWorldTransform(t),i),e}return null}dirtyLocal(t,e){e.localDirty||(e.localDirty=!0,e.worldDirty||this.dirtyWorld(t,e));}dirtyWorld(t,e){e.worldDirty||this.unfreezeParentToRoot(t),this.recursiveDirtyWorld(t,e),function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t;for(;i;){const{renderable:t}=i;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0),i=i.parentNode;}const n=new Ko("bounds-changed",{affectChildren:e});t.dispatchEvent(n);}(t,!0);}recursiveDirtyWorld(t,e){if(e.worldDirty)return;e.worldDirty=!0,e.frozen=!1,t.childNodes.forEach((t=>{const{transform:e}=t;e.worldDirty||this.recursiveDirtyWorld(t,e);}));const{renderable:i}=t;i&&(i.boundsDirty=!0,i.renderBoundsDirty=!0);const n=new fl("DOMAttrModified",t,null,null,"modelMatrix",fl.MODIFICATION,null,null);t.dispatchEvent(n);}unfreezeParentToRoot(t){let e=t;for(;e;){const{transform:t}=e;t&&(t.frozen=!1),e=e.parentNode;}}};class pr{constructor(){i(this,"contentBounds",void 0),i(this,"renderBounds",void 0);}}class gr{constructor(){i(this,"boundsDirty",!0),i(this,"bounds",void 0),i(this,"renderBoundsDirty",!0),i(this,"renderBounds",void 0);}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0;}}class fr{constructor(){i(this,"renderOrder",0),i(this,"lastSortedIndex",void 0),i(this,"sorted",void 0),i(this,"dirty",!1);}}let yr=class{constructor(){i(this,"frozen",!0),i(this,"worldDirty",!1),i(this,"localDirty",!1),i(this,"localRotation",0),i(this,"rotation",0),i(this,"localScale",rr.create(1,1)),i(this,"scale",rr.create(1,1)),i(this,"localPosition",rr.create(0,0)),i(this,"position",rr.create(0,0)),i(this,"localSkew",rr.create(0,0)),i(this,"skew",rr.create(0,0)),i(this,"origin",rr.create(0,0)),i(this,"worldTransform",ar.create()),i(this,"localTransform",ar.create());}updateLocalTransform(){const{origin:t,localScale:e,localPosition:i,localRotation:n}=this,s=ar.create();s.translateSelf(t.x,t.y);const o=ar.compose(i,e,n);s.multiplySelf(o),s.translateSelf(-t.x,-t.y),this.localTransform.setFromMatrix(s),this.localDirty=!1;}updateWorldTransform(t){const e=t.worldTransform.clone();e.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(e),this.worldDirty=!1;}};function mr(t,e){if(Number.isNaN(e))return {unit:"px",value:0};if(Hs(e))return {unit:"px",value:0};if(Jn(e))return {unit:"px",value:e};if(e=e.trim().toLowerCase(),Number.isFinite(Number(e))&&"px".search(t)>=0)return {unit:"px",value:Number(e)};const i=[];e=e.replace(t,(t=>(i.push(t),`U${t}`)));const n=`U(${t.source})`;return i.map((t=>({unit:t,value:Number(e.replace(new RegExp(`U${t}`,"g"),"").replace(new RegExp(n,"g"),"*0"))})))[0]}const vr=t=>mr(/px|pt/g,t),xr=t=>mr(/px|%|em/g,t),wr=t=>mr(/deg|rad|grad|turn/g,t);class br{constructor(t,e,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];i(this,"r",void 0),i(this,"g",void 0),i(this,"b",void 0),i(this,"alpha",void 0),i(this,"isNone",void 0),i(this,"formatted",""),this.r=t,this.g=e,this.b=n,this.alpha=s,this.isNone=o,this.formatted=`rgba(${t}, ${e}, ${n}, ${s})`;}clone(){return new br(this.r,this.g,this.b,this.alpha)}}class Cr{constructor(t,e){i(this,"type",void 0),i(this,"value",void 0),this.type=t,this.value=e;}clone(){return new Cr(this.type,this.value)}}const Sr={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},Pr=t=>{let e;return e="angular"===t.type?Number(t.value):Sr[t.value]||0,{value:e,unit:"deg"}},Ar=t=>{if(t.includes("linear")||t.includes("radial")){return bs(t).map((t=>{let{type:e,orientation:i,colorStops:n}=t;!function(t){var e;const{length:i}=t;var n;t[i-1].length=null!==(e=t[i-1].length)&&void 0!==e?e:{type:"%",value:"100"},i>1&&(t[0].length=null!==(n=t[0].length)&&void 0!==n?n:{type:"%",value:"0"});let s=0,o=Number(t[0].length.value);for(let e=1;e<i;e++){var r;const i=null===(r=t[e].length)||void 0===r?void 0:r.value;if(!Hs(i)&&!Hs(o)){for(let n=1;n<e-s;n++)t[s+n].length={type:"%",value:`${o+(Number(i)-o)*n/(e-s)}`};s=e,o=Number(i);}}}(n);const s=n.map((t=>({offset:{value:t.length.value,unit:"%"},color:ws(t)})));if("linear-gradient"===e)return new Cr(1,{angle:i?Pr(i):{value:0,unit:"deg"},steps:s});if("radial-gradient"===e){i||(i=[{type:"shape",value:"circle"}]);const t=i[0];if("shape"===(null==t?void 0:t.type)&&"circle"===(null==t?void 0:t.value)){const{cx:i,cy:n}=(t=>{let e=50,i=50,n="%",s="%";if("position"===(null==t?void 0:t.type)){const{x:o,y:r}=t.value;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?e=0:"center"===o.value?e=50:"right"===o.value?e=100:"top"===o.value?i=0:"bottom"===o.value&&(i=100)),"position-keyword"===(null==r?void 0:r.type)&&("left"===r.value?e=0:"center"===r.value?i=50:"right"===r.value?e=100:"top"===r.value?i=0:"bottom"===r.value&&(i=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(n=null==o?void 0:o.type,e=Number(o.value)),"px"!==(null==r?void 0:r.type)&&"%"!==(null==r?void 0:r.type)&&"em"!==(null==r?void 0:r.type)||(s=null==r?void 0:r.type,i=Number(r.value));}return {cx:{value:e,unit:n},cy:{value:i,unit:s}}})(null==t?void 0:t.at);let o;if(null!=t&&t.style){const{type:i,value:n}=t.style;o="extent-keyword"===i?n:{value:n,unit:e};}return new Cr(2,{cx:i,cy:n,size:o,steps:s})}}}))}};function Tr(t){const e=t.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(e[3]||"1"),n=Math.floor(i*parseInt(e[0],10)+255*(1-i)),s=Math.floor(i*parseInt(e[1],10)+255*(1-i)),o=Math.floor(i*parseInt(e[2],10)+255*(1-i));return `#${`0${n.toString(16)}`.slice(-2)}${`0${s.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`}function kr(t){return /^hsla?\(.+\)$/i.test(t)}function Dr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Hs(t))return null;if("currentColor"===t&&(t="black"),"transparent"===t)return new br(0,0,0,0);const e=Ar(t);if(e)return e;if(kr){const e=document.createElement("div");e.style.color=t,t=e.style.color;}const i=Nn(t),n=[0,0,0,0];return null!==i&&(n[0]=parseInt(i.r,10)||0,n[1]=parseInt(i.g,10)||0,n[2]=parseInt(i.b,10)||0,n[3]=parseFloat(i.opacity)),new br(...n)}function Er(t){let e=null;Fn(t)&&(e=t),Zn(t)&&(e=t.split(" "));for(let t=0;t<3;t++)e[t]?e[t]=vr(e[t]).value:e[t]=0;const i=Dr(e[3]);return e[3]=i?i.formatted:"black",e.slice(0,4)}function Ir(t){const e=[];return Zn(t)?t.split(" ").forEach((t=>{const i=vr(t);i&&e.push(i.value);})):e.push(...t),1===e.length?[e[0],e[0]]:e}const Rr=t=>{let e=t;if(Zn(t)){const i=xr(t);"%"===i.unit&&(e=i.value/100),"px"===i.unit&&(e=i.value);}return e>1&&(e=1),e},Mr={visibility:"visible",x:0,y:0,zIndex:0,anchor:[0,0],lineDash:[0,0],opacity:1,fillOpacity:1,borderOpacity:1,miterLimit:10,lineDashOffset:0,lineJoin:"miter",lineCap:"butt",borderColor:"black",renderBlendMode:"normal"},Br={color:"rgb(0,0,0)",fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",fontSize:20};function Lr(t){const e=[];return t.forEach((t=>{e.push({...Br,...t,fontSize:vr(t.fontSize||Br.fontSize)});})),e}function Ur(t,e,i,n){const{x:s=0,y:o=0}=i.parsedStyle,{x:r,y:a}=i.getLocalPosition();i.boundsDirty=!0,"x"===n&&s===r||"y"===n&&o===a||i.setLocalPosition(s,o);}function Or(t,e,i){if(!(i instanceof _a||i instanceof Wa||i instanceof Ba))return;if(t===e)return;i.pathDirty=!0,i.boundsDirty=!0,i.getPath();const{x:n,y:s}=i.getBoundingRect();i.updatePosition(n,s),i.updateOrigin();}function Nr(t,e,i){!(i instanceof Fa)||i instanceof $a||i instanceof Ma||t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath(),i.updateOrigin());}function _r(t,e,i){(i instanceof Ea||i instanceof Ia||i instanceof Ra)&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath());}function Wr(t,e,i){if(!(i instanceof Va||i instanceof Wa))return;if(t===e)return;i.pathDirty=!0,i.boundsDirty=!0,i.getPath();const{x:n,y:s}=i.getBoundingRect();i.updatePosition(n,s),i.updateOrigin();}function Fr(t,e,i){t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath());}function Hr(t,e,i){i instanceof Ha&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath());}function Vr(t,e,i,n){i instanceof Ga&&t!==e&&(i.setLimitWidth(i.parsedStyle.width.value),i.pathDirty=!0,i.boundsDirty=!0,("freeTextWriter"!==i.textType||"freeTextWriter"===i.textType&&["width","textContents"].includes(n))&&i.calculateTextLines(),i.getPath(),null!=i&&i.isEditMode||i.updateOrigin());}class zr{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,"x",void 0),i(this,"y",void 0),this.x=t,this.y=e;}static fromPoint(t){return new zr(t.x,t.y)}setFromPoint(t){return this.x=t.x||0,this.y=t.y||0,this}clone(){return new zr(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y)}lerpTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return new zr(this.x+e*(t.x-this.x),this.y+e*(t.y-this.y))}footPointInSegment(t,e){const i=rr.fromTwoPoint(t,this),n=rr.fromTwoPoint(t,e),s=n.norm(),o=zr.fromPoint(t);if(0===s)return o;const r=i.projectionTo(n)/s;return o.lerpTo(e,r)}perpendicularToSegment(t,e){const i=this.footPointInSegment(t,e);return this.distanceTo(i)}}function jr(t,e,i){const n=t.x-e.x,s=t.y-e.y;let o=(i.x-t.x)*n+(i.y-t.y)*s;o/=n*n+s*s;return new zr(t.x+o*n,t.y+o*s)}function $r(t,e,i,n){let s=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return !((s^o)>=0&&0!==s&&0!==o)&&(s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),o=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),!((s^o)>=0&&0!==s&&0!==o))}function Gr(t,e,i,n,s){const o=s||[],r=t[e],a=t[i];let l=0,h=1;for(let n=e+1;n<i;n++){const e=jr(r,a,t[n]),i=(d=e,c=t[n],((d.x-c.x)**2+(d.y-c.y)**2)**.5);i>l&&(l=i,h=n);}var d,c;return l>=n?(Gr(t,e,h,n,o),Gr(t,h,i,n,o)):(!o.length&&r&&o.push(r),o.push(a)),o}function Xr(t,e,i,n,s,o){const r=function(t,e,i,n,s,o){const r=function(t,e,i){const n=Math.cos(t),s=Math.sin(t);return function(t,o){return {x:n*(t-e)+s*(o-i),y:-s*(t-e)+n*(o-i)}}}((p=s-t,g=o-e,Math.atan2(g,p)),(t+s)/2,(e+o)/2),a=r(t,e),l=r(i,n),h=r(s,o),d=Math.abs(a.x),[c,u]=[l.y/2,0].sort(((t,e)=>t-e));var p,g;let f,y;l.x>=a.x&&l.x<=h.y?[f,y]=[a.x,h.x]:l.x>0?[f,y]=[a.x,.5*(l.x+d*d/l.x)]:[f,y]=[.5*(l.x+d*d/l.x),h.x];return function(t,e,i){const n=r(t,e);return !(n.x<f-i||n.x>y+i)&&!(n.y<c-i||n.y>u+i)}}(t,e,i,n,s,o),{getDistance:a}=function(t,e,i,n,s,o){const r=[i-t,n-e],a=[t-2*i+s,e-2*n+o],l=[2*r[0],2*r[1]],h=1/qr(a,a),d=h*qr(r,a),c=d*d,u=qr(r,r),p=3**.5,g=0===qr(a,a)?function(t){return 0===u?0:Yr(-qr(r,t)/2/u,0,1)}:function(t){const e=h*(2*u+qr(t,a))/3,i=h*qr(t,r),n=e-c,s=d*(2*c-3*e)+i;let o=s*s+4*(n*n*n);if(o>=0){o=Math.sqrt(o);const t=(o-s)/2,e=(-o-s)/2;return Yr(Math.sign(t)*Math.abs(t)**(1/3)+Math.sign(e)*Math.abs(e)**(1/3)-d,0,1)}const l=Math.sqrt(-n),g=Math.acos(s/(n*l*2))/3,f=Math.cos(g),y=Math.sin(g)*p;return [Yr((f+f)*l-d,0,1),Yr((-y-f)*l-d,0,1)]};return {getDistance(i,n){const s=[t-i,e-n],o=g(s);if("number"==typeof o)return Math.sqrt(Jr((l[0]+a[0]*o)*o+s[0],(l[1]+a[1]*o)*o+s[1]));const[r,h]=o;return Math.sqrt(Math.min(Jr(s[0]+(l[0]+a[0]*r)*r,s[1]+(l[1]+a[1]*r)*r),Jr(s[0]+(l[0]+a[0]*h)*h,s[1]+(l[1]+a[1]*h)*h)))}}}(t,e,i,n,s,o);return {isHit:function(t,e){return function(t,e,i){return !!r(t,e,i)&&a(t,e)<=i}(t[0],t[1],e)}}}function Yr(t,e,i){return Math.min(Math.max(t,e),i)}function qr(t,e){return t[0]*e[0]+t[1]*e[1]}function Jr(t,e){return t*t+e*e}function Zr(t,e,i,n,s){const{PI:o,cos:r,sin:a,min:l,max:h,tan:d}=Math;s-n>2*o&&(s=n+2*o);let c=h(o/12,(s-n)/12);const u=[];for(u.push({x:t+i*r(n),y:e+i*a(n)});n<s;){const o=t+i*r(n),h=e+i*a(n),p=l(s,n+c);c=l(s-n,c);const g=t+i*r(p),f=e+i*a(p),y=i*d(c/3),m={x:o-(h-e)/i*y,y:h+(o-t)/i*y},v={x:g+(f-e)/i*y,y:f-(g-t)/i*y},x={x:g,y:f};u.push(m,v,x),n+=c;}return u}function Qr(t,e,i,n){const s=t-i,o=t+i,r=e-n,a=e+n,l=.551915024494,h=l*i,d=l*n,c=[];return c.push({x:o,y:e}),c.push({x:o,y:e+d},{x:t+h,y:a},{x:t,y:a}),c.push({x:t-h,y:a},{x:s,y:e+d},{x:s,y:e}),c.push({x:s,y:e-d},{x:t-h,y:r},{x:t,y:r}),c.push({x:t+h,y:r},{x:o,y:e-d},{x:o,y:e}),c}function Kr(t,e){return {type:t,data:e,close:arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}function ta(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t.length;if(i<=1)return [];const n=[],[s]=t;n.push(Kr("moveTo",[s]));for(let e=0;e+3<i;e+=3){const i=t[e+1],s=t[e+2],o=t[e+3];n.push(Kr("bezierCurveTo",[i,s,o]));}return e&&t.length>2&&n.push(Kr("lineTo",[s])),n}function ea(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function ia(t,e){const i=t.length;if(i<=1)return [];if(2===i)return [{index:0,ops:[Kr("moveTo",[t[0]])]},{index:1,ops:[Kr("lineTo",[t[1]])]}];let n=i-e;i<=e&&(n=0);const s=[];let o=[],r={index:n,ops:[]};if(s.push(r),i<=e){const e=Kr("moveTo",[t[0]]);r.ops.push(e),o=[...t];}else o=t.slice(-e);const a=function(t,e,i){const n=[];for(let s=1;s<t.length-1;s++){const o=180*Na(Ua(t[s-1],t[s]),Ua(t[s],t[s+1]))/Math.PI;o>=e&&o<=i&&n.push(s);}return n}(o,45,135),l=[];for(let e=0;e<o.length;e++)if(a.includes(e)){const i=t[e-1],s=t[e+1],r=ea(t[e],i),a=ea(t[e],s);let h,d;r>6&&(h=la(i,t[e],.2),l.push({val:h})),l.push({index:e+n,val:o[e]}),a>6&&(d=la(s,t[e],.2),l.push({val:d}));}else l.push({index:e+n,val:o[e]});for(let t=0;t<l.length;t++){var h,d,c,u,p,g;const e=l[t],i=l[t].val,o=null!==(h=null===(d=l[t-1])||void 0===d?void 0:d.val)&&void 0!==h?h:i,a=null!==(c=null===(u=l[t+1])||void 0===u?void 0:u.val)&&void 0!==c?c:i,f=na(o,i,a,null!==(p=null===(g=l[t+2])||void 0===g?void 0:g.val)&&void 0!==p?p:a);void 0!==e.index&&(e.index!==n&&(r={index:void 0,ops:[]},s.push(r)),r.index=e.index),r.ops.push(f);}return s}function na(t,e,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const o=ea(e,i);let r={x:e.x+(i.x-t.x)/s,y:e.y+(i.y-t.y)/s},a={x:i.x-(n.x-e.x)/s,y:i.y-(n.y-e.y)/s};const l=ea(r,e),h=ea(a,i);l>o&&(r=la(r,e,o)),h>o&&(a=la(a,i,o));return Kr("bezierCurveTo",[r,a,i])}function sa(t,e,i){const n=(t.x+e.x)/2,s=(t.y+e.y)/2,o=(e.x+i.x)/2,r=(e.y+i.y)/2;return Kr("bezierCurveTo",[{x:n+2*(e.x-n)/3,y:s+2*(e.y-s)/3},{x:o+2*(e.x-o)/3,y:r+2*(e.y-r)/3},e])}function oa(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];let[n]=t;i.push(Kr("moveTo",[n]));for(let e=1;e<t.length;e++)n=t[e],i.push(Kr("lineTo",[n]));return e&&t.length>2&&([n]=t,i.push(Kr("lineTo",[n]))),i}function ra(t,e){const{data:i,type:n}=e,[s,o,r]=i;switch(n){case"moveTo":t.moveTo(s.x,s.y);break;case"lineTo":t.lineTo(s.x,s.y);break;case"bezierCurveTo":t.bezierCurveTo(s.x,s.y,o.x,o.y,r.x,r.y);break;case"quadraticCurveTo":t.quadraticCurveTo(s.x,s.y,o.x,o.y);}}function aa(t){let{x:e,y:i}=t[0],n=e,s=i;for(let o=1;o<t.length;o++){const{x:r,y:a}=t[o];e=Math.min(e,r),n=Math.max(n,r),i=Math.min(i,a),s=Math.max(s,a);}return {left:e,top:i,right:n,bottom:s,width:n-e,height:s-i}}function la(t,e,i){const n=e.x-t.x,s=e.y-t.y,o=Math.abs(n)/Math.abs(s);let r=Math.sqrt(i*i/(o*o+1)),a=r*o;return 0===n&&(a=0,r=Math.sqrt(i)),0===s&&(r=0,a=Math.sqrt(i)),{x:e.x-(n>=0?a:-a),y:e.y-(s>=0?r:-r)}}function ha(t){if(t.length<1)return [];const e=[];let i=[];for(let n=0;n<t.length;n++){const s=t[n];if(0===s.step)n>0&&e.push({step:i,close:t[n-1].close}),i=[],i.push(Kr("moveTo",[{x:s.x,y:s.y}]));else if(1===s.step)i.push(Kr("lineTo",[{x:s.x,y:s.y}]));else if(2===s.step&&n+2<t.length&&2===t[n+1].step&&2===t[n+2].step){const e=t[n+1],o=t[n+2];i.push(Kr("bezierCurveTo",[s,e,o])),n+=2;}}return e.push({step:i,close:t[t.length-1].close}),e}function da(t){return 180*t/Math.PI}function ca(t){return t<0?t%360+360:t%360}function ua(t,e,i,n){return t/(i*i)+e/(n*n)}function pa(t,e,i,n){let s=0,o=0,r=0,a=0;const l=[t,e],h=aa(l),d=function(t,e,i,n){let s=n/2,o=n/2;const r=e.y-t.y,a=e.x-t.x;if(0===r||0===a)return [a,r];const l=-1/((e.y-t.y)/(e.x-t.x)),h=Math.atan(l);return "square"===i?(s=Math.sqrt(2)*n/2,o=Math.sqrt(2)*n/2):"round"===i?(s=n/2,o=n/2):(s=Math.abs(Math.cos(h)*n)/2,o=Math.abs(Math.sin(h)*n)/2),[s,o]}(l[0],l[1],n,i||0);return 0===d[1]?(s=h.left,o=h.top-i/2,r=h.width,a=h.height+i,"square"!==n&&"round"!==n||(s-=i/2,r+=i)):0===d[0]?(s=h.left-i/2,o=h.top,r=h.width+i,a=h.height,"square"!==n&&"round"!==n||(o-=i/2,a+=i)):(s=h.left-d[0],o=h.top-d[1],r=h.width+2*d[0],a=h.height+2*d[1]),{x:s,y:o,width:r,height:a}}function ga(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function fa(t,e,i,n){const{x:s,y:o}=t,{x:r,y:a}=e,{x:l,y:h}=n,d=Math.min(s,r),c=Math.max(s,r),u=Math.min(o,a),p=Math.max(o,a),g=i/2;return l>=d-g&&l<=c+g&&h>=u-g&&h<=p+g&&function(t,e,i,n,s,o){const r=[i-t,n-e];if(new rr(r[0],r[1]).equals({x:0,y:0}))return Math.sqrt((s-t)*(s-t)+(o-e)*(o-e));const a=[-r[1],r[0]],l=new rr(a[0],a[1]);l.normalize();const h=[s-t,o-e],d=new rr(h[0],h[1]);return Math.abs(d.dot(l))}(s,o,r,a,l,h)<=i/2}function ya(t,e,i,n,s){const o=t.length;if(o<2)return !1;for(let s=0;s<o-1;s++)if(fa(t[s],t[s+1],e,{x:i,y:n}))return !0;if(s){if(fa(t[0],t[o-1],e,{x:i,y:n}))return !0}return !1}function ma(t,e,i,n,s,o){return s>=t&&s<=t+i&&o>=e&&o<=e+n}function va(t,e,i,n,s,o){const r=o;let a=n.x,l=n.y,h=s.x,d=s.y;0===e&&(a=s.x,l=s.y,h=n.x,d=n.y);let c=Math.PI/2;const u=h-a>=0?1:-1,p=d-l>=0?1:-1;a!==h&&(c=Math.atan(Math.abs(d-l)/Math.abs(h-a)));const g=Math.cos(c),f=Math.sin(c),y=i?1:-1,m={x:h+7.8*y*r*g*u-4.5*r*f*u,y:d+7.8*y*r*f*p+4.5*r*g*p,step:0,close:!1},v={x:h,y:d,step:1,close:!1};i&&(v.x=h+r*y*g*u,v.y=d+r*y*f*p);const x={x:h+7.8*y*r*g*u+4.5*r*f*u,y:d+7.8*y*r*f*p-4.5*r*g*p,step:1,close:!1};t.push(m,v,x);}function xa(t,e,i,n,s,o){const r=o;let a=n.x,l=n.y,h=s.x,d=s.y;0===e&&(a=s.x,l=s.y,h=n.x,d=n.y);let c=Math.PI/2;const u=h-a>=0?1:-1,p=d-l>=0?1:-1;a!==h&&(c=Math.atan(Math.abs(d-l)/Math.abs(h-a)));const g=Math.cos(c),f=Math.sin(c),y=i?1:-1,m={x:h+7.8*y*r*g*u-4.5*r*f*u,y:d+7.8*y*r*f*p+4.5*r*g*p,step:0,close:!1},v={x:h,y:d,step:1,close:!1};i&&(v.x=h+r*y*g*u,v.y=d+r*y*f*p);const x={x:h+7.8*y*r*g*u+4.5*r*f*u,y:d+7.8*y*r*f*p-4.5*r*g*p,step:1,close:!0};t.push(m,v,x);}function wa(t,e,i,n,s){const o=s;let r=i.x,a=i.y,l=n.x,h=n.y;0===e&&(r=n.x,a=n.y,l=i.x,h=i.y);let d=Math.PI/2;const c=l-r>=0?1:-1,u=h-a>=0?1:-1;r!==l&&(d=Math.atan(Math.abs(h-a)/Math.abs(l-r)));const p=Math.cos(d),g=Math.sin(d),f={x:l-3*o*g*c,y:h+3*o*p*u,step:0,close:!1},y={x:l+3*o*g*c,y:h-3*o*p*u,step:1,close:!1};t.push(f,y);}function ba(t,e,i,n,s){const o=s;let r=i.x,a=i.y,l=n.x,h=n.y;0===e&&(r=n.x,a=n.y,l=i.x,h=i.y);let d=Math.PI/2;const c=l-r>=0?1:-1,u=h-a>=0?1:-1,p=h>=a&&l>=r||h<=a&&l<=r?-1:1;r!==l&&(d=Math.atan(Math.abs(h-a)/Math.abs(l-r)));const g=Math.cos(d),f=Math.sin(d),y=4.5*Math.sqrt(3)*o,m={x:l+4.5*o*g*c-y*f*c*p,y:h+4.5*o*f*u+y*g*u*p,step:0,close:!1},v={x:l-4.5*o*g*c+y*f*c*p,y:h-4.5*o*f*u-y*g*u*p,step:1,close:!1};t.push(m,v);}function Ca(t,e,i,n,s){const o=s;let{x:r,y:a}=n;0===e&&(r=i.x,a=i.y);const l={x:r-3*o,y:a-3*o,step:0,close:!1},h={x:r+3*o,y:a-3*o,step:1,close:!1},d={x:r+3*o,y:a+3*o,step:1,close:!1},c={x:r-3*o,y:a+3*o,step:1,close:!0};t.push(l,h,d,c);}function Sa(t,e,i,n,s){const o=s;let{x:r,y:a}=n;0===e&&(r=i.x,a=i.y);const l={x:r-3*o,y:a,step:0,close:!1},h={x:r,y:a-3*o,step:1,close:!1},d={x:r+3*o,y:a,step:1,close:!1},c={x:r,y:a+3*o,step:1,close:!0};t.push(l,h,d,c);}function Pa(t,e,i,n,s){const o=s;let{x:r,y:a}=n;0===e&&(r=i.x,a=i.y);const l=3*o-0*o,h=Qr(r,a,l,l);h.forEach(((e,i)=>{const n=0===i?0:2,s=i===h.length-1,o={x:e.x,y:e.y,step:n,close:s};t.push(o);}));}class Aa{constructor(t){i(this,"lineAlign",void 0),i(this,"owner",void 0),this.owner=t,this.reset();}reset(){this.lineAlign=.5;}get x(){return this.owner.getAttribute("x")}set x(t){this.owner.setAttribute("x",t);}get y(){return this.owner.getAttribute("y")}set y(t){this.owner.setAttribute("y",t);}get r(){return this.owner.getAttribute("r")}set r(t){this.owner.setAttribute("r",t);}get width(){return this.owner.getAttribute("width")}set width(t){this.owner.setAttribute("width",t);}get height(){return this.owner.getAttribute("height")}set height(t){this.owner.setAttribute("height",t);}get points(){return this.owner.getAttribute("points")}set points(t){this.owner.setAttribute("points",t);}get origin(){return this.owner.getAttribute("origin")}set origin(t){this.owner.setAttribute("origin",t);}get anchor(){return this.owner.getAttribute("anchor")}set anchor(t){this.owner.setAttribute("anchor",t);}get visibility(){return this.owner.getAttribute("visibility")}set visibility(t){this.owner.setAttribute("visibility",t);}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(t){this.owner.setAttribute("zIndex",t);}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(t){this.owner.setAttribute("borderWidth",t);}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(t){this.owner.setAttribute("borderColor",t);}get opacity(){return this.owner.getAttribute("opacity")}set opacity(t){this.owner.setAttribute("opacity",t);}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(t){this.owner.setAttribute("fillOpacity",t);}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(t){this.owner.setAttribute("borderOpacity",t);}get background(){return this.owner.getAttribute("background")}set background(t){this.owner.setAttribute("background",t);}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(t){this.owner.setAttribute("clipPath",t);}get cursor(){return this.owner.getAttribute("cursor")}set cursor(t){this.owner.setAttribute("cursor",t);}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(t){this.owner.setAttribute("hitArea",t);}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(t){this.owner.setAttribute("pointerEvents",t);}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(t){this.owner.setAttribute("miterLimit",t);}get roundedRadius(){return this.owner.getAttribute("roundedRadius")}set roundedRadius(t){this.owner.setAttribute("roundedRadius",t);}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(t){this.owner.setAttribute("lineCap",t);}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(t){this.owner.setAttribute("lineJoin",t);}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(t){this.owner.setAttribute("lineDash",t);}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(t){this.owner.setAttribute("lineDashOffset",t);}get shadow(){return this.owner.getAttribute("shadow")}set shadow(t){this.owner.setAttribute("shadow",t);}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(t){this.owner.setAttribute("shadowOffsetX",t);}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(t){this.owner.setAttribute("shadowOffsetY",t);}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(t){this.owner.setAttribute("shadowBlur",t);}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(t){this.owner.setAttribute("shadowColor",t);}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(t){this.owner.setAttribute("startAngle",t);}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(t){this.owner.setAttribute("endAngle",t);}get rx(){return this.owner.getAttribute("rx")}set rx(t){this.owner.setAttribute("rx",t);}get ry(){return this.owner.getAttribute("ry")}set ry(t){this.owner.setAttribute("ry",t);}get img(){return this.owner.getAttribute("img")}set img(t){this.owner.setAttribute("img",t);}get src(){return this.owner.getAttribute("src")}set src(t){this.owner.setAttribute("src",t);}get text(){return this.owner.getAttribute("text")}set text(t){this.owner.setAttribute("text",t);}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(t){this.owner.setAttribute("wordWarp",t);}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(t){this.owner.setAttribute("wordBreak",t);}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(t){this.owner.setAttribute("textMaxWidth",t);}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(t){this.owner.setAttribute("letterSpacing",t);}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(t){this.owner.setAttribute("textBaseLine",t);}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(t){this.owner.setAttribute("textTransform",t);}get color(){return this.owner.getAttribute("color")}set color(t){this.owner.setAttribute("color",t);}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(t){this.owner.setAttribute("fontStyle",t);}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(t){this.owner.setAttribute("fontVariant",t);}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(t){this.owner.setAttribute("fontWeight",t);}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(t){this.owner.setAttribute("fontSize",t);}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(t){this.owner.setAttribute("lineHeight",t);}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(t){this.owner.setAttribute("fontFamily",t);}get font(){return this.owner.getAttribute("font")}set font(t){this.owner.setAttribute("font",t);}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(t){this.owner.setAttribute("startPoint",t);}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(t){this.owner.setAttribute("endPoint",t);}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(t){this.owner.setAttribute("lineEnding",t);}get segments(){return this.owner.getAttribute("segments")}set segments(t){this.owner.setAttribute("segments",t);}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(t){this.owner.setAttribute("stampPoints",t);}get imageData(){return this.owner.getAttribute("imageData")}set imageData(t){this.owner.setAttribute("imageData",t);}get iconName(){return this.owner.getAttribute("iconName")}set iconName(t){this.owner.setAttribute("iconName",t);}get textContents(){return this.owner.getAttribute("textContents")}set textContents(t){this.owner.setAttribute("textContents",function(t){const e=[];return t.forEach((t=>{t.content.length&&e.push(t);})),e}(t));}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(t){this.owner.setAttribute("textAlign",t);}get renderBlendMode(){return this.owner.getAttribute("renderBlendMode")}set renderBlendMode(t){this.owner.setAttribute("renderBlendMode",t);}}const Ta=new class{constructor(){i(this,"parsers",void 0),i(this,"updaters",void 0),this.parsers=new Map,this.updaters=new Map,this.initParser(),this.initUpdater();}getStyleParser(t){return this.parsers.get(t)}getStyleUpdaters(t){return this.updaters.get(t)}initParser(){this.bindHandler(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth","roundedRadius"],vr,void 0),this.bindHandler(["startAngle","endAngle"],wr,void 0),this.bindHandler(["r","rx","ry","width","height","fontSize"],vr,void 0),this.bindHandler(["borderColor","background","shadowColor","color"],Dr,void 0),this.bindHandler(["opacity","fillOpacity","borderOpacity"],Rr,void 0),this.bindHandler(["lineDash"],Ir,void 0),this.bindHandler(["shadow"],Er,void 0),this.bindHandler(["textContents"],Lr,void 0);}initUpdater(){this.bindHandler(["borderWidth"],void 0,Fr),this.bindHandler(["x","y"],void 0,Ur),this.bindHandler(["width","height"],void 0,Nr),this.bindHandler(["r","rx","ry","startAngle","endAngle"],void 0,_r),this.bindHandler(["points","segments"],void 0,Or),this.bindHandler(["startPoint","endPoint","lineEnding"],void 0,Wr),this.bindHandler(["stampPoints"],void 0,Hr),this.bindHandler(["width","height","textContents","textAlign","borderWidth"],void 0,Vr);}bindHandler(t,e,i){for(let n=0;n<t.length;n++)if(e&&this.parsers.set(t[n],e),i){const e=this.updaters.get(t[n])||[];e.push(i),this.updaters.set(t[n],e);}}};class ka extends tr{constructor(t){super(),i(this,"attributes",{}),i(this,"id",void 0),i(this,"pageUid",void 0),i(this,"index",void 0),i(this,"name",void 0),i(this,"renderable",new gr),i(this,"sortable",new fr),i(this,"geometry",new pr),i(this,"transform",new yr),i(this,"parsedStyle",{}),i(this,"style",void 0),i(this,"isDestroyed",!1),i(this,"childNodes",[]),i(this,"nodeName",""),i(this,"nodeType",0),i(this,"nodeValue",null),i(this,"ownerDocument",null),i(this,"parentNode",null),i(this,"isConnected",!1),i(this,"textContent",void 0),i(this,"shapeType",void 0),i(this,"config",void 0),i(this,"path",void 0),i(this,"steps",void 0),i(this,"pathDirty",!0),i(this,"boundsDirty",!0),i(this,"bounds",void 0),i(this,"strokePath",void 0),i(this,"strokeSteps",void 0),i(this,"externalMatrices",[]),i(this,"clippable",!1),i(this,"imageData",null),this.config=t,this.id=t.id||t.uid||"",this.name=t.name||"",this.index=t.index,this.nodeName=t.type||"container",this.pageUid=t.pageUid||"",(t.className||t.class)&&(this.className=t.className||t.class),this.style=new Aa(this),this.initAttributes(t);}static isNode(t){return !!t.childNodes}set className(t){this.setAttribute("class",t);}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter((t=>""!==t))}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:t}=this;return t.length>0?t[t.length-1]:null}get nextSibling(){const{parentNode:t}=this;if(t){const e=t.childNodes.indexOf(this);return t.childNodes[e+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:t}=this;if(t){const e=t.childNodes.indexOf(this);return t.childNodes[e-1]}return null}getAttribute(t){const e=this.attributes[t];return null==e?null:e}getElementsByName(t){return ur.querySelectorAll(`[name="${t}"]`,this)}getElementsByClassName(t){return ur.querySelectorAll(`.${t}`,this)}getElementsByTagName(t){return ur.querySelectorAll(t,this)}hasAttribute(t){return Object.keys(this.attributes).indexOf(t)>-1}removeAttribute(t){this.setAttribute(t,null),delete this.attributes[t];}appendChild(t,e){ur.append(t,this,e);const i=new Ko("child-inserted",{child:t});this.dispatchEvent(i);const n=new fl("DOMNodeInserted",this,"","","",0,"","");return t.dispatchEvent(n),t}cloneNode(t){return null}insertBefore(t,e){if(e){const i=this.childNodes.indexOf(e);this.appendChild(t,i-1);}else this.appendChild(t);return t}removeChild(t){const e=new fl("removed",this,"","","",0,"","");t.dispatchEvent(e);const i=new Ko("child-removed",{child:t});return this.dispatchEvent(i),ur.remove(t),t}isChildExist(t){return ur.isChildExist(t)}replaceChild(t,e){const i=this.childNodes.indexOf(e);return this.removeChild(e),this.appendChild(t,i),e}destroy(){const t=new Ko("destroy",{});this.dispatchEvent(t),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0;}after(){const{parentNode:t}=this;if(t){const s=t.childNodes.indexOf(this);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];i.forEach(((e,i)=>{null==t||t.appendChild(e,s+i+1);}));}}before(){const{parentNode:t}=this;if(t){const s=t.childNodes.indexOf(this);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];i.forEach(((e,i)=>{null==t||t.appendChild(e,s+i);}));}}remove(){this.parentNode&&this.parentNode.removeChild(this);}replaceWith(){this.after(...arguments),this.remove();}append(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((t=>{this.appendChild(t);}));}prepend(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(((t,e)=>{this.appendChild(t,e);}));}querySelector(t){return ur.querySelector(t,this)}querySelectorAll(t){return ur.querySelectorAll(t,this)}find(t){let e=null;return this.recursiveCall((i=>!(i!==this||!t(i))&&(e=i,!0))),e}findAll(t){const e=[];return this.recursiveCall((i=>{i===this&&t(i)&&e.push(i);})),e}contains(t){let e=t;for(;e&&this!==e;)e=e.parentNode;return !!e}getRootNode(t){return this.parentNode?this.parentNode.getRootNode(t):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(t){return this===t}isSameNode(t){return this.isEqualNode(t)}normalize(){throw new Error("Method to be implemented")}recursiveCall(t){t(this)||this.childNodes.forEach((e=>{e.recursiveCall(t);}));}hasParentTransform(){return !(!this.parentNode||!this.parentNode.transform)}getGeometryBounds(){return ur.getGeometryBounds(this)}getRenderBounds(){return ur.getBounds(this,!0)}getBounds(){return ur.getBounds(this)}getLocalBounds(){return ur.getLocalBounds(this)}getBoundingClientRect(){return ur.getBoundingClientRect(this)}get isVisible(){return "visible"===this.parsedStyle.visibility}get isInteractive(){return "none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)if(Vs(e,t)){if("style"===e)continue;this.attributes[e]=t[e];}for(const e in t.style)Vs(e,t.style)&&(this.parseStyleProperty(e,t.style[e]),this.attributes[e]=t.style[e]);this.renderable.toRenderable();}setAttribute(t,e){if(zn(e))return;const i="x"===t||"y"===t,n=this.attributes[t];(e!==this.attributes[t]||i)&&(this.attributes[t]=e,Object.keys(this.config).includes(t)||(this.parseStyleProperty(t,e),this.updateStyleProperty(t,n,e)));}parseStyleProperty(t,e){const i=Ta.getStyleParser(t);this.parsedStyle[t]=i?i(e,this,t):e;}updateStyleProperty(t,e,i){const n=Ta.getStyleUpdaters(t);n&&n.forEach((n=>{n(e,i,this,t);}));}toFront(){const{parentNode:t}=this;if(t){const e=Math.max(...t.children.map((t=>t.style.zIndex)));this.style.zIndex=e+1;}return this}toBack(){const{parentNode:t}=this;if(t){const e=Math.min(...t.children.map((t=>t.style.zIndex)));this.style.zIndex=e-1;}return this}setOrigin(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return ur.setOrigin(this,t,e),this}getOrigin(){return ur.getOrigin(this)}setPosition(t){return t=Da(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),ur.setPosition(this,t),this}setLocalPosition(t){return t=Da(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),ur.setLocalPosition(this,t),this}getPosition(){return ur.getPosition(this)}getLocalPosition(){return ur.getLocalPosition(this)}translate(t){return t=Da(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),ur.translate(this,t),this}translateLocal(t){return t=Da(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),ur.translateLocal(this,t),this}scale(t,e){return this.scaleLocal(t,e)}scaleLocal(t,e){return Jn(t)&&(t={x:t,y:e=e||t}),ur.scaleLocal(this,t),this}setLocalScale(t,e){return Jn(t)&&(t={x:t,y:e=e||t}),ur.setLocalScale(this,t),this}getScale(){return ur.getScale(this)}getLocalScale(){return ur.getLocalScale(this)}rotate(t){return ur.rotate(this,t),this}rotateLocal(t){return ur.rotateLocal(this,t),this}setAngle(t){return ur.setAngle(this,t),this}setLocalAngle(t){return ur.setLocalAngle(this,t),this}getAngle(){return ur.getAngle(this)}getLocalAngle(){return ur.getLocalAngle(this)}getLocalTransform(){return ur.getLocalTransform(this)}getWorldTransform(){return ur.getWorldTransform(this)}setLocalTransform(t){return ur.setLocalTransform(this,t),this}resetLocalTransform(){return ur.resetLocalTransform(this),this}getPath(){}getBoundingRect(){return {x:0,y:0,width:0,height:0}}isPointInPath(t){return !1}updateStyle(t){Object.keys(t).forEach((e=>{Vs(e,t)&&(this.style[e]=t[e]);}));}updatePosition(t,e){this.style.x=t||0,this.style.y=e||0;}updateOrigin(){const{width:t,height:e}=this.getBoundingRect();this.setOrigin(t/2,e/2);}getBoundingRectObject(){const{x:t,y:e,width:i,height:n}=this.getBoundingRect();return new Fa({style:{x:t,y:e,width:i,height:n,borderWidth:1,background:"transparent"}})}}function Da(t,e){return Jn(t)?{x:t,y:e}:t}class Ea extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"arc",style:{...Mr,r:0,startAngle:0,endAngle:1.5*Math.PI,...t},...e}),i(this,"shapeType","arc");const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}normAngle(){const{startAngle:t,endAngle:e}=this.style;let i=wr(t).value,n=wr(e).value;if(i>n){const t=i;i=n,n=t;}if(Math.abs(n-i)>=2*Math.PI-1e-5&&(i=0,n=2*Math.PI),i<-2*Math.PI||n<-2*Math.PI){const t=Math.max(Math.floor(i/(-2*Math.PI)),Math.floor(n/(-2*Math.PI)));i+=2*Math.PI*t,n+=2*Math.PI*t;}if(i>2*Math.PI||n>2*Math.PI){const t=Math.max(Math.floor(i/(2*Math.PI)),Math.floor(n/(2*Math.PI)));i-=2*Math.PI*t,n-=2*Math.PI*t;}this.parsedStyle.startAngle=wr(i),this.parsedStyle.endAngle=wr(n);}updateOrigin(){const{width:t,height:e,x:i,y:n}=this.getBoundingRect(),s=i-this.style.x+t/2,o=n-this.style.y+e/2;this.setOrigin(s,o);}getPath(){if(!this.pathDirty)return this.path;this.normAngle();const{r:t,borderWidth:e,startAngle:i,endAngle:n}=this.parsedStyle,s=.5*((null==e?void 0:e.value)||0),o=i.value,r=n.value;return this.path=Zr(0,0,t.value-s,o,r),this.steps=ta(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,r:i,startAngle:n,endAngle:s,borderWidth:o}=this.parsedStyle,r=i.value,a=n.value,l=s.value;null==o||o.value;if(n===s)return {x:t-r-0,y:e-r-0,width:2*r+0,height:2*r+0};const{sin:h,cos:d,PI:c}=Math,u=[t+r*d(a),t+r*d(l)],p=[e+r*h(a),e+r*h(l)];return a<0&&l>0&&u.push(t+r),(a<.5*c&&l>.5*c||a<-1.5*c&&l>-1.5*c)&&p.push(e+r),(a<c&&l>c||a<-c&&l>-c)&&u.push(t-r),(a<1.5*c&&l>1.5*c||a<-.5*c&&l>-.5*c)&&p.push(e-r),u.sort(((t,e)=>t-e)),p.sort(((t,e)=>t-e)),this.boundsDirty=!1,this.bounds={x:u[0]-0,y:p[0]-0,width:u[u.length-1]-u[0]+0,height:p[p.length-1]-p[0]+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{x:i,y:n,r:s,startAngle:o,endAngle:r,background:a,borderWidth:l}=this.parsedStyle,h=ca(da(o.value)),d=ca(da(r.value)),c=ca(da(o.value+r.value)/2),u=Zn(this.style.background)&&""!==this.style.background,p=l&&l.value,g=u?0:e,f=(l.value+g||0)/2,y=s.value-f,m=new zr(i+y*Math.cos(h*Math.PI/180),n+y*Math.sin(h*Math.PI/180)),v=new zr(i+y*Math.cos(d*Math.PI/180),n+y*Math.sin(d*Math.PI/180)),x=new zr(i+y*Math.cos(c*Math.PI/180),n+y*Math.sin(c*Math.PI/180)),w=new zr(t.x,t.y),b=w.distanceTo({x:i,y:n}),C=$r([m.x,m.y],[x.x,x.y],[w.x,w.y],[i,n]),S=$r([v.x,v.y],[x.x,x.y],[w.x,w.y],[i,n]),P=$r([m.x,m.y],[v.x,v.y],[w.x,w.y],[i,n]);if(b>y+f)return !1;const A=fa(m,v,2*f,t);if(d-h<180&&d-h>0||d-h<-180){if(a&&P||A)return !0;if(!a&&p&&b>=y-f&&b<=y+f&&P)return !0}else if(180===Math.abs(d-h)){if(a){if(C||S)return !0;if(function(t,e,i,n){const{x:s,y:o}=t,{x:r,y:a}=e,{x:l,y:h}=i,{x:d,y:c}=n;return !(((d-s)*(a-o)-(c-o)*(r-s))*((l-s)*(a-o)-(h-o)*(r-s))<=0||((d-l)*(a-h)-(c-h)*(r-l))*((s-l)*(a-h)-(o-h)*(r-l))<=0||((d-s)*(h-o)-(c-o)*(l-s))*((r-s)*(h-o)-(a-o)*(l-s))<=0)}(m,x,v,t))return !0}if(!a&&p&&b>=y-f&&b<=y+f&&(C||S))return !0}else {if(a){if(C||S)return !0;if(!P)return !0}if(!a&&p&&b>=y-f&&b<=y+f&&(C||S))return !0}return !!A}}class Ia extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"circle",style:{...Mr,r:0,anchor:[.5,.5],...t},...e}),i(this,"shapeType","circle");const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}updateOrigin(){this.setOrigin(0,0);}getPath(){if(!this.pathDirty)return this.path;const{r:t,borderWidth:e}=this.parsedStyle;let i=.5*((null==e?void 0:e.value)||0);return t.value===i&&(i=0),this.path=Zr(0,0,t.value-i,0,2*Math.PI),this.steps=ta(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,r:i}=this.parsedStyle,n=i.value;return this.boundsDirty=!1,this.bounds={x:t-n-0,y:e-n-0,width:2*n+0,height:2*n+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{x:i,y:n,r:s,background:o,borderWidth:r}=this.parsedStyle,a=Zn(this.style.background)&&""!==this.style.background,l=r&&r.value,h=a?0:e,d=(r.value+h||0)/2,c=s.value-d,u=new zr(t.x,t.y).distanceTo({x:i,y:n});return o&&l?u<=c+d:o?u<=c:!!l&&(u>=c-d&&u<=c+d)}}let Ra=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"ellipse",style:{...Mr,rx:"",ry:"",borderWidth:0,anchor:[.5,.5],...t},...e}),i(this,"shapeType","ellipse");const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}updateOrigin(){this.setOrigin(0,0);}getPath(){if(!this.pathDirty)return this.path;const{rx:t,ry:e,borderWidth:i}=this.parsedStyle,n=.5*i.value;return this.path=Qr(0,0,t.value-n,e.value-n),this.steps=ta(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,rx:i,ry:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t-i.value-0,y:e-n.value-0,width:2*i.value+0,height:2*n.value+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{x:i,y:n,rx:s,ry:o,borderWidth:r}=this.parsedStyle,a=Zn(this.style.background)&&""!==this.style.background,l=r&&r.value,h=a?0:e,d=(r.value||0)/2,c=s.value-d,u=o.value-d,p=(t.x-i)*(t.x-i),g=(t.y-n)*(t.y-n);return a&&l?ua(p,g,c+d,u+d)<=1:a?ua(p,g,c,u)<=1:!!l&&(ua(p,g,c-d-h/2,u-d-h/2)>=1&&ua(p,g,c+d+h/2,u+d+h/2)<=1)}},Ma=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"image",style:{...Mr,width:0,height:0,img:"",...t},...e}),i(this,"shapeType","image"),i(this,"meteData",void 0),this.meteData=(null==e?void 0:e.metadata)||null;const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:n.value},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}},Ba=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"ink",style:{...Mr,segments:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:10,...t},...e}),i(this,"shapeType","ink"),i(this,"inkPaths",[]),i(this,"inkSteps",[]),i(this,"inkRenderPaths",[]),i(this,"inkOriginalRenderPath",void 0),i(this,"inkRenderSteps",[]),i(this,"initialRect",void 0),i(this,"douglasPeuckerPoints",[]),i(this,"partDirty",!1),i(this,"optimizedOpSteps",[]),i(this,"positionDirty",!1),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height);}addSegment(){const{segments:t}=this.style;t[t.length-1].length&&this.style.segments.push([]);}addPoint(t){const e=[...this.style.segments],i=this.style.segments.length,n=e[i-1],s=n[n.length-1];if((null==s?void 0:s.x)!==t.x||(null==s?void 0:s.y)!==t.y){this.partDirty=!0;const n=this.getBoundingRect(),s=this.parsedStyle.borderWidth.value/2;(t.x<n.x+s||t.y<n.y+s)&&(this.positionDirty=!0),e[i-1].push(t),this.style.segments=e;const o=this.getBoundingRect();(t.x<o.x||t.y<o.y||t.x>o.x+o.width||t.y>o.y+o.height)&&(this.boundsDirty=!0);}}getPath(){if(!this.pathDirty&&!this.partDirty)return this.path;const{segments:t}=this.parsedStyle;if(this.partDirty){const e=t.length;if(e>1)for(let i=0;i<e-1;i++){const e=t[i];if(!this.optimizedOpSteps[i]){let t=[...e];1===t.length?t=this.offsetPoints(e[0],.1):(t=Gr(t,0,t.length-1,1),t.length<=3&&t.push({...t[t.length-1]}));const n=ia(t,t.length).map((t=>t.ops)).flat(2);this.optimizedOpSteps[i]=n;}if(this.positionDirty||!this.inkRenderSteps[i]){const t=this.getRenderStep(this.optimizedOpSteps[i]);this.inkRenderSteps[i]=t;}}let i=t[e-1];1===i.length?i=this.offsetPoints(i[0],.1):i.length<=3&&i.push(i[i.length-1]),i=this.getRenderPath(i);const n=function(t){const e=t.length;if(e<=1)return [];if(2===e)return [Kr("moveTo",[t[0]]),Kr("lineTo",[t[1]])];const i=[Kr("moveTo",[t[0]])];for(let n=0;n<e-1;n++){const e=t[n-1]||t[n],s=t[n],o=t[n+1]||t[n];i.push(sa(e,s,o));}return i}(i);this.inkRenderSteps[e-1]=n;}else this.pathDirty&&(this.reset(),t.forEach(((t,e)=>{if(0===t.length)return;let i=[...t];1===t.length?i=this.offsetPoints(t[0],.1):(i=Gr(i,0,i.length-1,1),i.length<=3&&i.push({...i[i.length-1]})),this.inkPaths[e]=i;const n=ia(i,i.length);this.inkSteps[e]=n.map((t=>t.ops)).flat(2);const s=this.getRenderPath(i),o=ia(s,s.length).map((t=>t.ops)).flat(2);this.inkRenderSteps[e]=o;})));return this.pathDirty=!1,this.partDirty=!1,this.positionDirty=!1,this.path}offsetPoints(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const{x:i,y:n}=t;return [{x:i-e,y:n-e},{x:i+e,y:n-e},{x:i+e,y:n+e},{x:i-e,y:n+e}]}getRenderStep(t){return t.map((t=>({...t,data:this.getRenderPath(t.data)})))}getInkOriginalRenderPath(){if(!this.pathDirty&&this.inkOriginalRenderPath)return;const{segments:t}=this.parsedStyle,e=[];for(let i=0;i<t.length;i++){const n=this.getRenderPath(t[i]);e.push(n);}this.inkOriginalRenderPath=e;}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i});})),n}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t}=this.parsedStyle,e=[],i=[];this.parsedStyle.segments.forEach((t=>{t.forEach((t=>{t&&(e.push(t.x),i.push(t.y));}));}));const{min:n,max:s}=La(e),{min:o,max:r}=La(i),a=t.value/2;return this.boundsDirty=!1,this.bounds={x:n-a,y:o-a,width:s-n+2*a,height:r-o+2*a},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{borderWidth:i}=this.parsedStyle;for(let n=0;n<this.inkSteps.length;n++){const s=this.inkSteps[n];for(let n=1;n<s.length;n+=2){const o=s[n-1].data[0],r=s[n].data[0],a=s[n].data[1];if(Xr(o.x,o.y,r.x,r.y,a.x,a.y).isHit([t.x,t.y],i.value+e))return !0}}return !1}reset(){this.inkPaths=[],this.inkSteps=[],this.inkRenderPaths=[],this.inkRenderSteps=[];}};function La(t){if(0===t.length)return {min:void 0,max:void 0};let e=t[0],i=t[0];for(let n=1;n<t.length;n++)t[n]<e&&(e=t[n]),t[n]>i&&(i=t[n]);return {min:e,max:i}}function Ua(t,e){return {x:e.x-t.x,y:e.y-t.y}}function Oa(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function Na(t,e){const i=function(t,e){return t.x*e.x+t.y*e.y}(t,e),n=Oa(t),s=Oa(e);return Math.acos(i/(n*s))}let _a=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polygon",style:{...Mr,points:[{x:0,y:0},{x:10,y:10}],miterLimit:10,borderWidth:2,...t},...e}),i(this,"shapeType","polygon"),i(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:n,y:s,width:o,height:r}=this.getBoundingRect();this.updatePosition(n,s),this.setOrigin(o/2,r/2);}addPoint(t){const e=[...this.style.points];e.push(t),this.style.points=e;}updatePoints(){const{renderPath:t}=this,e=this.getLocalPosition(),i=[];t.forEach((t=>{i.push({x:t.x+e.x,y:t.y+e.y});})),this.style.points=i;}getPath(){if(!this.pathDirty)return this.path;const{x:t,y:e}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map((i=>({x:i.x-t,y:i.y-e}))),this.steps=oa(this.renderPath,!0),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,points:e,lineCap:i}=this.parsedStyle;if(2===e.length)return this.boundsDirty=!1,this.bounds=pa(e[0],e[1],t.value,i),this.bounds;const n=aa(e),s=t.value/2||0;return this.boundsDirty=!1,this.bounds={x:n.left-s,y:n.top-s,width:n.width+2*s,height:n.height+2*s},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{borderWidth:i,points:n}=this.parsedStyle,s=Zn(this.style.background)&&""!==this.style.background,o=s?0:e;let r=!1;return i&&i.value&&(r=ya(n,i.value+o,t.x,t.y,!0)),!r&&s&&(r=function(t,e,i){let n=!1;const s=t.length;if(s<=2)return !1;for(let l=0;l<s;l++){const h=t[l],d=t[(l+1)%s];if(r=d,((a={x:e,y:i}).x-(o=h).x)*(r.y-o.y)==(r.x-o.x)*(a.y-o.y)&&Math.min(o.x,r.x)<=a.x&&a.x<=Math.max(o.x,r.x)&&Math.min(o.y,r.y)<=a.y&&a.y<=Math.max(o.y,r.y))return !0;ga(h.y-i)>0!=ga(d.y-i)>0&&ga(e-(i-h.y)*(h.x-d.x)/(h.y-d.y)-h.x)<0&&(n=!n);}var o,r,a;return n}(n,t.x,t.y)),r}},Wa=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polyline",style:{...Mr,points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:10,...t},...e}),i(this,"shapeType","polyline"),i(this,"renderPath",void 0),this.getPath();const{x:n,y:s}=this.getBoundingRect();this.updatePosition(n,s),this.updateOrigin();}initPath(){const {points:t,lineEnding:e}=this.parsedStyle,n=[];if(t.forEach(((t,e)=>{0===e?n.push({x:t.x,y:t.y,step:0,close:!1}):n.push({x:t.x,y:t.y,step:1,close:!1});})),e&&n.length>1)for(let t=0;t<e.length;t++)switch(e[t]){case"OpenArrow":this.addOpenArrow(n,t,!1);break;case"ROpenArrow":this.addOpenArrow(n,t,!0);break;case"ClosedArrow":this.addCloseArrow(n,t,!1);break;case"RClosedArrow":this.addCloseArrow(n,t,!0);break;case"Butt":this.addButt(n,t);break;case"Slash":this.addSlash(n,t);break;case"Square":this.addSquare(n,t);break;case"Diamond":this.addDiamond(n,t);break;case"Circle":this.addCircle(n,t);}return n}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close});})),n}addPoint(t){const e=[...this.style.points];e.push(t),this.style.points=e;}updatePoints(){const{length:t}=this.parsedStyle.points,e=this.getLocalPosition(),i=[];this.renderPath.slice(0,t).forEach((t=>{i.push({x:t.x+e.x,y:t.y+e.y});})),this.style.points=i;}updatePoint(){const t=this.getLocalPosition(),e=this.parsedStyle.points.length,i=[];for(let n=0;n<e;n++)i.push({x:this.renderPath[n].x+t.x,y:this.renderPath[n].y+t.y});this.updateStyle({points:i});}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=ha(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,lineCap:e}=this.parsedStyle;if(2===this.path.length)return this.boundsDirty=!1,this.bounds=pa(this.path[0],this.path[1],t.value,e),this.bounds;const i=aa(this.path),n=t.value/2;return this.boundsDirty=!1,this.bounds={x:i.left-n,y:i.top-n,width:i.width+2*n,height:i.height+2*n},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{borderWidth:i,points:n}=this.parsedStyle;return ya(n,i.value+e,t.x,t.y,!1)}isLineArrow(){const{lineEnding:t}=this.parsedStyle;return !!t&&("None"!==t[0]||"None"!==t[1])}addOpenArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:n,borderWidth:s}=this.parsedStyle,{length:o}=n;let r=n[o-2],a=n[o-1];0===e&&(r={...n[0]},a={...n[1]}),va(t,e,i,r,a,s.value);}addCloseArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:n,borderWidth:s}=this.parsedStyle,{length:o}=n;let r=n[o-2],a=n[o-1];0===e&&(r={...n[0]},a={...n[1]}),xa(t,e,i,r,a,s.value);}addCircle(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;Pa(t,e,i[0],i[s-1],n.value);}addDiamond(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;Sa(t,e,i[0],i[s-1],n.value);}addSquare(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;Ca(t,e,i[0],i[s-1],n.value);}addSlash(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;let o=i[s-2],r=i[s-1];0===e&&(o={...i[0]},r={...i[1]}),ba(t,e,o,r,n.value);}addButt(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;let o=i[s-2],r=i[s-1];0===e&&(o={...i[0]},r={...i[1]}),wa(t,e,o,r,n.value);}},Fa=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"rect",style:{...Mr,width:0,height:0,...t},...e}),i(this,"shapeType","rect");const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}getPath(){if(!this.pathDirty)return this.path;const{width:t,height:e,borderWidth:i}=this.parsedStyle,n=(null==i?void 0:i.value)||0,s=n,o=n,r=t.value-2*n,a=e.value-2*n;return this.path=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],this.steps=oa(this.path),this.pathDirty=!1,this.path}getStrokePath(){const{width:t,height:e,borderWidth:i}=this.parsedStyle,n=.5*((null==i?void 0:i.value)||0),s=n,o=n,r=t.value-2*n,a=e.value-2*n;this.strokePath=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],this.strokeSteps=oa(this.strokePath);}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:n.value},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:i,y:n,borderWidth:s,width:o,height:r}=this.parsedStyle,a=Zn(this.style.background)&&""!==this.style.background,l=s&&s.value,h=e/2;return a?ma(i,n,o.value,r.value,t.x,t.y):!!l&&function(t,e,i,n,s,o,r){return ma(t,e,i,s,o,r)||ma(t,e,s,n,o,r)||ma(t,e+n-s,i,s,o,r)||ma(t+i-s,e,s,n,o,r)}(i-h,n-h,o.value+e,r.value+e,s.value+e,t.x,t.y)}};class Ha extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stampPath",style:{...Mr,stampPoints:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4,...t},...e}),i(this,"shapeType","stampPath"),i(this,"renderPath",void 0),this.getPath();}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close});})),n}getPath(){return this.pathDirty?(this.path=this.parsedStyle.stampPoints,this.renderPath=this.getRenderPath(this.path),this.steps=function(t){if(t.length<1)return [];const e=[];for(let i=0;i<t.length;i++){const n=t[i];if(0===n.step)e.push(Kr("lineTo",[n],n.close));else if(1===n.step){if(i+2<t.length&&1===t[i+1].step&&1===t[i+2].step){const s=t[i+1],o=t[i+2];e.push(Kr("bezierCurveTo",[n,s,o],n.close)),i+=2;}}else 2===n.step&&e.push(Kr("moveTo",[n],n.close));}return e}(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,stampPoints:e,lineCap:i}=this.parsedStyle;if(2===e.length)return this.boundsDirty=!1,this.bounds=pa(e[0],e[1],t.value,i),this.bounds;const n=aa(e),s=t.value/2;return this.boundsDirty=!1,this.bounds={x:n.left-s,y:n.top-s,width:n.width+2*s,height:n.height+2*s},this.bounds}}let Va=class extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"line",style:{...Mr,startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:["None","None"],borderWidth:2,...t},...e}),i(this,"shapeType","line"),i(this,"renderPath",void 0),this.getPath();const{x:n,y:s}=this.getBoundingRect();this.updatePosition(n,s),this.updateOrigin();}initPath(){const{startPoint:t,endPoint:e,lineEnding:i}=this.parsedStyle,n=[{...t,step:0,close:!1},{...e,step:1,close:!1}];if(i)for(let t=0;t<i.length;t++)switch(i[t]){case"OpenArrow":this.addOpenArrow(n,t,!1);break;case"ROpenArrow":this.addOpenArrow(n,t,!0);break;case"ClosedArrow":this.addCloseArrow(n,t,!1);break;case"RClosedArrow":this.addCloseArrow(n,t,!0);break;case"Butt":this.addButt(n,t);break;case"Slash":this.addSlash(n,t);break;case"Square":this.addSquare(n,t);break;case"Diamond":this.addDiamond(n,t);break;case"Circle":this.addCircle(n,t);}return n}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close});})),n}updatePoints(){const t=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+t.x,y:this.renderPath[0].y+t.y},endPoint:{x:this.renderPath[1].x+t.x,y:this.renderPath[1].y+t.y}});}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=ha(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,lineCap:e}=this.parsedStyle,i=aa(this.path);if(2===this.path.length)return this.boundsDirty=!1,this.bounds=pa(this.path[0],this.path[1],t.value,e),this.bounds;const n=t.value/2||0;return this.boundsDirty=!1,this.bounds={x:i.left-n,y:i.top-n,width:i.width+2*n,height:i.height+2*n},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;return fa(i,n,s.value+e,t)}isLineArrow(){const{lineEnding:t}=this.parsedStyle;return !!t&&("None"!==t[0]||"None"!==t[1])}addCircle(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;Pa(t,e,i,n,s.value);}addDiamond(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;Sa(t,e,i,n,s.value);}addSquare(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;Ca(t,e,i,n,s.value);}addSlash(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;ba(t,e,i,n,s.value);}addButt(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;wa(t,e,i,n,s.value);}addOpenArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:n,endPoint:s,borderWidth:o}=this.parsedStyle;va(t,e,i,n,s,o.value);}addCloseArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:n,endPoint:s,borderWidth:o}=this.parsedStyle;xa(t,e,i,n,s,o.value);}};class za extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stampText",style:{...Mr,text:"",color:"black",fontSize:12,fontFamily:"Microsoft YaHei",fontWeight:"normal",fontStyle:"normal",...t},...e}),i(this,"shapeType","stampText"),this.setTextFont();const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}setTextFont(){const{fontStyle:t,fontWeight:e,fontFamily:i,fontSize:n}=this.parsedStyle,s=""===(null==i?void 0:i.trim())?"sans-serif":i;null!=i&&i.includes(" ")?this.style.font=`${t} ${e} ${n.value}${n.unit} '${s}'`:this.style.font=`${t} ${e} ${n.value}${n.unit} ${s}`;}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,text:i,fontSize:n,font:s}=this.parsedStyle,o=document.createElement("canvas").getContext("2d");o.font=s;const{width:r}=o.measureText(i);return this.boundsDirty=!1,this.bounds={x:t,y:e-n.value,width:r,height:n.value},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}}let ja=class extends Fa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stamp",style:{...t,background:"transparent",borderColor:"transparent"},...e}),i(this,"shapeType","stamp"),i(this,"stampConfig",[]),i(this,"stampItemShapes",[]),i(this,"renderType","stamp"),i(this,"initialWidth",0),i(this,"initialHeight",0),this.stampConfig=t.stampConfig||[];}initStamp(){this.stampConfig&&(this.renderType="stamp",this.initStampItem(),this.initStampStyle());}initStampItem(){if(!Fn(this.stampConfig))return;this.stampItemShapes=[];const{stampConfig:t,stampItemShapes:e}=this,{renderBlendMode:i}=this.parsedStyle;for(let n=0;n<t.length;n++){let s;"path"===t[n].type&&(s=new Ha({style:{opacity:this.style.opacity,renderBlendMode:i,...t[n]}})),"text"===t[n].type&&(s=new za({style:{opacity:this.style.opacity,renderBlendMode:i,...t[n]}})),"image"===t[n].type&&(s=new Ma({style:{opacity:this.style.opacity,renderBlendMode:i,...t[n]}})),s&&e.push(s);}}initStampStyle(){if(!Fn(this.stampConfig))return;const t=[],e=[],{stampItemShapes:i}=this,n=i.some((t=>t instanceof Ha));for(const s of i){if(n&&!(s instanceof Ha)){this.appendChild(s);continue}const i=s.getBoundingRect();t.push(i.x,i.x+i.width),e.push(i.y,i.y+i.height),this.appendChild(s);}this.initialWidth=Math.max(...t)-Math.min(...t),this.initialHeight=Math.max(...e)-Math.min(...e);const s=Math.min(...t),o=Math.min(...e);this.updateStyle({x:s,y:o,width:this.initialWidth,height:this.initialHeight});for(let t=0;t<i.length;t++){const e=i[t].getBoundingRect();let n=e.y-this.style.y;i[t]instanceof za&&(n+=i[t].parsedStyle.fontSize.value),i[t].setLocalPosition(e.x-this.style.x,n);}this.updateOrigin();}isPointInPath(t,e){return super.isPointInPath(t,0)}};class $a extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"roundedRect",style:{...Mr,roundedRadius:0,width:0,height:0,...t},...e}),i(this,"shapeType","roundedRect");const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:n.value},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:i,y:n,width:s,height:o,borderWidth:r}=this.parsedStyle,a=(r.value+e||0)/2;return ma(i-a,n-a,s.value+2*a,o.value+2*a,t.x,t.y)}getCenterPosition(){const{width:t,height:e}=this.parsedStyle,i=new Ia({style:{x:t.value/2,y:e.value/2}});this.appendChild(i);const{x:n,y:s}=i.getPosition();return i.destroy(),{x:n,y:s}}}class Ga extends ka{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"freeText",style:{...Mr,width:0,height:0,textAlign:"left",...t},...e}),i(this,"shapeType","freeText"),i(this,"lines",void 0),i(this,"textType","textBox"),i(this,"lineHeightOffset",.2),i(this,"renderClipPath",void 0),i(this,"renderClipStep",void 0),i(this,"totalTextHeight",0),i(this,"limitWidth",1),i(this,"textMaxWidth",0),i(this,"borderOffset",0),i(this,"padding",1),this.textType=t.freeTextType||"textBox",this.setLimitWidth(this.parsedStyle.width.value),this.calculateTextLines();const{x:n,y:s}=this.parsedStyle;this.setLocalPosition(n,s),this.updateOrigin();}getLimitTextWithoutSpace(t,e){const{textContents:i}=this.parsedStyle,n=Vn(t),s=n.segmentation.length,o=n.segmentation[s-1],r=Xa(" ",i[o.freeContentIndex]),a=o.text.split(" ").length-1;let l;for(let t=0;t<a&&(l=t+1,!(n.width-l*r<e));t++);for(let t=0;t<l;t++)n.word=n.word.slice(0,-1),n.width-=r,o.text=o.text.slice(0,-1),o.width-=r;return n}splitWordSegment(t,e){const i=t,n=[],s=[];let o=e;const r=i.segmentation.length;for(let t=0;t<r;t++){const e=i.segmentation[t];if(!(e.width<o)){if(e.width===o){n.push({...e}),s.push(...i.segmentation.slice(r-t-1));break}{const a=this.parsedStyle.textContents[e.freeContentIndex],l=Ya(e.text,o,a);2===l.length?(n.push({text:l[0],width:Xa(l[0],a),freeContentIndex:e.freeContentIndex}),s.push({text:l[1],width:Xa(l[1],a),freeContentIndex:e.freeContentIndex})):s.push({...e});const h=r-t-1;h>0&&s.push(...i.segmentation.slice(-h));break}}n.push({...e}),o-=e.width;}const a=t=>{let e="",i=0;return t.forEach((t=>{e+=t.text,i+=t.width;})),{word:e,width:i,segmentation:t}};return 0===n.length?[a(s)]:[a(n),a(s)]}getWordSegmentation(){const{textContents:t}=this.parsedStyle;let e="";const i=[0];t.forEach((t=>{e+=t.content,i.push(e.length);}));const n=e.match(/\S+\s*/g)||[],s=[];let o=0;const r=Za(e);if(r.length&&n.unshift(...r)," "===e[0]){const t=e.match(/^ +/)[0];n[0]?n[0]=t+n[0]:n[0]=t;}for(let t=0;t<n.length;t++){const e=n[t].split(/(\r\n|[\r\n])/).filter((t=>""!==t));e.length>2&&(n[t]=e[0]+e[1],n.splice(t+1,0,...e.slice(2)));}return n.forEach((e=>{const n=o+e.length-1,r=[...i.filter((t=>t>o&&t<=n))];if(0===r.length){const n=i.filter((t=>t<=o)).length,r=Xa(e,t[n-1]);s.push({word:e,segmentation:[{text:e,width:r,freeContentIndex:n-1}],width:r});}else {const n=[];let a=0;r.forEach(((s,l)=>{const h=s-(r[l-1]||o),d=r[l-1]-o||0,c=e.substring(d,d+h),u=Xa(c,t[i.indexOf(s)-1]);if(n.push({text:c,width:u,freeContentIndex:i.indexOf(s)-1}),a+=u,l===r.length-1){const o=Xa(e.substring(d+h),t[i.indexOf(s)]);n.push({text:e.substring(d+h),freeContentIndex:i.indexOf(s),width:o}),a+=o;}})),s.push({word:e,width:a,segmentation:n});}o+=e.length;})),s}organizeLine(){if(0===this.lines.length)return;const{y:t}=this.parsedStyle;let e=t+this.borderOffset+this.padding,i=0,n=0;this.lines.forEach(((t,s)=>{n=0,i=Math.max(t.width,i);let o=0,r="";if(0===t.width&&""===t.words[0].text){const e=Xa(" ",t.words[0].style);t.width=e,t.words[0].wordWidth=e,t.words[0].text=" ";}if(t.words.forEach((t=>{r+=t.text,o=Math.max(o,t.wordHeight),t.widthWithoutLf=Ja(t.text)?Xa(t.text,t.style,!0):t.wordWidth,n+=t.widthWithoutLf;})),"textBox"===this.textType&&"justify"===this.style.textAlign&&s!==this.lines.length-1){const e=[],i=/\b\w/g;let s,o=0;for(;null!==(s=i.exec(r));)e.push(s.index);if(e.length>1){let i=this.limitWidth-n;i<0&&(i=0);const s=i/(e.length-1),r=t=>{for(let i=0;i<e.length;i++)if(e[i]>t)return i;return e.length};t.words.forEach(((t,e)=>{e>0&&(t.x+=s*(r(o)-1)),o+=t.text.length;})),n=this.limitWidth,t.width=this.limitWidth;}}const{lineHeightOffset:a}=this;t.widthWithoutLF=n,t.height=o,t.y=o*(1-a)+e,e+=o,s>0&&(t.y+=this.lines[s-1].height*a,e+=this.lines[s-1].height*a);})),this.textMaxWidth=i;}getTextAlignOffset(t){if("freeTextWriter"===this.textType)return 0;const{limitWidth:e}=this,{textAlign:i}=this.parsedStyle,n=t?t.widthWithoutLF:0;let s=0;return "center"===i?s=(e-n)/2:"right"===i&&(s=e-n),s}getPath(){var t;if(!this.pathDirty)return this.path;const{width:e,height:i}=this.getBoundingRect(),n=.5*((null===(t=this.parsedStyle.borderWidth)||void 0===t?void 0:t.value)||0),s=n,o=n,r=e-2*n,a=i-2*n;if(this.path=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],"textBox"===this.textType){const t=this.borderOffset/2;this.renderClipPath=[{x:s+t,y:o+t},{x:s+r-t,y:o+t},{x:s+r-t,y:o+a-t},{x:s+t,y:o+a-t}],this.renderClipStep=oa(this.renderClipPath);}return this.steps=oa(this.path),this.pathDirty=!1,this.path}setLimitWidth(t){const{borderWidth:e,borderColor:i}=this.parsedStyle;"textBox"===this.textType&&e.value&&!i.isNone&&(this.borderOffset=e.value,this.padding=e.value),this.limitWidth=t-2*this.borderOffset-2*this.padding;}calculateTextLines(){const{textContents:t,x:e}=this.parsedStyle;if(null==t||!t.length||this.limitWidth<=0)return this.lines=[],void this.calculateTotalHeight();const i=e+this.borderOffset+this.padding;this.lines=function(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=document.createElement("div"),o=function(t,e,i){const n=[],s=document.createDocumentFragment();return t.style.width=`${e}px`,t.style.wordBreak="break-word",t.style.visibility="hidden",i.forEach((t=>{const{fontSize:e,fontStyle:i,fontFamily:o,fontWeight:r,color:a,content:l}=t;if(!l.length)return;const h=""===(null==o?void 0:o.trim())?"sans-serif":o,d=null!=o&&o.includes(" ")?`${i} ${r} ${e.value}${e.unit} '${h}'`:`${i} ${r} ${e.value}${e.unit} ${h}`,c=document.createElement("div");if(c.style.font=d,c.style.letterSpacing="0px",c.style.whiteSpace="pre-wrap",c.style.display="inline",c.style.color=a,u=l,new RegExp(`([A-Za-z0-9])\\1{${10-1},}`).test(u)){const t=document.createDocumentFragment();for(let t=0;t<l.length;t++){const e=document.createElement("span");e.style.display="inline-block",e.innerText=l[t],c.appendChild(e);}c.appendChild(t);}else c.innerText=l;var u;s.appendChild(c),n.push(c);})),t.appendChild(s),n}(s,e,t);document.body.appendChild(s);const r=[];let a,l=[],h={};const d=()=>{if(!l.length)return;h.x=i,h.words=l;let t=0;l.forEach((e=>{t+=e.wordWidth;})),h.width=t,r.push(h),l=[],h={};},c=(e,s,o,r)=>{const h=t[o];if(n){const n=[],r=/\b\w/g;let d;for(;null!==(d=r.exec(e));)n.push(d.index);let c=s-(a||0)+i;for(let i=0;i<n.length;i++){const s=n[i],r=i===n.length-1?e.length:n[i+1],a=e.slice(s,r),d=Xa(a,t[o]);l.push({freeContentIndex:o,originText:a,style:h,text:a,wordHeight:h.fontSize.value,wordWidth:d,x:c}),c+=d;}}else l.push({freeContentIndex:o,originText:e,style:h,text:e,wordHeight:h.fontSize.value,wordWidth:r,x:s-(a||0)+i});},u=(t,e)=>{c("\n",a||0,t,e),d();};for(let e=0;e<o.length;e++){const i=Qa(o[e]);if(0===i.length)continue;const n=t[e].content.replace(/\r\n/g,"\n"),s=n.length,r=Za(n).length,l=n.slice(r),h=Xa("\n",t[e]);if(r)for(let t=0;t<r;t++)u(e,h);i.length&&zn(a)&&(a=i[0].x);const p=i.map(((t,e)=>({obj:t,index:e,oldIndex:e,minIndex:void 0}))).filter((t=>{let{obj:e,index:i}=t;return e.x===a&&0!==i}));i.length&&i[0].x===a&&d();const g=i[i.length-1];if(s===i.length)if(p.length){let t=0;p.forEach((s=>{const{index:o}=s,r=n.slice(t,o),a=i[o-1],l=i[t].x;t=o,c(r,l,e,a.x-l+a.width),d();}));const s=n.slice(t),o=i[t].x;c(s,o,e,g.x-o+g.width);}else {const t=g.x-i[0].x+g.width;c(n,i[0].x,e,t);}else {const t=Ka(l);for(let e=0;e<t.length;e++)p.forEach((i=>{i.index>=t[e]&&(i.index===t[e]&&zn(null==i?void 0:i.minIndex)&&(i.minIndex=t[e]),i.index+=1);}));if(p.length){let n=0,s=0;p.forEach(((t,o)=>{const{index:r,oldIndex:a,minIndex:p}=t;let g=0;if(zn(p)||(g=r-p),g){const t=l.slice(n,r-g+1),o=i[a-1],p=i[s].x,f=o.x-p+o.width+h;c(t,p,e,f),d();for(let t=0;t<g-1;t++)u(e,h);}else {const t=l.slice(n,r),o=i[a-1],h=i[s].x;c(t,h,e,o.x-h+o.width),d();}n=r,s=a;}));const o=t.filter((t=>t>p[p.length-1].index)).length,r=l.slice(n,l.length-o+1),a=i[i.length-1],g=i[p[p.length-1].oldIndex].x,f=o>0?a.x-g+a.width+h:a.x-g+a.width;c(r,g,e,f);for(let t=0;t<o-1;t++)0===t&&d(),u(e,h);}else if(t.length){const n=l.slice(0,l.length-t.length+1),s=g.x-i[0].x+g.width+h;c(n,i[0].x,e,s),d();for(let i=0;i<t.length-1;i++)u(e,h);}else {const t=g.x-i[0].x+g.width;c(l,i[0].x,e,t);}}}return d(),s.remove(),r}(t,this.limitWidth,i,"justify"===this.style.textAlign),this.organizeLine(),this.calculateTotalHeight();}calculateTotalHeight(){const{y:t,height:e}=this.parsedStyle,i=this.lines.length;if(i){const n=this.lines[i-1];let s=n.y+n.height*this.lineHeightOffset-t+2*this.borderOffset;Ja(n.words[0].text)&&(s+=n.height*(1+this.lineHeightOffset)),this.totalTextHeight=s>e.value?s:e.value;}else this.totalTextHeight=e.value;}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,height:i}=this.parsedStyle;let n=i.value,s=this.limitWidth+2*this.borderOffset+2*this.padding;return "freeTextWriter"===this.textType?(s=this.textMaxWidth+2*this.borderOffset+2*this.padding,n=this.totalTextHeight):s=this.parsedStyle.width.value,this.boundsDirty=!1,this.bounds={x:t,y:e,width:s,height:n},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}}function Xa(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{fontSize:n,fontStyle:s,fontFamily:o,fontWeight:r}=e,a=document.createElement("canvas").getContext("2d"),l=""===(null==o?void 0:o.trim())?"sans-serif":o;null!=o&&o.includes(" ")?a.font=`${s} ${r} ${n.value}${n.unit} '${l}'`:a.font=`${s} ${r} ${n.value}${n.unit} ${l}`;let h=0;for(let e=0;e<t.length;e++){const n=t.charAt(e);i&&qa(n)||(h+=a.measureText(n).width);}return h}function Ya(t,e,i){let n=0;for(let s=0;s<t.length;s++){if(Xa(t.substring(0,s+1),i)>e){n=s;break}}return 0===n?[t]:[t.substring(0,n),t.substring(n)]}function qa(t){return /^[\r\n]+$/.test(t)}function Ja(t){return t.endsWith("\n")||t.endsWith("\r")||t.endsWith("\r\n")}function Za(t){const e=t.match(/^(?:\r\n|\r|\n)*/);if(e){const t=e[0];let i=0;for(const e of t)"\n"!==e&&"\r"!==e||(i+=1);return t.includes("\r\n")&&(i-=1),Array.from({length:i},(()=>"\n"))}return []}function Qa(t){const e=[],i=document.createRange(),n=function(t){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null);let n;for(;n=i.nextNode();)e.push(n);return e}(t);return n.forEach((t=>{i.selectNodeContents(t);const n=t.nodeValue;for(let s=0;s<n.length;s++){i.setStart(t,s),i.setEnd(t,s+1);const o=i.getClientRects(),r=o.length>1?o[1]:o[0];e.push({text:n[s],x:r.left,y:r.top,width:r.width,height:r.height});}})),function(t){const e=new Map;t.forEach((t=>{var i;e.has(t.y)||e.set(t.y,[]),null===(i=e.get(t.y))||void 0===i||i.push(t);})),e.forEach((t=>{t.sort(((t,e)=>t.x-e.x));}));const i=[];return e.forEach((t=>{i.push(...t);})),i}(e)}function Ka(t){const e=/(\r\n|[\r\n])/g;let i;const n=[];for(;null!==(i=e.exec(t));)n.push(i.index);return n}const tl=1/0;class el{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tl,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tl,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;i(this,"minX",void 0),i(this,"maxX",void 0),i(this,"minY",void 0),i(this,"maxY",void 0),i(this,"rect",void 0),i(this,"updateId",void 0),this.minX=t,this.maxX=e,this.minY=n,this.maxY=s,this.rect=null,this.updateId=-1;}static isEmpty(t){return t.minX===t.maxX&&t.minY===t.maxY}static fromBounds(t){return (new el).setFromBounds(t)}static create(){return new el}setFromBounds(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}clear(){return this.minX=tl,this.maxX=-1/0,this.minY=tl,this.maxY=-1/0,this}getRect(t){const{minX:e,minY:i,maxX:n,maxY:s}=this;if(e>n||i>s)return new us(0,0,0,0);const o=t||new us;return o.update(e,i,n-e,s-i),o}addPoint(t){return this.addBounds({minX:t.x,maxX:t.x,minY:t.y,maxY:t.y})}addBounds(t){const e=nl(this,t);return this.setFromBounds(e)}addBoundsMask(t,e){const i=il(t,e);if(i.minX<=i.maxX&&i.minY<=i.maxY){const t=nl(i,this);this.setFromBounds(t);}return this}intersection(t){if(i=t,!((e=this).minX<=i.maxX&&e.maxX>=i.minX&&e.minY<=i.maxY&&e.maxY>=i.minY))return null;var e,i;const n=il(this,t);return el.fromBounds(n)}union(t){const e=nl(this,t);return el.fromBounds(e)}addBoundsArea(t,e){const{x:i,y:n,width:s,height:o}=e,r={minX:i,minY:n,maxX:i+s,maxY:n+o};return this.addBoundsMask(t,r)}addFrame(t,e){return this.setFromTransformedBounds(t.worldTransform,e)}setFromTransformedBounds(t,e){for(let i=0;i<2;i++){const n=t.transformPoint({x:i?e.maxX:e.minX,y:i?e.maxY:e.minY});this.addPoint(n);}return this}addQuad(t){for(let e=0;e<4;e++)this.addPoint({x:t[2*e],y:t[2*e+1]});}}function il(t,e){return {minX:t.minX>e.minX?t.minX:e.minX,minY:t.minY>e.minY?t.minY:e.minY,maxX:t.maxX<e.maxX?t.maxX:e.maxX,maxY:t.maxY<e.maxY?t.maxY:e.maxY}}function nl(t,e){return {minX:t.minX<e.minX?t.minX:e.minX,minY:t.minY<e.minY?t.minY:e.minY,maxX:t.maxX>e.maxX?t.maxX:e.maxX,maxY:t.maxY>e.maxY?t.maxY:e.maxY}}class sl extends ka{constructor(){super({}),i(this,"name","Document"),i(this,"defaultView",void 0),i(this,"documentElement",void 0),i(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new ka({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement];}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(t,e){const i=this.defaultView.customElements.get(t);return new i(e)}getElementById(t){return null}getElementsByName(t){return this.documentElement.getElementsByTagName(t)}getElementsByTagName(t){return this.documentElement.getElementsByTagName(t)}getElementsByClassName(t){return this.documentElement.getElementsByClassName(t)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(t){return this.documentElement.querySelector(t)}querySelectorAll(t){return this.documentElement.querySelectorAll(t)}find(t){return this.documentElement.find(t)}findAll(t){return this.documentElement.findAll(t)}appendChild(t){return this.documentElement.appendChild(t)}cloneNode(t){return this.documentElement.cloneNode(t)}insertBefore(t,e){return this.documentElement.insertBefore(t,e)}removeChild(t){return this.documentElement.removeChild(t)}replaceChild(t,e){return this.documentElement.replaceChild(t,e)}destroy(){}}class ol extends Zo{constructor(){super(...arguments),i(this,"altKey",void 0),i(this,"button",void 0),i(this,"buttons",void 0),i(this,"ctrlKey",void 0),i(this,"metaKey",void 0),i(this,"shiftKey",void 0),i(this,"relatedTarget",void 0),i(this,"client",new zr),i(this,"movement",new zr),i(this,"offset",new zr),i(this,"page",new zr),i(this,"screen",new zr),i(this,"global",new zr),i(this,"canvas",new zr);}initEvent(t,e,i){throw new Error("Method not implemented.")}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(t){return "getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,o,r,a,l,h,d,c,u,p,g){throw this.initUIEvent(t,i,i,n,s),new Error("initMouseEvent() DOM API is deprecated.")}}function rl(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.relatedTarget=null,e.client.setFromPoint(t.client),e.movement.setFromPoint(t.movement),e.offset.setFromPoint(t.offset),e.page.setFromPoint(t.page),e.screen.setFromPoint(t.screen),e.global.setFromPoint(t.global),e.canvas.setFromPoint(t.canvas);}class al extends ol{constructor(){super(...arguments),i(this,"deltaMode",void 0),i(this,"deltaX",void 0),i(this,"deltaY",void 0),i(this,"deltaZ",void 0),i(this,"DOM_DELTA_PIXEL",0),i(this,"DOM_DELTA_LINE",1),i(this,"DOM_DELTA_PAGE",2);}}function ll(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;}class hl extends ol{constructor(t){super(t),i(this,"height",0),i(this,"isPrimary",void 0),i(this,"pointerId",void 0),i(this,"pointerType",void 0),i(this,"pressure",void 0),i(this,"tangentialPressure",void 0),i(this,"tiltX",void 0),i(this,"tiltY",void 0),i(this,"twist",void 0),i(this,"width",0),i(this,"getCoalescedEvents",void 0),i(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0;}}function dl(t,e){e.isPrimary=t.isPrimary,e.width=t.width,e.height=t.height,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.pointerType=t.pointerType,e.pointerId=t.pointerId,e.pressure=t.pressure,e.twist=t.twist,e.tangentialPressure=t.tangentialPressure;}class cl{constructor(t,e){i(this,"root",void 0),i(this,"cursor","default"),i(this,"events",void 0),i(this,"trackingData",void 0),i(this,"contextService",void 0),this.root=t,this.contextService=e,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this));}clientToCanvas(t){const e=this.contextService.getBoundingClientRect();return new zr(t.x-(e.x||0),t.y-(e.y||0))}canvasToClient(t){const e=this.root.defaultView.contextService.getBoundingClientRect();return new zr(t.x+(e.x||0),t.y+(e.y||0))}getPropagationPath(t){const e=[t];for(;ka.isNode(t)&&t!==this.root;)t=t.parentNode,e.push(t);return e.reverse()}getHitTarget(t,e){const{root:i}=this,{isInteractive:n}=i,s=gl(i,n,new zr(t,e));return s?s[0]:null}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push({fn:e,order:0}),this.events[t].sort(((t,e)=>t.order-e.order));}emit(t){if(!this.root)return;const e=this.events[t.type]||[];for(let i=0;i<e.length;i++)e[i].fn(t);}onPointerdown(t){if(!(t instanceof hl))return;const e=this.generatePointerEvent(t);let i;ir(e,"pointerdown"),"touch"===e.pointerType?i="touchstart":ul(e)&&(i=2===e.button?"rightdown":"mousedown"),ir(e,i);this.getTrackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath();}onPointermove(t){if(!(t instanceof hl))return;const e=this.generatePointerEvent(t),i=ul(e),n=this.getTrackingData(t.pointerId),s=pl(n.overTargets);if(s&&s!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",o=this.generatePointerEvent(t,n,s);ir(o,"pointerout"),i&&ir(o,"mouseout");const r=e.composedPath();if(!r.includes(s)){const e=this.generatePointerEvent(t,"pointerleave",s);for(e.eventPhase=e.AT_TARGET;e.target&&!r.includes(e.target);)e.currentTarget=e.target,er(e,e.type),i&&er(e,"mouseleave"),e.target=e.target.parentNode;}}if(s!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",o=this.clonePointerEvent(e,n);ir(o,"pointerover"),i&&ir(o,"mouseover");let r=ka.isNode(s)&&(null==s?void 0:s.parentNode);for(;r&&r!==(ka.isNode(this.root)&&this.root.parentNode)&&r!==e.target;)r=r.parentNode;if(!r||r===this.root.parentNode){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==s&&t.target!==this.root.parentNode;)t.currentTarget=t.target,er(t,t.type),i&&er(t,"mouseenter"),t.target=t.target.parentNode;}}var o;(ir(e,"pointermove"),"touch"===e.pointerType&&ir(e,"touchmove"),i)&&(ir(e,"mousemove"),this.cursor=null===(o=e.target)||void 0===o?void 0:o.cursor);n.overTargets=e.composedPath();}onPointerup(t){if(!(t instanceof hl))return;const e=performance.now(),i=this.generatePointerEvent(t);ir(i,"pointerup");const{pointerType:n}=i;let s;"touch"===n?s="touchend":ul(i)&&(s=2===i.button?"rightup":"mouseup"),ir(i,s);const o=this.getTrackingData(t.pointerId),r=pl(o.pressTargetsByButton[t.button]);let a=r;const l=i.composedPath();if(r&&!l.includes(r)){let e=r;for(;e&&!l.includes(e);)i.currentTarget=e,er(i,"pointerupoutside"),"touch"===n?s="touchendoutside":ul(i)&&(s=2===i.button?"rightupoutside":"mouseupoutside"),er(i,s),e=e.parentNode;delete o.pressTargetsByButton[t.button],a=e;}if(a){const r=this.clonePointerEvent(i,"click");r.target=a,r.path=null,o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const l=o.clicksByButton[t.button];l.target===r.target&&e-l.timeStamp<200?l.clickCount+=1:l.clickCount=1,l.target=r.target,l.timeStamp=e,r.detail=l.clickCount,s="mouse"===n?"click":"touch"===n?"tap":"pointertap",ir(r,s);}}onPointerout(t){if(!(t instanceof hl))return;const e=this.getTrackingData(t.pointerId);if(e.overTargets){const i=ul(t),n=pl(e.overTargets),s=this.generatePointerEvent(t,"pointerout",n);ir(s),i&&ir(s,"mouseout");const o=this.generatePointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.root.parentNode;)o.currentTarget=o.target,er(o,o.type),i&&er(o,"mouseleave"),o.target=o.target.parentNode;e.overTargets=null;}this.cursor=null;}onPointerover(t){if(!(t instanceof hl))return;const e=this.getTrackingData(t.pointerId),i=this.generatePointerEvent(t),n=ul(t);var s;(ir(i,"pointerover"),n&&ir(i,"mouseover"),"mouse"===i.pointerType)&&(this.cursor=null===(s=i.target)||void 0===s?void 0:s.cursor);const o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.root.parentNode;)o.currentTarget=i.target,er(o,o.type),n&&er(o,"mouseenter"),o.target=o.target.parentNode;e.overTargets=i.composedPath();}onWheel(t){if(!(t instanceof al))return;ir(this.generateWheelEvent(t));}generatePointerEvent(t,e,i){const n=new hl(this);return dl(t,n),rl(t,n),Qo(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=null!=i?i:this.getHitTarget(n.globalX,n.globalY),n.type=null!=e?e:n.type,n}generateWheelEvent(t){const e=new al(this);return ll(t,e),rl(t,e),Qo(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.getHitTarget(e.globalX,e.globalY),e}clonePointerEvent(t,e){const i=new hl(this);return dl(t,i),rl(t,i),Qo(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=t.target,i.path=t.composedPath().slice(),i}getTrackingData(t){return this.trackingData[t]||(this.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[t]}}function ul(t){const{pointerType:e}=t;return "mouse"===e||"pen"===e}function pl(t){if(!t)return null;let e=t[0]||null;for(let i=1,n=t.length;i<n&&t[i].parentNode===e;i++)e=t[i];return e}function gl(t,e,i){if(!t||"visible"!==t.style.visibility)return null;const{hitArea:n}=t.style;if(n){const{x:e,y:s}=t.transform.worldTransform.transformPoint(i);if(!n.contains(e,s))return null}const{clipPath:s}=t.style;if(s&&!s.containPoint(i))return null;if(t.isChildrenInteractive&&t.children){const{children:n}=t;for(let s=n.length-1;s>=0;s--){const o=n[s],r=gl(o,e||o.isInteractive,i);if(r)return (r.length>0||t.isInteractive)&&r.push(t),r}}return e&&t.containPoint(i)?t.isInteractive?[t]:[]:null}i(class{constructor(){i(this,"canvasConfig",void 0),i(this,"contextService",void 0),i(this,"renderingContext",void 0),i(this,"eventService",void 0),i(this,"rootPointerEvent",new hl(null)),i(this,"rootWheelEvent",new al(null)),i(this,"autoPreventDefault",!0);}init(t){const{renderingService:e,renderingContext:i,contextService:n,canvasConfig:s}=t;this.eventService=new cl(i.root.parentNode,n),t.eventService=this.eventService,this.renderingContext=i,this.contextService=n,this.canvasConfig=s,e.hooks.wheel.on(this.onWheel),e.hooks.pointerdown.on(this.onPointerdown),e.hooks.pointermove.on(this.onPointermove),e.hooks.pointerup.on(this.onPointerup),e.hooks.pointerout.on(this.onPointermove),e.hooks.pointerover.on(this.onPointermove);}destroy(){}onWheel(t){const e=this.normalizeWheelEvent(t);this.eventService.emit(e);}onPointerdown(t){if(this.isTouchEvent(t))return;const e=this.normalizeToPointerEvent(t);if(this.autoPreventDefault&&e.isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault();}const i=this.bootstrapEvent(e,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor);}onPointermove(t){if(this.isTouchEvent(t))return;const e=this.normalizeToPointerEvent(t),i=this.bootstrapEvent(e,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor);}onPointerup(t){if(this.isTouchEvent(t))return;const e=this.contextService.getDomElement(),i=t.target===e?"":"outside",n=this.normalizeToPointerEvent(t),s=this.bootstrapEvent(n,this.rootPointerEvent);s.type+=i,this.eventService.emit(s),this.setCursor(this.eventService.cursor);}setCursor(t){this.contextService.setCursor(t||this.canvasConfig.cursor||"default");}normalizeWheelEvent(t){const e=this.rootWheelEvent;e.nativeEvent=t,this.transferMouseData(t,e),ll(t,e);const i=new zr(t.clientX,t.clientY),{x:n,y:s}=this.eventService.clientToCanvas(i);return e.canvas.x=n,e.canvas.y=s,e.offset.setFromPoint(e.canvas),e.global.setFromPoint(e.canvas),Qo(t,e),e}normalizeToPointerEvent(t){const e=this.renderingContext.root.ownerDocument.defaultView;if(e.supportTouchEvent&&t instanceof TouchEvent){const e=t;e.isNormalized=!0,e.pointerType="touch";}else if(!MouseEvent||t instanceof MouseEvent&&(!e.supportPointerEvent||!(t instanceof PointerEvent))){const e=t;e.isPrimary=!0,e.width=1,e.height=1,e.tiltX=0,e.tiltY=0,e.pointerType="mouse",e.pointerId=1,e.pressure=.5,e.twist=0,e.tangentialPressure=0,e.isNormalized=!0;}return t}bootstrapEvent(t,e){this.renderingContext.root.ownerDocument.defaultView,e.originalEvent=null,e.nativeEvent=t,dl(t,e),this.transferMouseData(t,e);const{x:i,y:n}=this.eventService.clientToCanvas(new zr(t.clientX,t.clientY));return e.canvas.x=i,e.canvas.y=n,e.offset.setFromPoint(e.canvas),e.global.setFromPoint(e.canvas),Qo(t,e),"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&e.type.replace("mouse","pointer"),e}transferMouseData(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.relatedTarget=null,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY;}isTouchEvent(t){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===t.pointerType}},"moduleName","Event");class fl extends Zo{constructor(t,e,n,s,o,r,a,l){super(null),i(this,"relatedNode",void 0),i(this,"prevValue",void 0),i(this,"newValue",void 0),i(this,"attrName",void 0),i(this,"attrChange",void 0),i(this,"prevParsedValue",void 0),i(this,"newParsedValue",void 0),this.type=t,this.relatedNode=e,this.prevValue=n,this.newValue=s,this.attrName=o,this.attrChange=r,this.prevParsedValue=a,this.newParsedValue=l;}}i(fl,"ADDITION",2),i(fl,"MODIFICATION",1),i(fl,"REMOVAL",3);class yl{constructor(t){i(this,"contextService",void 0),i(this,"renderingPlugins",[]),i(this,"config",{autoRendering:!0}),Object.assign(this.config,t);}use(t){this.renderingPlugins.includes(t)||this.renderingPlugins.push(t);}initPlugins(t){this.renderingPlugins.forEach((e=>{e.init(t);}));}destroyPlugins(){this.renderingPlugins.forEach((t=>{t.destroy();}));}getPlugins(){return this.renderingPlugins}getAnnotationConfig(){return this.config}}class ml{constructor(t){i(this,"hooks",{init:os.create(),beginFrame:os.create(),beforeRender:os.create(),render:os.create(),afterRender:os.create(),putImageData:os.create(),endFrame:os.create(),destroy:os.create(),pointerdown:os.create(),pointerup:os.create(),pointermove:os.create(),pointerout:os.create(),pointerover:os.create(),pointerCancel:os.create(),wheel:os.create()}),i(this,"isInited",!1),i(this,"zIndexCounter",0),i(this,"renderingContext",void 0),this.renderingContext=t;}init(){this.hooks.init.emit(),this.isInited=!0;}destroy(){this.isInited=!1,this.hooks.destroy.emit();}render(){const{root:t}=this.renderingContext;this.zIndexCounter=0,ur.recursiveUpdateHierarchy(t),this.isInited&&(this.renderDisplayObject(t),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear());}renderDisplayObject(t){if(!t.isVisible)return;const{sortable:e}=t;if(e.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),t.imageData)return void this.hooks.putImageData.emit(t);this.hooks.beforeRender.emit(t),this.hooks.render.emit(t),this.hooks.afterRender.emit(t);let i=!1;e.dirty&&(e.sorted=t.childNodes.slice().sort(vl),e.dirty=!1,i=!0);const n=e.sorted||t.childNodes;n.length>1&&n.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),n.forEach((t=>{this.renderDisplayObject(t);})),n.sort(((t,e)=>t.index-e.index)),i&&t.recursiveCall((t=>{const e=new Ko("renderOrderChanged",{renderOrder:t.sortable.renderOrder});t.dispatchEvent(e);}));}dirty(){this.renderingContext.renderCondition.add(0);}}function vl(t,e){const i=Number(t.style.zIndex),n=Number(e.style.zIndex);if(i===n&&t.parentNode){const{childNodes:i=[]}=t.parentNode;return i.indexOf(t)-i.indexOf(e)}return i-n}class xl extends tr{constructor(t){super(),i(this,"document",void 0),i(this,"customElements",void 0),i(this,"devicePixelRatio",void 0),i(this,"eventService",void 0),i(this,"renderingService",void 0),i(this,"renderingContext",void 0),i(this,"canvasConfig",void 0),i(this,"renderer",void 0),i(this,"supportTouchEvent",void 0),i(this,"supportPointerEvent",void 0),i(this,"limit1px",!1),i(this,"contextService",void 0);const{renderer:e,dpr:n,width:s,height:o,canvas:r,supportPointerEvent:a,supportTouchEvent:l}=t;this.supportPointerEvent=null!=a?a:!!globalThis.PointerEvent,this.supportTouchEvent=null!=l?l:"touchstart"in window;let h=s,d=o,c=n;r&&(c=n||window.devicePixelRatio||1,h=s||r.width/c,d=o||r.height/c),this.canvasConfig={...t,width:h,height:d,dpr:c},this.canvasConfig=t,this.renderer=e,this.document=new sl,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new ml(this.renderingContext),this.initRenderer(e);}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",(t=>{this.mountChildren(t.detail.child);})),this.document.documentElement.addEventListener("child-removed",(t=>{this.unmountChildren(t.detail.child);}));}initRenderer(t){this.renderingService.init(),t.initPlugins(this),this.contextService.init();t.getAnnotationConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall((t=>{const{renderable:e}=t;e&&(e.boundsDirty=!0,e.renderBoundsDirty=!0);})),this.mountChildren(this.document.documentElement);}render(){const t=new Ko("beforeRender",{});this.dispatchEvent(t),this.contextService.clearCanvas(),this.renderingService.render();}setDPR(t){this.canvasConfig.dpr=t,this.contextService.setDPR(t);}resize(t,e){this.canvasConfig.width=t,this.canvasConfig.height=e,this.contextService.resize(t,e);}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(t,e){return this.document.documentElement.appendChild(t,e)}insertBefore(t,e){return this.document.documentElement.insertBefore(t,e)}removeChild(t){return this.document.documentElement.removeChild(t)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(t){t.recursiveCall((t=>{if(!t.isConnected){t.isConnected=!0,t.ownerDocument=this.document;const e=new Ko("DOMNodeInsertedIntoDocument",{});t.dispatchEvent(e);}}));}unmountChildren(t){const e=[];t.recursiveCall((t=>{t.isConnected&&e.push(t);})),e.reverse().forEach((t=>{t.isConnected=!1;const e=new Ko("DOMNodeRemovedFromDocument",{});t.dispatchEvent(e),t!==this.document.documentElement&&(t.ownerDocument=null);}));}}class wl{}class bl extends wl{constructor(t){super(),i(this,"close",!0),i(this,"shape",void 0),i(this,"ctx",void 0),i(this,"rCanvas",void 0),this.rCanvas=t;}render(t,e){const{background:i,borderColor:n,visibility:s}=t.parsedStyle;if("hidden"===s)return;const o=!Hs(i)&&!i.isNone,r=!Hs(n)&&!n.isNone;this.renderPath(t,e),o&&this.renderFill(t,e),this.renderStrokePath(t,e),r&&this.renderStroke(t,e);}renderPath(t,e){t.getPath(),e.beginPath(),t.steps.forEach((t=>{ra(e,t);})),this.close&&t.steps.length>2&&e.closePath();}renderStrokePath(t,e){Yn(null==t?void 0:t.getStrokePath)&&(t.getStrokePath(),0!==t.strokePath.length&&(e.beginPath(),t.strokeSteps.forEach((t=>{ra(e,t);})),this.close&&t.strokeSteps.length>2&&e.closePath()));}renderFill(t,e){const{parsedStyle:i}=t,{background:n,opacity:s,fillOpacity:o,renderBlendMode:r}=i;if(e.save(),e.globalAlpha=s*o,"normal"!==r&&(e.globalCompositeOperation=r),Array.isArray(n)){this.setShapeGradientOrigin(t,e);for(let i=0;i<n.length;i++)0===i&&this.setShadow(t,e),e.fillStyle=this.getColor(t,n[i],e),e.fill();}else this.setShadow(t,e),e.fillStyle=n.formatted,e.fill();e.restore();}renderStroke(t,e){const{parsedStyle:i}=t,{borderWidth:n,borderColor:s,opacity:o,lineCap:r,lineJoin:a,miterLimit:l,lineDash:h,lineDashOffset:d,borderOpacity:c,renderBlendMode:u}=i;if(n&&n.value>0){if(e.save(),!Hs(n)){const i=t.getScale();this.rCanvas.limit1px?e.lineWidth=Math.max(1/i.x,n.value):e.lineWidth=n.value;}"normal"!==u&&(e.globalCompositeOperation=u),e.miterLimit=l,e.globalAlpha=o*c,e.lineCap=r,e.lineJoin=a,e.setLineDash(function(t){if(0===t.length)return !0;if(1===t.length)return 0===t[0];t.length%2!=0&&(t=t.concat(t));for(let e=1;e<t.length;e+=2)if(0!==t[e])return !1;return !0}(h)?[0,0]:h),e.lineDashOffset=d.value,Array.isArray(s)?(this.setShapeGradientOrigin(t,e),s.forEach((i=>{e.strokeStyle=this.getColor(t,i,e),e.stroke();}))):(e.strokeStyle=s.formatted,e.stroke()),e.restore();}}setShadow(t,e){const{shadow:i,shadowOffsetX:n,shadowOffsetY:s,shadowBlur:o,shadowColor:r}=t.parsedStyle;(i||r)&&(e.shadowOffsetX=(null==n?void 0:n.value)||i[0],e.shadowOffsetY=(null==s?void 0:s.value)||i[1],e.shadowBlur=(null==o?void 0:o.value)||i[2],e.shadowColor=(null==r?void 0:r.formatted)||i[3]);}getColor(t,e,i){let n;if(1===e.type||2===e.type){const s=t.getBoundingRect(),{width:o,height:r}=s;n=function(t,e){const{type:i,steps:n,width:s,height:o,angle:r,cx:a,cy:l,size:h}=t;let d=null;if(1===i){const{x1:t,y1:i,x2:n,y2:a}=function(t,e,i){const n=i*Math.PI/180,s=0+t/2,o=0+e/2,r=Math.abs(t*Math.cos(n))+Math.abs(e*Math.sin(n));return {x1:s-Math.cos(n)*r/2,y1:o-Math.sin(n)*r/2,x2:s+Math.cos(n)*r/2,y2:o+Math.sin(n)*r/2}}(s,o,r.value);d=e.createLinearGradient(t,i,n,a);}else if(2===i){const{x:t,y:i,r:n}=function(t,e,i,n,s){let o=i.value,r=n.value;"%"===i.unit&&(o=i.value/100*t),"%"===n.unit&&(r=n.value/100*e);let a=Math.max(xs({x:0,y:0},{x:o,y:r}),xs({x:0,y:e},{x:o,y:r}),xs({x:t,y:e},{x:o,y:r}),xs({x:t,y:0},{x:o,y:r}));return s&&(Hn(s)?a=s.value:Zn(s)&&("closest-side"===s?a=Math.min(o,t-o,r,e-r):"farthest-side"===s?a=Math.max(o,t-o,r,e-r):"closest-corner"===s&&(a=Math.min(xs({x:0,y:0},{x:o,y:r}),xs({x:0,y:e},{x:o,y:r}),xs({x:t,y:e},{x:o,y:r}),xs({x:t,y:0},{x:o,y:r}))))),{x:o,y:r,r:a}}(s,o,a,l,h);d=e.createRadialGradient(t,i,0,t,i,n);}d&&n.forEach((t=>{let{offset:e,color:i}=t;var n;"%"===e.unit&&(null===(n=d)||void 0===n||n.addColorStop(e.value/100,i.toString()));}));return d}({type:e.type,...e.value,width:o,height:r},i);}return n}setShapeGradientOrigin(t,e){const{type:i}=t.config;switch(i){case"circle":case"arc":{const{r:i}=t.parsedStyle;e.translate(0-i.value,0-i.value);break}case"ellipse":{const{rx:i,ry:n}=t.parsedStyle;e.translate(0-i.value,0-n.value);break}default:e.translate(0,0);}}}class Cl extends bl{constructor(){super(),this.close=!1;}}class Sl extends bl{}class Pl extends bl{}class Al extends bl{render(t,e){const{width:i,height:n,img:s,opacity:o,visibility:r}=t.parsedStyle;if("hidden"!==r&&!Zn(s)&&s){if(e.save(),e.globalAlpha=o,s instanceof ImageData)e.putImageData(s,0,0);else {e.imageSmoothingEnabled=!0,e.imageSmoothingQuality&&(e.imageSmoothingQuality="high");try{e.drawImage(s,0,0,i.value,n.value);}catch(t){}}e.restore();}}}class Tl extends bl{constructor(){super(...arguments),i(this,"close",!1);}render(t,e){const{visibility:i}=t.parsedStyle;"hidden"!==i&&(this.renderPath(t,e),this.renderStroke(t,e));}renderPath(t,e){t.getPath(),e.beginPath(),t.inkRenderSteps.forEach((t=>{t.forEach((t=>{ra(e,t);}));}));}}class kl extends bl{}class Dl extends bl{render(t,e){const{background:i,borderColor:n,visibility:s}=t.parsedStyle;if("hidden"===s)return;const o=!Hs(i)&&!i.isNone,r=!Hs(n)&&!n.isNone;t.getPath();const a=t.steps.length;for(let i=0;i<a;i++){const n=t.steps[i];e.beginPath(),n.step.forEach((t=>{ra(e,t);})),n.close&&(e.closePath(),o&&this.renderFill(t,e)),r&&this.renderStroke(t,e);}}}class El extends bl{}class Il extends bl{constructor(){super(...arguments),i(this,"close",!0);}renderPath(t,e){t.getPath(),e.beginPath(),t.steps.forEach((t=>{ra(e,t),t.close&&e.closePath();}));}}class Rl extends bl{render(t,e){const{background:i,borderColor:n,visibility:s}=t.parsedStyle;if("hidden"===s)return;const o=!Hs(i)&&!i.isNone,r=!Hs(n)&&!n.isNone;t.getPath();const a=t.steps.length;for(let i=0;i<a;i++){const n=t.steps[i];e.beginPath(),n.step.forEach((t=>{ra(e,t);})),n.close&&(e.closePath(),o&&this.renderFill(t,e)),r&&this.renderStroke(t,e);}}}class Ml extends bl{render(t,e){const{width:i,height:n,roundedRadius:s,background:o,borderWidth:r,visibility:a}=t.parsedStyle;if("hidden"!==a){for(let t=0;t<4;t++){e.beginPath();const t=s.value;if(0===t)e.rect(0,0,i.value,n.value);else {const{PI:s}=Math;e.arc(t,t,t,s,3*s/2),e.arc(i.value-t,t,t,3*s/2,2*s),e.arc(i.value-t,n.value-t,t,0,s/2),e.arc(t,n.value-t,t,s/2,s);}}e.closePath(),o&&this.renderFill(t,e),r.value>0&&this.renderStroke(t,e);}}}class Bl extends bl{render(t,e){t&&"hidden"!==t.parsedStyle.visibility&&(this.renderBox(t,e),e.save(),t.renderClipStep&&(e.beginPath(),t.renderClipStep.forEach((t=>{ra(e,t);})),e.closePath(),e.clip()),this.renderText(t,e),e.restore());}renderBox(t,e){const{background:i,borderColor:n}=t.parsedStyle,s="textBox"===t.textType&&!Hs(i)&&!i.isNone,o="textBox"===t.textType&&!Hs(n)&&!n.isNone;this.renderPath(t,e),s&&this.renderFill(t,e),o&&this.renderStroke(t,e);}renderText(t,e){const{parsedStyle:i,lines:n}=t,{opacity:s,y:o,x:r}=i;e.globalAlpha=s,n.forEach((i=>{const n=i.height/30,s=t.getTextAlignOffset(i);i.words.forEach((t=>{const{color:a,fontFamily:l,fontSize:h,fontStyle:d,fontWeight:c,lineThrough:u,underline:p}=t.style;e.fillStyle=a;const g=""===l.trim()?"sans-serif":l;l.includes(" ")?e.font=`${d} ${c} ${h.value}${h.unit} '${g}'`:e.font=`${d} ${c} ${h.value}${h.unit} ${g}`;let f=t.x-r+s;if(function(t){return /[\u0600-\u06FF]/.test(t)}(t.text))e.fillText(t.text,f,i.y-o);else for(let n=0;n<t.text.length;n++){const s=t.text.charAt(n);e.fillText(s,f,i.y-o),f+=e.measureText(s).width;}p&&e.fillRect(t.x-r+s,i.y-o+n,t.widthWithoutLf,n),u&&e.fillRect(t.x-r+s,i.y-t.wordHeight/3-o,t.widthWithoutLf,h.value/30);}));}));}}class Ll extends bl{render(t,e){t&&"hidden"!==t.parsedStyle.visibility&&this.renderText(t,e);}renderText(t,e){const{parsedStyle:i}=t;t.setTextFont();const{text:n,font:s,opacity:o,color:r,y:a}=i;e.save(),e.globalAlpha=o,e.font=s,e.fillStyle=r.formatted,e.textBaseline="alphabetic",e.fillText(n,0,0),e.restore();}}class Ul{constructor(t){i(this,"canvasConfig",void 0),i(this,"container",void 0),i(this,"canvas",void 0),i(this,"dpr",void 0),i(this,"context",void 0),i(this,"shapeRenderers",{}),this.canvasConfig=t;}init(){const{container:t,canvas:e,dpr:i,willReadFrequently:n}=this.canvasConfig;if(e){this.canvas=e;const{parentElement:i}=e;t&&i!==t&&t.appendChild(e),this.container=i,this.canvasConfig.container=i;}else if(t&&(this.container=t,Zn(t)&&(this.container=document.getElementById(t)),this.container)){const t=document.createElement("canvas");this.container.appendChild(t),this.canvas=t;}this.context=this.canvas.getContext("2d",{willReadFrequently:n}),this.dpr=i||Ds(),this.resize(this.canvasConfig.width,this.canvasConfig.height);}registerShapeRenderer(t,e){this.shapeRenderers[t]||(this.shapeRenderers[t]=e);}getShapeRenderer(t){return this.shapeRenderers[t]}destroy(){const{canvas:t,container:e}=this;e&&null!=t&&t.parentNode&&e.removeChild(t);}resize(t,e){const{canvas:i,dpr:n}=this;i&&(i.width=t*n,i.height=e*n,this.context.scale(n,n));}getDPR(){return this.dpr}setDPR(t){this.canvasConfig.dpr=t,this.dpr=t;}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(t){var e;null!=this&&null!==(e=this.container)&&void 0!==e&&e.style&&(this.container.style.cursor=t);}getBoundingClientRect(){var t;return null===(t=this.canvas)||void 0===t?void 0:t.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr));}}class Ol{constructor(){i(this,"restoreStack",[]);}init(t){const{hooks:e}=t.renderingService;e.endFrame.on((()=>{const{contextService:e}=t,i=e.getContext();this.restoreStack.forEach((()=>{i.restore();})),this.restoreStack=[];})),e.render.on((e=>{this.renderDisplayObject(e,t);})),e.putImageData.on((e=>{if(e.imageData){const{x:i,y:n}=e.getPosition(),s=t.contextService.getContext(),o=t.contextService.getDPR();s.putImageData(e.imageData,Math.floor(i*o+.5),Math.floor(n*o+.5));}}));}renderDisplayObject(t,e){if(!t.isVisible)return;const{contextService:i}=e,n=i.getContext();let s=this.restoreStack[this.restoreStack.length-1];for(;s&&t.parentNode!==s;)n.restore(),this.restoreStack.pop(),s=this.restoreStack[this.restoreStack.length-1];n.save(),this.applyTransform(n,t);const{clipPath:o}=t.style;o&&(n.save(),this.applyTransform(n,o),n.restore(),n.clip()),this.useAnchor(n,t);const r=i.getShapeRenderer(t.shapeType);r&&(r.render(t,n),t.clippable&&n.clip()),this.restoreStack.push(t);}applyTransform(t,e){e.externalMatrices.length&&e.externalMatrices.slice().reverse().forEach((e=>{const{a:i,b:n,c:s,d:o,e:r,f:a}=e;t.transform(i,n,s,o,r,a);}));const i=e.getLocalTransform(),{a:n,b:s,c:o,d:r,e:a,f:l}=i;t.transform(n,s,o,r,a,l);}applyAttributes(t,e,i){}useAnchor(t,e){const{anchor:i}=e.parsedStyle||{};if(!i||0===i[0]&&0===i[1])return;const n=e.getGeometryBounds().getRect();t.translate(-(i&&i[0]||0)*n.width,-(i&&i[1]||0)*n.height);}destroy(){}}i(Ol,"moduleName",void 0);class Nl{init(t){const e=new Ul(t.canvasConfig);t.contextService=e;[{name:"arc",renderer:new Cl},{name:"circle",renderer:new Sl(t)},{name:"ellipse",renderer:new Pl(t)},{name:"line",renderer:new Rl(t)},{name:"image",renderer:new Al(t)},{name:"ink",renderer:new Tl(t)},{name:"polygon",renderer:new kl(t)},{name:"polyline",renderer:new Dl(t)},{name:"rect",renderer:new El(t)},{name:"stampText",renderer:new Ll(t)},{name:"stampPath",renderer:new Il(t)},{name:"roundedRect",renderer:new Ml(t)},{name:"freeText",renderer:new Bl(t)}].forEach((t=>{let{name:i,renderer:n}=t;e.registerShapeRenderer(i,n);}));}destroy(){}}class _l extends yl{constructor(t){super(t),this.use(new Nl),this.use(new Ol);}}function Wl(t,e,i){const n=e.x-t.x,s=e.y-t.y,o=i.x-t.x,r=n*(i.y-t.y)-s*o,a=cs(t,e),l=cs(t,i);let h=(a**2+l**2-cs(e,i)**2)/(2*a*l);h<-1&&(h=-1),h>1&&(h=1);let d=180*Math.acos(h)/Math.PI;return d=Math.round(100*d)/100,r<0?-d:d}function Fl(t,e,i){const n=rr.fromTwoPoint(e,t);return rr.fromTwoPoint(e,i).angle(n)>Math.PI/2}function Hl(t,e){return (e=t.getWorldTransform().inverse().transformPoint(e)).x+=t.parsedStyle.x,e.y+=t.parsedStyle.y,e}function Vl(t){if(!t)return !1;const{shapeType:e}=t;return "annotationRect"===e||"annotationFreeText"===e&&"textBox"===t.textType||"annotationStamp"===e&&"image"===t.renderType}function zl(t){return !!t&&("annotationPolyline"===t.shapeType||"annotationPolygon"===t.shapeType||"annotationLine"===t.shapeType)}function jl(t){return !!t&&("annotationFreeText"===t.shapeType||"annotationTextBox"===t.shapeType)}function $l(t,e){e.controls||e.context.initControls(),e.context.renderControls();const i=e.controls.controlPoints.slice(0,4),n=[];for(let t=0;t<4;t++){const{x:e,y:s}=i[t].getPosition();n.push({x:e,y:s});}const{x:s,y:o}=t.getPosition(),{width:r,height:a}=t.parsedStyle,l=Math.abs(t.getScale().x),h=Math.abs(t.getScale().y);return function(t,e){const i={x1:Math.min(...e.map((t=>t.x))),y1:Math.min(...e.map((t=>t.y))),x2:Math.max(...e.map((t=>t.x))),y2:Math.max(...e.map((t=>t.y)))};if(!function(t,e){const i=t.x1,n=t.x2,s=t.y1,o=t.y2,r=e.x1,a=e.x2,l=e.y1,h=e.y2;return !(n<r||a<i||o<l||h<s)}(t,i))return !1;return function(t,e){const i=e,n=[];for(let t=0;t<i.length;t++){const e=(t+1)%i.length;n.push({p1:i[t],p2:i[e]});}for(const e of n){const n={x:e.p2.y-e.p1.y,y:e.p1.x-e.p2.x},s=Math.min(Gl(n,{x:t.x1,y:t.y1}),Gl(n,{x:t.x1,y:t.y2}),Gl(n,{x:t.x2,y:t.y1}),Gl(n,{x:t.x2,y:t.y2})),o=Math.max(Gl(n,{x:t.x1,y:t.y1}),Gl(n,{x:t.x1,y:t.y2}),Gl(n,{x:t.x2,y:t.y1}),Gl(n,{x:t.x2,y:t.y2})),r=Math.min(Gl(n,i[0]),Gl(n,i[1]),Gl(n,i[2]),Gl(n,i[3])),a=Math.max(Gl(n,i[0]),Gl(n,i[1]),Gl(n,i[2]),Gl(n,i[3]));if(o<r||a<s)return !1}return !0}(t,e)}({x1:s,y1:o,x2:s+r.value*l,y2:o+a.value*h},n)}function Gl(t,e){return t.x*e.x+t.y*e.y}function Xl(t,e){const i=window.TouchEvent&&e instanceof TouchEvent?e.targetTouches[0]:e,n=t.getBoundingClientRect();return {offsetX:i.pageX-window.scrollX-n.left,offsetY:i.pageY-window.scrollY-n.top}}function Yl(t){let e,i;if(t.controls){const{width:n,height:s}=t.controls.getLength();e=n,i=s;}else {const{x:n,y:s}=t.getScale(),{width:o,height:r}=t.getBoundingRect();e=o*n,i=r*s;}return {width:e,height:i}}function ql(t){return /^[\r\n]+$/.test(t)}function Jl(t,e,i){return t.slice(0,e)+t.slice(i+1)}function Zl(t,e){const{textContents:i}=t.style,n=[];return i.forEach((t=>{n.push({...t,...e});})),n}function Ql(t,e){const{textContents:i}=t.style,{textSelection:n}=t.textEditEventHandler;if(!n.length)return i;const[s,o]=n,r=s.freeContentIndex,a=o.freeContentIndex,l=i.slice(0,r),h=i.slice(r,a+1),d=i.slice(a+1),c=[];if(s.freeContentIndex===o.freeContentIndex){const{content:t}=h[0],i=t.slice(0,s.indexInFreeContent),n=t.slice(s.indexInFreeContent,o.indexInFreeContent+1),r=t.slice(o.indexInFreeContent+1);i&&c.push({...h[0],content:i}),n&&c.push({...h[0],...e,content:n}),r&&c.push({...h[0],content:r});}else for(let t=0;t<h.length;t++){const i=h[t];0===t?(c.push({...i,content:i.content.slice(0,s.indexInFreeContent)}),c.push({...i,...e,content:i.content.slice(s.indexInFreeContent)})):t===h.length-1?(c.push({...i,...e,content:i.content.slice(0,o.indexInFreeContent+1)}),c.push({...i,content:i.content.slice(o.indexInFreeContent+1)})):c.push({...i,...e});}return [...l,...c,...d]}function Kl(t){if(!t)return !1;let e=t,i="visible"===e.parsedStyle.visibility;for(;e;)e.parsedStyle.visibility&&"hidden"===e.parsedStyle.visibility&&(i=!1),e=e.parentNode;return i}var th;!function(t){t.REJECTED="SBRejected",t.ACCEPTED="SHAccepted",t.INITIAL_HERE="SHInitialHere",t.SIGN_HERE="SHSignHere",t.WITNESS="SHWitness",t.APPROVED="SBApproved",t.NOT_APPROVED="SBNotApproved",t.DRAFT="SBDraft",t.FINAL="SBFinal",t.COMPLETED="SBCompleted",t.CONFIDENTIAL="SBConfidential",t.VOID="SBVoid";}(th||(th={}));const eh={border:"1px solid #59626A",background:"transparent",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},ih={content:"Insert text here...",fontSize:32,color:"red",lineThrough:!1,underline:!1,fontFamily:"Times New Roman",fontStyle:"normal",fontWeight:"normal"},nh={opacity:1,background:"",borderColor:"red",borderWidth:4,lineDash:[0,0],lineEnding:["None","None"],stampIcon:th.DRAFT,imageData:null,textAlign:"left",textContent:{...ih}},sh={enableControl:!0,useDefaultControls:!0,enableEdit:!0,enableMove:!0,enableRotate:!0},oh={showOnTopWhenSelected:!1,enableContinuousDrawing:!1,enableDeleteWithKeyboard:!0,enableMoveWithKeyboard:!0,enableMultipleSelectWidthCtrl:!0,inkCreateDelay:3e3,controlsStyle:eh,defaultStyleConfig:{},eraserStyle:{background:"rgba(0,0,0)",borderColor:"rgba(0,0,0)",opacity:.3,borderWidth:8},selectionStyle:{background:"transparent",borderWidth:2,borderColor:"#59626A",lineDash:[5,5]}};class rh{constructor(t){i(this,"shape",void 0),i(this,"startTime",void 0),i(this,"startPoint",void 0),i(this,"lastPoint",void 0),i(this,"limitPosition",void 0),i(this,"limitAngle",void 0),i(this,"unLimitPosition",void 0),i(this,"unLimitScale",void 0),i(this,"unLimitStyle",void 0),i(this,"limitArea",void 0),this.shape=t;}setLimitArea(t){this.limitArea=t;}updateShapeByLimitArea(){const{shapeType:t}=this.shape,{left:e,right:i,top:n,bottom:s}=this.isOutOfLimitArea(1,1),o=e||i||n||s,r=Vl(this.shape)||"annotationEllipse"===t;o?(r?this.shape.updateStyle(this.unLimitStyle||{}):this.shape.setLocalScale(this.unLimitScale||this.shape.getLocalScale()),this.shape.setLocalPosition(this.unLimitPosition||this.shape.getLocalPosition())):(r&&(this.unLimitStyle={width:this.shape.style.width,height:this.shape.style.height,rx:this.shape.style.rx,ry:this.shape.style.ry}),this.unLimitPosition=this.shape.getLocalPosition().clone(),this.unLimitScale=this.shape.getLocalScale().clone());}getShapeOriginPosition(){const{x:t,y:e,width:i,height:n}=this.shape.getBoundingRect(),s=new Ia({style:{x:t-this.shape.style.x+i/2,y:e-this.shape.style.y+n/2}});this.shape.appendChild(s);const{x:o,y:r}=s.getPosition();return s.destroy(),{x:o,y:r}}getShapeControlPointPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertexes";const{x:e,y:i,width:n,height:s}=this.shape.getBoundingRect(),o=[];for(let r=0;r<4;r++){let a=e-this.shape.style.x,l=i-this.shape.style.y;if("vertexes"===t)switch(r){case 1:a+=n;break;case 2:a+=n,l+=s;break;case 3:l+=s;}else switch(r){case 1:a+=n,l+=s/2;break;case 2:a+=n/2,l+=s;break;case 3:l+=s/2;break;default:a+=n/2;}const h=new Ia({style:{x:a,y:l}});this.shape.appendChild(h);const{x:d,y:c}=h.getPosition();o.push({x:d,y:c}),h.destroy();}return o}isOutOfLimitArea(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.limitArea)return {left:!1,right:!1,top:!1,bottom:!1};const{x:n,y:s,width:o,height:r}=this.limitArea,a=i||this.getShapeControlPointPosition();let l=!1,h=!1,d=!1,c=!1;for(let i=0;i<4;i++){const{x:u,y:p}=a[i];l=u<n-t||l,h=u>n+o+t||h,d=p<s-e||d,c=p>s+r+e||c;}return {left:l,right:h,top:d,bottom:c}}getLimitPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.limitArea)return null;const e=t||this.getShapeControlPointPosition(),{x:i,y:n}=e[0],{x:s,y:o,width:r,height:a}=this.limitArea,l=e[1].x-i,h=e[2].x-i,d=e[3].x-i,c=e[1].y-n,u=e[2].y-n,p=e[3].y-n;let g=s-Math.min(l,h,d),f=s+r-Math.max(l,h,d),y=o-Math.min(c,u,p),m=o+a-Math.max(c,u,p);if(l>=0&&h>=0&&d>=0?g=s:l<=0&&h<=0&&d<=0&&(f=s+r),c>=0&&u>=0&&p>=0?y=o:c<=0&&u<=0&&p<=0&&(m=o+a),(v=this.shape)&&("annotationEllipse"===v.shapeType||"annotationCircle"===v.shapeType)){const{x:t,y:e}=this.getShapeOriginPosition(),s=t-i,o=e-n;g+=s,f+=s,y+=o,m+=o;}var v;return {minPosX:g,maxPosX:f,minPosY:y,maxPosY:m}}getLimitRotateAngle(){if(!this.limitArea)return [];const t=function(t,e){const i=t,[n,s,o,r]=i,{x:a,y:l,width:h,height:d}=e,c=a+h,u=l+d,p=(n.x+s.x+o.x+r.x)/4,g=(n.y+s.y+o.y+r.y)/4,f=Math.sqrt((p-n.x)**2+(g-n.y)**2),y=p-f,m=p+f,v=g-f,x=g+f;if(y>a&&v>l&&m<c&&x<u)return [];const w=t=>{const e=f*f-(t-p)**2;return [{x:t,y:g-Math.sqrt(e)},{x:t,y:g+Math.sqrt(e)}]},b=t=>{const e=f*f-(t-g)**2;return [{x:p-Math.sqrt(e),y:t},{x:p+Math.sqrt(e),y:t}]},C=(e,i)=>{const n=[];return e.forEach((e=>{t.forEach((t=>{let s=Wl({x:p,y:g},t,e);0===s&&(s=p>t.x?g>t.y?-0:0:g>t.y?0:-0,"top"!==i&&"bottom"!==i||(s=-s)),n.push(s);}));})),n},S=[];if(y<a){const t=w(a);S.push(...C(t,"left"));}if(v<l){const t=b(l);S.push(...C(t,"top"));}if(m>c){const t=w(c);S.push(...C(t,"right"));}if(x>u){const t=b(u);S.push(...C(t,"bottom"));}return S}(this.getShapeControlPointPosition(),this.limitArea);if(0===t.length)return [];let e=0;if(t.forEach((t=>{0===t&&e++;})),e>=2)return [0,0];const{maxNegative:i,minPositive:n}=function(t){let e=-1/0,i=1/0;for(let n=0;n<t.length;n++)t[n]<0&&t[n]>e||Object.is(t[n],-0)?e=t[n]:(t[n]>0&&t[n]<i||Object.is(t[n],0))&&(i=t[n]);return e===-1/0&&(e=0),i===1/0&&(i=0),{maxNegative:e,minPositive:i}}(t);return [i,n]}moveByKeyboard(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const{shape:i}=this,{controlsFlags:n}=i.context;if(!n.enableMove)return !1;t.preventDefault();let s=0,o=0;const r=Math.max(1,Math.round(e*(Bs(t)?8:1)));switch(t.key){case"ArrowLeft":s=-r;break;case"ArrowRight":s=r;break;case"ArrowUp":o=-r;break;case"ArrowDown":o=r;}const a=i.getPosition();let l=a.x+s,h=a.y+o;const{left:d,right:c,top:u,bottom:p}=this.isOutOfLimitArea(1,1),g=d||c||u||p,f=this.getLimitPosition();if(f&&!g){const{minPosX:t,maxPosX:e,minPosY:i,maxPosY:n}=f;l<t&&(l=t),l>e&&(l=e),h<i&&(h=i),h>n&&(h=n);}return this.shape.setPosition({x:l,y:h}),zl(i)&&i.pointEventsHandler.updateLineControls(),!0}moveShape(t){const{shape:e,startPoint:i}=this,{lastWorldPosition:n,controlsFlags:s}=e.context;if(!s.enableMove)return;if(new zr(t.x,t.y).distanceTo(i)<0)return;const o=t.x-i.x,r=t.y-i.y;let a=n.x+o,l=n.y+r;const{left:h,right:d,top:c,bottom:u}=this.isOutOfLimitArea(1,1),p=h||d||c||u;if(this.limitPosition&&!p){const{minPosX:t,maxPosX:e,minPosY:i,maxPosY:n}=this.limitPosition;a<t&&(a=t),a>e&&(a=e),l<i&&(l=i),l>n&&(l=n);}this.shape.setPosition({x:a,y:l});}moveVertex(t){const{shape:e}=this,{context:i,shapeType:n}=e,{hitControlPoint:s,lastLocalScale:o,lastControlsWidth:r,lastControlsHeight:a,keepAspectRatio:l,lastHitControlPoint:h,lastShareAxisYPoint:d,lastShareAxisXPoint:c,lastLocalTransform:u}=i,p=jr(h,c,t).distanceTo(c)||1;if(Fl(h,c,t))return;let g=p-r,f=p/r;const y=jr(h,d,t).distanceTo(d)||1;if(Fl(h,d,t))return;let m=y-a,v=y/a;l&&(f<=v?(v=f,m=v*a-a):(f=v,g=f*r-r));const{left:x,right:w,top:b,bottom:C}=this.isOutOfLimitArea(1,1),S=x||w||b||C,P="annotationEllipse"===n;if(Vl(e))this.moveRectVertex(s,g,m);else if(P)this.moveEllipseVertex(s,g,m);else {s<2&&(m=-m),0!==s&&3!==s||(g=-g),e.setLocalTransform(u);const{x:t,y:i}=e.getScale();g/=Math.abs(t),m/=Math.abs(i),e.translateLocal(g/2,m/2),e.setLocalScale(f*o.x,v*o.y);}S||0===e.getAngle()||this.updateShapeByLimitArea(),e.context.updateControls();}moveEllipseVertex(t,e,i){const{shape:n}=this,{x:s,y:o}=n.getScale(),{lastShapeWidth:r,lastShapeHeight:a,lastLocalTransform:l}=this.shape.context;e/=Math.abs(s),i/=Math.abs(o),n.style.rx=Math.max(1,(r+e)/2),n.style.ry=Math.max(1,(a+i)/2),t<2&&(i=-i),0!==t&&3!==t||(e=-e),n.setLocalTransform(l),n.translateLocal(e/2,i/2);}moveRectVertex(t,e,i){const{shape:n}=this,{x:s,y:o}=n.getScale(),{lastShapeWidth:r,lastShapeHeight:a,lastWorldPosition:l,lastLocalTransform:h}=this.shape.context;if(e/=Math.abs(s),i/=Math.abs(o),n.style.width=Math.max(r+e,1),n.style.height=Math.max(a+i,1),2===t)n.setPosition(l);else switch(n.setLocalTransform(h),t){case 1:n.translateLocal(0,-i);break;case 3:n.translateLocal(-e,0);break;default:n.translateLocal(-e,-i);}}moveMidpoints(t){const{shape:e}=this,{context:i,shapeType:n}=e,{lastLocalScale:s,lastWorldTransform:o,lastHitControlPoint:r,lastShareAxisPoint:a,hitControlPoint:l,lastWorldPosition:h,lastControlsWidth:d,lastControlsHeight:c,lastHitControlPointCenter:u,lastParentWorldAngle:p}=i,g=l-4,f=jr(r,a,t).distanceTo(a);if(Fl(r,a,t))return;const y="annotationEllipse"===n,m=f/d*s.x,v=f/c*s.y,{left:x,right:w,top:b,bottom:C}=this.isOutOfLimitArea(1,1),S=x||w||b||C,P={x:t.x-(r.x-u.x),y:t.y-(r.y-u.y)};if(Vl(e))this.moveRectMidPoint(g,P);else if(y)this.moveEllipseMidPoint(g,P);else {const t=o.inverse(),i=t.transformPoint(P),n=t.transformPoint(h),r={...s};0===g?(r.y=v,90===p?n.x=i.x:n.y=i.y):1===g?r.x=m:2===g?r.y=v:3===g&&(r.x=m,90===p?n.y=i.y:n.x=i.x),this.shape.setLocalScale(r);const a=o.transformPoint(n);e.setPosition(a);}S||0===e.getAngle()||this.updateShapeByLimitArea(),this.shape.context.updateControls();}moveRectMidPoint(t,e){const{shape:i}=this,{lastShapeHeight:n,lastWorldPosition:s,lastShapeWidth:o}=i.context,r=i.getWorldTransform(),a=r.inverse().transformPoint(e),l=r.inverse().transformPoint(s),h=l;0===t?(i.style.height=n-(a.y-l.y),h.y=a.y):1===t?i.style.width=Math.max(1,a.x-l.x):2===t?i.style.height=Math.max(1,a.y-l.y):3===t&&(i.style.width=o-(a.x-l.x),h.x=a.x);const d=r.transformPoint(h);i.setPosition(d);}moveEllipseMidPoint(t,e){const{shape:i}=this,{lastShapeHeight:n,lastShapeWidth:s,lastWorldPosition:o}=i.context,r=i.getWorldTransform(),a=r.inverse().transformPoint(e),l=r.inverse().transformPoint(o),h=l;if(0===t){const t=(n/2-(a.y-l.y))/2;i.style.ry=t,h.y=a.y+t;}else if(1===t){const t=(s/2+(a.x-l.x))/2;i.style.rx=t,h.x=a.x-t;}else if(2===t){const t=(n/2+(a.y-l.y))/2;i.style.ry=t,h.y=a.y-t;}else if(3===t){const t=(s/2-(a.x-l.x))/2;i.style.rx=t,h.x=a.x+t;}const d=r.transformPoint(h);i.setPosition(d);}moveRotationPoint(t){const{startPoint:e,shape:i}=this,{lastOriginWorldPosition:n,lastLocalTransform:s}=i.context,o=Wl(n,e,t);this.shape.setLocalTransform(s),this.shape.rotateLocal(o);}isHit(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{shape:i}=this,{context:n,parsedStyle:s}=i;if("hidden"===s.visibility||!n.controlsFlags.enableControl)return -1;if(n.isGrouped)return n.unHitShape(),-1;let{controls:o}=i,r=!0;o||(r=!1,n.initControls(),n.renderControls(),o=i.controls);let a=o.checkHitArea(t.x,t.y);return zl(i)&&!i.context.controlsFlags.useDefaultControls&&(8===a?a=-1:a>0&&(a=9),-1!==i.pointEventsHandler.isHitPoint(t)&&(a=0)),a<0?(e&&(n.unHitShape(),r||i.context.destroyControls()),-1):a}startHandler(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.isHit(t);if(-1===i&&!e)return;-1===i&&e&&(i=9);const{shape:n}=this,{context:s}=n;s.isStart=!0,this.lastPoint={...t},this.startPoint={...t},this.startTime=(new Date).getTime(),zl(n)&&(n.pointEventsHandler.enableEditMode(),n.pointEventsHandler.editStartHandler(t)),jl(n)&&n.textEditEventHandler.editStartHandler(t);const o=this.getShapeControlPointPosition();if(this.limitPosition=this.getLimitPosition(o),s.controlsFlags.useDefaultControls){if(s.hitShape(),s.hitControlPoint=i,i<4){const{x:e,y:n}=o[i];s.lastHitControlPoint={...t},s.lastHitControlPointCenter={x:e,y:n},s.lastShareAxisYPoint={x:o[3-i].x+t.x-e,y:o[3-i].y+t.y-n},s.lastShareAxisXPoint={x:o[i%2?i-1:i+1].x+t.x-e,y:o[i%2?i-1:i+1].y+t.y-n};}else if(i<8){const e=this.getShapeControlPointPosition("mid"),{x:n,y:o}=e[i-4];s.lastHitControlPoint={...t},s.lastHitControlPointCenter={x:n,y:o},s.lastShareAxisPoint={x:e[(i-2)%4].x+t.x-n,y:e[(i-2)%4].y+t.y-o};}}else s.isHit=!0,s.hitControlPoint=9,s.lastWorldPosition=n.getPosition(),s.lastControlsWorldPosition=n.controls.getPosition();}moveHandler(t,e){const{shape:i}=this,{context:n,controls:s}=i,{isHit:o,isStart:r,hitControlPoint:a}=n,l=zl(i),h=jl(i);o&&r&&s&&(this.lastPoint={...t},l&&-1!==i.pointEventsHandler.hitIndex?i.pointEventsHandler.editMoveHandler(t):h&&i.textEditEventHandler.editMode?i.textEditEventHandler.editMoveHandler(t):a<4?(n.keepAspectRatio=e,this.moveVertex(t)):a<8?this.moveMidpoints(t):a<9?this.moveRotationPoint(t):(this.moveShape(t),l&&i.pointEventsHandler.updateLineControls()));}endHandler(t){const{shape:e,startPoint:i,lastPoint:n}=this,{context:s}=e,{isStart:o,isHit:r}=e.context;if(!o||!r)return;const a=(new Date).getTime()-this.startTime,l=n.x-i.x,h=n.y-i.y,d=a<=200&&(l**2+h**2)**.5<2,c=zl(e),u=jl(e);if(c&&e.pointEventsHandler.editEndHandler(),u&&e.textEditEventHandler.editEndHandler(),!s.isActive&&d&&(s.isActive=!0),t){if(u&&e.textEditEventHandler.editMode)return void(s.hitControlPoint=-1);const i=[];if(8===s.hitControlPoint&&this.shape.getAngle()!==(null==s?void 0:s.lastWorldAngle))i.push("rotated");else {const{lastControlsWorldPosition:t,lastControlsWidth:n,lastControlsHeight:o,lastWorldPosition:r}=s,{width:a,height:l}=e.controls.getLength(),h=e.controls.getPosition(),d=e.getPosition(),u=e instanceof ch?t:r,p=e instanceof ch?h:d;p.x.toFixed(1)===u.x.toFixed(1)&&p.y.toFixed(1)===u.y.toFixed(1)||i.push("moved");const g=c&&-1!==e.pointEventsHandler.hitIndex,f=!(!n||!o)&&(a.toFixed(3)!==n.toFixed(3)||l.toFixed(3)!==o.toFixed(3));if(!(e instanceof vh))if(f)i.push("resized");else if(g){const{hitIndex:t,hitPointPos:n}=e.pointEventsHandler,s=e.path[t];s.x.toFixed(2)===n.x.toFixed(2)&&s.y.toFixed(2)===n.y.toFixed(2)||i.push("resized");}}const n=[...new Set(i)];n.length&&t.emitModifyAnnotation(n,[e]);}s.isHit=!1,s.keepAspectRatio=!1;}}class ah extends ka{constructor(t,e){super({type:"annotationGroup",style:{visibility:"visible"}}),i(this,"shapeType","annotationControls"),i(this,"container",void 0),i(this,"borders",void 0),i(this,"rotationPoint",void 0),i(this,"controlPoints",void 0),i(this,"rotationBorder",void 0),i(this,"rotationPointOffset",30),i(this,"vertexes",[]),i(this,"midpoints",[]),this.container=t;for(const t in e)Vs(t,e)&&(this[t]=e[t]);this.updateControlPoints(this.vertexes),this.initBorders(),this.initControls();}get isVisible(){return "hidden"!==this.parsedStyle.visibility&&Kl(null==this?void 0:this.container)}initBorders(){const{borderColor:t,borderWidth:e,lineDash:i,background:n}=this.container.context.parsedControlsStyle,{width:s}=this.container.getBoundingRect(),o=e/2;this.borders=new _a({style:{points:this.vertexes,borderWidth:e,background:n,borderColor:t,lineDash:i}}),this.borders.setLocalPosition(-o,-o),this.rotationBorder=new _a({style:{points:[this.midpoints[0],this.rotationPoint],borderWidth:e,borderColor:t,lineDash:i}});const r=Math.abs(this.midpoints[0].y-this.rotationPoint.y);this.rotationBorder.setLocalPosition(s/2-o,-r),this.appendChild(this.borders),this.appendChild(this.rotationBorder);}initControls(){const{vertexes:t,midpoints:e,rotationPoint:i}=this,{ctrlBorderColor:n,ctrlBorderWidth:s,ctrlLineDash:o,ctrlBackground:r,ctrlWidth:a,ctrlHeight:l,ctrlBorderRadius:h}=this.container.context.parsedControlsStyle,{x:d,y:c}=this.container.getBoundingRect(),u=[...t,...e,i],p={background:r,borderColor:n,borderWidth:s,lineDash:o,width:a,height:l,roundedRadius:h};u.forEach((t=>{const e=new $a({style:{x:t.x,y:t.y,...p}});e.setLocalPosition(t.x-vr(a).value/2-d,t.y-vr(l).value/2-c),this.controlPoints||(this.controlPoints=[]),this.controlPoints.push(e),this.appendChild(e);}));}calculateMidpoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const s=new zr((t[i].x+t[(i+1)%n].x)/2,(t[i].y+t[(i+1)%n].y)/2);e.push(s);}return e}calculateRotationPoint(t){const e=t[0].distanceTo(t[2]),i=this.rotationPointOffset/e+1;return t[2].lerpTo(t[0],i)}update(t){const{midpoints:e,rotationPoint:i,container:n}=this,{ctrlWidth:s,ctrlHeight:o,borderWidth:r}=this.container.context.parsedControlsStyle,a=[...t,...e,i],{x:l,y:h,width:d,height:c}=n.getBoundingRect(),u=r/2;this.controlPoints.forEach(((t,e)=>{const{x:i,y:n}=a[e];t.updateStyle({x:i,y:n}),t.setLocalPosition(i-s/2-l,n-o/2-h);})),this.borders.updateStyle({points:t}),this.borders.setLocalPosition(d<0?d:-u,c<0?c:-u);const p=Math.min(e[0].x,i.x),g=Math.min(e[0].y,i.y);this.rotationBorder.updateStyle({points:[e[0],i]}),this.rotationBorder.setLocalPosition(p-l-u,g-h);}updateOrigin(){const t=this.controlPoints[4].parsedStyle.x-this.controlPoints[0].parsedStyle.x,e=this.controlPoints[7].parsedStyle.y-this.controlPoints[0].parsedStyle.y;this.setOrigin(t,e);}updateControlPoints(t){this.vertexes=t,this.midpoints=this.calculateMidpoints(this.vertexes),this.rotationPoint=this.calculateRotationPoint(this.midpoints);}getLength(){const t=this.midpoints[2].y-this.midpoints[0].y;return {width:this.midpoints[1].x-this.midpoints[3].x,height:t}}setVisible(t){this.style.visibility=t;}setBoxVisible(t){this.borders.style.visibility=t;}setRotationPointVisible(t){this.rotationBorder.style.visibility=t,this.controlPoints[8].style.visibility=t;}setControlPointVisible(t){this.controlPoints.forEach(((e,i)=>{i<8&&(e.style.visibility=t);}));}checkHitArea(t,e){const i=this.getWorldTransform().inverse().transformPoint({x:t,y:e}),{x:n,y:s}=this.controlPoints[0].parsedStyle,o={x:i.x+n,y:i.y+s},{ctrlWidth:r,ctrlHeight:a}=this.container.context.parsedControlsStyle;i.x+=n+r/2,i.y+=s+a/2;const l=qn()?10:0;let h=-1;for(let t=0;t<this.controlPoints.length;t++){const e=this.controlPoints[t];if("visible"===e.style.visibility&&e.isPointInPath({x:i.x,y:i.y},l)){h=t;break}}return h>-1?h:this.borders.isPointInPath(o)?9:-1}destroy(){this.parentNode&&(this.parentNode.removeChild(this),this.container.controls=null);}}class lh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,"shape",void 0),i(this,"referencePoint",void 0),i(this,"controlsStyle",void 0),i(this,"controlsFlags",void 0),i(this,"parsedControlsStyle",void 0),i(this,"tempData",{}),i(this,"keepAspectRatio",!1),i(this,"isInGroup",!1),i(this,"isGrouped",!1),i(this,"isActive",!1),i(this,"isStart",!1),i(this,"isHit",!1),i(this,"hitControlPoint",-1),i(this,"lastHitControlPoint",void 0),i(this,"lastHitControlPointCenter",void 0),i(this,"lastLocalTransform",void 0),i(this,"lastWorldTransform",void 0),i(this,"lastWorldPosition",void 0),i(this,"lastLocalScale",void 0),i(this,"lastOriginWorldPosition",void 0),i(this,"lastWorldAngle",void 0),i(this,"lastParentWorldAngle",void 0),i(this,"lastControlsWorldPosition",void 0),i(this,"lastControlsWidth",void 0),i(this,"lastControlsHeight",void 0),i(this,"lastShareAxisPoint",void 0),i(this,"lastShareAxisXPoint",void 0),i(this,"lastShareAxisYPoint",void 0),i(this,"lastShapeWidth",void 0),i(this,"lastShapeHeight",void 0),this.shape=t,this.controlsStyle={...eh,...e},this.controlsFlags={...sh},this.parseControlsStyle();}initReferenceBox(){if(this.referencePoint)return void this.updateReferenceBox();const{x:t,y:e}=this.shape.getBoundingRect(),i=t-this.shape.style.x,n=e-this.shape.style.y,s=new Ia({style:{x:i,y:n,r:0}});this.shape.appendChild(s),this.referencePoint=s;}updateReferenceBox(){if(!this.referencePoint)return;const{x:t,y:e}=this.shape.getBoundingRect(),i=t-this.shape.style.x,n=e-this.shape.style.y;this.referencePoint.updateStyle({x:i,y:n});}getControlVertexes(){const{shape:t}=this,{x:e,y:i,width:n,height:s}=t.getBoundingRect();return [new zr(e,i),new zr(e+n,i),new zr(e+n,i+s),new zr(e,i+s)]}getScaledControlVertexes(){const{shape:t}=this,{x:e,y:i}=t.getScale(),{x:n,y:s,width:o,height:r}=t.getBoundingRect(),a=o*Math.abs(e)||1,l=r*Math.abs(i)||1;return [new zr(n,s),new zr(n+a,s),new zr(n+a,s+l),new zr(n,s+l)]}showControls(){this.initReferenceBox();const{shape:t,referencePoint:e}=this,{x:i,y:n}=e.getPosition(),s=t.getAngle(),o=i,r=n;t.controls.setAngle(s),t.controls.setPosition({x:o,y:r});}parseControlsStyle(){if(!this.controlsStyle)return;this.parsedControlsStyle={};const{background:t,border:e,ctrlWidth:i,ctrlHeight:n,ctrlBackground:s,ctrlBorderRadius:o,ctrlBorder:r}=this.controlsStyle,a=e||eh.border,{borderColor:l,borderStyle:h,borderWidth:d}=Es(a),c=vr(d).value,u=r||eh.ctrlBorder,{borderColor:p,borderStyle:g,borderWidth:f}=Es(u),y=vr(f).value,m=vr(i).value,v=xr(o),x="%"===v.unit?v.value/100*m:o||eh.ctrlBorderRadius;this.parsedControlsStyle={background:t||eh.background,ctrlBackground:s||eh.ctrlBackground,ctrlBorderRadius:x,borderColor:l,borderWidth:c,lineDash:"solid"===h?[0,0]:[2*c,c],ctrlWidth:m,ctrlHeight:vr(n).value,ctrlBorderColor:p,ctrlBorderWidth:y,ctrlLineDash:"solid"===g?[0,0]:[2*y,y]};}updateControlsFlags(t){const{enableEdit:e,enableRotate:i,enableControl:n,isVisible:s}=t;this.shape.controls&&(Xn(e)&&this.shape.controls.setControlPointVisible(e?"visible":"hidden"),Xn(i)&&this.shape.controls.setRotationPointVisible(i?"visible":"hidden"),Xn(n)&&!n&&this.destroyControls()),Xn(s)&&(this.shape.style.visibility=s?"visible":"hidden"),this.controlsFlags={...this.controlsFlags,...t};}hitShape(){var t;const{shape:e}=this,{shapeType:i,controls:n}=e;this.isHit=!0,this.lastWorldPosition=e.getPosition(),this.lastLocalTransform=e.getLocalTransform(),this.lastWorldTransform=e.getLocalTransform(),this.lastLocalScale=e.getLocalScale(),this.lastControlsWorldPosition=n.getPosition(),this.lastControlsWidth=n.getLength().width,this.lastControlsHeight=n.getLength().height;const s=e.getBoundingRect();this.lastParentWorldAngle=Math.round(Math.abs(null==e||null===(t=e.parentNode)||void 0===t?void 0:t.getAngle())),this.lastWorldAngle=e.getAngle(),this.lastOriginWorldPosition=e.getWorldTransform().transformPoint({x:s.x-e.style.x+s.width/2,y:s.y-e.style.y+s.height/2});"annotationEllipse"===i&&(this.lastShapeWidth=2*e.parsedStyle.rx.value,this.lastShapeHeight=2*e.parsedStyle.ry.value),Vl(this.shape)&&(this.lastShapeWidth=e.parsedStyle.width.value,this.lastShapeHeight=e.parsedStyle.height.value);}unHitShape(){const{context:t}=this.shape;t.isStart=!1,t.isHit=!1,t.isActive=!1,t.hitControlPoint=-1,jl(this.shape)&&this.shape.textEditEventHandler.disableEditMode(),zl(this.shape)&&this.shape.pointEventsHandler.disableEditMode();}initControls(){const{shape:t}=this,e=this.getControlVertexes(),i=new ah(t,{vertexes:e});t.controls=i,t.getRootNode().appendChild(i),this.updateControlsFlags(this.controlsFlags);}updateControls(){var t,e,i,n;const{shape:s}=this,o=this.getScaledControlVertexes();JSON.stringify(o)!==JSON.stringify(null===(t=s.controls)||void 0===t?void 0:t.vertexes)&&(null===(e=s.controls)||void 0===e||e.updateControlPoints(o),null===(i=s.controls)||void 0===i||i.update(o),null===(n=s.controls)||void 0===n||n.updateOrigin());}renderControls(){const{shape:t,isStart:e,isActive:i,controlsFlags:n,isInGroup:s}=this,{useDefaultControls:o}=n,{controls:r}=t;if(!r)return;let a="hidden";o&&(e||i||s)&&(a="visible"),r&&r.setVisible(a),this.updateControls(),this.showControls();}destroyControls(){var t,e;null===(t=this.referencePoint)||void 0===t||t.destroy(),this.referencePoint=null,null===(e=this.shape.controls)||void 0===e||e.destroy(),this.shape.controls=null;}getTransform(){const{parentNode:t}=this.shape,e=t instanceof vh&&this.shape.context.isGrouped;e&&t.delete(this.shape,!1);const i={...this.shape.getLocalPosition()},n=this.shape.getLocalAngle(),s={...this.shape.getLocalScale()};return e&&t.add(this.shape),{angle:n,scale:s,position:i}}setTransform(t){if(t){const{scale:e,angle:i,position:n}=t;n&&this.shape.setLocalPosition(n),zn(i)||this.shape.setLocalAngle(i),zn(e)||this.shape.setLocalScale(e);}}getCommonStyleConfig(){const{lineCap:t,lineJoin:e,lineDash:i,background:n,fillOpacity:s,opacity:o,visibility:r,miterLimit:a,borderColor:l,borderWidth:h,borderOpacity:d}=this.shape.attributes;return {lineCap:t,lineJoin:e,lineDash:i,background:n,opacity:o,borderColor:l,borderWidth:h,miterLimit:a}}getRealTimeBoundingBox(){this.shape.boundsDirty=!0;const{x:t,y:e,width:i,height:n}=this.shape.getBoundingRect(),s=[],{useDefaultControls:o,enableRotate:r}=this.shape.context.controlsFlags,a=o&&r?5:4;for(let o=0;o<a;o++){let r=t-this.shape.style.x,a=e-this.shape.style.y;1!==o&&2!==o||(r+=i),2!==o&&3!==o||(a+=n),4===o&&(r+=i/2,a-=30/this.shape.getScale().y);const l=new Ia({style:{x:r,y:a,r:0}});this.shape.appendChild(l);const{x:h,y:d}=l.getPosition();s.push({x:h,y:d}),l.destroy();}return aa(s)}}class hh extends Ea{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationArc",...t}),i(this,"shapeType","annotationArc"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.eventHandler=new rh(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}getAnnotationConfig(){const t=this.context.getTransform(),{position:e}=t,{r:i,startAngle:n,endAngle:s}=this.attributes;return {type:"annotationArc",style:{x:e.x,y:e.y,r:i,startAngle:n,endAngle:s,...this.context.getCommonStyleConfig()},transform:t}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}}class dh extends Ia{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationCircle",...t}),i(this,"shapeType","annotationCircle"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.eventHandler=new rh(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const t=this.context.getTransform(),{position:e}=t,{r:i}=this.attributes;return {type:"annotationCircle",style:{x:e.x,y:e.y,r:i,...this.context.getCommonStyleConfig()},transform:t}}}class ch extends Ra{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationEllipse",...t}),i(this,"shapeType","annotationEllipse"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.eventHandler=new rh(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const t=this.context.getTransform(),{rx:e,ry:i}=this.parsedStyle,{position:n}=t;return {type:"annotationEllipse",style:{x:n.x-e.value,y:n.y-i.value,width:2*e.value,height:2*i.value,...this.context.getCommonStyleConfig()},transform:t}}}class uh extends Ma{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationImage",...t}),i(this,"shapeType","annotationImage"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.eventHandler=new rh(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const{x:t,y:e,img:i,opacity:n,visibility:s,width:o,height:r}=this.attributes;return {type:"annotationImage",style:{x:t,y:e,width:o,height:r,img:i,opacity:n,visibility:s},meteData:this.meteData,transform:this.context.getTransform()}}}class ph extends Ba{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationInk",...t}),i(this,"shapeType","annotationInk"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.eventHandler=new rh(this),this.context.setTransform(t),this.update();}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}setUseDouglasPeucker(t){t&&(this.boundsDirty=!0,this.pathDirty=!0);}getAnnotationConfig(){var t;let e=this.attributes.segments;const i=this.context.getTransform(),n=this.getBoundingRect(),{position:s}=i;(s.x!==n.x||s.y!==n.y)&&(e=[],this.attributes.segments.forEach((t=>{const i=[];t.forEach((t=>{i.push({x:t.x-n.x+s.x,y:t.y-n.y+s.y});})),e.push(i);})),this.context.isGrouped||(this.style.segments=e));return {type:"annotationInk",style:{renderBlendMode:null==this||null===(t=this.style)||void 0===t?void 0:t.renderBlendMode,segments:e,...this.context.getCommonStyleConfig()},transform:i}}}class gh extends Fa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationRect",...t}),i(this,"shapeType","annotationRect"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.eventHandler=new rh(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const t=this.context.getTransform(),{width:e,height:i}=this.attributes,{position:n}=t;return {type:"annotationRect",id:this.id,style:{x:n.x,y:n.y,width:e,height:i,...this.context.getCommonStyleConfig()},transform:t}}getPath(){if(!this.pathDirty)return this.path;const{width:t,height:e,borderWidth:i}=this.parsedStyle,n=.5*((null==i?void 0:i.value)||0),s=n,o=n,r=t.value-2*n,a=e.value-2*n;return this.path=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],this.steps=oa(this.path),this.pathDirty=!1,this.path}getStrokePath(){return this.strokePath=[],[]}}class fh{constructor(t){i(this,"shape",void 0),i(this,"textCursor",void 0),i(this,"textCursorInitCache",void 0),i(this,"inputComposition",!1),i(this,"startChar",void 0),i(this,"startDirection",void 0),i(this,"startPoint",void 0),i(this,"textRects",[]),i(this,"virtualChar",void 0),i(this,"isStart",!1),i(this,"canvas",void 0),i(this,"textClipboard",[]),i(this,"startTextContent",void 0),i(this,"lineChars",void 0),i(this,"flatChars",void 0),i(this,"editMode",void 0),i(this,"textarea",void 0),i(this,"textSelection",[]),this.shape=t,this.calculateCharPosition();}getLineIndexByMoved(t){const{lines:e,lineHeightOffset:i}=this.shape;let n=0;for(let s=0;s<e.length;s++){const{y:o,height:r}=e[s],a=o-r*(1-i);t.y>a&&(n=s);}return n}getLineIndexByPosition(t){const{lines:e,limitWidth:i,lineHeightOffset:n}=this.shape,{width:s}=this.shape.bounds;for(let i=0;i<e.length;i++){const o=e[i],{x:r,y:a,height:l,widthWithoutLF:h}=o,d=i===e.length-1?1:1+n;if(new Fa({style:{x:r,y:a-l*(1-n),width:Math.max(s,h),height:l*d,borderWidth:1,background:"transparent"}}).isPointInPath(t))return i}return -1}getCharByPosition(t,e){if(-1===e)return null;const{lineChars:i}=this,{lineHeightOffset:n}=this.shape,s=i[e];for(let e=0;e<s.length;e++){const o=s[e],{x:r,y:a,charWidth:l,charHeight:h}=o,d=o.lineIndex===i.length-1?1:1+n;if(new Fa({style:{x:r,y:a-h*(1-n),width:l,height:h*d,borderWidth:1,background:"transparent"}}).isPointInPath(t))return o}return null}getCharAndDirection(t){const e=this.getLineIndexByPosition(t);let i,n=1;if(-1===e)return i=this.flatChars[this.flatChars.length-1],n=1,{char:i,direction:n};const s="textBox"===this.shape.textType;if(i=this.getCharByPosition(t,e),i){const{x:e,charWidth:s}=i;n=t.x<e+s/2?0:1;}else {const o=this.lineChars[e];i=o[o.length-1],n=1,s&&t.x<o[0].x&&(i=o[0],n=0);}return "\r"!==i.text&&"\n"!==i.text&&"\r\n"!==i.text||(n=0),0===n&&0!==i.indexInLine&&(i=this.lineChars[i.lineIndex][i.indexInLine-1],n=1),{char:i,direction:n}}createCursor(t,e,i,n){if(!this.textCursor){const s=document.createElement("div");return s.className="ddv-annotation-cursor",s.style.left=t-.5+"px",s.style.top=`${e}px`,s.style.transform=`rotate(${i}deg)`,s.style.width="1px",s.style.height=`${n}px`,this.canvas.parentNode.appendChild(s),void(this.textCursor=s)}this.textCursor.style.left=t-.5+"px",this.textCursor.style.top=`${e}px`,this.textCursor.style.height=`${n}px`,this.textCursor.style.transform=`rotate(${i}deg)`,this.textCursor.style.animation="none",this.textCursor.offsetWidth,this.textCursor.style.animation="";}showTextCursor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{lineHeightOffset:n}=this.shape,s=(t,e)=>{const{x:i,y:s,charWidth:o,charHeight:r,lineIndex:a}=t,l=e?i+o:i,h=s-r*(1-n),d=a>=this.lineChars.length-1?1:1+n;return new Fa({style:{x:l-this.shape.style.x,y:h-this.shape.style.y,borderWidth:"1px",height:r*d}})},o=t=>{this.shape.appendChild(t);const e=this.shape.getScale().y,i=t.getAngle();t.setAngle(0);const{x:n,y:s}=t.getPosition();t.destroy(),this.createCursor(n,s,i,t.parsedStyle.height.value*e);};if(!this.editMode)return void(this.textCursor&&this.hideTextCursor());const{flatChars:r,shape:a}=this;if(!r.length&&this.virtualChar){const{fontSize:t}=this.shape.freeTextContentStyle,e=vr(t).value;if(e!==this.virtualChar.charHeight){const{borderOffset:t,padding:i}=this.shape,{y:s}=this.shape.style;this.virtualChar.charHeight=e,this.virtualChar.y=s+t+i+e*(1-n);}return o(s(this.virtualChar,1)),void(this.textCursorInitCache={char:{totalIndex:0},isBack:1})}let l=r[t];if(zn(t)&&(l=r[0],e=0),!r[t])return;"justify"===a.style.textAlign&&"textBox"===a.textType&&" "===l.text&&e&&r[l.totalIndex+1]&&(l=r[l.totalIndex+1],e=0);const h=r[l.totalIndex+1];let d;ql(l.text)&&e&&h&&(l=h,e=0),d=ql(l.text)&&e&&!h?s(this.virtualChar,1):s(l,e),o(d),this.startChar=l,this.startDirection=e,this.textCursorInitCache={char:l,isBack:e},i&&this.shape.hooks.selectTextChars.emit({startChar:l,endChar:l,isBack:!!e,needUpdate:!1});}moveTextCursor(t){const{textSelection:e}=this;let i,n;if(2===e.length){const[s,o]=e;switch(t){case"up":case"left":i=s.totalIndex,n=0;break;default:i=o.totalIndex,n=1;}return this.hideTextSelection(),this.shape.hooks.reRenderText.emit(),void this.showTextCursor(i,n)}const s=this.flatChars,o=s.length,{startChar:r,startDirection:a}=this;if(r){if("left"===t){const t=a?r.totalIndex-1:r.totalIndex-2;i=t>=0?t:0,n=t>=0?1:0;}else if("right"===t){const t=a?r.totalIndex+1:r.totalIndex;i=t>o-1?o-1:t,n=1;}else {const{x:e,charWidth:o,lineIndex:l}=r;if(0===l&&"up"===t)i=0,n=0;else if(l===this.lineChars.length-1&&"down"===t)i=s.length-1,n=1;else {const s=a?e+o:e,r="up"===t?this.lineChars[l-1]:this.lineChars[l+1];i=r[0].totalIndex,n=0,r.forEach((t=>{s>t.x+o/2&&!ql(t.text)&&(i=t.totalIndex,n=1);}));}}this.showTextCursor(i,n);}}hideTextCursor(){this.textCursor&&(this.textCursor.remove(),this.textCursor=null);}showTextSelection(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[],{lines:s,parsedStyle:o,textType:r,lineHeightOffset:a}=this.shape;if(this.hideTextSelection(),this.textSelection=[t,e],!t||!e)return;const l=["right","justify"].includes(o.textAlign)&&"textBox"===r;if(t.y===e.y){const i=ql(t.text),o=ql(e.text);if(i&&o)return;const r=t.x===e.x?t.charWidth:o?e.x-t.x:e.x-t.x+e.charWidth;n.push({x:t.x,y:t.y,lineIndex:t.lineIndex,width:r,height:s[t.lineIndex].height});}else {const i=this.shape.getTextAlignOffset(s[t.lineIndex]),{x:o,height:r}=s[t.lineIndex],a=l?s[t.lineIndex].widthWithoutLF:s[t.lineIndex].width;if(n.push({x:t.x,y:t.y,lineIndex:t.lineIndex,width:o+a+i-t.x,height:r}),e.lineIndex-t.lineIndex>1)for(let i=t.lineIndex+1;i<e.lineIndex;i++){const{x:t,y:e,height:o}=s[i],r=l?s[i].widthWithoutLF:s[i].width,a=this.shape.getTextAlignOffset(s[i]);n.push({x:t+a,y:e,width:r,height:o,lineIndex:i});}const h=this.shape.getTextAlignOffset(s[e.lineIndex]),{x:d,y:c,height:u}=s[e.lineIndex],p=l&&ql(e.text)?0:e.charWidth;n.push({x:d+h,y:c,width:e.x+p-d-h,height:u,lineIndex:e.lineIndex});}const{x:h,y:d}=this.shape.style;this.hideTextCursor(),n.forEach((t=>{const e=t.lineIndex===this.lineChars.length-1?1:1+a,i=new Fa({style:{x:t.x-h,y:t.y-d-t.height*(1-a),width:t.width,height:t.height*e,background:"rgba(0, 123, 255, 0.5)"}});this.shape.appendChild(i),this.textRects.push(i);})),this.shape.hooks.selectTextChars.emit({startChar:t,endChar:e,isBack:!0,needUpdate:i});}hideTextSelection(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.textRects.forEach((t=>{t.destroy();})),this.textSelection=[],this.textRects=[],t){const{char:t,isBack:e}=this.textCursorInitCache;this.showTextCursor(t.totalIndex,e);}}addText(t,e,i){if(!i||""===i)return;if(!t){const t={...this.shape.freeTextContentStyle,content:i};return this.shape.context.updateControlsFlags({useDefaultControls:!1}),this.shape.updateStyle({textContents:[t]}),this.showTextCursor(i.length-1,1),void this.shape.hooks.textContentUpdatedByChar.emit()}const n=Vn(this.shape.style.textContents),{freeContentIndex:s,indexInFreeContent:o}=t,r=n[s],{content:a}=r,l=yh(this.shape.freeTextContentStyle,r),h=()=>({...this.shape.freeTextContentStyle,content:i});if(e&&o===a.length-1)l?r.content+=i:n.splice(s+1,0,h());else if(e||o)if(l){const t=0===e?o:o+1;r.content=a.slice(0,t)+i+a.slice(t);}else {const t=[],i=a.slice(0,e?o+1:o),l=a.slice(e?o+1:o);i&&t.push({...r,content:i}),t.push(h()),l&&t.push({...r,content:l}),n.splice(s,1,...t);}else if(s){const t=n[s-1];yh(this.shape.freeTextContentStyle,t)?n[s-1].content+=i:n.splice(s,0,h());}else l?r.content=i+r.content:n.unshift(h());this.shape.updateStyle({textContents:[...n]}),this.shape.hooks.textContentUpdatedByChar.emit();const{char:d,isBack:c}=this.textCursorInitCache;c?this.showTextCursor(d.totalIndex+i.length,1):this.showTextCursor(d.totalIndex+i.length-1,1);}deleteText(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Vn(this.shape.style.textContents);if(!i.length)return;let n=0;if(2===this.textSelection.length){const[t,e]=this.textSelection;if(t.freeContentIndex===e.freeContentIndex){const n=i[t.freeContentIndex];n.content=Jl(n.content,t.indexInFreeContent,e.indexInFreeContent);}else {const n=i[t.freeContentIndex],s=i[e.freeContentIndex];n.content=n.content.substring(0,t.indexInFreeContent),s.content=s.content.substring(e.indexInFreeContent+1);for(let n=t.freeContentIndex+1;n<e.freeContentIndex;n++)i[n].content="";}n=t.totalIndex-1;}else {const{startChar:t,startDirection:o}=this;if(!t)return;let r=o?t:this.flatChars[t.totalIndex-1];if(e){var s;const t=zn(null===(s=r)||void 0===s?void 0:s.totalIndex)?0:r.totalIndex+1;r=this.flatChars[t];}if(!r)return;const{freeContentIndex:a,indexInFreeContent:l}=r,h=i[a];if(!h.color)return;h.content=Jl(h.content,l,l),n=r.totalIndex-1;}this.hideTextSelection(),this.shape.updateStyle({textContents:[...i]}),t&&this.shape.hooks.textContentUpdatedByChar.emit(),-1===n?this.showTextCursor(0,0,!1):this.showTextCursor(n,1,!1),this.shape.hooks.reRenderText.emit();}copyText(){if(!this.textSelection.length)return;this.textClipboard=[];const{textContents:t}=this.shape.style,[e,i]=this.textSelection,n=[],s=e.freeContentIndex,o=i.freeContentIndex;if(s===o){const o=t[s],r=o.content.slice(e.indexInFreeContent,i.indexInFreeContent+1);n.push({...o,content:r});}else for(let r=s;r<=o;r++){const a={...t[r]},l=a.content;r===s?a.content=l.slice(e.indexInFreeContent):r===o&&(a.content=l.slice(0,i.indexInFreeContent+1)),n.push({...a});}this.textClipboard=[...n],function(t){let e="";t.forEach((t=>{e+=t.content;}));try{navigator.clipboard.writeText(e);}catch(t){}}(n);}pasteText(){this.textSelection.length&&this.deleteText(!1);const{isBack:t,char:e}=this.textCursorInitCache,{textContents:i}=this.shape.style,n=t?e:this.flatChars[e.totalIndex-1];let s=0,o=(null==n?void 0:n.totalIndex)||-1;if(this.textClipboard.forEach((t=>{s+=t.content.length;})),n)if(this.flatChars.length){const t=i[e.freeContentIndex];if(t.content.length===n.indexInFreeContent+1)i.splice(e.freeContentIndex+1,0,...Vn(this.textClipboard)),this.shape.updateStyle({textContents:[...i]});else {const{content:s}=t,{indexInFreeContent:o}=n,r=[{...t,content:s.slice(0,o+1)},...Vn(this.textClipboard),{...t,content:s.slice(o+1)}];i.splice(e.freeContentIndex,1,...r),this.shape.updateStyle({textContents:[...i]});}}else this.shape.updateStyle({textContents:Vn(this.textClipboard)}),o=-1;else i.unshift(...Vn(this.textClipboard)),this.shape.updateStyle({textContents:i});this.showTextCursor(o+s,1),this.shape.hooks.textContentUpdatedByChar.emit();}selectAllText(){if(!this.flatChars.length)return;const t=this.flatChars[0],e=this.flatChars[this.flatChars.length-1];this.showTextSelection(t,e),this.shape.hooks.reRenderText.emit();}updateTextSelection(){if(!this.textSelection.length)return;const[t,e]=this.textSelection,i=this.flatChars[t.totalIndex],n=this.flatChars[e.totalIndex];this.showTextSelection(i,n,!0),this.shape.hooks.reRenderText.emit();}calculateCharPosition(){const{borderOffset:t,padding:e,lineHeightOffset:i,lines:n}=this.shape,s=[];let o=0,r=0,a=0,l=0;n.forEach(((t,e)=>{const i=t.height,n=[],h=this.shape.getTextAlignOffset(t),d=(t,s,a,h,d)=>{const c={text:t,x:s,y:a,charWidth:h,charHeight:i,freeContentIndex:d,lineIndex:e,indexInLine:r,indexInFreeContent:o,totalIndex:l};n.push(c);};r=0,t.words.forEach((e=>{const{wordWidth:i,freeContentIndex:n,x:s,text:c}=e;if(n!==a&&(o=0,a=n),1===e.text.length)d(c,s+h,t.y,i,n),l+=1,r+=1,o+=1;else {let i=e.x+h;for(let s=0;s<c.length;s++){const a=c.charAt(s),h=Xa(a,e.style);d(a,i,t.y,h,n),i+=h,l+=1,o+=1,r+=1;}e.text.length!==e.originText.length&&(o+=e.originText.length-e.text.length);}})),s.push(n);}));const h=this.shape.getTextAlignOffset();if(this.flatChars=s.flat(),this.lineChars=s,this.virtualChar=null,!n.length){const{x:n,y:s,textAlign:o}=this.shape.parsedStyle,{fontSize:r}=this.shape.freeTextContentStyle,a=vr(r).value,l="right"===o?n+e+h:n+t+e+h;return void(this.virtualChar={x:l,y:s+t+e+a*(1-i),charWidth:1,charHeight:a,lineIndex:0})}const d=this.flatChars[this.flatChars.length-1];ql(d.text)&&(this.virtualChar={x:this.shape.lines[0].x+h,y:d.y+n[d.lineIndex].height*(1+i),charWidth:1,charHeight:d.charHeight,lineIndex:d.lineIndex+1});}updateCursor(){if(!this.textCursor||!this.textCursorInitCache)return;const{char:t,isBack:e}=this.textCursorInitCache;this.showTextCursor(t.totalIndex,e);}enableEditMode(t,e){"freeTextWriter"===this.shape.textType&&(this.shape.pathDirty=!0,this.shape.boundsDirty=!0,this.shape.calculateTextLines(),this.shape.hooks.reRenderText.emit()),this.shape.hooks.enableTextEditMode.emit(),this.calculateCharPosition(),this.editMode=!0,this.canvas=e;let i=!1;if("textBox"===this.shape.textType){const{totalTextHeight:t,textMaxWidth:e}=this.shape,{height:i,width:n}=this.shape.parsedStyle;(t!==i.value||e>n.value)&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0);}if(this.flatChars.length){const e=Hl(this.shape,t),i=this.getCharAndDirection(e),{char:n,direction:s}=i;this.startChar=n,this.startDirection=s,this.showTextCursor(n.totalIndex,s);}else this.showTextCursor(void 0,void 0),"freeTextWriter"===this.shape.textType&&(i=!0);this.shape.context.updateControlsFlags({useDefaultControls:i,enableMove:!1}),this.openTextarea(t),this.resetStartTextContent();}disableEditMode(){if(this.editMode){if(this.textClipboard=[],this.editMode=!1,this.hideTextCursor(),this.hideTextSelection(),this.shape.lastIsBack=null,this.shape.lastSelectedEndChar=null,this.shape.context.updateControlsFlags({useDefaultControls:!0,enableMove:!0}),this.textarea&&this.textarea.blur(),"textBox"===this.shape.textType){const{totalTextHeight:t,textMaxWidth:e,maxEditWidth:i}=this.shape,{height:n,width:s}=this.shape.parsedStyle;(t!==n.value||e>s.value||i>s.value)&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0,this.shape.updateOrigin(),this.shape.hooks.reRenderText.emit());}this.shape.maxEditWidth=0,this.shape.hooks.disableTextEditMode.emit(),this.emitTextContentUpdated();}}editStartHandler(t){if(!this.editMode)return;if(!this.flatChars.length)return void this.showTextCursor(void 0,void 0);const e=Hl(this.shape,t),i=this.getCharAndDirection(e);this.hideTextSelection();const{char:n,direction:s}=i;this.showTextCursor(n.totalIndex,s),this.isStart=!0,this.startChar=n,this.startDirection=s,this.startPoint=e,this.shape.hooks.reRenderText.emit();}editMoveHandler(t){if(!this.editMode||!this.isStart)return;const{lineChars:e}=this,i=Hl(this.shape,t),n=this.getLineIndexByMoved(i);let{startChar:s,startDirection:o}=this,r=null;const a=e[n],l=n===this.startChar.lineIndex?i.x>this.startPoint.x:i.y>this.startPoint.y,{lineIndex:h,indexInLine:d}=this.startChar;if(!this.startDirection&&!l){if(0===s.totalIndex)return void this.hideTextSelection(!0);const t=s.lineIndex===e.length-1;if(t&&i.y<this.startPoint.y)s=this.flatChars[s.totalIndex-1],o=1;else if(t)return void this.hideTextSelection(!0)}if(l&&o&&(s=e[h][d+1],o=0,!s))return void this.hideTextSelection(!0);if(l&&i.x<a[0].x+a[0].charWidth/2&&s.lineIndex!==n){const t=e[n-1];return r=t[t.length-1],void this.showTextSelection(s,r)}if(l)a.forEach(((t,e)=>{const{x:n,charWidth:s}=t;i.x>n+s/2&&(r=a[e]);}));else for(let t=a.length-1;t>=0;t--){const{x:e,charWidth:n}=a[t];e+n/2>i.x&&(r=a[t]);}if(!r)return void this.hideTextSelection(!0);const{lineIndex:c,indexInLine:u}=s,{lineIndex:p,indexInLine:g}=r;l&&c===p&&u===g+1||!l&&c===p&&u===g-1?this.hideTextSelection(!0):l?this.showTextSelection(s,r):this.showTextSelection(r,s);}editEndHandler(){this.isStart=!1;}editClickHandler(t,e){this.editMode&&(this.canvas=e,this.openTextarea(t));}openTextarea(t){if(this.editMode){if(!this.textarea){const t=document.createElement("textarea");t.className="ddv-annotation-textarea",this.canvas.parentNode.appendChild(t),this.textarea=t,t.addEventListener("input",(t=>{this.inputComposition||this.textareaInput(t);}),!1),t.addEventListener("compositionstart",(t=>this.textareaCompositionstart(t)),!1),t.addEventListener("compositionend",(t=>{this.inputComposition=!1,this.textareaInput(t);}),!1),t.addEventListener("keydown",(t=>this.textareaKeydown(t)),!1);}if(t){const{x:e,y:i}=t;this.textarea.style.left=`${e}px`,this.textarea.style.top=`${i}px`;}this.textarea.value="",this.textarea.focus();}}destroyTextarea(){this.textarea&&(this.textarea.remove(),this.textarea=null);}emitTextContentUpdated(){(function(t,e){let i="",n="";for(let e=0;e<t.length;e++)i+=t[e].content;for(let t=0;t<e.length;t++)n+=e[t].content;return i===n})(this.startTextContent,this.shape.style.textContents)||(this.startTextContent=Vn(this.shape.style.textContents),this.shape.hooks.textContentUpdated.emit());}resetStartTextContent(){this.startTextContent=Vn(this.shape.style.textContents);}textareaInput(t){const e=this.textarea.value;if(2===this.textSelection.length&&this.deleteText(!1),this.flatChars.length){const{char:t,isBack:i}=this.textCursorInitCache;this.addText(t,i,e);}else this.addText(void 0,void 0,e);this.textarea.value="";}textareaCompositionstart(t){this.inputComposition=!0;}textareaKeydown(t){if(this.inputComposition||"Backspace"!==t.key||8!==t.keyCode)if(this.inputComposition||"Delete"!==t.key)switch(Ms(t)&&("KeyC"===t.code?this.copyText():"KeyX"===t.code?(this.copyText(),this.textSelection.length&&this.deleteText()):"KeyV"===t.code&&this.textClipboard.length?(t.preventDefault(),this.pasteText()):"KeyZ"===t.code?(t.preventDefault(),t.stopPropagation()):"KeyA"===t.code&&this.selectAllText()),t.key){case"ArrowLeft":this.moveTextCursor("left");break;case"ArrowRight":this.moveTextCursor("right");break;case"ArrowUp":this.moveTextCursor("up");break;case"ArrowDown":this.moveTextCursor("down");}else this.deleteText(!0,!0);else this.deleteText();}}function yh(t,e){return t.color===e.color&&t.fontFamily===e.fontFamily&&t.fontSize===e.fontSize&&t.fontStyle===e.fontStyle&&t.fontWeight===e.fontWeight&&t.lineThrough===e.lineThrough&&t.underline===e.underline}class mh extends Ga{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"textBox",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ih,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super({type:"annotationFreeText",id:t.id,style:{freeTextType:e,...t.style}}),i(this,"lastSelectedEndChar",void 0),i(this,"lastIsBack",void 0),i(this,"shapeType","annotationFreeText"),i(this,"textEditEventHandler",void 0),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),i(this,"freeTextContentStyle",void 0),i(this,"inputModeTimer",void 0),i(this,"maxEditWidth",0),i(this,"hooks",{reRenderText:rs(),selectTextChars:rs(),enableTextEditMode:rs(),disableTextEditMode:rs(),textContentUpdated:rs(),textContentUpdatedByChar:rs()}),this.freeTextContentStyle=n,this.init(t.transform,t.selectableStyle,s),"freeTextWriter"===this.textType&&this.context.updateControlsFlags({enableEdit:!1,enableRotate:!1}),this.hooks.selectTextChars.on((t=>{const e=t.endChar;if(this.isSameChar(e,this.lastSelectedEndChar)&&t.isBack===this.lastIsBack&&!t.needUpdate)return;let i=e.freeContentIndex;e.indexInFreeContent||!e.freeContentIndex||t.isBack||(i-=1);const n=this.style.textContents[i];this.lastSelectedEndChar=e,this.lastIsBack=t.isBack,this.freeTextContentStyle={...n,content:this.freeTextContentStyle.content};}));}get isEditMode(){var t;return null===(t=this.textEditEventHandler)||void 0===t?void 0:t.editMode}get hasSelectedChars(){var t;return (null===(t=this.textEditEventHandler)||void 0===t?void 0:t.textSelection.length)>0}init(t,e,i){if("freeTextWriter"===this.textType&&i&&super.updateOrigin(),this.context=new lh(this,e),this.textEditEventHandler=new fh(this),this.eventHandler=new rh(this),this.context.setTransform(t),"freeTextWriter"===this.textType&&i){const{x:t,y:e}=this.getPosition();this.updateOrigin(),this.setPosition({x:t,y:e});}}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.textEditEventHandler.disableEditMode(),this.textEditEventHandler.destroyTextarea(),this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}updateOrigin(){"freeTextWriter"===this.textType?this.setOrigin(0,0):super.updateOrigin();}getAnnotationConfig(){const t="textBox"===this.textType?"annotationTextBox":"annotationFreeText",e=this.context.getTransform(),{position:i}=e,{width:n,height:s,textContents:o}=this.attributes,r={type:t,style:{x:i.x,y:i.y,textContents:Vn(o),textAlign:this.style.textAlign,...this.context.getCommonStyleConfig(),width:n},transform:e};return "textBox"===this.textType&&(r.style.height=s),r}calculateTotalHeight(){var t,e;const i=vr((null===(t=this.freeTextContentStyle)||void 0===t?void 0:t.fontSize)||16);if(null!==(e=this.lines)&&void 0!==e&&e.length)super.calculateTotalHeight();else if("freeTextWriter"===this.textType)this.totalTextHeight=i.value+2*this.borderOffset;else {const{height:t}=this.parsedStyle;this.totalTextHeight=t.value>i.value+2*this.borderOffset?t.value:i.value+2*this.borderOffset+2*this.padding;}}getBoundingRect(){var t;if(!this.boundsDirty)return this.bounds;const{x:e,y:i}=this.parsedStyle;if("freeTextWriter"===this.textType&&(null===(t=this.lines)||void 0===t||!t.length)){var n;const t=vr((null===(n=this.freeTextContentStyle)||void 0===n?void 0:n.fontSize)||16);return this.boundsDirty=!1,this.bounds={x:e,y:i,width:Xa("  ",{...this.freeTextContentStyle,fontSize:t}),height:t.value+2*this.padding},this.bounds}return super.getBoundingRect(),"textBox"===this.textType&&this.isEditMode&&(this.bounds.height=this.totalTextHeight,this.textMaxWidth>this.bounds.width&&(this.bounds.width=this.textMaxWidth+2*this.borderOffset+2*this.padding),this.maxEditWidth=Math.max(this.maxEditWidth,this.bounds.width),this.maxEditWidth>this.bounds.width&&(this.bounds.width=this.maxEditWidth)),this.bounds}updateFreeTextContentStyle(t){this.freeTextContentStyle=t,this.textEditEventHandler.updateCursor();const{flatChars:e}=this.textEditEventHandler;this.isEditMode&&!e.length&&(this.pathDirty=!0,this.boundsDirty=!0,this.calculateTotalHeight(),this.hooks.reRenderText.emit(),this.hooks.enableTextEditMode.emit());}focusTexture(){const t=qn();this.isEditMode&&this.textEditEventHandler.textarea&&(t||this.textEditEventHandler.textarea.focus());}updateCursor(){this.textEditEventHandler.updateCursor();}isSameChar(t,e){return !(!t||!e)&&(t.charHeight===e.charHeight&&t.charWidth===e.charWidth&&t.freeContentIndex===e.freeContentIndex&&t.indexInFreeContent===e.indexInFreeContent&&t.indexInLine===e.indexInLine&&t.text===e.text&&t.totalIndex===e.totalIndex)}}class vh extends Fa{constructor(t){super({id:t,type:"annotationGroup",style:{visibility:"hidden",background:"transparent",borderColor:"transparent"}}),i(this,"shapeType","annotationGroup"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),i(this,"parent",void 0),i(this,"parentPosition",void 0),i(this,"shapes",[]),i(this,"clickedShape",null),i(this,"state",!1),i(this,"groupMode",0),this.context=new lh(this),this.eventHandler=new rh(this),this.eventHandler.isHit=this.isHit.bind(this),this.groupMode?this.context.updateControlsFlags({enableEdit:!1}):this.context.updateControlsFlags({useDefaultControls:!1});}isHit(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{context:i,parsedStyle:n}=this;let{controls:s}=this;if(!this.state||"hidden"===n.visibility||!i.controlsFlags.enableControl)return this.clickedShape=null,-1;s||(i.initControls(),i.renderControls(),s=this.controls);let o=-1;if(this.groupMode)o=s.checkHitArea(t.x,t.y);else for(let e=0;e<this.shapes.length;e++)if(this.shapes[e].controls||(this.shapes[e].context.initControls(),this.shapes[e].context.renderControls()),this.shapes[e].controls.checkHitArea(t.x,t.y)>=0){this.clickedShape=this.shapes[e],o=9;break}return o<0&&e?(this.clickedShape=null,i.unHitShape(),this.context.destroyControls(),-1):o}init(){this.style.visibility="visible",this.parent.appendChild(this),this.shapes.forEach((t=>{t instanceof mh&&t.isEditMode&&t.textEditEventHandler.disableEditMode(),this.appendChild(t),t.context.isGrouped=!0;})),this.update(),this.context.initControls();}add(t){if(!this.parent){const e=t.parentNode;this.parent=e,this.parentPosition=e.getPosition();}if("hidden"!==t.parsedStyle.visibility&&-1===this.shapes.indexOf(t)){if(t.context.isInGroup=!0,this.shapes.push(t),this.state){const e=[];this.shapes.forEach((t=>{e.push(t.getWorldTransform().clone());})),t instanceof mh&&t.isEditMode&&t.textEditEventHandler.disableEditMode(),t.context.isGrouped=!0,this.appendChild(t),this.groupMode||this.showAllControls(t),this.shapes.forEach(((t,i)=>{const n=this.getWorldTransform().inverse().multiply(e[i]);t.setLocalTransform(n);})),this.update();}this.shapes.length>=2&&!1===this.state&&(this.state=!0,this.init());}}update(){const t=[],e=[],i=[];let n=!0;for(let s=0;s<this.shapes.length;s++){const o=this.shapes[s];let{controls:r}=o;r||(o.context.initControls(),r=o.controls),o.context.renderControls(),this.groupMode&&o.context.unHitShape(),o.context.controlsFlags.enableMove||(n=!1);const a=r.controlPoints.slice(0,4);for(let i=0;i<4;i++){const{x:n,y:s}=a[i].getCenterPosition();t.push(n),e.push(s);}i.push(this.shapes[s].getWorldTransform().clone());}const s=Math.max(...t),o=Math.min(...t),r=Math.max(...e),a=Math.min(...e);this.updateStyle({x:0,y:0,width:s-o,height:r-a}),this.context.updateControlsFlags({enableMove:n}),this.setAngle(180===this.parent.getAngle()?179.99:0),this.setLocalScale(1,1);const{x:l,y:h}=this.getScale();this.scale(1/Math.abs(l),1/Math.abs(h)),this.setPosition({x:o,y:a}),this.updateOrigin(),this.context.updateControls(),this.shapes.forEach(((t,e)=>{const n=this.getWorldTransform().inverse().multiply(i[e]);t.setLocalTransform(n);}));}delete(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.parent)return;if(-1===this.shapes.indexOf(t))return;const i=t.getWorldTransform().clone();this.parent.appendChild(t);const n=this.parent.getWorldTransform().inverse().multiply(i);t.setLocalTransform(n),t.context.isInGroup=!1,t.context.isGrouped=!1,t.context.isActive=!1,t.context.destroyControls(),"freeTextWriter"!==(null==t?void 0:t.textType)&&(t.context.updateControlsFlags({enableRotate:t.context.tempData.enableRotate||!1}),delete t.context.tempData.enableRotate),zl(t)&&t.pointEventsHandler.disableEditMode(),this.shapes.splice(this.shapes.indexOf(t),1),e&&this.update(),0===this.shapes.length&&this.clear();}clear(){const{length:t}=this.shapes;for(let e=t-1;e>=0;e--)this.delete(this.shapes[e],!1);this.context.destroyControls(),this.reset();}reset(){this.parent&&this.parent.removeChild(this),this.updateStyle({x:0,y:0,width:0,height:0}),this.resetLocalTransform(),this.shapes=[],this.parent=null,this.state=!1,this.style.visibility="hidden";}destroy(){const{length:t}=this.shapes;for(let e=t-1;e>=0;e--)this.shapes[e].destroy();this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.shapes=[],this.state=!1,this.parent=null,this.style.visibility="hidden",this.updateStyle({x:0,y:0,width:0,height:0});}showAllControls(t){if(!this.state)return;if(this.groupMode)return;const e=t=>{zl(t)&&t.pointEventsHandler.enableEditMode(),t.controls||t.context.initControls(),t.context.controlsFlags.enableRotate&&(t.context.tempData.enableRotate=t.context.controlsFlags.enableRotate,t.context.updateControlsFlags({enableRotate:!1})),t.context.isActive=!0,t.context.renderControls();};t?e(t):this.shapes.forEach((t=>{e(t);}));}getAnnotationConfig(){return {type:"annotationGroup"}}}class xh extends Fa{constructor(t){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),i(this,"shapeType","annotationLineControls"),i(this,"container",void 0),this.container=t;}get isVisible(){return "hidden"!==this.parsedStyle.visibility&&Kl(null==this?void 0:this.container)}}class wh{constructor(t){i(this,"shape",void 0),i(this,"editMode",void 0),i(this,"hitIndex",-1),i(this,"hitPointPos",void 0),i(this,"startPoint",void 0),i(this,"controlsBox",void 0),i(this,"controlsPoints",[]),this.shape=t;}getLineShapePoints(){const{shape:t}=this,{shapeType:e}=t;if("annotationLine"===e){const{startPoint:e,endPoint:i}=t.style;return [e,i]}const{points:i}=this.shape.parsedStyle;return i.slice(0,i.length)}initLineControls(){const{shape:t}=this;t.updatePoints();const{x:e,y:i}=this.shape.getScale(),{ctrlBorderColor:n,ctrlBorderWidth:s,ctrlLineDash:o,borderColor:r,borderWidth:a,lineDash:l,ctrlBorderRadius:h,ctrlWidth:d,ctrlHeight:c,background:u,ctrlBackground:p}=t.context.parsedControlsStyle,g={background:p,borderColor:n,borderWidth:s,lineDash:o},f=this.shape.getBoundingRect(),y=this.getLineShapePoints();this.controlsBox=new xh(this.shape,{style:{width:f.width*e,height:f.height*i,borderColor:r,borderWidth:a,background:u,lineDash:l}}),y.forEach((n=>{const s=new $a({style:{width:d,height:c,roundedRadius:h,...g,visibility:t.context.controlsFlags.enableEdit?"visible":"hidden"}}),o=(n.x-f.x)*e-vr(d).value/2,r=(n.y-f.y)*i-vr(c).value/2;s.setLocalPosition(o,r),this.controlsPoints.push(s),this.controlsBox.appendChild(s);})),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.getRootNode().appendChild(this.controlsBox);}isHitPoint(t){if(!this.editMode)return -1;if(this.shape.context.controlsFlags.enableEdit)for(let e=0;e<this.controlsPoints.length;e++){const i=Hl(this.controlsPoints[e],t);if(this.controlsPoints[e].isPointInPath(i))return e}return -1}updateLineControls(){if(!this.controlsBox||0===this.controlsPoints.length)return;if(!this.editMode)return;const{ctrlWidth:t,ctrlHeight:e}=this.shape.context.parsedControlsStyle,{x:i,y:n}=this.shape.getScale(),s=this.shape.getBoundingRect(),o=this.getLineShapePoints();this.controlsPoints.length!==o.length&&(this.destroyLineControls(),this.initLineControls()),o.forEach(((o,r)=>{const a=(o.x-s.x)*i-t/2,l=(o.y-s.y)*n-e/2;this.controlsPoints[r].setLocalPosition(a,l);})),this.controlsBox.updateStyle({width:s.width*i,height:s.height*n}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.controls&&(this.shape.context.lastControlsWidth=this.shape.controls.getLength().width,this.shape.context.lastControlsHeight=this.shape.controls.getLength().height);}destroyLineControls(){var t;null===(t=this.controlsBox)||void 0===t||t.destroy(),this.controlsPoints.forEach((t=>{t.destroy(),t=null;})),this.controlsBox=null,this.controlsPoints=[];}enableEditMode(){if(this.shape.path||this.shape.getPath(),this.shape.path.length>this.shape.pointerLimitCount)return;if(this.controlsPoints.length>0)return;const{shape:t}=this;this.editMode||this.initLineControls(),this.editMode=!0,t.context.isHit=!0,t.controls&&(t.context.lastControlsWidth=t.controls.getLength().width,t.context.lastControlsHeight=t.controls.getLength().height);}disableEditMode(){this.destroyLineControls(),this.editMode=!1;}editStartHandler(t){if(!this.editMode)return;this.hitIndex=-1;const e=this.isHitPoint(t);-1!==e&&(this.hitIndex=e,this.hitPointPos={...this.shape.path[this.hitIndex]}),this.startPoint=t,this.shape.context.lastLocalTransform=this.shape.getLocalTransform();}editMoveHandler(t){if(!this.editMode||-1===this.hitIndex)return;const{shape:e}=this,i="annotationLine"===e.shapeType,n=i?[...e.path]:[...e.parsedStyle.points],s=Hl(e,t);n[this.hitIndex]=s,i?e.updateStyle({startPoint:{x:n[0].x,y:n[0].y},endPoint:{x:n[1].x,y:n[1].y}}):e.style.points=n,this.updateLineControls();}editEndHandler(){this.editMode&&this.shape.updatePoints();}}class bh extends _a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationPolygon",...t}),i(this,"shapeType","annotationPolygon"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),i(this,"pointEventsHandler",void 0),i(this,"pointerLimitCount",200),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.pointEventsHandler=new wh(this),this.eventHandler=new rh(this),this.context.setTransform(t),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1});}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls();}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{position:i}=t,n=i.x!==e.x||i.y!==e.y;let s=this.attributes.points;n&&(s=[],this.attributes.points.forEach((t=>{s.push({x:t.x-e.x+i.x,y:t.y-e.y+i.y});})));return {type:"annotationPolygon",style:{points:s,...this.context.getCommonStyleConfig()},transform:t}}}class Ch extends Wa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationPolyline",...t}),i(this,"shapeType","annotationPolyline"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),i(this,"pointEventsHandler",void 0),i(this,"pointerLimitCount",200),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.pointEventsHandler=new wh(this),this.eventHandler=new rh(this),this.context.setTransform(t),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1});}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls();}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{position:i}=t,n=i.x!==e.x||i.y!==e.y;let s=this.attributes.points;n&&(s=[],this.attributes.points.forEach((t=>{s.push({x:t.x-e.x+i.x,y:t.y-e.y+i.y});})));return {type:"annotationPolyline",style:{points:s,lineEnding:this.attributes.lineEnding,...this.context.getCommonStyleConfig()},transform:t}}}class Sh extends Va{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationLine",...t}),i(this,"shapeType","annotationLine"),i(this,"eventHandler",void 0),i(this,"controls",void 0),i(this,"context",void 0),i(this,"pointEventsHandler",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new lh(this,e),this.pointEventsHandler=new wh(this),this.eventHandler=new rh(this),this.context.setTransform(t),this.context.updateControlsFlags({useDefaultControls:!1});}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls();}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{startPoint:i,endPoint:n,lineEnding:s}=this.attributes,{position:o}=t,r=o.x!==e.x||o.y!==e.y;return {type:"annotationLine",style:{startPoint:r?{x:i.x-e.x+o.x,y:i.y-e.y+o.y}:i,endPoint:r?{x:n.x-e.x+o.x,y:n.y-e.y+o.y}:n,lineEnding:s,...this.context.getCommonStyleConfig()},transform:t}}}const Ph=[{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #a9d776, #40691b)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"round",miterLimit:4}],Ah=[{type:"path",stampPoints:[{x:424.45703125,y:294.07291666666663,step:2},{x:424.45703125,y:298.47265625,step:1},{x:420.83984375,y:302.07291666666663,step:1},{x:416.4192708333333,y:302.07291666666663,step:1},{x:222.49481201171875,y:302.07291666666663,step:0},{x:218.07421875,y:302.07291666666663,step:1},{x:214.45703125,y:298.47265625,step:1},{x:214.45703125,y:294.07291666666663,step:1},{x:214.45703125,y:252.07291666666666,step:0},{x:214.45703125,y:247.67313639322916,step:1},{x:218.07421875,y:244.07291666666666,step:1},{x:222.49481201171875,y:244.07291666666666,step:1},{x:416.4192708333333,y:244.07291666666666,step:0},{x:420.83984375,y:244.07291666666666,step:1},{x:424.45703125,y:247.67313639322916,step:1},{x:424.45703125,y:252.07291666666666,step:1},{x:424.45703125,y:294.07291666666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:424.0677083333333,y:293.9374593098958,step:2},{x:424.0677083333333,y:298.3358968098958,step:1},{x:420.45048014322913,y:301.9374593098958,step:1},{x:416.02994791666663,y:301.9374593098958,step:1},{x:222.10614013671875,y:301.9374593098958,step:0},{x:217.685546875,y:301.9374593098958,step:1},{x:214.06837972005206,y:298.3358968098958,step:1},{x:214.06837972005206,y:293.9374593098958,step:1},{x:214.06837972005206,y:251.93684895833331,step:0},{x:214.06837972005206,y:247.53715006510416,step:1},{x:217.685546875,y:243.93684895833331,step:1},{x:222.10614013671875,y:243.93684895833331,step:1},{x:416.02994791666663,y:243.93684895833331,step:0},{x:420.45048014322913,y:243.93684895833331,step:1},{x:424.0677083333333,y:247.53715006510416,step:1},{x:424.0677083333333,y:251.93684895833331,step:1},{x:424.0677083333333,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(41,66,18,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:234.81705729166666,y:280.5859375,step:2},{x:231.83074951171875,y:287.9374593098958,step:0},{x:226.009765625,y:287.9374593098958,step:0},{x:238.44596354166666,y:259.6288655598958,step:0},{x:245.4388224283854,y:259.6288655598958,step:0},{x:248.38736979166666,y:287.9374593098958,step:0},{x:242.67903645833331,y:287.9374593098958,step:0},{x:242.150390625,y:280.5859375,step:0},{x:234.81705729166666,y:280.5859375,step:0},{x:241.9238077799479,y:275.9661458333333,step:2},{x:241.43166097005206,y:269.8769124348958,step:0},{x:241.318359375,y:268.3229573567708,step:1},{x:241.205078125,y:266.0553792317708,step:1},{x:241.0917765299479,y:264.33268229166663,step:1},{x:240.978515625,y:264.33268229166663,step:0},{x:240.33528645833331,y:266.0553792317708,step:1},{x:239.6171671549479,y:268.2389729817708,step:1},{x:238.93684895833331,y:269.8769124348958,step:1},{x:236.44270833333331,y:275.9661458333333,step:0},{x:241.9238077799479,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:255.87109375,y:260.1335042317708,step:2},{x:257.5345052083333,y:259.67057291666663,step:1},{x:260.06705729166663,y:259.41861979166663,step:1},{x:262.52410888671875,y:259.41861979166663,step:1},{x:264.83009847005206,y:259.41861979166663,step:1},{x:267.43815104166663,y:259.8391927083333,step:1},{x:269.2903645833333,y:261.30924479166663,step:1},{x:271.02931722005206,y:262.56901041666663,step:1},{x:272.0501302083333,y:264.58463541666663,step:1},{x:272.0501302083333,y:267.314453125,step:1},{x:272.0501302083333,y:270.884765625,step:1},{x:270.5755208333333,y:273.6145833333333,step:1},{x:268.61002604166663,y:275.2942708333333,step:1},{x:266.5305989583333,y:277.1015625,step:1},{x:263.544921875,y:277.94010416666663,step:1},{x:260.4446818033854,y:277.94010416666663,step:1},{x:259.5384318033854,y:277.94010416666663,step:1},{x:258.78190104166663,y:277.81510416666663,step:1},{x:258.21486409505206,y:277.7734375,step:1},{x:256.4759114583333,y:287.9374593098958,step:0},{x:251.146484375,y:287.9374593098958,step:0},{x:255.87109375,y:260.1335042317708,step:0},{x:259.0462239583333,y:272.8170979817708,step:2},{x:259.61328125,y:272.9427083333333,step:1},{x:260.2181193033854,y:273.0266927083333,step:1},{x:261.1634318033854,y:273.0266927083333,step:1},{x:264.4140625,y:273.0266927083333,step:1},{x:266.56901041666663,y:270.6751302083333,step:1},{x:266.56901041666663,y:267.861328125,step:1},{x:266.56901041666663,y:265.130859375,step:1},{x:264.7923177083333,y:264.24869791666663,step:1},{x:262.712890625,y:264.24869791666663,step:1},{x:261.6927083333333,y:264.24869791666663,step:1},{x:260.9368489583333,y:264.33268229166663,step:1},{x:260.48307291666663,y:264.4167073567708,step:1},{x:259.0462239583333,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:277.19010416666663,y:260.1335042317708,step:2},{x:278.85353597005206,y:259.67057291666663,step:1},{x:281.3860677083333,y:259.41861979166663,step:1},{x:283.84246826171875,y:259.41861979166663,step:1},{x:286.14845784505206,y:259.41861979166663,step:1},{x:288.75651041666663,y:259.8391927083333,step:1},{x:290.6087239583333,y:261.30924479166663,step:1},{x:292.34765625,y:262.56901041666663,step:1},{x:293.3685099283854,y:264.58463541666663,step:1},{x:293.3685099283854,y:267.314453125,step:1},{x:293.3685099283854,y:270.884765625,step:1},{x:291.8938802083333,y:273.6145833333333,step:1},{x:289.92836507161456,y:275.2942708333333,step:1},{x:287.84962972005206,y:277.1015625,step:1},{x:284.86328125,y:277.94010416666663,step:1},{x:281.763671875,y:277.94010416666663,step:1},{x:280.8567708333333,y:277.94010416666663,step:1},{x:280.10028076171875,y:277.81510416666663,step:1},{x:279.533203125,y:277.7734375,step:1},{x:277.794921875,y:287.9374593098958,step:0},{x:272.4648234049479,y:287.9374593098958,step:0},{x:277.19010416666663,y:260.1335042317708,step:0},{x:280.36525472005206,y:272.8170979817708,step:2},{x:280.93229166666663,y:272.9427083333333,step:1},{x:281.537109375,y:273.0266927083333,step:1},{x:282.482421875,y:273.0266927083333,step:1},{x:285.732421875,y:273.0266927083333,step:1},{x:287.88736979166663,y:270.6751302083333,step:1},{x:287.88736979166663,y:267.861328125,step:1},{x:287.88736979166663,y:265.130859375,step:1},{x:286.1106974283854,y:264.24869791666663,step:1},{x:284.03192138671875,y:264.24869791666663,step:1},{x:283.0110677083333,y:264.24869791666663,step:1},{x:282.2552286783854,y:264.33268229166663,step:1},{x:281.80145263671875,y:264.4167073567708,step:1},{x:280.36525472005206,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:298.583984375,y:260.1335042317708,step:2},{x:300.2845052083333,y:259.67057291666663,step:1},{x:302.8548380533854,y:259.41861979166663,step:1},{x:305.3880208333333,y:259.41861979166663,step:1},{x:307.80731201171875,y:259.41861979166663,step:1},{x:310.3020833333333,y:259.79752604166663,step:1},{x:312.078125,y:261.056640625,step:1},{x:313.7415364583333,y:262.1491292317708,step:1},{x:314.9134318033854,y:263.91276041666663,step:1},{x:314.9134318033854,y:266.5592854817708,step:1},{x:314.9134318033854,y:270.7591145833333,step:1},{x:312.41861979166663,y:273.4049072265625,step:1},{x:309.1302083333333,y:274.58072916666663,step:1},{x:309.1302083333333,y:274.70703125,step:0},{x:310.642578125,y:275.46354166666663,step:1},{x:311.322265625,y:277.3098958333333,step:1},{x:311.54949951171875,y:279.8723958333333,step:1},{x:311.88930257161456,y:283.06510416666663,step:1},{x:312.078125,y:286.76041666666663,step:1},{x:312.53190104166663,y:287.9374593098958,step:1},{x:306.93752034505206,y:287.9374593098958,step:0},{x:306.7109375,y:287.18094889322913,step:1},{x:306.4466145833333,y:284.74479166666663,step:1},{x:306.21940104166663,y:281.2591145833333,step:1},{x:305.955078125,y:277.81510416666663,step:1},{x:304.89650472005206,y:276.765625,step:1},{x:302.7415364583333,y:276.765625,step:1},{x:301.07877604166663,y:276.765625,step:0},{x:299.1888020833333,y:287.9374593098958,step:0},{x:293.82096354166663,y:287.9374593098958,step:0},{x:298.583984375,y:260.1335042317708,step:0},{x:301.9101359049479,y:272.22855631510413,step:2},{x:304.1399739583333,y:272.22855631510413,step:0},{x:307.08917236328125,y:272.22855631510413,step:1},{x:309.24346923828125,y:270.25455729166663,step:1},{x:309.24346923828125,y:267.48246256510413,step:1},{x:309.24346923828125,y:265.1731770833333,step:1},{x:307.5423380533854,y:264.16471354166663,step:1},{x:305.35026041666663,y:264.16471354166663,step:1},{x:304.330078125,y:264.16471354166663,step:1},{x:303.6868693033854,y:264.24869791666663,step:1},{x:303.2337239583333,y:264.3749593098958,step:1},{x:301.9101359049479,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:327.236328125,y:288.3984375,step:2},{x:320.6210734049479,y:288.3984375,step:1},{x:316.91668701171875,y:283.19010416666663,step:1},{x:316.91668701171875,y:276.59635416666663,step:1},{x:316.91668701171875,y:271.47330729166663,step:1},{x:318.61783854166663,y:266.39127604166663,step:1},{x:321.603515625,y:263.19921875,step:1},{x:323.98502604166663,y:260.6790364583333,step:1},{x:327.236328125,y:259.16666666666663,step:1},{x:330.90236409505206,y:259.16666666666663,step:1},{x:337.63087972005206,y:259.16666666666663,step:1},{x:341.18424479166663,y:264.20703125,step:1},{x:341.18424479166663,y:270.9693603515625,step:1},{x:341.18424479166663,y:276.1354573567708,step:1},{x:339.55859375,y:281.17447916666663,step:1},{x:336.6477864583333,y:284.3255208333333,step:1},{x:334.2669270833333,y:286.8880615234375,step:1},{x:331.0540364583333,y:288.3984375,step:1},{x:327.2734375,y:288.3984375,step:1},{x:327.236328125,y:288.3984375,step:0},{x:328.02994791666663,y:283.35941569010413,step:2},{x:329.6555989583333,y:283.35941569010413,step:1},{x:331.12957763671875,y:282.6028645833333,step:1},{x:332.30143229166663,y:281.3021240234375,step:1},{x:334.3040364583333,y:279.0755208333333,step:1},{x:335.40104166666663,y:274.41276041666663,step:1},{x:335.40104166666663,y:271.13736979166663,step:1},{x:335.40104166666663,y:267.6087239583333,step:1},{x:334.2669270833333,y:264.20703125,step:1},{x:330.2597452799479,y:264.20703125,step:1},{x:328.55922444661456,y:264.20703125,step:1},{x:327.04689534505206,y:265.0045166015625,step:1},{x:325.8749796549479,y:266.34891764322913,step:1},{x:323.83400472005206,y:268.57486979166663,step:1},{x:322.69986979166663,y:272.9849853515625,step:1},{x:322.69986979166663,y:276.3880208333333,step:1},{x:322.69986979166663,y:280.3775634765625,step:1},{x:324.3255208333333,y:283.35941569010413,step:1},{x:327.99151611328125,y:283.35941569010413,step:1},{x:328.02994791666663,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:347.61002604166663,y:287.9374593098958,step:2},{x:344.435546875,y:259.6288655598958,step:0},{x:350.06705729166663,y:259.6288655598958,step:0},{x:351.201171875,y:273.1106770833333,step:0},{x:351.4661458333333,y:276.1354573567708,step:1},{x:351.6549886067708,y:278.8646240234375,step:1},{x:351.80594889322913,y:281.8046468098958,step:1},{x:351.88151041666663,y:281.8046468098958,step:0},{x:352.82682291666663,y:279.03385416666663,step:1},{x:354.03641764322913,y:276.0091552734375,step:1},{x:355.283203125,y:273.068359375,step:1},{x:360.9915771484375,y:259.6288655598958,step:0},{x:367.07743326822913,y:259.6288655598958,step:0},{x:353.9232177734375,y:287.9374593098958,step:0},{x:347.61002604166663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:381.7805989583333,y:275.88285319010413,step:2},{x:372.74674479166663,y:275.88285319010413,step:0},{x:371.5755208333333,y:282.7708333333333,step:0},{x:381.7434895833333,y:282.7708333333333,step:0},{x:380.87369791666663,y:287.9374593098958,step:0},{x:365.224609375,y:287.9374593098958,step:0},{x:370.06315104166663,y:259.6288655598958,step:0},{x:385.1451416015625,y:259.6288655598958,step:0},{x:384.2376708984375,y:264.79496256510413,step:0},{x:374.6366780598958,y:264.79496256510413,step:0},{x:373.57877604166663,y:270.8014729817708,step:0},{x:382.68815104166663,y:270.8014729817708,step:0},{x:381.7805989583333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:389.52994791666663,y:260.048828125,step:2},{x:391.7220052083333,y:259.6288655598958,step:1},{x:394.103515625,y:259.41861979166663,step:1},{x:396.5989990234375,y:259.41861979166663,step:1},{x:400.5677083333333,y:259.41861979166663,step:1},{x:403.705078125,y:260.42704264322913,step:1},{x:405.8593343098958,y:262.4849853515625,step:1},{x:407.93876139322913,y:264.33268229166663,step:1},{x:409.22391764322913,y:267.146484375,step:1},{x:409.22391764322913,y:271.3470052083333,step:1},{x:409.22391764322913,y:276.8073323567708,step:1},{x:407.1444905598958,y:281.5521240234375,step:1},{x:404.0071614583333,y:284.3671875,step:1},{x:401.05924479166663,y:287.01298014322913,step:1},{x:397.3170166015625,y:288.1458333333333,step:1},{x:391.7981770833333,y:288.1458333333333,step:1},{x:388.73636881510413,y:288.1458333333333,step:1},{x:386.0904541015625,y:287.85282389322913,step:1},{x:384.80533854166663,y:287.5598958333333,step:1},{x:389.52994791666663,y:260.048828125,step:0},{x:391.080078125,y:283.1067708333333,step:2},{x:391.7220052083333,y:283.19010416666663,step:1},{x:392.5162353515625,y:283.2317708333333,step:1},{x:393.4609375,y:283.2317708333333,step:1},{x:396.40946451822913,y:283.2317708333333,step:1},{x:399.017578125,y:282.0573323567708,step:1},{x:400.6809895833333,y:279.9569905598958,step:1},{x:402.4198811848958,y:277.7317708333333,step:1},{x:403.32682291666663,y:274.7916259765625,step:1},{x:403.32682291666663,y:271.38871256510413,step:1},{x:403.32682291666663,y:266.8952229817708,step:1},{x:401.0970052083333,y:264.24869791666663,step:1},{x:396.5989990234375,y:264.24869791666663,step:1},{x:395.6536865234375,y:264.24869791666663,step:1},{x:394.8600667317708,y:264.33268229166663,step:1},{x:394.2923583984375,y:264.458984375,step:1},{x:391.080078125,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Th=[{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:329.54166666666663,y:287.13798014322913,step:2},{x:328.1810099283854,y:287.80985514322913,step:1},{x:325.91276041666663,y:288.35673014322913,step:1},{x:322.8515625,y:288.35673014322913,step:1},{x:316.0852864583333,y:288.35673014322913,step:1},{x:311.58660888671875,y:283.8203125,step:1},{x:311.58660888671875,y:276.3437093098958,step:1},{x:311.58660888671875,y:269.9609375,step:1},{x:314.15690104166663,y:265.046875,step:1},{x:318.0130411783854,y:262.1901448567708,step:1},{x:320.65885416666663,y:260.1745198567708,step:1},{x:323.75844319661456,y:259.2083333333333,step:1},{x:327.349609375,y:259.2083333333333,step:1},{x:330.1087443033854,y:259.2083333333333,step:1},{x:332.18817138671875,y:259.92191569010413,step:1},{x:332.943359375,y:260.38541666666663,step:1},{x:331.43166097005206,y:265.29947916666663,step:0},{x:330.71356201171875,y:264.8802490234375,step:1},{x:329.01236979166663,y:264.3749593098958,step:1},{x:326.8203125,y:264.3749593098958,step:1},{x:324.62760416666663,y:264.3749593098958,step:1},{x:322.5488077799479,y:265.1302083333333,step:1},{x:320.99867757161456,y:266.5598958333333,step:1},{x:318.8821614583333,y:268.4895833333333,step:1},{x:317.4837239583333,y:271.7239583333333,step:1},{x:317.4837239583333,y:275.6718343098958,step:1},{x:317.4837239583333,y:280.16666666666663,step:1},{x:319.78971354166663,y:283.19010416666663,step:1},{x:324.25002034505206,y:283.19010416666663,step:1},{x:326.064453125,y:283.19010416666663,step:1},{x:327.84051513671875,y:282.85416666666663,step:1},{x:329.087890625,y:282.265625,step:1},{x:329.54166666666663,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:342.9987386067708,y:288.3984375,step:2},{x:336.3841145833333,y:288.3984375,step:1},{x:332.67970784505206,y:283.19010416666663,step:1},{x:332.67970784505206,y:276.59635416666663,step:1},{x:332.67970784505206,y:271.4739990234375,step:1},{x:334.380859375,y:266.390625,step:1},{x:337.3665364583333,y:263.19791666666663,step:1},{x:339.74806722005206,y:260.6796875,step:1},{x:342.9987386067708,y:259.16666666666663,step:1},{x:346.6653645833333,y:259.16666666666663,step:1},{x:353.3938802083333,y:259.16666666666663,step:1},{x:356.94730631510413,y:264.2083333333333,step:1},{x:356.94730631510413,y:270.96875,step:1},{x:356.94730631510413,y:276.1354573567708,step:1},{x:355.3216145833333,y:281.17447916666663,step:1},{x:352.4107666015625,y:284.3255208333333,step:1},{x:350.0292561848958,y:286.8880615234375,step:1},{x:346.8170979817708,y:288.3984375,step:1},{x:343.0364583333333,y:288.3984375,step:1},{x:342.9987386067708,y:288.3984375,step:0},{x:343.79296875,y:283.35941569010413,step:2},{x:345.4185791015625,y:283.35941569010413,step:1},{x:346.892578125,y:282.6015625,step:1},{x:348.0638020833333,y:281.3021240234375,step:1},{x:350.06705729166663,y:279.0755208333333,step:1},{x:351.1634114583333,y:274.4140625,step:1},{x:351.1634114583333,y:271.13798014322913,step:1},{x:351.1634114583333,y:267.609375,step:1},{x:350.0292561848958,y:264.2083333333333,step:1},{x:346.0227864583333,y:264.2083333333333,step:1},{x:344.3216552734375,y:264.2083333333333,step:1},{x:342.8098958333333,y:265.00516764322913,step:1},{x:341.6380208333333,y:266.34891764322913,step:1},{x:339.5970052083333,y:268.5755208333333,step:1},{x:338.46291097005206,y:272.9843343098958,step:1},{x:338.46291097005206,y:276.3880208333333,step:1},{x:338.46291097005206,y:280.3775634765625,step:1},{x:340.087890625,y:283.35941569010413,step:1},{x:343.75455729166663,y:283.35941569010413,step:1},{x:343.79296875,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:379.5130208333333,y:287.9374593098958,step:2},{x:381.06315104166663,y:276.26041666666663,step:0},{x:381.478515625,y:273.1953125,step:1},{x:382.04557291666663,y:269.33072916666663,step:1},{x:382.76371256510413,y:265.2161865234375,step:1},{x:382.6503499348958,y:265.2161865234375,step:0},{x:381.2519124348958,y:268.8671875,step:1},{x:379.66471354166663,y:272.7734375,step:1},{x:378.26627604166663,y:275.88285319010413,step:1},{x:373.04886881510413,y:287.4739990234375,step:0},{x:368.8157958984375,y:287.4739990234375,step:0},{x:367.908203125,y:276.00785319010413,step:0},{x:367.68168131510413,y:272.90104166666663,step:1},{x:367.4928792317708,y:268.9948323567708,step:1},{x:367.34183756510413,y:265.2161865234375,step:1},{x:367.26627604166663,y:265.2161865234375,step:0},{x:366.54752604166663,y:268.953125,step:1},{x:365.79166666666663,y:273.2369384765625,step:1},{x:365.14908854166663,y:276.26041666666663,step:1},{x:362.6165364583333,y:287.9374593098958,step:0},{x:357.626953125,y:287.9374593098958,step:0},{x:364.0150146484375,y:259.6302083333333,step:0},{x:371.3105061848958,y:259.6302083333333,step:0},{x:372.10416666666663,y:270.42191569010413,step:0},{x:372.255859375,y:273.06766764322913,step:1},{x:372.5201416015625,y:276.26041666666663,step:1},{x:372.5579427083333,y:279.4114583333333,step:1},{x:372.708984375,y:279.4114583333333,step:0},{x:373.69205729166663,y:276.26041666666663,step:1},{x:375.052734375,y:272.9427083333333,step:1},{x:376.1491292317708,y:270.3802083333333,step:1},{x:380.87369791666663,y:259.6302083333333,step:0},{x:388.2447509765625,y:259.6302083333333,step:0},{x:384.80533854166663,y:287.9374593098958,step:0},{x:379.5130208333333,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:393.99027506510413,y:260.1328125,step:2},{x:395.6536865234375,y:259.6718343098958,step:1},{x:398.1862386067708,y:259.4192708333333,step:1},{x:400.64322916666663,y:259.4192708333333,step:1},{x:402.94921875,y:259.4192708333333,step:1},{x:405.5572509765625,y:259.83854166666663,step:1},{x:407.40946451822913,y:261.3098958333333,step:1},{x:409.1484375,y:262.56766764322913,step:1},{x:410.1692708333333,y:264.5859375,step:1},{x:410.1692708333333,y:267.31510416666663,step:1},{x:410.1692708333333,y:270.8854573567708,step:1},{x:408.6946614583333,y:273.6145833333333,step:1},{x:406.72855631510413,y:275.2942708333333,step:1},{x:404.6503499348958,y:277.1015625,step:1},{x:401.66410319010413,y:277.94010416666663,step:1},{x:398.5644124348958,y:277.94010416666663,step:1},{x:397.656982421875,y:277.94010416666663,step:1},{x:396.9010823567708,y:277.81510416666663,step:1},{x:396.333984375,y:277.7734375,step:1},{x:394.59574381510413,y:287.9374593098958,step:0},{x:389.26566569010413,y:287.9374593098958,step:0},{x:393.99027506510413,y:260.1328125,step:0},{x:397.1659749348958,y:272.8177083333333,step:2},{x:397.73246256510413,y:272.9427083333333,step:1},{x:398.337890625,y:273.02604166666663,step:1},{x:399.28251139322913,y:273.02604166666663,step:1},{x:402.5331624348958,y:273.02604166666663,step:1},{x:404.68815104166663,y:270.6745198567708,step:1},{x:404.68815104166663,y:267.859375,step:1},{x:404.68815104166663,y:265.1302083333333,step:1},{x:402.91141764322913,y:264.25,step:1},{x:400.8326416015625,y:264.25,step:1},{x:399.81180826822913,y:264.25,step:1},{x:399.05533854166663,y:264.3333333333333,step:1},{x:398.60221354166663,y:264.4167073567708,step:1},{x:397.1659749348958,y:272.8177083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:415.421875,y:259.6302083333333,step:2},{x:420.8645833333333,y:259.6302083333333,step:0},{x:416.9348958333333,y:282.64579264322913,step:0},{x:426.7239583333333,y:282.64579264322913,step:0},{x:425.8177083333333,y:287.9374593098958,step:0},{x:410.58329264322913,y:287.9374593098958,step:0},{x:415.421875,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.54947916666663,y:275.88285319010413,step:2},{x:436.515625,y:275.88285319010413,step:0},{x:435.3437093098958,y:282.7708333333333,step:0},{x:445.51041666666663,y:282.7708333333333,step:0},{x:444.6419270833333,y:287.9374593098958,step:0},{x:428.9921875,y:287.9374593098958,step:0},{x:433.83072916666663,y:259.6302083333333,step:0},{x:448.9127197265625,y:259.6302083333333,step:0},{x:448.00516764322913,y:264.7942708333333,step:0},{x:438.4036458333333,y:264.7942708333333,step:0},{x:437.34635416666663,y:270.8021240234375,step:0},{x:446.45572916666663,y:270.8021240234375,step:0},{x:445.54947916666663,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:457.0780843098958,y:264.92191569010413,step:2},{x:450.3489990234375,y:264.92191569010413,step:0},{x:451.2942708333333,y:259.6302083333333,step:0},{x:470.2317708333333,y:259.6302083333333,step:0},{x:469.32548014322913,y:264.92191569010413,step:0},{x:462.5208333333333,y:264.92191569010413,step:0},{x:458.58988444010413,y:287.9374593098958,step:0},{x:453.1458333333333,y:287.9374593098958,step:0},{x:457.0780843098958,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:485.0130208333333,y:275.88285319010413,step:2},{x:475.97782389322913,y:275.88285319010413,step:0},{x:474.8059895833333,y:282.7708333333333,step:0},{x:484.9739583333333,y:282.7708333333333,step:0},{x:484.10416666666663,y:287.9374593098958,step:0},{x:468.45572916666663,y:287.9374593098958,step:0},{x:473.2942708333333,y:259.6302083333333,step:0},{x:488.37504069010413,y:259.6302083333333,step:0},{x:487.46875,y:264.7942708333333,step:0},{x:477.8671875,y:264.7942708333333,step:0},{x:476.8098958333333,y:270.8021240234375,step:0},{x:485.9192708333333,y:270.8021240234375,step:0},{x:485.0130208333333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:492.76041666666663,y:260.04947916666663,step:2},{x:494.953125,y:259.6302083333333,step:1},{x:497.33463541666663,y:259.4192708333333,step:1},{x:499.8294270833333,y:259.4192708333333,step:1},{x:503.7981770833333,y:259.4192708333333,step:1},{x:506.9348958333333,y:260.42704264322913,step:1},{x:509.0911458333333,y:262.4843343098958,step:1},{x:511.1692708333333,y:264.3333333333333,step:1},{x:512.4544270833333,y:267.14579264322913,step:1},{x:512.4544270833333,y:271.34635416666663,step:1},{x:512.4544270833333,y:276.8073323567708,step:1},{x:510.37504069010413,y:281.5521240234375,step:1},{x:507.2382405598958,y:284.3671875,step:1},{x:504.28910319010413,y:287.01298014322913,step:1},{x:500.546875,y:288.1458333333333,step:1},{x:495.0286865234375,y:288.1458333333333,step:1},{x:491.9661458333333,y:288.1458333333333,step:1},{x:489.3203125,y:287.8515218098958,step:1},{x:488.03641764322913,y:287.5598958333333,step:1},{x:492.76041666666663,y:260.04947916666663,step:0},{x:494.3099365234375,y:283.1067708333333,step:2},{x:494.953125,y:283.19010416666663,step:1},{x:495.7473958333333,y:283.2317708333333,step:1},{x:496.6927083333333,y:283.2317708333333,step:1},{x:499.640625,y:283.2317708333333,step:1},{x:502.2473958333333,y:282.0573323567708,step:1},{x:503.91141764322913,y:279.95572916666663,step:1},{x:505.6510823567708,y:277.7317708333333,step:1},{x:506.5572509765625,y:274.7916259765625,step:1},{x:506.5572509765625,y:271.3880615234375,step:1},{x:506.5572509765625,y:266.8958740234375,step:1},{x:504.32816569010413,y:264.25,step:1},{x:499.8294270833333,y:264.25,step:1},{x:498.8841145833333,y:264.25,step:1},{x:498.0911458333333,y:264.3333333333333,step:1},{x:497.52347819010413,y:264.45829264322913,step:1},{x:494.3099365234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],kh=[{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:306.875,y:287.13798014322913,step:2},{x:305.51434326171875,y:287.80985514322913,step:1},{x:303.24609375,y:288.35673014322913,step:1},{x:300.1848958333333,y:288.35673014322913,step:1},{x:293.41861979166663,y:288.35673014322913,step:1},{x:288.91994222005206,y:283.8203125,step:1},{x:288.91994222005206,y:276.3437093098958,step:1},{x:288.91994222005206,y:269.9609375,step:1},{x:291.490234375,y:265.046875,step:1},{x:295.34637451171875,y:262.1901448567708,step:1},{x:297.9921875,y:260.1745198567708,step:1},{x:301.0917765299479,y:259.2083333333333,step:1},{x:304.6829427083333,y:259.2083333333333,step:1},{x:307.44207763671875,y:259.2083333333333,step:1},{x:309.52150472005206,y:259.92191569010413,step:1},{x:310.2766927083333,y:260.38541666666663,step:1},{x:308.7649943033854,y:265.29947916666663,step:0},{x:308.04689534505206,y:264.8802490234375,step:1},{x:306.345703125,y:264.3749593098958,step:1},{x:304.1536458333333,y:264.3749593098958,step:1},{x:301.9609375,y:264.3749593098958,step:1},{x:299.88214111328125,y:265.1302083333333,step:1},{x:298.3320109049479,y:266.5598958333333,step:1},{x:296.21549479166663,y:268.4895833333333,step:1},{x:294.81705729166663,y:271.7239583333333,step:1},{x:294.81705729166663,y:275.6718343098958,step:1},{x:294.81705729166663,y:280.16666666666663,step:1},{x:297.123046875,y:283.19010416666663,step:1},{x:301.5833536783854,y:283.19010416666663,step:1},{x:303.3977864583333,y:283.19010416666663,step:1},{x:305.17384847005206,y:282.85416666666663,step:1},{x:306.4212239583333,y:282.265625,step:1},{x:306.875,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:320.3320109049479,y:288.3984375,step:2},{x:313.71744791666663,y:288.3984375,step:1},{x:310.0130411783854,y:283.19010416666663,step:1},{x:310.0130411783854,y:276.59635416666663,step:1},{x:310.0130411783854,y:271.4739990234375,step:1},{x:311.7141927083333,y:266.390625,step:1},{x:314.69986979166663,y:263.19791666666663,step:1},{x:317.0814005533854,y:260.6796875,step:1},{x:320.3320109049479,y:259.16666666666663,step:1},{x:323.99867757161456,y:259.16666666666663,step:1},{x:330.72721354166663,y:259.16666666666663,step:1},{x:334.28057861328125,y:264.2083333333333,step:1},{x:334.28057861328125,y:270.96875,step:1},{x:334.28057861328125,y:276.1354573567708,step:1},{x:332.65494791666663,y:281.17447916666663,step:1},{x:329.74416097005206,y:284.3255208333333,step:1},{x:327.3626505533854,y:286.8880615234375,step:1},{x:324.150390625,y:288.3984375,step:1},{x:320.36981201171875,y:288.3984375,step:1},{x:320.3320109049479,y:288.3984375,step:0},{x:321.1263020833333,y:283.35941569010413,step:2},{x:322.751953125,y:283.35941569010413,step:1},{x:324.2259114583333,y:282.6015625,step:1},{x:325.39711507161456,y:281.3021240234375,step:1},{x:327.400390625,y:279.0755208333333,step:1},{x:328.49676513671875,y:274.4140625,step:1},{x:328.49676513671875,y:271.13798014322913,step:1},{x:328.49676513671875,y:267.609375,step:1},{x:327.3626505533854,y:264.2083333333333,step:1},{x:323.35611979166663,y:264.2083333333333,step:1},{x:321.65494791666663,y:264.2083333333333,step:1},{x:320.14322916666663,y:265.00516764322913,step:1},{x:318.97135416666663,y:266.34891764322913,step:1},{x:316.93033854166663,y:268.5755208333333,step:1},{x:315.7962443033854,y:272.9843343098958,step:1},{x:315.7962443033854,y:276.3880208333333,step:1},{x:315.7962443033854,y:280.3775634765625,step:1},{x:317.4212239583333,y:283.35941569010413,step:1},{x:321.087890625,y:283.35941569010413,step:1},{x:321.1263020833333,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:335.56512451171875,y:287.9374593098958,step:2},{x:340.4036458333333,y:259.6302083333333,step:0},{x:346.79166666666663,y:259.6302083333333,step:0},{x:350.1556396484375,y:270.42191569010413,step:0},{x:351.17643229166663,y:274.03385416666663,step:1},{x:351.8573811848958,y:276.9739583333333,step:1},{x:352.46158854166663,y:280.0833740234375,step:1},{x:352.57486979166663,y:280.0833740234375,step:0},{x:352.6888427734375,y:277.18485514322913,step:1},{x:353.06640625,y:274.0755208333333,step:1},{x:353.74674479166663,y:269.9192708333333,step:1},{x:355.4857177734375,y:259.6302083333333,step:0},{x:360.58854166666663,y:259.6302083333333,step:0},{x:355.75,y:287.9374593098958,step:0},{x:350.11783854166663,y:287.9374593098958,step:0},{x:346.5650634765625,y:276.6380208333333,step:0},{x:345.4309895833333,y:272.7734375,step:1},{x:344.75065104166663,y:270.2135823567708,step:1},{x:344.0697021484375,y:266.7682698567708,step:1},{x:343.9563802083333,y:266.7682698567708,step:0},{x:343.69205729166663,y:269.54166666666663,step:1},{x:343.0872395833333,y:273.53129069010413,step:1},{x:342.3313802083333,y:278.0234375,step:1},{x:340.63087972005206,y:287.9374593098958,step:0},{x:335.56512451171875,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.57743326822913,y:259.6302083333333,step:2},{x:380.50846354166663,y:259.6302083333333,step:0},{x:379.6009521484375,y:264.7942708333333,step:0},{x:370.1516927083333,y:264.7942708333333,step:0},{x:368.9798177083333,y:271.42972819010413,step:0},{x:377.86258951822913,y:271.42972819010413,step:0},{x:376.9557698567708,y:276.51298014322913,step:0},{x:368.11063639322913,y:276.51298014322913,step:0},{x:366.1823323567708,y:287.9374593098958,step:0},{x:360.7395833333333,y:287.9374593098958,step:0},{x:365.57743326822913,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.22265625,y:259.6302083333333,step:2},{x:385.3847249348958,y:287.9374593098958,step:0},{x:379.94071451822913,y:287.9374593098958,step:0},{x:384.7792561848958,y:259.6302083333333,step:0},{x:390.22265625,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:395.1737874348958,y:260.04947916666663,step:2},{x:397.36649576822913,y:259.6302083333333,step:1},{x:399.748046875,y:259.4192708333333,step:1},{x:402.24283854166663,y:259.4192708333333,step:1},{x:406.21158854166663,y:259.4192708333333,step:1},{x:409.3489990234375,y:260.42704264322913,step:1},{x:411.50260416666663,y:262.4843343098958,step:1},{x:413.58329264322913,y:264.3333333333333,step:1},{x:414.8671875,y:267.14579264322913,step:1},{x:414.8671875,y:271.34635416666663,step:1},{x:414.8671875,y:276.8073323567708,step:1},{x:412.7890625,y:281.5521240234375,step:1},{x:409.6510823567708,y:284.3671875,step:1},{x:406.7030843098958,y:287.01298014322913,step:1},{x:402.9609375,y:288.1458333333333,step:1},{x:397.4420166015625,y:288.1458333333333,step:1},{x:394.380859375,y:288.1458333333333,step:1},{x:391.734375,y:287.8515218098958,step:1},{x:390.4491780598958,y:287.5598958333333,step:1},{x:395.1737874348958,y:260.04947916666663,step:0},{x:396.7239583333333,y:283.1067708333333,step:2},{x:397.36649576822913,y:283.19010416666663,step:1},{x:398.16015625,y:283.2317708333333,step:1},{x:399.10477701822913,y:283.2317708333333,step:1},{x:402.0540364583333,y:283.2317708333333,step:1},{x:404.662109375,y:282.0573323567708,step:1},{x:406.3249104817708,y:279.95572916666663,step:1},{x:408.0638020833333,y:277.7317708333333,step:1},{x:408.970703125,y:274.7916259765625,step:1},{x:408.970703125,y:271.3880615234375,step:1},{x:408.970703125,y:266.8958740234375,step:1},{x:406.74088541666663,y:264.25,step:1},{x:402.24283854166663,y:264.25,step:1},{x:401.2974853515625,y:264.25,step:1},{x:400.5038655598958,y:264.3333333333333,step:1},{x:399.9368489583333,y:264.45829264322913,step:1},{x:396.7239583333333,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:432.7096761067708,y:275.88285319010413,step:2},{x:423.67447916666663,y:275.88285319010413,step:0},{x:422.50260416666663,y:282.7708333333333,step:0},{x:432.6718343098958,y:282.7708333333333,step:0},{x:431.80204264322913,y:287.9374593098958,step:0},{x:416.1536865234375,y:287.9374593098958,step:0},{x:420.9921875,y:259.6302083333333,step:0},{x:436.07291666666663,y:259.6302083333333,step:0},{x:435.16666666666663,y:264.7942708333333,step:0},{x:425.56510416666663,y:264.7942708333333,step:0},{x:424.5077718098958,y:270.8021240234375,step:0},{x:433.61722819010413,y:270.8021240234375,step:0},{x:432.7096761067708,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:435.69535319010413,y:287.9374593098958,step:2},{x:440.53385416666663,y:259.6302083333333,step:0},{x:446.921875,y:259.6302083333333,step:0},{x:450.2864583333333,y:270.42191569010413,step:0},{x:451.3072509765625,y:274.03385416666663,step:1},{x:451.98697916666663,y:276.9739583333333,step:1},{x:452.59244791666663,y:280.0833740234375,step:1},{x:452.70572916666663,y:280.0833740234375,step:0},{x:452.8190511067708,y:277.18485514322913,step:1},{x:453.1978759765625,y:274.0755208333333,step:1},{x:453.87760416666663,y:269.9192708333333,step:1},{x:455.61722819010413,y:259.6302083333333,step:0},{x:460.71875,y:259.6302083333333,step:0},{x:455.8802083333333,y:287.9374593098958,step:0},{x:450.24869791666663,y:287.9374593098958,step:0},{x:446.6953125,y:276.6380208333333,step:0},{x:445.56119791666663,y:272.7734375,step:1},{x:444.8802083333333,y:270.2135823567708,step:1},{x:444.2005208333333,y:266.7682698567708,step:1},{x:444.0872395833333,y:266.7682698567708,step:0},{x:443.8228759765625,y:269.54166666666663,step:1},{x:443.21875,y:273.53129069010413,step:1},{x:442.4622802734375,y:278.0234375,step:1},{x:440.76041666666663,y:287.9374593098958,step:0},{x:435.69535319010413,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:469.4127197265625,y:264.92191569010413,step:2},{x:462.6848958333333,y:264.92191569010413,step:0},{x:463.6302490234375,y:259.6302083333333,step:0},{x:482.5677083333333,y:259.6302083333333,step:0},{x:481.65885416666663,y:264.92191569010413,step:0},{x:474.85550944010413,y:264.92191569010413,step:0},{x:470.92447916666663,y:287.9374593098958,step:0},{x:465.4818115234375,y:287.9374593098958,step:0},{x:469.4127197265625,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:490.9583740234375,y:259.6302083333333,step:2},{x:486.1197509765625,y:287.9374593098958,step:0},{x:480.67704264322913,y:287.9374593098958,step:0},{x:485.51566569010413,y:259.6302083333333,step:0},{x:490.9583740234375,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:498.1770833333333,y:280.5859375,step:2},{x:495.1913655598958,y:287.9374593098958,step:0},{x:489.3697509765625,y:287.9374593098958,step:0},{x:501.8072509765625,y:259.6302083333333,step:0},{x:508.79947916666663,y:259.6302083333333,step:0},{x:511.7473958333333,y:287.9374593098958,step:0},{x:506.0403645833333,y:287.9374593098958,step:0},{x:505.51041666666663,y:280.5859375,step:0},{x:498.1770833333333,y:280.5859375,step:0},{x:505.28385416666663,y:275.9661458333333,step:2},{x:504.79166666666663,y:269.87760416666663,step:0},{x:504.6796875,y:268.3229573567708,step:1},{x:504.5650634765625,y:266.05472819010413,step:1},{x:504.4530843098958,y:264.3333333333333,step:1},{x:504.3385009765625,y:264.3333333333333,step:0},{x:503.6966552734375,y:266.05472819010413,step:1},{x:502.9792073567708,y:268.2396240234375,step:1},{x:502.2981770833333,y:269.87760416666663,step:1},{x:499.80204264322913,y:275.9661458333333,step:0},{x:505.28385416666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:519.3463541666666,y:259.6302083333333,step:2},{x:524.7890625,y:259.6302083333333,step:0},{x:520.8568115234375,y:282.64579264322913,step:0},{x:530.6484375,y:282.64579264322913,step:0},{x:529.7395833333333,y:287.9374593098958,step:0},{x:514.5077718098958,y:287.9374593098958,step:0},{x:519.3463541666666,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Dh=[{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:356.54886881510413,y:260.048828125,step:2},{x:358.7415364583333,y:259.6288655598958,step:1},{x:361.12308756510413,y:259.41861979166663,step:1},{x:363.61722819010413,y:259.41861979166663,step:1},{x:367.5865478515625,y:259.41861979166663,step:1},{x:370.7239583333333,y:260.42704264322913,step:1},{x:372.8782552083333,y:262.4849853515625,step:1},{x:374.9577229817708,y:264.33268229166663,step:1},{x:376.24283854166663,y:267.146484375,step:1},{x:376.24283854166663,y:271.3470052083333,step:1},{x:376.24283854166663,y:276.8073323567708,step:1},{x:374.1634114583333,y:281.5521240234375,step:1},{x:371.0267333984375,y:284.3671875,step:1},{x:368.07743326822913,y:287.01298014322913,step:1},{x:364.3352864583333,y:288.1458333333333,step:1},{x:358.8170979817708,y:288.1458333333333,step:1},{x:355.7552083333333,y:288.1458333333333,step:1},{x:353.10868326822913,y:287.85282389322913,step:1},{x:351.8235677083333,y:287.5598958333333,step:1},{x:356.54886881510413,y:260.048828125,step:0},{x:358.0989990234375,y:283.1067708333333,step:2},{x:358.7415364583333,y:283.19010416666663,step:1},{x:359.53515625,y:283.2317708333333,step:1},{x:360.47977701822913,y:283.2317708333333,step:1},{x:363.4284261067708,y:283.2317708333333,step:1},{x:366.0370686848958,y:282.0573323567708,step:1},{x:367.69986979166663,y:279.9569905598958,step:1},{x:369.4388020833333,y:277.7317708333333,step:1},{x:370.34574381510413,y:274.7916259765625,step:1},{x:370.34574381510413,y:271.38871256510413,step:1},{x:370.34574381510413,y:266.8952229817708,step:1},{x:368.1158447265625,y:264.24869791666663,step:1},{x:363.61722819010413,y:264.24869791666663,step:1},{x:362.67252604166663,y:264.24869791666663,step:1},{x:361.8782552083333,y:264.33268229166663,step:1},{x:361.31180826822913,y:264.458984375,step:1},{x:358.0989990234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:382.3288167317708,y:260.1335042317708,step:2},{x:384.0292561848958,y:259.67057291666663,step:1},{x:386.599609375,y:259.41861979166663,step:1},{x:389.1321614583333,y:259.41861979166663,step:1},{x:391.5520833333333,y:259.41861979166663,step:1},{x:394.0462239583333,y:259.79752604166663,step:1},{x:395.8228759765625,y:261.056640625,step:1},{x:397.48636881510413,y:262.1491292317708,step:1},{x:398.658203125,y:263.91276041666663,step:1},{x:398.658203125,y:266.5592854817708,step:1},{x:398.658203125,y:270.7591145833333,step:1},{x:396.1634114583333,y:273.4049072265625,step:1},{x:392.8743489583333,y:274.58072916666663,step:1},{x:392.8743489583333,y:274.70703125,step:0},{x:394.38671875,y:275.46354166666663,step:1},{x:395.06705729166663,y:277.3098958333333,step:1},{x:395.2942708333333,y:279.8723958333333,step:1},{x:395.6341145833333,y:283.06510416666663,step:1},{x:395.8228759765625,y:286.76041666666663,step:1},{x:396.2766927083333,y:287.9374593098958,step:1},{x:390.6823323567708,y:287.9374593098958,step:0},{x:390.45572916666663,y:287.18094889322913,step:1},{x:390.1907552083333,y:284.74479166666663,step:1},{x:389.96415201822913,y:281.2591145833333,step:1},{x:389.69921875,y:277.81510416666663,step:1},{x:388.6412353515625,y:276.765625,step:1},{x:386.486328125,y:276.765625,step:1},{x:384.8236083984375,y:276.765625,step:0},{x:382.9329427083333,y:287.9374593098958,step:0},{x:377.5657958984375,y:287.9374593098958,step:0},{x:382.3288167317708,y:260.1335042317708,step:0},{x:385.6549886067708,y:272.22855631510413,step:2},{x:387.88541666666663,y:272.22855631510413,step:0},{x:390.833984375,y:272.22855631510413,step:1},{x:392.9876708984375,y:270.25455729166663,step:1},{x:392.9876708984375,y:267.48246256510413,step:1},{x:392.9876708984375,y:265.1731770833333,step:1},{x:391.287109375,y:264.16471354166663,step:1},{x:389.0950520833333,y:264.16471354166663,step:1},{x:388.07421875,y:264.16471354166663,step:1},{x:387.431640625,y:264.24869791666663,step:1},{x:386.978515625,y:264.3749593098958,step:1},{x:385.6549886067708,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:406.9739583333333,y:280.5859375,step:2},{x:403.9876302083333,y:287.9374593098958,step:0},{x:398.1659749348958,y:287.9374593098958,step:0},{x:410.6028645833333,y:259.6288655598958,step:0},{x:417.59635416666663,y:259.6288655598958,step:0},{x:420.5442708333333,y:287.9374593098958,step:0},{x:414.8359375,y:287.9374593098958,step:0},{x:414.30729166666663,y:280.5859375,step:0},{x:406.9739583333333,y:280.5859375,step:0},{x:414.08072916666663,y:275.9661458333333,step:2},{x:413.58854166666663,y:269.8769124348958,step:0},{x:413.4753011067708,y:268.3229573567708,step:1},{x:413.36197916666663,y:266.0553792317708,step:1},{x:413.24869791666663,y:264.33268229166663,step:1},{x:413.1353759765625,y:264.33268229166663,step:0},{x:412.4921468098958,y:266.0553792317708,step:1},{x:411.7734375,y:268.2389729817708,step:1},{x:411.0937093098958,y:269.8769124348958,step:1},{x:408.599609375,y:275.9661458333333,step:0},{x:414.08072916666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:428.1419677734375,y:259.6288655598958,step:2},{x:443.07291666666663,y:259.6288655598958,step:0},{x:442.1653645833333,y:264.79496256510413,step:0},{x:432.71610514322913,y:264.79496256510413,step:0},{x:431.5442708333333,y:271.4309895833333,step:0},{x:440.42704264322913,y:271.4309895833333,step:0},{x:439.51822916666663,y:276.51298014322913,step:0},{x:430.67447916666663,y:276.51298014322913,step:0},{x:428.7460530598958,y:287.9374593098958,step:0},{x:423.3033447265625,y:287.9374593098958,step:0},{x:428.1419677734375,y:259.6288655598958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:451.1614583333333,y:264.9206136067708,step:2},{x:444.43229166666663,y:264.9206136067708,step:0},{x:445.37760416666663,y:259.6288655598958,step:0},{x:464.3151448567708,y:259.6288655598958,step:0},{x:463.40885416666663,y:264.9206136067708,step:0},{x:456.6041259765625,y:264.9206136067708,step:0},{x:452.6731770833333,y:287.9374593098958,step:0},{x:447.22916666666663,y:287.9374593098958,step:0},{x:451.1614583333333,y:264.9206136067708,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Eh=[{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01236979166666,step:0},{x:347.61588541666663,y:248.14583333333331,step:1},{x:352.7974853515625,y:243.345703125,step:1},{x:359.1308186848958,y:243.345703125,step:1},{x:458.4973958333333,y:243.345703125,step:0},{x:464.83203125,y:243.345703125,step:1},{x:470.0130208333333,y:248.14583333333331,step:1},{x:470.0130208333333,y:254.01236979166666,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01302083333331,step:0},{x:347.61588541666663,y:248.14652506510416,step:1},{x:352.7974853515625,y:243.34635416666666,step:1},{x:359.1308186848958,y:243.34635416666666,step:1},{x:458.4973958333333,y:243.34635416666666,step:0},{x:464.83203125,y:243.34635416666666,step:1},{x:470.0130208333333,y:248.14652506510416,step:1},{x:470.0130208333333,y:254.01302083333331,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.95768229166663,y:259.62955729166663,step:2},{x:380.888671875,y:259.62955729166663,step:0},{x:379.9810791015625,y:264.79496256510413,step:0},{x:370.5318603515625,y:264.79496256510413,step:0},{x:369.36002604166663,y:271.431640625,step:0},{x:378.24283854166663,y:271.431640625,step:0},{x:377.3359375,y:276.51298014322913,step:0},{x:368.4908447265625,y:276.51298014322913,step:0},{x:366.5625,y:287.9374593098958,step:0},{x:361.1197509765625,y:287.9374593098958,step:0},{x:365.95768229166663,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.6028645833333,y:259.62955729166663,step:2},{x:385.76493326822913,y:287.9374593098958,step:0},{x:380.3210042317708,y:287.9374593098958,step:0},{x:385.1595052083333,y:259.62955729166663,step:0},{x:390.6028645833333,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.79166666666663,y:287.9374593098958,step:2},{x:395.62955729166663,y:259.62955729166663,step:0},{x:402.01822916666663,y:259.62955729166663,step:0},{x:405.3822021484375,y:270.423828125,step:0},{x:406.4030354817708,y:274.03641764322913,step:1},{x:407.0833333333333,y:276.9739583333333,step:1},{x:407.68815104166663,y:280.0833740234375,step:1},{x:407.8013916015625,y:280.0833740234375,step:0},{x:407.91471354166663,y:277.18485514322913,step:1},{x:408.29300944010413,y:274.078125,step:1},{x:408.97330729166663,y:269.91861979166663,step:1},{x:410.7109375,y:259.62955729166663,step:0},{x:415.81510416666663,y:259.62955729166663,step:0},{x:410.97660319010413,y:287.9374593098958,step:0},{x:405.34440104166663,y:287.9374593098958,step:0},{x:401.79166666666663,y:276.6380208333333,step:0},{x:400.6569417317708,y:272.775390625,step:1},{x:399.9771728515625,y:270.212890625,step:1},{x:399.2962239583333,y:266.7689208984375,step:1},{x:399.18290201822913,y:266.7689208984375,step:0},{x:398.9185791015625,y:269.541015625,step:1},{x:398.31315104166663,y:273.53129069010413,step:1},{x:397.5579427083333,y:278.0260823567708,step:1},{x:395.8567708333333,y:287.9374593098958,step:0},{x:390.79166666666663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.9974365234375,y:280.5859375,step:2},{x:420.0103759765625,y:287.9374593098958,step:0},{x:414.1888427734375,y:287.9374593098958,step:0},{x:426.625,y:259.62955729166663,step:0},{x:433.61722819010413,y:259.62955729166663,step:0},{x:436.5677083333333,y:287.9374593098958,step:0},{x:430.859375,y:287.9374593098958,step:0},{x:430.3294270833333,y:280.5859375,step:0},{x:422.9974365234375,y:280.5859375,step:0},{x:430.1028645833333,y:275.9661458333333,step:2},{x:429.61197916666663,y:269.8769124348958,step:0},{x:429.4973958333333,y:268.322265625,step:1},{x:429.38541666666663,y:266.0553792317708,step:1},{x:429.27079264322913,y:264.33268229166663,step:1},{x:429.15751139322913,y:264.33268229166663,step:0},{x:428.515625,y:266.0553792317708,step:1},{x:427.796875,y:268.2389729817708,step:1},{x:427.1171468098958,y:269.8769124348958,step:1},{x:424.6223958333333,y:275.9661458333333,step:0},{x:430.1028645833333,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:444.1640625,y:259.62955729166663,step:2},{x:449.6068115234375,y:259.62955729166663,step:0},{x:445.67704264322913,y:282.64579264322913,step:0},{x:455.4661458333333,y:282.64579264322913,step:0},{x:454.5598958333333,y:287.9374593098958,step:0},{x:439.32548014322913,y:287.9374593098958,step:0},{x:444.1640625,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Ih=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,50,130,1)",background:"linear-gradient(to right bottom, #ccc2ff, #8677c7)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.35221354166663,y:267.82421875,step:2},{x:384.50846354166663,y:278.6067708333333,step:0},{x:382.435546875,y:278.6067708333333,step:0},{x:384.27799479166663,y:267.82421875,step:0},{x:386.35221354166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.4237874348958,y:278.6067708333333,step:2},{x:388.2669677734375,y:267.82421875,step:0},{x:390.7005208333333,y:267.82421875,step:0},{x:391.982421875,y:271.935546875,step:0},{x:392.37113444010413,y:273.3118489583333,step:1},{x:392.6302490234375,y:274.4322509765625,step:1},{x:392.8606770833333,y:275.6145833333333,step:1},{x:392.9036458333333,y:275.6145833333333,step:0},{x:392.94730631510413,y:274.51298014322913,step:1},{x:393.0911458333333,y:273.32816569010413,step:1},{x:393.3503011067708,y:271.744140625,step:1},{x:394.0124104817708,y:267.82421875,step:0},{x:395.9563802083333,y:267.82421875,step:0},{x:394.1132405598958,y:278.6067708333333,step:0},{x:391.9680989583333,y:278.6067708333333,step:0},{x:390.61393229166663,y:274.3046468098958,step:0},{x:390.1823323567708,y:272.83203125,step:1},{x:389.9232177734375,y:271.8561604817708,step:1},{x:389.66410319010413,y:270.5435791015625,step:1},{x:389.6204833984375,y:270.5435791015625,step:0},{x:389.52018229166663,y:271.599609375,step:1},{x:389.28971354166663,y:273.11979166666663,step:1},{x:389.0013020833333,y:274.83203125,step:1},{x:388.353515625,y:278.6067708333333,step:0},{x:386.4237874348958,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.88736979166663,y:267.82421875,step:2},{x:398.0442708333333,y:278.6067708333333,step:0},{x:395.970703125,y:278.6067708333333,step:0},{x:397.8138020833333,y:267.82421875,step:0},{x:399.88736979166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:403.2141927083333,y:269.83984375,step:2},{x:400.65104166666663,y:269.83984375,step:0},{x:401.0110677083333,y:267.82421875,step:0},{x:408.22526041666663,y:267.82421875,step:0},{x:407.87955729166663,y:269.83984375,step:0},{x:405.28776041666663,y:269.83984375,step:0},{x:403.7897542317708,y:278.6067708333333,step:0},{x:401.71610514322913,y:278.6067708333333,step:0},{x:403.2141927083333,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:411.421875,y:267.82421875,step:2},{x:409.5780843098958,y:278.6067708333333,step:0},{x:407.50455729166663,y:278.6067708333333,step:0},{x:409.3489990234375,y:267.82421875,step:0},{x:411.421875,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:414.1718343098958,y:275.80729166666663,step:2},{x:413.0338948567708,y:278.6067708333333,step:0},{x:410.8177490234375,y:278.6067708333333,step:0},{x:415.55472819010413,y:267.82421875,step:0},{x:418.21875,y:267.82421875,step:0},{x:419.3411458333333,y:278.6067708333333,step:0},{x:417.16666666666663,y:278.6067708333333,step:0},{x:416.9661458333333,y:275.80729166666663,step:0},{x:414.1718343098958,y:275.80729166666663,step:0},{x:416.8802083333333,y:274.04691569010413,step:2},{x:416.6927083333333,y:271.7278645833333,step:0},{x:416.6484375,y:271.1360677083333,step:1},{x:416.6054280598958,y:270.2714436848958,step:1},{x:416.5625,y:269.61588541666663,step:1},{x:416.5181884765625,y:269.61588541666663,step:0},{x:416.27347819010413,y:270.2714436848958,step:1},{x:416,y:271.1034749348958,step:1},{x:415.7421875,y:271.7278645833333,step:1},{x:414.79166666666663,y:274.04691569010413,step:0},{x:416.8802083333333,y:274.04691569010413,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.2357177734375,y:267.82421875,step:2},{x:424.3099365234375,y:267.82421875,step:0},{x:422.81254069010413,y:276.5911458333333,step:0},{x:426.5417073567708,y:276.5911458333333,step:0},{x:426.19535319010413,y:278.6067708333333,step:0},{x:420.39322916666663,y:278.6067708333333,step:0},{x:422.2357177734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Rh=[{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,0.2)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:281.60611979166663,y:288,step:2},{x:286.44403076171875,y:259.69205729166663,step:0},{x:292.83270263671875,y:259.69205729166663,step:0},{x:296.1966145833333,y:270.4856770833333,step:0},{x:297.21744791666663,y:274.0989583333333,step:1},{x:297.89711507161456,y:277.0377197265625,step:1},{x:298.50260416666663,y:280.1458333333333,step:1},{x:298.61588541666663,y:280.1458333333333,step:0},{x:298.72914632161456,y:277.2473958333333,step:1},{x:299.10744222005206,y:274.14066569010413,step:1},{x:299.78774007161456,y:269.9817708333333,step:1},{x:301.52604166666663,y:259.69205729166663,step:0},{x:306.62957763671875,y:259.69205729166663,step:0},{x:301.791015625,y:288,step:0},{x:296.15887451171875,y:288,step:0},{x:292.60546875,y:276.70182291666663,step:0},{x:291.47137451171875,y:272.837890625,step:1},{x:290.791015625,y:270.27604166666663,step:1},{x:290.1106974283854,y:266.83203125,step:1},{x:289.99737548828125,y:266.83203125,step:0},{x:289.73305257161456,y:269.6041259765625,step:1},{x:289.12760416666663,y:273.59375,step:1},{x:288.3724161783854,y:278.0885823567708,step:1},{x:286.67057291666663,y:288,step:0},{x:281.60611979166663,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:318.19596354166663,y:288.4622395833333,step:2},{x:311.58074951171875,y:288.4622395833333,step:1},{x:307.8763020833333,y:283.25394694010413,step:1},{x:307.8763020833333,y:276.66015625,step:1},{x:307.8763020833333,y:271.5364583333333,step:1},{x:309.57682291666663,y:266.4544270833333,step:1},{x:312.56378173828125,y:263.26236979166663,step:1},{x:314.9446614583333,y:260.7421875,step:1},{x:318.19596354166663,y:259.2298177083333,step:1},{x:321.86195882161456,y:259.2298177083333,step:1},{x:328.5911458333333,y:259.2298177083333,step:1},{x:332.14322916666663,y:264.27018229166663,step:1},{x:332.14322916666663,y:271.0325520833333,step:1},{x:332.14322916666663,y:276.1979573567708,step:1},{x:330.51822916666663,y:281.2369384765625,step:1},{x:327.60805257161456,y:284.3880208333333,step:1},{x:325.2265421549479,y:286.9505615234375,step:1},{x:322.0136515299479,y:288.4622395833333,step:1},{x:318.23307291666663,y:288.4622395833333,step:1},{x:318.19596354166663,y:288.4622395833333,step:0},{x:318.9895833333333,y:283.42191569010413,step:2},{x:320.6145833333333,y:283.42191569010413,step:1},{x:322.08854166666663,y:282.66666666666663,step:1},{x:323.26041666666663,y:281.3645833333333,step:1},{x:325.26430257161456,y:279.13798014322913,step:1},{x:326.3606974283854,y:274.4765218098958,step:1},{x:326.3606974283854,y:271.2005208333333,step:1},{x:326.3606974283854,y:267.6718343098958,step:1},{x:325.2265421549479,y:264.27018229166663,step:1},{x:321.2200520833333,y:264.27018229166663,step:1},{x:319.51822916666663,y:264.27018229166663,step:1},{x:318.00649007161456,y:265.06766764322913,step:1},{x:316.83465576171875,y:266.412109375,step:1},{x:314.79361979166663,y:268.6380208333333,step:1},{x:313.65948486328125,y:273.0481770833333,step:1},{x:313.65948486328125,y:276.4505208333333,step:1},{x:313.65948486328125,y:280.44010416666663,step:1},{x:315.28515625,y:283.42191569010413,step:1},{x:318.95182291666663,y:283.42191569010413,step:1},{x:318.9895833333333,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:340.64906819661456,y:264.98368326822913,step:2},{x:333.92055257161456,y:264.98368326822913,step:0},{x:334.865234375,y:259.69205729166663,step:0},{x:353.8033447265625,y:259.69205729166663,step:0},{x:352.8958740234375,y:264.98368326822913,step:0},{x:346.091796875,y:264.98368326822913,step:0},{x:342.16080729166663,y:288,step:0},{x:336.71744791666663,y:288,step:0},{x:340.64906819661456,y:264.98368326822913,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:366.0124104817708,y:280.64969889322913,step:2},{x:363.02604166666663,y:288,step:0},{x:357.2044270833333,y:288,step:0},{x:369.640625,y:259.69205729166663,step:0},{x:376.6341145833333,y:259.69205729166663,step:0},{x:379.58203125,y:288,step:0},{x:373.8743489583333,y:288,step:0},{x:373.3450520833333,y:280.64969889322913,step:0},{x:366.0124104817708,y:280.64969889322913,step:0},{x:373.11844889322913,y:276.0299886067708,step:2},{x:372.626953125,y:269.94010416666663,step:0},{x:372.513671875,y:268.38602701822913,step:1},{x:372.400390625,y:266.1184895833333,step:1},{x:372.2864583333333,y:264.3958333333333,step:1},{x:372.1731770833333,y:264.3958333333333,step:0},{x:371.5305989583333,y:266.1184895833333,step:1},{x:370.81254069010413,y:268.3020833333333,step:1},{x:370.1321614583333,y:269.94010416666663,step:1},{x:367.63736979166663,y:276.0299886067708,step:0},{x:373.11844889322913,y:276.0299886067708,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:387.06640625,y:260.1966552734375,step:2},{x:388.7292073567708,y:259.7337239583333,step:1},{x:391.2624104817708,y:259.4818115234375,step:1},{x:393.71940104166663,y:259.4818115234375,step:1},{x:396.0247395833333,y:259.4818115234375,step:1},{x:398.63346354166663,y:259.90234375,step:1},{x:400.4856770833333,y:261.3723958333333,step:1},{x:402.22391764322913,y:262.6321614583333,step:1},{x:403.2447509765625,y:264.6477864583333,step:1},{x:403.2447509765625,y:267.37760416666663,step:1},{x:403.2447509765625,y:270.94791666666663,step:1},{x:401.77079264322913,y:273.6783447265625,step:1},{x:399.8052978515625,y:275.35807291666663,step:1},{x:397.7259114583333,y:277.1640625,step:1},{x:394.7395833333333,y:278.00394694010413,step:1},{x:391.6399739583333,y:278.00394694010413,step:1},{x:390.73307291666663,y:278.00394694010413,step:1},{x:389.9771728515625,y:277.87760416666663,step:1},{x:389.41015625,y:277.8359375,step:1},{x:387.6712239583333,y:288,step:0},{x:382.3411458333333,y:288,step:0},{x:387.06640625,y:260.1966552734375,step:0},{x:390.2415364583333,y:272.8802490234375,step:2},{x:390.80863444010413,y:273.0058186848958,step:1},{x:391.4134114583333,y:273.0898030598958,step:1},{x:392.35807291666663,y:273.0898030598958,step:1},{x:395.609375,y:273.0898030598958,step:1},{x:397.763671875,y:270.7382405598958,step:1},{x:397.763671875,y:267.92447916666663,step:1},{x:397.763671875,y:265.19401041666663,step:1},{x:395.98697916666663,y:264.3118489583333,step:1},{x:393.908203125,y:264.3118489583333,step:1},{x:392.8880615234375,y:264.3118489583333,step:1},{x:392.13151041666663,y:264.3958333333333,step:1},{x:391.67838541666663,y:264.4798177083333,step:1},{x:390.2415364583333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.3847249348958,y:260.1966552734375,step:2},{x:410.0481770833333,y:259.7337239583333,step:1},{x:412.58072916666663,y:259.4818115234375,step:1},{x:415.0378011067708,y:259.4818115234375,step:1},{x:417.3437093098958,y:259.4818115234375,step:1},{x:419.9517822265625,y:259.90234375,step:1},{x:421.8033447265625,y:261.3723958333333,step:1},{x:423.5417073567708,y:262.6321614583333,step:1},{x:424.5638020833333,y:264.6477864583333,step:1},{x:424.5638020833333,y:267.37760416666663,step:1},{x:424.5638020833333,y:270.94791666666663,step:1},{x:423.08854166666663,y:273.6783447265625,step:1},{x:421.12369791666663,y:275.35807291666663,step:1},{x:419.0442708333333,y:277.1640625,step:1},{x:416.05729166666663,y:278.00394694010413,step:1},{x:412.9583740234375,y:278.00394694010413,step:1},{x:412.0520833333333,y:278.00394694010413,step:1},{x:411.2956136067708,y:277.87760416666663,step:1},{x:410.7292073567708,y:277.8359375,step:1},{x:408.9896240234375,y:288,step:0},{x:403.66019694010413,y:288,step:0},{x:408.3847249348958,y:260.1966552734375,step:0},{x:411.5598958333333,y:272.8802490234375,step:2},{x:412.12760416666663,y:273.0058186848958,step:1},{x:412.7317708333333,y:273.0898030598958,step:1},{x:413.67704264322913,y:273.0898030598958,step:1},{x:416.9270833333333,y:273.0898030598958,step:1},{x:419.08203125,y:270.7382405598958,step:1},{x:419.08203125,y:267.92447916666663,step:1},{x:419.08203125,y:265.19401041666663,step:1},{x:417.3059895833333,y:264.3118489583333,step:1},{x:415.2265625,y:264.3118489583333,step:1},{x:414.20572916666663,y:264.3118489583333,step:1},{x:413.45048014322913,y:264.3958333333333,step:1},{x:412.9974365234375,y:264.4798177083333,step:1},{x:411.5598958333333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:429.77860514322913,y:260.1966552734375,step:2},{x:431.4792073567708,y:259.7337239583333,step:1},{x:434.0494384765625,y:259.4818115234375,step:1},{x:436.58329264322913,y:259.4818115234375,step:1},{x:439.00260416666663,y:259.4818115234375,step:1},{x:441.4973958333333,y:259.8606770833333,step:1},{x:443.2734375,y:261.11979166666663,step:1},{x:444.9362386067708,y:262.2122395833333,step:1},{x:446.10807291666663,y:263.9759114583333,step:1},{x:446.10807291666663,y:266.6223958333333,step:1},{x:446.10807291666663,y:270.82230631510413,step:1},{x:443.6145833333333,y:273.46879069010413,step:1},{x:440.3255208333333,y:274.64322916666663,step:1},{x:440.3255208333333,y:274.7708333333333,step:0},{x:441.83719889322913,y:275.5260823567708,step:1},{x:442.5181884765625,y:277.37369791666663,step:1},{x:442.7447509765625,y:279.93619791666663,step:1},{x:443.08463541666663,y:283.12760416666663,step:1},{x:443.2734375,y:286.82425944010413,step:1},{x:443.7265625,y:288,step:1},{x:438.1328125,y:288,step:0},{x:437.90625,y:287.24479166666663,step:1},{x:437.640625,y:284.8073323567708,step:1},{x:437.4140625,y:281.3229573567708,step:1},{x:437.1497395833333,y:277.87760416666663,step:1},{x:436.0911458333333,y:276.82816569010413,step:1},{x:433.9374593098958,y:276.82816569010413,step:1},{x:432.27347819010413,y:276.82816569010413,step:0},{x:430.3841145833333,y:288,step:0},{x:425.01566569010413,y:288,step:0},{x:429.77860514322913,y:260.1966552734375,step:0},{x:433.1054280598958,y:272.2916259765625,step:2},{x:435.3359375,y:272.2916259765625,step:0},{x:438.2838948567708,y:272.2916259765625,step:1},{x:440.43876139322913,y:270.31766764322913,step:1},{x:440.43876139322913,y:267.54557291666663,step:1},{x:440.43876139322913,y:265.2362874348958,step:1},{x:438.73697916666663,y:264.2279052734375,step:1},{x:436.5442708333333,y:264.2279052734375,step:1},{x:435.5247395833333,y:264.2279052734375,step:1},{x:434.88151041666663,y:264.3118489583333,step:1},{x:434.42838541666663,y:264.4381103515625,step:1},{x:433.1054280598958,y:272.2916259765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:458.43094889322913,y:288.4622395833333,step:2},{x:451.81510416666663,y:288.4622395833333,step:1},{x:448.1119384765625,y:283.25394694010413,step:1},{x:448.1119384765625,y:276.66015625,step:1},{x:448.1119384765625,y:271.5364583333333,step:1},{x:449.8125,y:266.4544270833333,step:1},{x:452.79947916666663,y:263.26236979166663,step:1},{x:455.1796468098958,y:260.7421875,step:1},{x:458.43094889322913,y:259.2298177083333,step:1},{x:462.09765625,y:259.2298177083333,step:1},{x:468.8255208333333,y:259.2298177083333,step:1},{x:472.3802083333333,y:264.27018229166663,step:1},{x:472.3802083333333,y:271.0325520833333,step:1},{x:472.3802083333333,y:276.1979573567708,step:1},{x:470.75390625,y:281.2369384765625,step:1},{x:467.8437093098958,y:284.3880208333333,step:1},{x:465.4622802734375,y:286.9505615234375,step:1},{x:462.24869791666663,y:288.4622395833333,step:1},{x:458.4687093098958,y:288.4622395833333,step:1},{x:458.43094889322913,y:288.4622395833333,step:0},{x:459.22391764322913,y:283.42191569010413,step:2},{x:460.85026041666663,y:283.42191569010413,step:1},{x:462.32421875,y:282.66666666666663,step:1},{x:463.49609375,y:281.3645833333333,step:1},{x:465.5,y:279.13798014322913,step:1},{x:466.59635416666663,y:274.4765218098958,step:1},{x:466.59635416666663,y:271.2005208333333,step:1},{x:466.59635416666663,y:267.6718343098958,step:1},{x:465.4622802734375,y:264.27018229166663,step:1},{x:461.45572916666663,y:264.27018229166663,step:1},{x:459.75390625,y:264.27018229166663,step:1},{x:458.2421875,y:265.06766764322913,step:1},{x:457.0703125,y:266.412109375,step:1},{x:455.0286865234375,y:268.6380208333333,step:1},{x:453.8958333333333,y:273.0481770833333,step:1},{x:453.8958333333333,y:276.4505208333333,step:1},{x:453.8958333333333,y:280.44010416666663,step:1},{x:455.5208740234375,y:283.42191569010413,step:1},{x:459.1875,y:283.42191569010413,step:1},{x:459.22391764322913,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:478.8046875,y:288,step:2},{x:475.6302490234375,y:259.69205729166663,step:0},{x:481.2630208333333,y:259.69205729166663,step:0},{x:482.3958740234375,y:273.1737874348958,step:0},{x:482.6614583333333,y:276.1979573567708,step:1},{x:482.8489990234375,y:278.9284261067708,step:1},{x:483.0013020833333,y:281.8684895833333,step:1},{x:483.07682291666663,y:281.8684895833333,step:0},{x:484.0208740234375,y:279.09635416666663,step:1},{x:485.23173014322913,y:276.07291666666663,step:1},{x:486.47916666666663,y:273.13151041666663,step:1},{x:492.1862386067708,y:259.69205729166663,step:0},{x:498.27213541666663,y:259.69205729166663,step:0},{x:485.1171468098958,y:288,step:0},{x:478.8046875,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:512.9766031901041,y:275.9466145833333,step:2},{x:503.94266764322913,y:275.9466145833333,step:0},{x:502.7708333333333,y:282.8333333333333,step:0},{x:512.9388020833333,y:282.8333333333333,step:0},{x:512.0690104166666,y:288,step:0},{x:496.4192708333333,y:288,step:0},{x:501.2578125,y:259.69205729166663,step:0},{x:516.3411458333333,y:259.69205729166663,step:0},{x:515.4323323567708,y:264.85807291666663,step:0},{x:505.83203125,y:264.85807291666663,step:0},{x:504.7734375,y:270.8646240234375,step:0},{x:513.8828125,y:270.8646240234375,step:0},{x:512.9766031901041,y:275.9466145833333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:520.7252604166666,y:260.1119384765625,step:2},{x:522.9166259765625,y:259.69205729166663,step:1},{x:525.2994791666666,y:259.4818115234375,step:1},{x:527.7942708333333,y:259.4818115234375,step:1},{x:531.7630208333333,y:259.4818115234375,step:1},{x:534.8997395833333,y:260.4901936848958,step:1},{x:537.0547281901041,y:262.5482177734375,step:1},{x:539.1340738932291,y:264.3958333333333,step:1},{x:540.4192708333333,y:267.20963541666663,step:1},{x:540.4192708333333,y:271.4101155598958,step:1},{x:540.4192708333333,y:276.86979166666663,step:1},{x:538.33984375,y:281.61588541666663,step:1},{x:535.203125,y:284.4296875,step:1},{x:532.25390625,y:287.0755208333333,step:1},{x:528.5116780598958,y:288.20963541666663,step:1},{x:522.9935302734375,y:288.20963541666663,step:1},{x:519.9309895833333,y:288.20963541666663,step:1},{x:517.2851155598958,y:287.91666666666663,step:1},{x:516,y:287.6223958333333,step:1},{x:520.7252604166666,y:260.1119384765625,step:0},{x:522.2747802734375,y:283.1692708333333,step:2},{x:522.9166259765625,y:283.25394694010413,step:1},{x:523.7109375,y:283.29557291666663,step:1},{x:524.65625,y:283.29557291666663,step:1},{x:527.6041666666666,y:283.29557291666663,step:1},{x:530.2135416666666,y:282.11979166666663,step:1},{x:531.8763020833333,y:280.0208333333333,step:1},{x:533.6145833333333,y:277.7942708333333,step:1},{x:534.5221354166666,y:274.85416666666663,step:1},{x:534.5221354166666,y:271.45182291666663,step:1},{x:534.5221354166666,y:266.95829264322913,step:1},{x:532.2917073567708,y:264.3118489583333,step:1},{x:527.7942708333333,y:264.3118489583333,step:1},{x:526.8489990234375,y:264.3118489583333,step:1},{x:526.0547281901041,y:264.3958333333333,step:1},{x:525.4870198567708,y:264.52213541666663,step:1},{x:522.2747802734375,y:283.1692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Mh=[{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #f89077, #b21f10)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Bh=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(110,0,5,1)",background:"linear-gradient(to right bottom, #f89077, #cc4a31)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:397.2669270833333,y:276.1119384765625,step:2},{x:397.8430989583333,y:276.4791259765625,step:1},{x:398.64908854166663,y:276.78385416666663,step:1},{x:399.556640625,y:276.78385416666663,step:1},{x:400.3483479817708,y:276.78385416666663,step:1},{x:401.08268229166663,y:276.3671875,step:1},{x:401.08268229166663,y:275.5364583333333,step:1},{x:401.08268229166663,y:274.9114583333333,step:1},{x:400.6653645833333,y:274.5286458333333,step:1},{x:399.77274576822913,y:274,step:1},{x:398.75,y:273.3919270833333,step:1},{x:397.77079264322913,y:272.5598958333333,step:1},{x:397.77079264322913,y:271.16796875,step:1},{x:397.77079264322913,y:268.9921875,step:1},{x:399.4700520833333,y:267.6640625,step:1},{x:401.5865478515625,y:267.6640625,step:1},{x:402.75321451822913,y:267.6640625,step:1},{x:403.44462076822913,y:267.95182291666663,step:1},{x:403.86258951822913,y:268.1920979817708,step:1},{x:403.2141927083333,y:270.111328125,step:0},{x:402.8977864583333,y:269.919921875,step:1},{x:402.220703125,y:269.6314697265625,step:1},{x:401.4140625,y:269.6477864583333,step:1},{x:400.4491780598958,y:269.6477864583333,step:1},{x:399.9452718098958,y:270.17582194010413,step:1},{x:399.9452718098958,y:270.767578125,step:1},{x:399.9452718098958,y:271.3919270833333,step:1},{x:400.53580729166663,y:271.775390625,step:1},{x:401.35611979166663,y:272.28776041666663,step:1},{x:402.53776041666663,y:272.9759114583333,step:1},{x:403.2720947265625,y:273.83984375,step:1},{x:403.2720947265625,y:275.13541666666663,step:1},{x:403.2720947265625,y:277.5364583333333,step:1},{x:401.48636881510413,y:278.7682698567708,step:1},{x:399.34049479166663,y:278.7682698567708,step:1},{x:398.0013020833333,y:278.75260416666663,step:1},{x:397.0221761067708,y:278.3671875,step:1},{x:396.5755208333333,y:278,step:1},{x:397.2669270833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.052734375,y:267.82421875,step:2},{x:406.20963541666663,y:278.6067708333333,step:0},{x:404.1361083984375,y:278.6067708333333,step:0},{x:405.97916666666663,y:267.82421875,step:0},{x:408.052734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:416.1302083333333,y:278.1119384765625,step:2},{x:415.3958740234375,y:278.3827718098958,step:1},{x:414.2161458333333,y:278.71879069010413,step:1},{x:412.9921875,y:278.71879069010413,step:1},{x:411.66666666666663,y:278.71879069010413,step:1},{x:410.5572509765625,y:278.3358968098958,step:1},{x:409.765625,y:277.5364583333333,step:1},{x:408.98832194010413,y:276.78385416666663,step:1},{x:408.5423177083333,y:275.5833333333333,step:1},{x:408.5423177083333,y:274.2083333333333,step:1},{x:408.5423177083333,y:272.1920979817708,step:1},{x:409.27665201822913,y:270.44791666666663,step:1},{x:410.515625,y:269.279296875,step:1},{x:411.609375,y:268.2714436848958,step:1},{x:413.12109375,y:267.7115478515625,step:1},{x:414.8059895833333,y:267.7115478515625,step:1},{x:416.05859375,y:267.7115478515625,step:1},{x:416.9948323567708,y:267.98368326822913,step:1},{x:417.3697509765625,y:268.1920979817708,step:1},{x:416.75,y:270.1438802083333,step:0},{x:416.3177490234375,y:269.919921875,step:1},{x:415.55472819010413,y:269.69596354166663,step:1},{x:414.69010416666663,y:269.69596354166663,step:1},{x:413.7265625,y:269.69596354166663,step:1},{x:412.8763020833333,y:270,step:1},{x:412.2292073567708,y:270.5598958333333,step:1},{x:411.37890625,y:271.29557291666663,step:1},{x:410.8177490234375,y:272.57621256510413,step:1},{x:410.8177490234375,y:274.04691569010413,step:1},{x:410.8177490234375,y:275.8567708333333,step:1},{x:411.7812093098958,y:276.7682698567708,step:1},{x:413.3072509765625,y:276.7682698567708,step:1},{x:413.796875,y:276.7682698567708,step:1},{x:414.12894694010413,y:276.6875,step:1},{x:414.37504069010413,y:276.5755208333333,step:1},{x:414.7630615234375,y:274.3046468098958,step:0},{x:413.2499593098958,y:274.3046468098958,step:0},{x:413.58203125,y:272.46354166666663,step:0},{x:417.109375,y:272.46354166666663,step:0},{x:416.1302083333333,y:278.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:417.81510416666663,y:278.6067708333333,step:2},{x:419.65885416666663,y:267.82421875,step:0},{x:422.09244791666663,y:267.82421875,step:0},{x:423.37504069010413,y:271.935546875,step:0},{x:423.7630208333333,y:273.3118489583333,step:1},{x:424.0221761067708,y:274.4322509765625,step:1},{x:424.25260416666663,y:275.6145833333333,step:1},{x:424.2956136067708,y:275.6145833333333,step:0},{x:424.3385009765625,y:274.51298014322913,step:1},{x:424.4817708333333,y:273.32816569010413,step:1},{x:424.7421875,y:271.744140625,step:1},{x:425.4036458333333,y:267.82421875,step:0},{x:427.3489990234375,y:267.82421875,step:0},{x:425.50516764322913,y:278.6067708333333,step:0},{x:423.359375,y:278.6067708333333,step:0},{x:422.00516764322913,y:274.3046468098958,step:0},{x:421.5729573567708,y:272.83203125,step:1},{x:421.31510416666663,y:271.8561604817708,step:1},{x:421.05472819010413,y:270.5435791015625,step:1},{x:421.0130208333333,y:270.5435791015625,step:0},{x:420.91141764322913,y:271.599609375,step:1},{x:420.6809895833333,y:273.11979166666663,step:1},{x:420.39322916666663,y:274.83203125,step:1},{x:419.7447509765625,y:278.6067708333333,step:0},{x:417.81510416666663,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Lh=[{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:371.2519124348958,y:286.9765625,step:2},{x:368.0761311848958,y:258.6692708333333,step:0},{x:373.708984375,y:258.6692708333333,step:0},{x:374.84183756510413,y:272.15043131510413,step:0},{x:375.1073811848958,y:275.17447916666663,step:1},{x:375.2962239583333,y:277.90360514322913,step:1},{x:375.447265625,y:280.8450520833333,step:1},{x:375.5228271484375,y:280.8450520833333,step:0},{x:376.46805826822913,y:278.07291666666663,step:1},{x:377.677734375,y:275.0494384765625,step:1},{x:378.923828125,y:272.1087239583333,step:1},{x:384.6321614583333,y:258.6692708333333,step:0},{x:390.71805826822913,y:258.6692708333333,step:0},{x:377.564453125,y:286.9765625,step:0},{x:371.2519124348958,y:286.9765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.7519124348958,y:287.4388427734375,step:2},{x:393.1373291015625,y:287.4388427734375,step:1},{x:389.4329427083333,y:282.2318115234375,step:1},{x:389.4329427083333,y:275.63798014322913,step:1},{x:389.4329427083333,y:270.51298014322913,step:1},{x:391.1347249348958,y:265.4309895833333,step:1},{x:394.1204427083333,y:262.2389729817708,step:1},{x:396.501953125,y:259.7193603515625,step:1},{x:399.7519124348958,y:258.20768229166663,step:1},{x:403.4185791015625,y:258.20768229166663,step:1},{x:410.14847819010413,y:258.20768229166663,step:1},{x:413.7005615234375,y:263.2473958333333,step:1},{x:413.7005615234375,y:270.0091552734375,step:1},{x:413.7005615234375,y:275.17447916666663,step:1},{x:412.0755208333333,y:280.2161865234375,step:1},{x:409.1634114583333,y:283.3645833333333,step:1},{x:406.7831624348958,y:285.9270833333333,step:1},{x:403.5697021484375,y:287.4388427734375,step:1},{x:399.791015625,y:287.4388427734375,step:1},{x:399.7519124348958,y:287.4388427734375,step:0},{x:400.5462239583333,y:282.3984375,step:2},{x:402.1712239583333,y:282.3984375,step:1},{x:403.646484375,y:281.64322916666663,step:1},{x:404.818359375,y:280.3411458333333,step:1},{x:406.8210042317708,y:278.1145833333333,step:1},{x:407.91727701822913,y:273.453125,step:1},{x:407.91727701822913,y:270.1771240234375,step:1},{x:407.91727701822913,y:266.64908854166663,step:1},{x:406.7831624348958,y:263.2473958333333,step:1},{x:402.7753499348958,y:263.2473958333333,step:1},{x:401.0761311848958,y:263.2473958333333,step:1},{x:399.5631917317708,y:264.044921875,step:1},{x:398.39127604166663,y:265.38871256510413,step:1},{x:396.3509114583333,y:267.6145833333333,step:1},{x:395.21683756510413,y:272.0247395833333,step:1},{x:395.21683756510413,y:275.4270833333333,step:1},{x:395.21683756510413,y:279.4167073567708,step:1},{x:396.84183756510413,y:282.3984375,step:1},{x:400.50846354166663,y:282.3984375,step:1},{x:400.5462239583333,y:282.3984375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:425.1536458333333,y:258.6692708333333,step:2},{x:420.3151448567708,y:286.9765625,step:0},{x:414.8723958333333,y:286.9765625,step:0},{x:419.7109375,y:258.6692708333333,step:0},{x:425.1536458333333,y:258.6692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:430.10416666666663,y:259.0892333984375,step:2},{x:432.29691569010413,y:258.6692708333333,step:1},{x:434.6796875,y:258.458984375,step:1},{x:437.1744384765625,y:258.458984375,step:1},{x:441.1431884765625,y:258.458984375,step:1},{x:444.2786458333333,y:259.46683756510413,step:1},{x:446.43485514322913,y:261.5247395833333,step:1},{x:448.51298014322913,y:263.373046875,step:1},{x:449.79947916666663,y:266.1868896484375,step:1},{x:449.79947916666663,y:270.38736979166663,step:1},{x:449.79947916666663,y:275.8463134765625,step:1},{x:447.71875,y:280.59375,step:1},{x:444.58072916666663,y:283.40625,step:1},{x:441.6328125,y:286.0521240234375,step:1},{x:437.8905843098958,y:287.1874593098958,step:1},{x:432.3724365234375,y:287.1874593098958,step:1},{x:429.3098958333333,y:287.1874593098958,step:1},{x:426.6640625,y:286.89322916666663,step:1},{x:425.3802083333333,y:286.5989583333333,step:1},{x:430.10416666666663,y:259.0892333984375,step:0},{x:431.6536865234375,y:282.1458333333333,step:2},{x:432.29691569010413,y:282.2318115234375,step:1},{x:433.0911458333333,y:282.2734375,step:1},{x:434.03641764322913,y:282.2734375,step:1},{x:436.98441569010413,y:282.2734375,step:1},{x:439.59375,y:281.09635416666663,step:1},{x:441.2552083333333,y:278.9973958333333,step:1},{x:442.9948323567708,y:276.7708333333333,step:1},{x:443.90104166666663,y:273.83072916666663,step:1},{x:443.90104166666663,y:270.42899576822913,step:1},{x:443.90104166666663,y:265.9348958333333,step:1},{x:441.6718343098958,y:263.28971354166663,step:1},{x:437.1744384765625,y:263.28971354166663,step:1},{x:436.2292073567708,y:263.28971354166663,step:1},{x:435.4348958333333,y:263.373046875,step:1},{x:434.8671875,y:263.4993489583333,step:1},{x:431.6536865234375,y:282.1458333333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Uh=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(213,177,66,1)",background:"linear-gradient(to right bottom, #f7fc93, #f8fb4f)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:409.1328125,y:278.6067708333333,step:2},{x:408.75846354166663,y:267.82421875,step:0},{x:410.8606770833333,y:267.82421875,step:0},{x:410.8606770833333,y:272.6236572265625,step:0},{x:410.8606770833333,y:273.9348958333333,step:1},{x:410.83203125,y:275.1510009765625,step:1},{x:410.80338541666663,y:276.12760416666663,step:1},{x:410.83203125,y:276.12760416666663,step:0},{x:411.17704264322913,y:275.07157389322913,step:1},{x:411.52347819010413,y:273.9674886067708,step:1},{x:411.96875,y:272.6555989583333,step:1},{x:413.7109375,y:267.82421875,step:0},{x:415.98697916666663,y:267.82421875,step:0},{x:415.9583333333333,y:272.6399739583333,step:0},{x:415.9439697265625,y:273.9348958333333,step:1},{x:415.9140625,y:275.0078125,step:1},{x:415.8567708333333,y:276.0638020833333,step:1},{x:415.88541666666663,y:276.0638020833333,step:0},{x:416.21744791666663,y:274.9427083333333,step:1},{x:416.5780843098958,y:273.7916259765625,step:1},{x:416.9661458333333,y:272.6236572265625,step:1},{x:418.6366780598958,y:267.82421875,step:0},{x:420.8255208333333,y:267.82421875,step:0},{x:416.54947916666663,y:278.6067708333333,step:0},{x:414.28910319010413,y:278.6067708333333,step:0},{x:414.23050944010413,y:274.1927490234375,step:0},{x:414.2161458333333,y:272.912109375,step:1},{x:414.2447509765625,y:271.82421875,step:1},{x:414.3020833333333,y:270.607421875,step:1},{x:414.27347819010413,y:270.607421875,step:0},{x:413.9270833333333,y:271.759765625,step:1},{x:413.58203125,y:272.927734375,step:1},{x:413.1067708333333,y:274.2396240234375,step:1},{x:411.4375,y:278.6067708333333,step:0},{x:409.1328125,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:424.0234375,y:267.82421875,step:2},{x:422.1796875,y:278.6067708333333,step:0},{x:420.10546875,y:278.6067708333333,step:0},{x:421.9478759765625,y:267.82421875,step:0},{x:424.0234375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:427.3489990234375,y:269.83984375,step:2},{x:424.7851155598958,y:269.83984375,step:0},{x:425.1458333333333,y:267.82421875,step:0},{x:432.359375,y:267.82421875,step:0},{x:432.01432291666663,y:269.83984375,step:0},{x:429.421875,y:269.83984375,step:0},{x:427.92447916666663,y:278.6067708333333,step:0},{x:425.8515218098958,y:278.6067708333333,step:0},{x:427.3489990234375,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:431.6823323567708,y:278.6067708333333,step:2},{x:433.52604166666663,y:267.82421875,step:0},{x:435.95963541666663,y:267.82421875,step:0},{x:437.2421875,y:271.935546875,step:0},{x:437.6302490234375,y:273.3118489583333,step:1},{x:437.88932291666663,y:274.4322509765625,step:1},{x:438.1197509765625,y:275.6145833333333,step:1},{x:438.16276041666663,y:275.6145833333333,step:0},{x:438.20572916666663,y:274.51298014322913,step:1},{x:438.3503011067708,y:273.32816569010413,step:1},{x:438.6093343098958,y:271.744140625,step:1},{x:439.27079264322913,y:267.82421875,step:0},{x:441.2161458333333,y:267.82421875,step:0},{x:439.3723958333333,y:278.6067708333333,step:0},{x:437.2265625,y:278.6067708333333,step:0},{x:435.8723958333333,y:274.3046468098958,step:0},{x:435.44010416666663,y:272.83203125,step:1},{x:435.18229166666663,y:271.8561604817708,step:1},{x:434.921875,y:270.5435791015625,step:1},{x:434.8802083333333,y:270.5435791015625,step:0},{x:434.77860514322913,y:271.599609375,step:1},{x:434.5481770833333,y:273.11979166666663,step:1},{x:434.26041666666663,y:274.83203125,step:1},{x:433.61197916666663,y:278.6067708333333,step:0},{x:431.6823323567708,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:447.58072916666663,y:274.015625,step:2},{x:444.1380208333333,y:274.015625,step:0},{x:443.6927083333333,y:276.640625,step:0},{x:447.56510416666663,y:276.640625,step:0},{x:447.234375,y:278.6067708333333,step:0},{x:441.2734375,y:278.6067708333333,step:0},{x:443.1171468098958,y:267.82421875,step:0},{x:448.8620198567708,y:267.82421875,step:0},{x:448.515625,y:269.7916259765625,step:0},{x:444.859375,y:269.7916259765625,step:0},{x:444.45572916666663,y:272.08011881510413,step:0},{x:447.92578125,y:272.08011881510413,step:0},{x:447.58072916666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:449.1497395833333,y:276.1119384765625,step:2},{x:449.7265625,y:276.4791259765625,step:1},{x:450.5312093098958,y:276.78385416666663,step:1},{x:451.44010416666663,y:276.78385416666663,step:1},{x:452.2317708333333,y:276.78385416666663,step:1},{x:452.9661458333333,y:276.3671875,step:1},{x:452.9661458333333,y:275.5364583333333,step:1},{x:452.9661458333333,y:274.9114583333333,step:1},{x:452.546875,y:274.5286458333333,step:1},{x:451.65629069010413,y:274,step:1},{x:450.6328125,y:273.3919270833333,step:1},{x:449.6536865234375,y:272.5598958333333,step:1},{x:449.6536865234375,y:271.16796875,step:1},{x:449.6536865234375,y:268.9921875,step:1},{x:451.3529052734375,y:267.6640625,step:1},{x:453.46875,y:267.6640625,step:1},{x:454.63541666666663,y:267.6640625,step:1},{x:455.328125,y:267.95182291666663,step:1},{x:455.7447509765625,y:268.1920979817708,step:1},{x:455.09635416666663,y:270.111328125,step:0},{x:454.7812093098958,y:269.919921875,step:1},{x:454.10416666666663,y:269.6314697265625,step:1},{x:453.29691569010413,y:269.6477864583333,step:1},{x:452.33207194010413,y:269.6477864583333,step:1},{x:451.828125,y:270.17582194010413,step:1},{x:451.828125,y:270.767578125,step:1},{x:451.828125,y:271.3919270833333,step:1},{x:452.4192708333333,y:271.775390625,step:1},{x:453.2395833333333,y:272.28776041666663,step:1},{x:454.4192708333333,y:272.9759114583333,step:1},{x:455.1536458333333,y:273.83984375,step:1},{x:455.1536458333333,y:275.13541666666663,step:1},{x:455.1536458333333,y:277.5364583333333,step:1},{x:453.3697509765625,y:278.7682698567708,step:1},{x:451.22391764322913,y:278.7682698567708,step:1},{x:449.8841145833333,y:278.75260416666663,step:1},{x:448.90494791666663,y:278.3671875,step:1},{x:448.4583333333333,y:278,step:1},{x:449.1497395833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:456.4934895833333,y:276.1119384765625,step:2},{x:457.0703125,y:276.4791259765625,step:1},{x:457.87504069010413,y:276.78385416666663,step:1},{x:458.7838134765625,y:276.78385416666663,step:1},{x:459.5755208333333,y:276.78385416666663,step:1},{x:460.3099365234375,y:276.3671875,step:1},{x:460.3099365234375,y:275.5364583333333,step:1},{x:460.3099365234375,y:274.9114583333333,step:1},{x:459.8919270833333,y:274.5286458333333,step:1},{x:459,y:274,step:1},{x:457.9765625,y:273.3919270833333,step:1},{x:456.9974365234375,y:272.5598958333333,step:1},{x:456.9974365234375,y:271.16796875,step:1},{x:456.9974365234375,y:268.9921875,step:1},{x:458.6966145833333,y:267.6640625,step:1},{x:460.81254069010413,y:267.6640625,step:1},{x:461.97916666666663,y:267.6640625,step:1},{x:462.6718343098958,y:267.95182291666663,step:1},{x:463.08854166666663,y:268.1920979817708,step:1},{x:462.44010416666663,y:270.111328125,step:0},{x:462.125,y:269.919921875,step:1},{x:461.4478759765625,y:269.6314697265625,step:1},{x:460.6405843098958,y:269.6477864583333,step:1},{x:459.67704264322913,y:269.6477864583333,step:1},{x:459.1718343098958,y:270.17582194010413,step:1},{x:459.1718343098958,y:270.767578125,step:1},{x:459.1718343098958,y:271.3919270833333,step:1},{x:459.7630208333333,y:271.775390625,step:1},{x:460.58329264322913,y:272.28776041666663,step:1},{x:461.7642822265625,y:272.9759114583333,step:1},{x:462.49869791666663,y:273.83984375,step:1},{x:462.49869791666663,y:275.13541666666663,step:1},{x:462.49869791666663,y:277.5364583333333,step:1},{x:460.71354166666663,y:278.7682698567708,step:1},{x:458.5677083333333,y:278.7682698567708,step:1},{x:457.22782389322913,y:278.75260416666663,step:1},{x:456.2499593098958,y:278.3671875,step:1},{x:455.80204264322913,y:278,step:1},{x:456.4934895833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}];class Oh extends ja{constructor(t){var e;super({type:"annotationStamp",...t,style:{...t.style,stampConfig:(null==t||null===(e=t.style)||void 0===e?void 0:e.stampConfig)||Nh(null==t?void 0:t.style.iconName)}}),i(this,"shapeType","annotationStamp"),i(this,"stampType","base"),i(this,"controls",void 0),i(this,"eventHandler",void 0),i(this,"context",void 0),i(this,"renderClipStep",void 0),i(this,"shapes",[]),i(this,"initialRect",void 0),i(this,"iconName",void 0),i(this,"imageLoadedByDraw",!1),i(this,"initByDraw",!1),i(this,"hooks",{reRenderImage:rs()}),this.initByDraw=(null==t?void 0:t.initByDraw)||!1,this.initStamp(),this.init(t.transform,t.selectableStyle),this.initSize(t.style,t.transform);}init(t,e){this.eventHandler=new rh(this),this.context=new lh(this,e),this.context.setTransform(t),this.initialRect=this.getBoundingRect();}initStamp(){const{imageData:t,width:e,height:i}=this.style;if(this.stampItemShapes.forEach((t=>{t.destroy();})),this.stampItemShapes=[],t){var n;this.renderType="image",this.imageLoadedByDraw=!1,(null==this||null===(n=this.style)||void 0===n?void 0:n.img)instanceof HTMLImageElement&&this.style.img.src&&URL.revokeObjectURL(this.style.img.src);const s=t instanceof Blob?URL.createObjectURL(t):t,o=new Image;o.src=s,this.style.img=o,o.onload=()=>{if(this.initByDraw||!Jn(e)||!Jn(i)){const{width:t,height:e}=o;let i=t,n=e;if(t>400||e>400){const s=Math.max(t/400,e/400);i/=s,n/=s;}this.updateStyle({width:i,height:n}),this.setLocalScale(1,1),this.initialWidth=i,this.initialHeight=n,this.initByDraw=!1,this.imageLoadedByDraw=!0;}this.hooks.reRenderImage.emit();};}else this.initByDraw=!1,super.initStamp();this.getPath(),this.renderClipStep=this.steps;}initSize(t,e){if("image"===this.renderType){const{x:t,y:e}=this.getLocalScale();1===t&&1===e||this.updateSize(this.parsedStyle.width.value,this.parsedStyle.height.value);}const i={},n=this.getAnnotationConfig(),{x:s,y:o}=(null==e?void 0:e.scale)||{x:1,y:1};var r;Jn(null==t?void 0:t.x)&&(null==t?void 0:t.x)!==n.style.x&&(i.x=t.x),Jn(null==t?void 0:t.y)&&(null==t?void 0:t.y)!==n.style.y&&(i.y=t.y),Jn(null==t?void 0:t.width)&&t.width*s!==n.style.width&&(i.width=t.width),Jn(null==t?void 0:t.height)&&t.height*o!==n.style.height&&(i.height=t.height),r=i,(0!==Object.keys(r).length||r.constructor!==Object)&&this.updateStampStyle(i);}update(){this.updateOrigin(),this.context.updateControls();}updateSize(t,e){const{x:i,y:n}=this.getLocalScale(),{x:s,y:o}=this.getPosition();if("image"===this.renderType){const{x:s,y:o}=this.getLocalPosition(),r=this.getAngle(),a=t*i,l=e*n;this.setAngle(0),this.setLocalScale(1,1),this.updateStyle({width:a,height:l});const h=s+(t-a)/2,d=o+(e-l)/2;return this.initialWidth=a,this.initialHeight=l,this.setLocalPosition({x:h,y:d}),void this.setAngle(r)}const{width:r,height:a}=this.parsedStyle,l=t||r.value*i,h=e||a.value*n;this.setLocalScale(l/r.value,h/a.value),this.setPosition({x:s,y:o});}updateStampStyle(t){const{x:e,y:i}=this.getLocalPosition(),{x:n,y:s}=this.getLocalScale(),{width:o,height:r}=this.parsedStyle,{width:a,height:l}=t,{imageData:h,iconName:d}=this.style;let c=e,u=i;h||zn(null==t?void 0:t.imageData)||this.setLocalScale(1),null!=t&&t.imageData&&t.imageData!==h?(this.style.imageData=t.imageData,this.initStamp()):null!=t&&t.iconName&&t.iconName!==d&&(this.style.imageData=null,this.style.iconName=t.iconName,this.stampConfig=Nh(t.iconName),this.initStamp()),Jn(null==t?void 0:t.opacity)&&(null==t?void 0:t.opacity)!==this.style.opacity&&(this.style.opacity=t.opacity),this.updateSize(Jn(a)?a:o.value*n,Jn(l)?l:r.value*s);const{x:p,y:g}=this.getLocalScale();if(Jn(null==t?void 0:t.x)){const e=this.initialWidth*p;c=t.x-(this.initialWidth-e)/2;}if(Jn(null==t?void 0:t.y)){const e=this.initialHeight*g;u=t.y-(this.initialHeight-e)/2;}this.setLocalPosition(c,u);}getAnnotationConfig(){const t=this.context.getTransform(),{x:e,y:i}=this.style,n=Vn(t);if(n.position.x===e&&n.position.y===i&&1===n.scale.x&&1===n.scale.y&&(delete n.position,delete n.scale),this.style.imageData)return {type:"annotationStamp",style:{x:t.position.x,y:t.position.y,width:this.style.width,height:this.style.height,opacity:this.style.opacity,imageData:this.style.imageData},transform:{...n}};const{initialWidth:s,initialHeight:o}=this,r=s*t.scale.x,a=o*t.scale.y;return {type:"annotationStamp",style:{x:t.position.x+(s-r)/2,y:t.position.y+(o-a)/2,width:r,height:a,opacity:this.style.opacity,stampConfig:[...this.stampConfig],iconName:this.style.iconName},transform:{...n}}}destroy(){var t;this.parentElement&&(this.parentElement.removeChild(this),(null==this||null===(t=this.style)||void 0===t?void 0:t.img)instanceof HTMLImageElement&&this.style.img.src&&URL.revokeObjectURL(this.style.img.src));this.controls&&this.controls.destroy();}}function Nh(t){const e=[th.REJECTED,th.ACCEPTED,th.APPROVED,th.NOT_APPROVED,th.COMPLETED,th.DRAFT,th.FINAL,th.VOID,th.CONFIDENTIAL,th.INITIAL_HERE,th.SIGN_HERE,th.WITNESS];return [Mh,Ph,Ah,Rh,Th,Dh,Eh,Lh,kh,Ih,Bh,Uh][e.indexOf(t)]}var _h;!function(t){t.HIGHLIGHT="highlight",t.UNDERLINE="underline",t.STRIKEOUT="strikeout";}(_h||(_h={}));class Wh extends Oh{constructor(t,e){super({...t}),i(this,"stampType","textAssist"),i(this,"textAssistType",void 0),i(this,"annotationRaw",void 0),this.textAssistType=e,this.annotationRaw=t.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1});}getAnnotationConfig(){const t=super.getAnnotationConfig();return this.annotationRaw&&(t.style.annotationRaw=this.annotationRaw),t}}class Fh extends Oh{constructor(t){super({...t}),i(this,"stampType","raw"),i(this,"annotationRaw",void 0),this.annotationRaw=t.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1});}getAnnotationConfig(){const t=super.getAnnotationConfig();return this.annotationRaw&&(t.style.annotationRaw=this.annotationRaw),t}}function Hh(t,e,i){var n;(i instanceof dh||i instanceof ch||i instanceof hh)&&t!==e&&(null===(n=i.context)||void 0===n||n.updateControls());}function Vh(t,e,i){t!==e&&i.childNodes.length>0&&i.childNodes.forEach((t=>{t&&t.style&&(t.style.opacity=e);}));}function zh(t,e,i){var n;(i instanceof ph||i instanceof bh||i instanceof Ch)&&t!==e&&(null===(n=i.context)||void 0===n||n.updateControls());}function jh(t,e,i){if(!(i instanceof bh||i instanceof Ch||i instanceof Sh||i instanceof ph))return;if(t===e)return;const{x:n,y:s}=i.getBoundingRect();i.updatePosition(n,s),i.updateOrigin();}function $h(t,e,i){var n;(i instanceof gh||i instanceof mh)&&t!==e&&(null===(n=i.context)||void 0===n||n.updateControls());}function Gh(t,e,i){var n;i instanceof Sh&&t!==e&&(null==i||null===(n=i.context)||void 0===n||n.updateControls());}function Xh(t,e,i){i instanceof mh&&t!==e&&(i.textEditEventHandler.calculateCharPosition(),i.textEditEventHandler.updateTextSelection(),i.updateCursor(),i.hooks.reRenderText.emit());}function Yh(t,e,i){i instanceof mh&&t!==e&&(i.textEditEventHandler.calculateCharPosition(),i.textEditEventHandler.updateTextSelection(),i.hooks.reRenderText.emit());}const qh={annotationRect:"rectangle",annotationEllipse:"ellipse",annotationPolygon:"polygon",annotationPolyline:"polyline",annotationLine:"line",annotationInk:"ink",annotationTextBox:"textBox",annotationFreeText:"textTypewriter",annotationStamp:"stamp"};class Jh{constructor(t){i(this,"eraserPath",void 0),i(this,"erasedShapeIds",[]),i(this,"selectionBox",void 0),i(this,"startCanvasPoint",void 0),i(this,"startLocalPoint",void 0),i(this,"lastMovePoint",void 0),i(this,"resetActivatedZIndex",!0),i(this,"isSeparateText",!1),i(this,"lastClickPointerType",""),i(this,"drawType","annotationRect"),i(this,"isStartEdit",!1),i(this,"isStartDraw",!1),i(this,"controller",void 0),i(this,"eventArea",void 0),i(this,"eventMode","none"),i(this,"defaultGroup",void 0),i(this,"activatedShape",void 0),i(this,"activatedZIndex",0),i(this,"drawLineShape",!1),i(this,"stampPreview",void 0),i(this,"inkDelayTimeout",void 0),i(this,"drawInkShape",!1),i(this,"isArrowKeyDown",!1),this.controller=t,this.defaultGroup=new vh("ddvDefaultGroup"),this.defaultGroup.style.zIndex=1e5;}isDefaultGroup(t){return t===this.defaultGroup}getDrawInitStyle(t,e){var i,n;let s={};const{defaultStyleConfig:o,eraserStyle:r,selectionStyle:a}=this.controller.interactiveConfig,l={x:e.x,y:e.y};let h=[{...nh.textContent,..."annotationFreeText"===t?null==o||null===(i=o.textTypewriter)||void 0===i?void 0:i.textContent:null==o||null===(n=o.textBox)||void 0===n?void 0:n.textContent}];switch(""===h[0].content&&(h=[]),t){case"annotationInk":s={lineCap:"round",lineJoin:"round",segments:[[e]]};break;case"annotationPolygon":case"annotationPolyline":s={points:[e]};break;case"annotationLine":s={startPoint:e,endPoint:e};break;case"annotationFreeText":case"annotationTextBox":s={...l,textContents:h};break;default:s=l;}let d={...nh,...o[qh[t]]||{}};return "select"===this.eventMode?d={...a,zIndex:999}:"erase"===this.eventMode&&(d=r),{...d,...s}}getDrawUpdateStyle(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(this.startLocalPoint.x+e.x)/2,s=(this.startLocalPoint.y+e.y)/2,o=e.x-this.startLocalPoint.x,r=e.y-this.startLocalPoint.y;const a=["annotationCircle","annotationEllipse"].includes(t),l=Math.min(Math.abs(o),Math.abs(r));i&&(o=e.x>=this.startLocalPoint.x?l:-l,r=e.y>=this.startLocalPoint.y?l:-l,a&&(n=(2*this.startLocalPoint.x+o)/2,s=(2*this.startLocalPoint.y+r)/2));let h={};switch(t){case"annotationFreeText":break;case"annotationCircle":case"annotationArc":h={x:n,y:s,r:l};break;case"annotationEllipse":h={x:n,y:s,rx:Math.abs(o)/2,ry:Math.abs(r)/2};break;case"annotationLine":h={endPoint:e};break;default:h={width:o,height:r};}return h}limitPoint(t,e,i){if(!this.eventArea)return;const{x:n,y:s,width:o,height:r}=this.eventArea;let a=0,l=0,h=0;if(e){const{lastHitControlPoint:t,lastHitControlPointCenter:e}=this.activatedShape.context;t&&e&&(l=t.x-e.x,h=t.y-e.y);}else a=Vl(i)?i.parsedStyle.borderWidth.value*i.getScale().x:0;t.x<n+a+l&&(t.x=n+a+l),t.y<s+a+h&&(t.y=s+a+h),t.x>n+o+l&&(t.x=n+o+l),t.y>s+r+h&&(t.y=s+r+h);}executeErase(){var t;"erase"===this.eventMode&&(this.erasedShapeIds.length>0&&this.controller.deleteShape(this.erasedShapeIds),this.controller.deleteShape([null===(t=this.eraserPath)||void 0===t?void 0:t.id],!1),this.eraserPath=null,this.activatedShape=null,this.erasedShapeIds=[]);}executeBoxSelect(){if("select"!==this.eventMode)return;const{shapeArrMap:t,containerId:e}=this.controller,i=[],n=t.get(e),{width:s,height:o}=this.selectionBox.parsedStyle;if(s.value<2&&o.value<2){const t=[];n.forEach((e=>{if("hidden"===e.style.visibility||!e.context.controlsFlags.enableControl||e===this.selectionBox||"annotationGroup"===e.shapeType)return;const i=Hl(e,this.startCanvasPoint);!e.context.isGrouped&&e.isPointInPath(i,this.getHitBorderOffset(e))&&t.push(e);})),t.length&&(t.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),i.push(t[t.length-1]));}else n.forEach((t=>{"annotationGroup"!==t.shapeType&&"visible"===t.style.visibility&&t.context.controlsFlags.enableControl&&t!==this.selectionBox&&$l(this.selectionBox,t)&&i.push(t);}));1===i.length?this.selectShapes([i[0]]):i.length>1?this.selectShapes(i):(this.activatedShape=null,this.controller.hooks.emitSelectAnnotation(null)),this.controller.deleteShape([this.selectionBox.id],!1),this.selectionBox=null,this.controller.hooks.emitAnnotationRender();}activateShape(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||"hidden"===t.style.visibility||!t.context.controlsFlags.enableControl)return;if(this.activatedShape===t&&t.context.isActive)return;const{showOnTopWhenSelected:n}=this.controller.interactiveConfig;var s;this.activatedShape&&this.activatedShape!==t&&(e?(n&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.isDefaultGroup(this.activatedShape)||this.defaultGroup.shapes.includes(this.activatedShape)||((null===(s=this.activatedShape)||void 0===s?void 0:s.parentNode)===(null==t?void 0:t.parentNode)?this.defaultGroup.add(this.activatedShape):this.inactivateShape())):this.inactivateShape());this.activatedShape=t,this.activatedShape.context.isActive=!0,this.activatedShape.eventHandler.setLimitArea(this.eventArea),n&&(this.resetActivatedZIndex&&(this.activatedZIndex=this.activatedShape.style.zIndex),this.resetActivatedZIndex=!0,this.activatedShape.style.zIndex=99999),this.activatedShape.controls||t.context.initControls(),t.context.renderControls(),zl(t)&&t.pointEventsHandler.enableEditMode(),this.isDefaultGroup(t)&&t.showAllControls(),e||this.controller.hooks.emitSelectAnnotation(t),i&&this.controller.hooks.emitAnnotationRender();}inactivateShape(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.activatedShape)return;const{showOnTopWhenSelected:i}=this.controller.interactiveConfig;if(i&&!this.isDefaultGroup(this.activatedShape)&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.drawInkShape&&this.activatedShape instanceof ph&&(this.drawInkShape=!1,clearTimeout(this.inkDelayTimeout)),this.activatedShape.context.unHitShape(),this.activatedShape.context.destroyControls(),this.isDefaultGroup(this.activatedShape)&&this.activatedShape.clear(),this.activatedShape instanceof mh&&"freeTextWriter"===this.activatedShape.textType){const{textContents:t}=this.activatedShape.style;let e="";t.forEach((t=>{e+=(null==t?void 0:t.content)||"";})),0===e.length&&this.controller.deleteShape([this.activatedShape.id],!0);}this.isArrowKeyDown&&(this.isArrowKeyDown=!1,this.controller.hooks.emitModifyAnnotation(["moved"],[this.activatedShape]),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape)),this.activatedShape=null,this.controller.hooks.emitAnnotationRender(),t&&this.controller.hooks.emitSelectAnnotation(null,e);}setEventArea(t){this.eventArea=t,this.activatedShape&&this.activatedShape.eventHandler.setLimitArea(this.eventArea);}setEventMode(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"annotationRect";if("draw"===this.eventMode&&this.activatedShape&&("annotationInk"===this.drawType&&this.activatedShape instanceof ph&&this.activatedShape.setUseDouglasPeucker(!0),this.drawLineShape)){const t=[...this.activatedShape.style.points];qn()||t.pop(),this.activatedShape.style.points=t;}this.drawLineShape&&this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape]),(this.drawInkShape||this.drawLineShape)&&(clearTimeout(this.inkDelayTimeout),this.inactivateShape(!1)),this.isStartDraw=!1,this.drawLineShape=!1,this.drawInkShape=!1,this.eventMode=t,this.drawType=e,this.stampPreview&&(this.controller.deleteShape([this.stampPreview.id],!1),this.stampPreview=null,this.controller.hooks.emitAnnotationRender()),"none"!==t&&(this.inactivateShape(!0),"erase"===t&&(this.drawType="annotationInk"),"select"===t&&(this.drawType="annotationRect"));}getFreeTextLimitWidth(t,e,i,n,s,o){const r=t,a=e,l=Math.round(i),h=Math.round(o);if(!r)return 0;let d=r,c=n;if(h!==l){if(0===h)switch(l){case 90:return s;case 180:return n;case-90:d=a,c=s;}if(-90===h)switch(l){case 0:return s;case 90:return n;case 180:d=a,c=s;}if(180===h||-180===h)switch(l){case 0:return n;case-90:return s;case 90:d=a,c=s;}if(90===h)switch(l){case 180:return s;case-90:return n;case 0:d=a,c=s;}}let u=d-c;return u<0&&(u=d),u}selectShapes(t){const e=[];return t.forEach((t=>{"visible"===t.parsedStyle.visibility&&t.context.controlsFlags.enableControl&&e.push(t);})),this.inactivateShape(!t.length),!!e.length&&(this.defaultGroup.clear(),1===e.length?this.activateShape(e[0],!1,!0):(e.forEach((t=>{this.defaultGroup.add(t);})),this.activateShape(this.defaultGroup,!1,!0)),!0)}editStartHandler(t){if("none"!==this.eventMode)return;if(!this.activatedShape)return;const{offsetX:e,offsetY:i}=Xl(this.controller.canvas,t),n={x:e,y:i};this.isStartEdit=!0,180===this.activatedShape.getAngle()&&this.activatedShape.setAngle(179.99),this.activatedShape.eventHandler.startHandler(n,!0),this.controller.hooks.emitBeforeAnnotationEdit(this.activatedShape);}editMoveHandler(t){if(!this.activatedShape||"none"!==this.eventMode||!this.isStartEdit)return;const{offsetX:e,offsetY:i}=Xl(this.controller.canvas,t),n={x:e,y:i};this.limitPoint(n,!0,this.activatedShape),this.activatedShape.eventHandler.moveHandler(n,Bs(t)),this.controller.hooks.emitAnnotationRender();}editEndHandler(t){this.isStartEdit=!1,this.activatedShape&&"none"===this.eventMode&&(this.activatedShape.eventHandler.endHandler(this.controller.hooks),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape));}drawStartHandler(t){if(!this.controller.container||"none"===this.eventMode)return;if("draw"===this.eventMode&&"annotationStamp"===this.drawType)return void("touch"!==t.pointerType&&"pen"!==t.pointerType||this.drawStampMoveHandler(t,!1));if(!this.eventArea)return;const{controller:e}=this,{drawType:i,drawLineShape:n,eventMode:s}=this,{offsetX:o,offsetY:r}=Xl(e.canvas,t),{x:a,y:l,width:h,height:d}=this.eventArea;if(o<a||o>a+h||r<l||r>l+d)return;const c={x:o,y:r},u=e.container.getWorldTransform().inverse().transformPoint(c);if(this.isStartDraw=!0,this.startCanvasPoint=c,this.startLocalPoint=u,this.lastMovePoint=null,"select"===s&&(this.inactivateShape(),this.controller.hooks.emitBeforeAnnotationEdit(null)),this.drawInkShape&&clearTimeout(this.inkDelayTimeout),"draw"===s&&(n||this.drawInkShape)){const e=this.activatedShape instanceof ph;return e&&this.activatedShape.addSegment(),this.activatedShape.addPoint(u),void(e||"touch"!==t.pointerType&&"pen"!==t.pointerType||this.controller.hooks.emitAnnotationRender())}-1!==["annotationPolyline","annotationPolygon"].indexOf(i)&&(this.drawLineShape=!0),"draw"===s&&-1!==["annotationInk"].indexOf(i)&&(this.drawInkShape=!0);const p={style:this.getDrawInitStyle(this.drawType,u)};if("annotationFreeText"===this.drawType){const{cropBoxRect:t}=this.controller.container.parentNode.parentNode.parentNode,e=this.getFreeTextLimitWidth(t.width,t.height,this.controller.container.getAngle(),p.style.x-t.left||0,p.style.y-t.top||0,0);p.style.width=e||p.style.width;}const g=this.controller.addShape(this.drawType,p,!1);g.style.zIndex=999;const f=()=>{0!==this.controller.container.getAngle()&&Zh(g)&&(g.setAngle(0),g.setPosition(c));},{container:y}=this.controller;if("draw"===s)this.controller.hooks.emitBeforeAnnotationDraw(g),f();else if("erase"===s){if(g.style.background=null,y){const t=g.style.borderWidth/y.getScale().x;g.style.borderWidth=t;}this.eraserPath=g;}else {if(y){const t=g.style.borderWidth/y.getScale().x;g.style.borderWidth=t;}this.selectionBox=g,f();}this.activatedShape=g,this.controller.hooks.emitAnnotationRender();}drawMoveHandler(t,e){const{activatedShape:i,eventMode:n,isStartDraw:s,drawType:o}=this;if("none"===n)return;if("draw"===n&&"annotationStamp"===o)return void this.drawStampMoveHandler(t,e);if("draw"===n&&"annotationFreeText"===o)return;if(!s)return;const{offsetX:r,offsetY:a}=Xl(this.controller.canvas,t),l={x:r,y:a};this.limitPoint(l,!1,this.activatedShape);const h=this.controller.container.getWorldTransform().inverse().transformPoint(l);if("annotationPolyline"===o||"annotationPolygon"===o){const t=Vn(i.parsedStyle.points),e=t.length;1===e?t[e]=h:t[e-1]=h,i.style.points=t;}else if("annotationInk"===o)i.addPoint(h);else {const e=this.getDrawUpdateStyle(this.drawType,h,Bs(t)),n=this.controller.container.getAngle();if(0!==n&&Zh(i)){if(90===Math.abs(Math.round(n))){const t=e.width;e.width=e.height,e.height=t;}e.width=l.x-this.startCanvasPoint.x>0?Math.abs(e.width):-Math.abs(e.width),e.height=l.y-this.startCanvasPoint.y>0?Math.abs(e.height):-Math.abs(e.height),i.updateStyle(e),i.setPosition({...this.startCanvasPoint});}else i.updateStyle(e);}this.controller.hooks.emitAnnotationRender();}drawStampMoveHandler(t,e){const{offsetX:i,offsetY:n}=Xl(this.controller.canvas,t),s={x:i,y:n},o=this.controller.container.getRootNode(),r=o.getWorldTransform().inverse().transformPoint(s),a=()=>{if(!this.stampPreview)return;const i=this.stampPreview.getBoundingRect(),n=(null==t?void 0:t.target)instanceof HTMLCanvasElement;this.stampPreview.style.visibility=!e&&n?"visible":"hidden",this.stampPreview.setLocalPosition(r.x-i.width/2,r.y-i.height/2);};if(!this.stampPreview){const{defaultStyleConfig:t}=this.controller.interactiveConfig,{stamp:e}=t,i=(null==e?void 0:e.stampIcon)||(null==nh?void 0:nh.stampIcon),n=(null==e?void 0:e.imageData)||(null==nh?void 0:nh.imageData),s=(null==e?void 0:e.stampConfig)||null;if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:s?null:i,imageData:n,stampConfig:s,opacity:Jn(e.opacity)?e.opacity:.5,zIndex:9999},initByDraw:!0}),o.appendChild(this.stampPreview),!n&&i){const{width:t,height:e}=this.stampPreview.parsedStyle;if(e.value>60){const i=e.value/60;this.stampPreview.updateSize(t.value/i,e.value/i);}this.stampPreview.hooks.reRenderImage.on((()=>{this.controller.hooks.emitAnnotationRender();}));}else this.stampPreview.hooks.reRenderImage.on((()=>{"visible"===this.stampPreview.style.visibility&&a(),this.controller.hooks.emitAnnotationRender();}));}a(),this.controller.hooks.emitAnnotationRender();}eraseMoveHandler(t){const{eraserStyle:e}=this.controller.interactiveConfig,{eventMode:i,isStartDraw:n,erasedShapeIds:s,controller:o}=this;if("erase"!==i||!o.container||!n)return;const r=o.shapeArrMap.get(o.containerId);if(!r.size)return;const{offsetX:a,offsetY:l}=Xl(o.canvas,t),h={x:a,y:l};this.lastMovePoint||(this.lastMovePoint=h),r.forEach((t=>{t!==this.eraserPath&&-1===s.indexOf(t.id)&&"visible"===t.parsedStyle.visibility&&t.context.controlsFlags.enableControl&&function(t,e,i,n){const s=Hl(t,e),o=cs(e,i),r=t.isPointInPath(s,5);if(r||o<=.9)return r;const a=o/1,l=(e.x-i.x)/a,h=(e.y-i.y)/a;for(let e=0;e<Math.abs(a);e++){const n=Hl(t,{x:i.x+l*e,y:i.y+h*e});if(t.isPointInPath(n,5))return !0}return !1}(t,h,this.lastMovePoint,e.borderWidth)&&(t.style.opacity=.5,s.push(t.id));})),this.lastMovePoint=h;}drawEndHandler(t){const{eventMode:e,isStartDraw:i,drawLineShape:n,drawType:s,activatedShape:o,controller:r}=this;if("draw"===e&&"annotationStamp"===s)return void this.drawStampEndHandler(t);if("none"===e||!i||n)return;this.isStartDraw=!1;if(["annotationRect","annotationTextBox"].includes(s)){const{width:t,height:e,borderWidth:i}=o.parsedStyle,{x:n,y:s}=o.getPosition(),{x:r,y:a}=o.getScale(),l=(null==i?void 0:i.value)||0;let h=n,d=s;t.value<0&&(h=n-(-t.value+l)*r,o.style.width=-t.value+2*l),e.value<0&&(d=s-(-e.value+l)*a,o.style.height=-e.value+2*l),o.setPosition({x:h,y:d});}if("draw"===e&&this.drawInkShape)return o.setUseDouglasPeucker(!0),this.controller.hooks.emitAnnotationRender(),1===this.activatedShape.style.segments.length?r.hooks.emitAddAnnotation("draw",[this.activatedShape]):r.hooks.emitModifyAnnotation(["resized"],[this.activatedShape]),void(this.inkDelayTimeout=setTimeout((()=>{this.drawInkShape&&(this.drawInkShape=!1,this.activatedShape&&this.activatedShape instanceof ph&&(this.activatedShape.setUseDouglasPeucker(!0),this.inactivateShape(!1,!1)));}),this.controller.interactiveConfig.inkCreateDelay));if("draw"===e&&"annotationFreeText"!==s&&"annotationStamp"!==s){const{offsetX:e,offsetY:i}=Xl(r.canvas,t);((this.startCanvasPoint.x-e)**2+(this.startCanvasPoint.y-i)**2)**.5<2&&"annotationStamp"!==o.shapeType&&(r.deleteShape([o.id],!1),r.hooks.emitAfterAnnotationDraw(null),this.activatedShape=null);}const a=(t,e)=>{if(t instanceof mh){const{enableControl:i}=t.context.controlsFlags;if(!i)return;t.textEditEventHandler.enableEditMode(this.startCanvasPoint,e),"textBox"===t.textType&&this.controller.hooks.emitAnnotationRender(),"freeTextWriter"===t.textType&&setTimeout((()=>{document.activeElement instanceof HTMLTextAreaElement||t.textEditEventHandler.enableEditMode(this.startCanvasPoint,e);}),10);}};if("draw"===e&&this.activatedShape){const t=this.activatedShape,{canvas:e}=this.controller;r.hooks.emitAddAnnotation("draw",[this.activatedShape]),r.interactiveConfig.enableContinuousDrawing?o instanceof mh?(this.eventMode="none",this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),a(o,e)):this.activatedShape=null:(this.controller.setAnnotationMode("none",!0),r.hooks.emitAfterAnnotationDraw(t),this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),a(o,e));}"erase"===e&&this.executeErase(),"select"===e&&this.executeBoxSelect();}drawStampEndHandler(t){const{offsetX:e,offsetY:i}=Xl(this.controller.canvas,t);if(!this.stampPreview)return;if(!this.eventArea)return;if(this.stampPreview&&"image"===this.stampPreview.renderType&&!this.stampPreview.imageLoadedByDraw)return void(this.stampPreview.style.visibility="hidden");const{x:n,y:s,width:o,height:r}=this.eventArea;if(e<n||e>o+n||i<s||i>r+s)return;const{defaultStyleConfig:a}=this.controller.interactiveConfig,{stamp:l}=a,h=Jn(null==l?void 0:l.opacity)?null==l?void 0:l.opacity:null==nh?void 0:nh.opacity,d=this.stampPreview;d.style.opacity=h;const{containerId:c,container:u,shapeArrMap:p}=this.controller,g={...d.getPosition()},f={...d.getScale()},y=u.getScale(),m=f.x/y.x,v=f.y/y.y;if(p.get(c).set(d.id,d),d.index=p.get(c).size,d.pageUid=c,u.appendChild(d),d.style.imageData){const{width:t,height:e}=d.parsedStyle;d.updateStyle({width:t.value*m,height:e.value*v}),d.setLocalScale(1,1);}else d.setLocalScale(m,v);d.setAngle(0),d.setPosition(g),this.stampPreview=null,this.activatedShape=d,this.controller.hooks.emitBeforeAnnotationDraw(d),this.controller.hooks.emitAddAnnotation("draw",[d]),this.controller.interactiveConfig.enableContinuousDrawing?qn()&&this.createStampPreviewForMobile():(this.resetActivatedZIndex=!1,this.controller.setAnnotationMode("none",!0),this.activateShape(d,!1,!0),this.controller.hooks.emitAfterAnnotationDraw(d));}dblClickHandler(t){const{activatedShape:e,controller:i}=this;if(!e)return;const{shapeType:n}=e;if(this.drawLineShape&&("annotationPolygon"===n||"annotationPolyline"===n)){const t=[...e.style.points],n=t.length;return qn()?cs(t[n-1],t[n-2])<=15&&t.pop():t.pop(),"mouse"===this.lastClickPointerType&&(t.pop(),this.lastClickPointerType=""),t.length<2?(i.deleteShape([e.id],!1),this.activatedShape=null):(e.style.points=t,this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape])),this.isStartDraw=!1,this.drawLineShape=!1,void(!i.interactiveConfig.enableContinuousDrawing&&this.activatedShape?(this.controller.setAnnotationMode("none",!0),this.controller.hooks.emitAfterAnnotationDraw(e),this.resetActivatedZIndex=!1,this.activateShape(e,!1,!0)):this.activatedShape=null)}if("annotationFreeText"===n&&!this.isSeparateText){const{offsetX:i,offsetY:n}=Xl(this.controller.canvas,t),{textEditEventHandler:s}=e,o={x:i,y:n};if(this.activatedShape instanceof mh&&"freeTextWriter"===this.activatedShape.textType){const{cropBoxRect:t}=this.controller.container.parentNode.parentNode.parentNode,e=this.getFreeTextLimitWidth(t.width,t.height,this.controller.container.getAngle(),this.activatedShape.getLocalPosition().x-t.left,this.activatedShape.getLocalPosition().y-t.top,this.activatedShape.getAngle());e!==this.activatedShape.style.width&&(this.activatedShape.style.width=e);}s.enableEditMode(o,this.controller.canvas),this.controller.hooks.emitAnnotationRender();}}clickHandler(t){const{activatedShape:e,eventMode:i}=this;if(!e)return;const{shapeType:n}=e,s=()=>{if("annotationFreeText"===n){const{offsetX:i,offsetY:n}=Xl(this.controller.canvas,t),{textEditEventHandler:s}=e,o={x:i,y:n};s.editClickHandler(o,this.controller.canvas);}};if(this.lastClickPointerType=null==t?void 0:t.pointerType,this.isSeparateText=!1,"none"===i){if(Ms(t)&&this.controller.interactiveConfig.enableMultipleSelectWidthCtrl){if(this.isDefaultGroup(e)){const{clickedShape:t}=e;this.defaultGroup.delete(t);const{shapes:i}=this.defaultGroup;if(i.length<2&&(this.defaultGroup.context.isActive=!1),1===i.length){const t=i[0];this.activateShape(t,!1,!1),this.isSeparateText=t instanceof mh;}}else this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.defaultGroup.add(this.activatedShape),this.defaultGroup.shapes.length>=2?(this.defaultGroup.context.isActive=!0,this.activateShape(this.defaultGroup,!1,!1)):(this.controller.hooks.emitSelectAnnotation(e),s());return void this.controller.hooks.emitAnnotationRender()}s();}}keyDownHandler(t,e){const{activatedShape:i}=this;if(!i)return;const n=()=>{if(this.isStartDraw&&(this.isStartDraw=!1),this.drawLineShape)return this.drawLineShape=!1,this.controller.deleteShape([this.activatedShape.id]),void this.controller.hooks.emitAnnotationRender();this.inactivateShape(!0),this.defaultGroup.clear();};switch(t.code){case"Escape":n();break;case"Delete":case"Backspace":if(jl(i)&&i.textEditEventHandler.editMode)return;if(!this.controller.interactiveConfig.enableDeleteWithKeyboard)return;if(this.drawInkShape||this.drawLineShape)return;t.preventDefault(),this.controller.deleteShape([i.id]),this.inactivateShape();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(!this.controller.interactiveConfig.enableMoveWithKeyboard)return;if(i instanceof mh&&i.isEditMode)return;if(this.drawInkShape||this.drawLineShape)return;this.isArrowKeyDown=!0;i.eventHandler.moveByKeyboard(t,e)&&(this.controller.hooks.emitBeforeAnnotationEdit(i),this.controller.hooks.emitAnnotationRender());break}}keyUpHandler(t){this.isArrowKeyDown&&(this.isArrowKeyDown=!1,["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.code)&&(this.controller.hooks.emitModifyAnnotation(["moved"],[this.activatedShape]),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape)));}getHitBorderOffset(t){if(!t)return 10;const e=t.getScale();if(e.x<1||e.y<1){const t=Math.min(e.x,e.y);return Math.round(Math.abs(10/t))}return 10}createStampPreviewForMobile(){if(this.stampPreview)return;const{defaultStyleConfig:t}=this.controller.interactiveConfig,{stamp:e}=t,i=(null==e?void 0:e.stampIcon)||(null==nh?void 0:nh.stampIcon),n=(null==e?void 0:e.imageData)||(null==nh?void 0:nh.imageData),s=(null==e?void 0:e.stampConfig)||null,o=this.controller.container.getRootNode();if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:s?null:i,imageData:n,stampConfig:s,opacity:Jn(e.opacity)?e.opacity:.5,zIndex:9999,visibility:!1},initByDraw:!0}),o.appendChild(this.stampPreview),!n&&i){const{width:t,height:e}=this.stampPreview.parsedStyle;if(e.value>60){const i=e.value/60;this.stampPreview.updateSize(t.value/i,e.value/i);}}}}function Zh(t){return ["annotationFreeText","annotationTextBox","annotationRect"].includes(t.shapeType)}exports.EnumConvertMode = void 0;exports.EnumAnnotationRenderMode = void 0;var td=new WeakMap;class ed extends Qs{constructor(){super(...arguments),i(this,"renderAnnotation",eo(this)),i(this,"addAnnotation",eo(this)),i(this,"deleteAnnotation",eo(this)),i(this,"selectAnnotation",eo(this)),i(this,"modifyAnnotation",eo(this)),i(this,"annotationModeChanged",eo(this)),i(this,"beforeAnnotationEdit",eo(this)),i(this,"afterAnnotationEdit",eo(this)),i(this,"beforeAnnotationDraw",eo(this)),i(this,"afterAnnotationDraw",eo(this)),i(this,"annotationTextContentUpdated",eo(this)),i(this,"selectAnnotationTextChars",eo(this)),i(this,"enableAnnotationTextEditMode",eo(this)),i(this,"disableAnnotationTextEditMode",eo(this)),f(this,td,{writable:!0,value:[]});}emitAddAnnotation(t,e){const i=[];e.forEach((t=>{i.push({uid:t.id,shape:t});})),this.addAnnotation.emit({action:t,shapes:i});}emitDeleteAnnotation(t){const e=[];t.forEach((t=>{e.push({uid:t.id,shape:t});})),this.deleteAnnotation.emit({shapes:e});}emitSelectAnnotation(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];t instanceof vh?t.shapes.forEach((t=>{i.push(t.id);})):t&&i.push(t.id),(i.length||n(this,td).length)&&(this.selectAnnotation.emit({newAnnotationUids:[...i],oldAnnotationsUids:[...n(this,td)],emitSelected:e}),s(this,td,i));}emitModifyAnnotation(t,e){const i=[];e.forEach((t=>{t instanceof vh?t.shapes.forEach((t=>{i.push({uid:t.id,shape:t});})):i.push({uid:t.id,shape:t});})),this.modifyAnnotation.emit({actions:t,shapes:i});}emitAnnotationModeChanged(t){this.annotationModeChanged.emit(t);}emitBeforeAnnotationEdit(t){t instanceof mh&&t.textEditEventHandler.editMode||this.beforeAnnotationEdit.emit(t);}emitAfterAnnotationEdit(t){this.afterAnnotationEdit.emit(t);}emitAnnotationRender(){this.renderAnnotation.emit();}emitSelectAnnotationTextChar(t){this.selectAnnotationTextChars.emit(t);}emitBeforeAnnotationDraw(t){this.beforeAnnotationDraw.emit(t);}emitAfterAnnotationDraw(t){this.afterAnnotationDraw.emit(t);}emitEnableAnnotationTextEditMode(t){this.enableAnnotationTextEditMode.emit(t);}emitDisableAnnotationTextEditMode(t){this.disableAnnotationTextEditMode.emit(t);}emitAnnotationTextContentUpdated(t){this.annotationTextContentUpdated.emit(t);}}class id{constructor(t){i(this,"shapeArrMap",void 0),i(this,"shapeMap",void 0),i(this,"annotationMode","none"),i(this,"brush","annotationRect"),i(this,"tempTextStyle",void 0),i(this,"canvas",void 0),i(this,"hooks",void 0),i(this,"interactiveConfig",Vn(oh)),i(this,"eventService",void 0),i(this,"containerId",void 0),i(this,"container",void 0),Ta.bindHandler(["opacity"],void 0,Vh),Ta.bindHandler(["width","height","borderWidth"],void 0,$h),Ta.bindHandler(["startPoint","endPoint","lineEnding"],void 0,Gh),Ta.bindHandler(["r","rx","ry","borderWidth"],void 0,Hh),Ta.bindHandler(["points","segments"],void 0,zh),Ta.bindHandler(["borderWidth"],void 0,jh),Ta.bindHandler(["textContents","borderWidth","textAlign"],void 0,Xh),Ta.bindHandler(["textAlign"],void 0,Yh),this.canvas=t,this.eventService=new Jh(this),this.hooks=new ed,this.shapeArrMap=new Map,this.shapeMap=new Map;}set drawType(t){this.brush=t,"draw"===this.annotationMode&&this.eventService.setEventMode("draw",t);}get drawType(){return this.brush}bindFreeTextHooks(t){if(!(t instanceof mh))return;const e=t.hooks;let i;e.reRenderText.on((()=>{this.hooks.emitAnnotationRender();})),e.textContentUpdated.on((()=>{this.hooks.emitModifyAnnotation(["contentChanged"],[t]);})),e.textContentUpdatedByChar.on((()=>{this.hooks.emitAnnotationTextContentUpdated(t);})),e.selectTextChars.on((e=>{var n;if(e.startChar===e.endChar&&t.isSameChar(i,e.endChar)&&!e.needUpdate)return;const{freeTextContentStyle:s}=t,o="freeTextWriter"===t.textType?"textTypewriter":"textBox",{defaultStyleConfig:r}=this.interactiveConfig;r[o]||(r[o]={}),r[o].textContent={...s,content:null===(n=r[o])||void 0===n||null===(n=n.textContent)||void 0===n?void 0:n.content},i=e.endChar,this.hooks.emitSelectAnnotationTextChar(t);})),e.enableTextEditMode.on((e=>{this.tempTextStyle=Vn(this.interactiveConfig.defaultStyleConfig["textBox"===t.textType?"textBox":"textTypewriter"]),this.hooks.emitEnableAnnotationTextEditMode(t);})),e.disableTextEditMode.on((e=>{this.interactiveConfig.defaultStyleConfig["textBox"===t.textType?"textBox":"textTypewriter"]=this.tempTextStyle,this.tempTextStyle=null,i=null,this.hooks.emitDisableAnnotationTextEditMode(t);}));}bindStampHooks(t){t instanceof Oh&&t.hooks.reRenderImage.on((()=>{this.hooks.emitAnnotationRender();}));}isHitShape(t){const{offsetX:e,offsetY:i}=Xl(this.canvas,t),{activatedShape:n,defaultGroup:s}=this.eventService,o={x:e,y:i},{shapeArrMap:r,shapeMap:a,containerId:l}=this,h=r.get(l)||a,d=s===this.eventService.activatedShape&&(null==s?void 0:s.parentNode)===this.container;if(n&&(d||h.has(n.id))){const t=n.eventHandler.isHit(o,!1);if(-1!==t)return {isHit:!0,isHitSelected:!0,hitControlPointIndex:t,shape:n}}const c=[];let u=!1,p=null;return h.forEach((t=>{if("hidden"===t.style.visibility||!t.context.controlsFlags.enableControl||t===n)return;const e=Hl(t,o);!t.context.isGrouped&&t.isPointInPath(e,this.eventService.getHitBorderOffset(t))&&(u=!0,c.push(t));})),u&&(c.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),p=c[c.length-1]),{isHit:u,shape:p,isHitSelected:!1,hitControlPointIndex:-1}}isInTextEditMode(){return !!(this.eventService.activatedShape&&this.eventService.activatedShape instanceof mh)&&this.eventService.activatedShape.isEditMode}setAnnotationMode(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.annotationMode=t,this.eventService.setEventMode(t,this.drawType),qn()&&"draw"===t&&"annotationStamp"===this.drawType&&this.eventService.createStampPreviewForMobile(),"none"!==t&&this.eventService.inactivateShape(),e&&this.hooks.emitAnnotationModeChanged(t);}setAnnotationContainer(t,e){if(e!==this.container){const{activatedShape:t,drawLineShape:e,drawInkShape:i,drawType:n}=this.eventService;if("draw"===this.eventService.eventMode&&t){if(i&&t instanceof ph&&(clearTimeout(this.eventService.inkDelayTimeout),t.setUseDouglasPeucker(!0),this.eventService.drawInkShape=!1),e){const e=[...t.style.points];t.style.points=e,this.eventService.drawLineShape=!1,this.eventService.isStartDraw=!1;}"annotationInk"!==n&&(this.hooks.emitAddAnnotation("draw",[t]),this.interactiveConfig.enableContinuousDrawing||(this.setAnnotationMode("none",!0),this.hooks.emitAfterAnnotationDraw(t)),this.eventService.activatedShape=null);}}this.containerId=t,this.container=e,this.shapeArrMap.get(t)||this.shapeArrMap.set(t,new Map);}setAnnotationInteractiveConfig(t){if(this.tempTextStyle){const e=this.eventService.activatedShape;if(e instanceof mh){const i=t.defaultStyleConfig["textBox"===e.textType?"textBox":"textTypewriter"];if(i){const t=this.tempTextStyle.textContent;this.tempTextStyle={...this.tempTextStyle,...i},this.tempTextStyle.textContent={...t,...i.textContent};}}}const e=Vn(t),{controlsStyle:i,defaultStyleConfig:n,eraserStyle:s,selectionStyle:o}=this.interactiveConfig;e.defaultStyleConfig=(null==e?void 0:e.defaultStyleConfig)||{};const{stamp:r}=n,{stamp:a}=e.defaultStyleConfig,l=(null==r?void 0:r.stampIcon)||nh.stampIcon,h=null==r?void 0:r.stampConfig,d=(null==r?void 0:r.imageData)||nh.imageData,c=null==a?void 0:a.stampIcon,u=null==a?void 0:a.stampConfig,p=null==a?void 0:a.imageData;this.interactiveConfig={...this.interactiveConfig,...e,controlsStyle:js((null==e?void 0:e.controlsStyle)||{},i),defaultStyleConfig:js((null==e?void 0:e.defaultStyleConfig)||{},n),eraserStyle:js((null==e?void 0:e.eraserStyle)||{},s),selectionStyle:js((null==e?void 0:e.selectionStyle)||{},o)},(c||u||p)&&(p||(this.interactiveConfig.defaultStyleConfig.stamp.imageData=null),u||(this.interactiveConfig.defaultStyleConfig.stamp.stampConfig=null)),null!=e&&e.controlsStyle&&this.updateAllShapeControlsStyle(this.interactiveConfig.controlsStyle);const{stampPreview:g}=this.eventService;var f;(g&&g.style.opacity!==(null==a?void 0:a.opacity)&&(this.eventService.stampPreview.style.opacity=null==a?void 0:a.opacity),l===c&&d===p&&h===u||!this.eventService.stampPreview)||(null===(f=this.eventService.stampPreview)||void 0===f||f.destroy(),this.eventService.stampPreview=null);}setAnnotationFlags(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this.getShape(t);if(!(n instanceof Fh||n instanceof Wh)&&n){n!==this.eventService.activatedShape||!1!==e.enableControl&&!1!==e.isVisible||this.eventService.inactivateShape(!0),n.context.updateControlsFlags({...e});const{isVisible:t,enableControl:s,enableEdit:o}=n.context.controlsFlags;if(n.context.isInGroup&&(!t||!s)){const{defaultGroup:t,activatedShape:e}=this.eventService;t.delete(n),e===t&&1===t.shapes.length&&this.eventService.activateShape(t.shapes[0],!1,!0);}zl(n)&&n.pointEventsHandler.editMode&&!o&&(n.pointEventsHandler.disableEditMode(),n.pointEventsHandler.enableEditMode()),i&&this.hooks.emitAnnotationRender();}}getShape(t){if("ddvDefaultGroup"===t)return this.eventService.defaultGroup;const e=this.shapeMap.get(t);return e||null}getSelectedShapeUids(){const{activatedShape:t}=this.eventService;if(!t)return [];const e=[];return t instanceof vh?t.shapes.forEach((t=>{e.push(t.id);})):e.push(t.id),e}createShape(t,e){var i,n;let s;if(e.selectableStyle={...this.interactiveConfig.controlsStyle,...e.selectableStyle},"annotationEllipse"===t){const{style:t}=e;t.x+=t.width/2||0,t.y+=t.height/2||0,t.rx=t.width/2||t.rx,t.ry=t.height/2||t.ry;}const{defaultStyleConfig:o}=this.interactiveConfig;switch(t){case"annotationRect":s=new gh(e);break;case"annotationGroup":s=new vh(null==e?void 0:e.id);break;case"annotationArc":s=new hh(e);break;case"annotationCircle":s=new dh(e);break;case"annotationEllipse":s=new ch(e);break;case"annotationLine":s=new Sh(e);break;case"annotationInk":s=new ph(e);break;case"annotationPolygon":s=new bh(e);break;case"annotationPolyline":s=new Ch(e);break;case"annotationFreeText":s=new mh(e,"freeTextWriter",{...nh.textContent,...null===(i=o.textTypewriter)||void 0===i?void 0:i.textContent});break;case"annotationTextBox":s=new mh(e,"textBox",{...nh.textContent,...null===(n=o.textBox)||void 0===n?void 0:n.textContent});break;case"annotationImage":s=new uh(e);break;case"annotationStamp":s=new Oh(e);break;case"annotationHighlight":s=new Wh(e,_h.HIGHLIGHT);break;case"annotationUnderline":s=new Wh(e,_h.UNDERLINE);break;case"annotationStrikeout":s=new Wh(e,_h.STRIKEOUT);break;default:s=new Fh(e);}return s?(s.id||(s.id=ts()),this.shapeMap.set(s.id,s),s):null}addShape(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null!=e&&e.id){const t=this.getShape(null==e?void 0:e.id);if(t)return t}const n=this.createShape(t,e);return this.containerId&&this.shapeArrMap.get(this.containerId).set(n.id,n),this.container&&(n.index=this.shapeArrMap.get(this.containerId).size,n.pageUid=this.containerId,this.container.appendChild(n),i&&this.hooks.emitAddAnnotation("data",[n])),this.bindFreeTextHooks(n),this.bindStampHooks(n),n}updateShape(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this.getShape(t);if(!n)return !1;const{isGrouped:s}=n.context;if(s&&this.eventService.defaultGroup.delete(n),null!=e&&e.style)if(n instanceof Oh)n.updateStampStyle({...e.style});else {if(n instanceof ch){const{x:t,y:i,width:s,height:o}=e.style,{x:r,y:a}=n.getLocalPosition(),l=s?vr(s).value/2:0,h=o?vr(o).value/2:0,d=Jn(t)?t+l:r,c=Jn(i)?i+h:a,u=l||n.style.rx,p=h||n.style.ry;e.style={...e.style,x:d,y:c,rx:u,ry:p};}n.updateStyle({...e.style});}if(null!=e&&e.transform){const{angle:t,scale:i}=e.transform;zn(t)||n.setLocalAngle(t),zn(i)||n instanceof Oh||n.setLocalScale(i);}return i&&this.hooks.emitModifyAnnotation(["appearanceChanged"],[n]),s&&this.eventService.defaultGroup.add(n),!0}updateAllShapeControlsStyle(t){let e=!1;this.shapeMap.forEach((i=>{if(i.context.controlsStyle=t,i.context.parseControlsStyle(),i.controls){i.controls.isVisible&&(e=!0),i.context.destroyControls(),i.context.initControls(),i.context.renderControls();}})),e&&this.hooks.emitAnnotationRender();}updateFreeTextDefaultConfig(){const{defaultStyleConfig:t}=this.interactiveConfig;this.shapeMap.forEach((e=>{if(e instanceof mh){const i=nh.textContent,n="freeTextWriter"===e.textType?"textTypewriter":"textBox",{textContent:s}=t[n]||{};e.updateFreeTextContentStyle({...i,...s,content:i.content});}}));}updateLayer(t,e){const i=this.getShape(t);return !!i&&(this.interactiveConfig.showOnTopWhenSelected&&this.eventService.activatedShape===i?this.eventService.activatedZIndex=e:i.updateStyle({zIndex:e}),this.interactiveConfig.showOnTopWhenSelected&&this.interactiveConfig.enableContinuousDrawing&&"draw"===this.eventService.eventMode&&i.updateStyle({zIndex:e}),!0)}deleteShape(t){var e;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=[],{eventService:o}=this,r=t.includes(null==o||null===(e=o.activatedShape)||void 0===e?void 0:e.id);if(t.forEach((t=>{const e=this.getShape(t);e&&(e instanceof vh?(s.push(...e.shapes),e.clear()):s.push(e));})),!s.length)return !1;i&&this.hooks.emitDeleteAnnotation(s),s.forEach((t=>{t.context.isInGroup&&this.eventService.defaultGroup.delete(t),this.shapeMap.delete(t.id),this.shapeArrMap.get(t.pageUid)&&this.shapeArrMap.get(t.pageUid).delete(t.id),t.destroy();}));const{activatedShape:a,defaultGroup:l}=o,h=a===l&&!l.state;return (r||h)&&this.eventService.inactivateShape(!0,n),!0}selectShape(t){const e=[];return t.forEach((t=>{e.push(this.getShape(t));})),this.eventService.selectShapes(e)}moveShape(t,e,i){t.forEach((t=>{const n=this.getShape(t);if(!n)return;const s=n.pageUid,o=this.shapeArrMap.get(s);o&&o.delete(t),this.shapeArrMap.get(e)||this.shapeArrMap.set(e,new Map),this.shapeArrMap.get(e).set(t,n),n.context.isGrouped&&n.parentNode.delete(n,!0),i.appendChild(n);}));}setShapeLayout(t,e){var i;if(!t.parentNode)return;const n=t.parentNode;let s,o;if(n instanceof Ma)s=n.width,o=n.height;else {const{width:t,height:e}=Yl(n);s=t,o=e;}const{x:r,y:a}=n.getLocalScale();n.scale(r<0?-1:1,a<0?-1:1);const l=n.getAngle(),{width:h,height:d}=Yl(t),{x:c,y:u}=n.getPosition(),{x:p,y:g}=t.getPosition(),{shapeType:f}=t;let y,m;if(n.setAngle(0),null!=n&&null!==(i=n.context)&&void 0!==i&&i.referencePoint){const{x:t,y:e}=n.context.referencePoint.getPosition();y=t,m=e;}else y=c,m=u;switch(e){case"left":m=g;break;case"top":y=p;break;case"right":y+=s-h,m=g;break;case"bottom":y=p,m+=o-d;break;case"center":y+=s/2-h/2,m+=o/2-d/2;break;case"horizontal-center":y+=s/2-h/2,m=g;break;case"vertical-center":y=p,m+=o/2-d/2;}const v=t.getAngle();t.setAngle(0),["annotationCircle","annotationArc","annotationEllipse"].includes(f)&&(["left","right","horizontal-center"].includes(e)?y+=h/2:(["top","bottom","vertical-center"].includes(e)||(y+=h/2),m+=d/2)),t.setPosition({x:y,y:m}),t.setAngle(v),n.setAngle(l),n.scale(r<0?-1:1,a<0?-1:1),this.hooks.emitAnnotationRender();}clickHandler(t){this.eventService.clickHandler(t);}dblClickHandler(t){this.eventService.dblClickHandler(t);}keyDownHandler(t,e){this.eventService.keyDownHandler(t,e);}keyUpHandler(t){this.eventService.keyUpHandler(t);}startHandler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.isHitShape(t),n=Ms(t)&&this.interactiveConfig.enableMultipleSelectWidthCtrl;if("none"===this.annotationMode&&e&&(i.isHit?this.eventService.activateShape(i.shape,n,!0):this.eventService.inactivateShape()),"draw"!==this.annotationMode||i.isHit||this.annotationMode===this.eventService.eventMode){if("draw"===this.annotationMode&&!this.eventService.drawLineShape&&"annotationInk"!==this.brush&&"annotationStamp"!==this.brush&&i.isHit)this.eventService.setEventMode("none"),this.eventService.activateShape(i.shape,n,!0);else if("select"===this.annotationMode){const{isHitSelected:t,isHit:e}=i;t?this.eventService.setEventMode("none"):!t&&e&&n?(this.eventService.setEventMode("none"),this.eventService.activateShape(i.shape,n,!0)):(this.eventService.setEventMode("select"),this.eventService.defaultGroup.clear());}}else this.eventService.setEventMode(this.annotationMode,this.brush);this.eventService.editStartHandler(t),this.eventService.drawStartHandler(t);}moveHandler(t,e){this.eventService.editMoveHandler(t),this.eventService.drawMoveHandler(t,e),this.eventService.eraseMoveHandler(t);}endHandler(t){this.eventService.editEndHandler(t),this.eventService.drawEndHandler(t);}cursorHandler(t,e,i){if(!this.container)return;if(!(t.target instanceof HTMLCanvasElement))return;if(e)return void(t.target.style.cursor=i);if(!(this.shapeArrMap.get(this.containerId)||this.shapeMap).size&&"none"===this.eventService.eventMode)return void(t.target.style.cursor=i);if("erase"===this.eventService.eventMode)return void(t.target.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOE+Vk8ErRFEUxs93/gXZUUrNhiRFWUkWVpaWSomlpaVkaUlZ2CiWllZKjbJQVqQokaYspPwL5+e9aeb15s17z7i7273nd77v3O/KBliSrs1sycxugMV8if6ql3RpZiPAvaR5M/vJQ2oBki7MbBR47DYqQioB7n4OjAHPRZV5SCnA3U+AceCtyqKkZTP76AO4+yHQAFoDzGerB+DuB8DUgMXpQL8zgLvvA3P/KG4BK13AnqQFMxsC7uqkS5o1s3dgNb0ndz9ON8BwAmnWQSRNS3qNiLXcswogs1IFSTIxIeklIjZ7kij1AtqyCkokNSQ9RcR2Xybc/QyYASYL5LYdM/uS9BARO2WzaUvvdLS+jyI1Jd1GxG5loHLDSDtmEEmfSWSvImKj9lXyh+5+Cqx3VB2VeS7CfgHdAKKUgZXPMQAAAABJRU5ErkJggg==) 10 10,auto");if(this.eventService.isStartDraw)return;const n=this.isHitShape(t);if(this.eventService.isStartEdit){if(!n.isHitSelected||9!==n.hitControlPointIndex)return;t.target.style.cursor="move";}if("draw"===this.eventService.eventMode&&["annotationInk","annotationStamp"].includes(this.eventService.drawType))t.target.style.cursor="crosshair";else if(n.isHit)if(n.isHitSelected){if(9===n.hitControlPointIndex)t.target.style.cursor="move";else t.target.style.cursor="grab";9===n.hitControlPointIndex&&n.shape instanceof mh&&n.shape.isEditMode&&(t.target.style.cursor="text");}else t.target.style.cursor="pointer";else "draw"===this.annotationMode?t.target.style.cursor="crosshair":t.target.style.cursor=i;}}class nd extends bl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class sd extends nd{constructor(t){super(t),this.close=!1;}}class od extends nd{render(t,e){super.render(t,e);}}class rd extends nd{}class ad extends Rl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()));}}class ld extends nd{}class hd extends Al{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class dd extends Tl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class cd extends nd{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()));}}class ud extends Dl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()));}}class pd extends nd{}class gd extends bl{render(t,e){if("hidden"!==t.parsedStyle.visibility){if("stamp"===t.renderType)t.renderClipStep&&(e.beginPath(),t.renderClipStep.forEach((t=>{ra(e,t);})),e.closePath(),e.clip()),super.render(t,e);else {const{width:i,height:n,img:s,opacity:o}=t.parsedStyle;if(Zn(s))return;e.save(),e.globalAlpha=o,e.imageSmoothingEnabled=!0,e.imageSmoothingQuality&&(e.imageSmoothingQuality="high"),e.drawImage(s,0,0,i.value,n.value),e.restore();}t.controls&&t.context.renderControls();}}}class fd extends Bl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class yd extends bl{render(t,e){"hidden"!==t.parsedStyle.visibility&&md(t,e);}}function md(t,e){const{container:i}=t,n=t.parentNode;if(!n)return;const s=n.getLocalTransform(),{a:o,b:r,c:a,d:l,e:h,f:d}=s;let c=null,u=i.parentNode;for(;!c&&u;)"pageCropBox"===u.name&&(c=u),u=u.parentNode;if(c){const{x:t,y:i,width:n,height:s}=function(t){let{x:e,y:i}=t.getPosition(),{width:n,height:s}=t;const o=t.parentNode.parentNode,r=(o.rotation%360+360)%360/90,a=devicePixelRatio;1===r?e-=s:2===r?(e-=n,i-=s):3===r&&(i-=n);if(1===r||3===r){const t=n;n=s,s=t;}return {x:e*a,y:i*a,width:n*a,height:s*a}}(c);e.save(),e.setTransform(o,r,a,l,h,d),e.beginPath(),e.moveTo(t,i),e.lineTo(t+n,i),e.lineTo(t+n,i+s),e.lineTo(t,i+s),e.closePath(),e.restore(),e.clip();}}class vd extends bl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(md(t,e),super.render(t,e));}}class xd{init(t){[{name:"annotationArc",renderer:new sd(t)},{name:"annotationCircle",renderer:new od(t)},{name:"annotationEllipse",renderer:new rd(t)},{name:"annotationLine",renderer:new ad(t)},{name:"annotationImage",renderer:new hd(t)},{name:"annotationInk",renderer:new dd(t)},{name:"annotationPolygon",renderer:new cd(t)},{name:"annotationPolyline",renderer:new ud(t)},{name:"annotationRect",renderer:new pd(t)},{name:"annotationFreeText",renderer:new fd(t)},{name:"annotationGroup",renderer:new ld(t)},{name:"annotationStamp",renderer:new gd(t)},{name:"annotationControls",renderer:new yd(t)},{name:"annotationLineControls",renderer:new vd(t)}].forEach((e=>{let{name:i,renderer:n}=e;t.contextService.registerShapeRenderer(i,n);}));}destroy(){}}function wd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Do.displayResolution;const i={left:0,top:0,width:t.imageWidth/t.imageXResolution*e,height:t.imageHeight/t.imageYResolution*e};return {fileIndex:0,mediaBox:i,cropBox:{...i},resource:{data:t.imageData,width:t.imageWidth,height:t.imageHeight,resolutionX:t.imageXResolution,resolutionY:t.imageYResolution,bitDepth:t.imageBitDepth}}}class bd extends Yo{constructor(){super(),i(this,"type","imageParser"),i(this,"once",!1),i(this,"imgReader",void 0),i(this,"isDestroy",!1),i(this,"source",void 0),i(this,"parserOptions",void 0),this.imgReader=new bo;}initParser(t,e){this.source={fileSource:t},e&&(this.parserOptions=e);}async getPageCount(){return 1}destroy(){var t;null===(t=this.imgReader)||void 0===t||t.destroy(),this.imgReader=null,this.isDestroy=!0;}async parse(){if(this.isDestroy)return null;return [wd(await this.imgReader.readImageInfo(this.source))]}async parseAnnotations(t,e){return []}async getPage(){var t;if(this.isDestroy)return null;const e={"image/jpeg":po.IT_JPG,"image/png":po.IT_PNG,"image/bmp":po.IT_BMP},{outputType:i,jpegQuality:n,returnBase64:s}=null!==(t=this.parserOptions)&&void 0!==t?t:{},o=await this.imgReader.readImage({source:this.source,outputType:null!=i?i:e[this.source.fileSource.type],jpegQuality:n,returnBase64:s});if(o){return wd(o)}return null}cancelGetPage(t){var e;if(this.isDestroy)return;const{outputType:i}=null!==(e=this.parserOptions)&&void 0!==e?e:{};this.imgReader.cancelReadImage(this.source,i);}}class Cd{constructor(){i(this,"type","tiffParser"),i(this,"once",!1),i(this,"imgReader",void 0),i(this,"parserOptions",void 0),i(this,"source",void 0),i(this,"isDestroy",!1),this.imgReader=new bo;}initParser(t,e){this.source={fileSource:t},e&&(this.parserOptions=e);}async getPageCount(){return this.imgReader.getTiffPageCount(this.source)}destroy(){var t;null===(t=this.imgReader)||void 0===t||t.destroy(),this.imgReader=void 0,this.isDestroy=!0;}async parse(t){if(this.isDestroy||!this.source)return null;return (await this.imgReader.readTiffPageInfo(this.source,t)).map((t=>{const e=wd(t);return e.fileIndex=t.pageIndex,e}))}async parseAnnotations(t,e){return []}async getPage(t){var e;if(this.isDestroy||!this.source)return null;const{outputType:i,returnBase64:n}=null!==(e=this.parserOptions)&&void 0!==e?e:{},s=await this.imgReader.readTiffPage({source:this.source,index:t,outputType:i,returnBase64:n});if(s){const t=wd(s);return t.fileIndex=s.pageIndex,t}return null}cancelGetPage(t){!this.isDestroy&&this.source&&this.imgReader.cancelReadTiffPage(this.source,t);}}function Sd(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Dr(t),s=e||1;if(Fn(n)&&n[0]&&n[0]instanceof Cr){const t=n[0].value.steps,{length:e}=n[0].value.steps,s=[0,0,0];t.forEach((t=>{const e=Dr(t.color);s[0]+=e.r,s[1]+=e.g,s[2]+=e.b;}));const o=[s[0]/e,s[1]/e,s[2]/e];return i&&(o[3]=255),o}const{r:o,g:r,b:a,alpha:l}=n,h=[o,r,a];return i&&(h[3]=Math.floor(l*s*255+.5)),h}function Pd(t,e){return {strokeColor:t?Sd(t,1,!1):null,fillColor:e?Sd(e,1,!1):null}}function Ad(t,e,i){let n,s;return n=t?Sd(t,i,!0):null,s=e?Sd(e,i,!0):null,{apStrokeColor:n,apFillColor:s}}function Td(t,e,i){const n=t.value?t.value/i:0,s=Md(e||[],i);return s.length?{width:n,style:"D",dash:s}:{width:n}}function kd(t){const e=t.getLocalTransform().clone(),{a:i,b:n,c:s,d:o}=e;return [jd(i),-jd(n),-jd(s),jd(o),0,0]}function Dd(t,e){const{min:i,max:n}=Math;let s=t[0][0],o=t[0][1],r=t[0][0],a=t[0][1];for(let e=1;e<t.length;e++){const l=t[e];s=i(s,l[0]),r=n(r,l[0]),a=i(a,l[1]),o=n(o,l[1]);}return s===r&&(s-=1,r+=1),a===o&&(a-=1,o+=1),[s-e/2,a-e/2,r+e/2,o+e/2]}function Ed(t,e,i,n,s,o){const r=[],a=aa(e),l=i/2,h=[{x:a.left-l*n,y:a.bottom+l*s},{x:a.right+l*n,y:a.bottom+l*s},{x:a.right+l*n,y:a.top-l*s},{x:a.left-l*n,y:a.top-l*s}],d=t.getLocalTransform();return h.forEach((t=>{const e=d.transformPoint({x:t.x,y:t.y});r.push([e.x/n,o-e.y/s]);})),Dd(r,0)}function Id(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],{length:n}=t;if(n>50&&e){const e=Math.floor(n/2),s=Math.floor(n/4);i.push(t[0][0],t[0][1]),i.push(t[s][0],t[s][1]),i.push(t[e][0],t[e][1]),i.push(t[n-s][0],t[n-s][1]),i.push(t[n-1][0],t[n-1][1]),i.push(t[0][0],t[0][1]);}else t.forEach((t=>{i.push(t[0],t[1]);}));return i}function Rd(t){const e=[];for(let i=0;i<t.length;i++){const n=[];t[i].forEach((t=>{n.push(t[0],t[1]);})),e.push(n);}return e}function Md(t,e){if(!t)return [];if(2===t.length&&0===t[0]&&0===t[1])return [];return t.map((t=>t/e))}function Bd(t){return Math.max(["butt","round","square"].indexOf(t),0)}function Ld(t){return Math.max(["miter","round","bevel"].indexOf(t),0)}function Ud(t){const e=[],i=t.getLocalTransform();return t.renderPath.forEach((t=>{const n=i.transformPoint({x:t.x,y:t.y});e.push({x:n.x,y:n.y});})),e}function Od(t,e){const i=Dr(t);let n=0,s=0,o=99999,r=99999;if(Fn(i)&&i[0]&&i[0]instanceof Cr){const i=(t=>{const e=t.match(/(to\s+\w+\s+\w+)|(#\w+)/g);if(!e)return null;const i=e[0],n=e.slice(1);return {direction:i.replace(/\s+/g," ").trim(),colors:n.map((t=>t.trim()))}})(t);e.forEach((t=>{n=Math.max(n,t[0]),o=Math.min(o,t[0]),s=Math.max(s,t[1]),r=Math.min(r,t[1]);}));const a=[o,s,n,r];i.direction.includes("left")&&(a[0]=n,a[2]=o),i.direction.includes("top")&&(a[1]=r,a[3]=s);const l=Dr(i.colors[0]),h=Dr(i.colors[1]);return {coords:a,extend:[!0,!0],function:[{bounds:[],domain:[0,1],encode:[0,1],functions:[{c0:[l.r/255,l.g/255,l.b/255],c1:[h.r/255,h.g/255,h.b/255],domain:[0,1],n:1,type:"exponentialInterpolation"}],type:"stitching"}],shadingType:"axial",type:"shading"}}return null}function Nd(t){const e=t.map((t=>t.toLowerCase())),i=[];return e.includes("print")&&i.push("print"),e.includes("noview")&&i.push("noview"),e.includes("readonly")&&i.push("readonly"),i}function _d(t,e,i,n,s){const{width:o,height:r}=t.parsedStyle;let a=o.value,l=r.value;if(t instanceof mh){const{width:e,height:i}=t.getBoundingRect();a=e,l=i;}const{x:h,y:d}=t.getLocalPosition(),c=e/2,u=h/i,p=s-d/n,g=a/i,f=l/n;return [[u+c,p-f+c,2,!1],[u+g-c,p-f+c,0,!1],[u+g-c,p-c,0,!1],[u+c,p-c,0,!1],[u+c,p-f+c,0,!0]]}function Wd(t,e,i,n){t.renderPath||t.getPath();const{renderPath:s}=t,o=[],{x:r,y:a}=t.getLocalPosition();let l=[];for(let t=0;t<s.length;t++){const{step:h,close:d}=s[t],c=(s[t].x+r)/e,u=n-(s[t].y+a)/i;0!==t?0!==h||0===t?2===h?l.push([c,u,1,d]):l.push([c,u,0,d]):(o.push(l),l=[],l.push([c,u,2,d])):l.push([c,u,2,d]);}return o.push(l),o}function Fd(t,e,i,n){const s=t.childNodes,o=[];for(let t=0;t<s.length;t++){if(!(s[t]instanceof Ha))continue;const r=[],{renderPath:a}=s[t],{x:l,y:h}=s[t].getLocalPosition();a.forEach(((t,s)=>{const o=[(t.x+l)/e,n-(t.y+h)/i,t.step,!1];s===a.length-1&&(o[3]=!0),r.push(o);})),o.push(r);}return o}function Hd(t,e,i,n,s,o,r){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const{lineDash:l}=t.parsedStyle,h=kd(t),d=Dd(o,s),c=[];a&&c.push(Vd(t,o,e,i,s,Md(l,r)));return {bbox:d,matrix:h,transform:d,objs:c}}function Vd(t,e,i,n,s,o){const{miterLimit:r,lineCap:a,lineJoin:l}=t.parsedStyle;return {dashArray:o,dashPhase:0,fillColor:i||[0,0,0,0],fillType:i?2:0,isStroke:s>0,lineCap:Bd(a),lineJoin:Ld(l),lineWidth:s,miterLimit:r,objMatrix:[1,0,0,1,0,0],segments:e,strokeColor:n||[0,0,0,0],type:"path"}}function zd(t,e,i,n){const{fontSize:s,fontFamily:o,fontWeight:r,fontStyle:a,opacity:l,text:h}=t.parsedStyle,{color:d,borderColor:c}=t.style,{x:u,y:p}=t.getLocalPosition(),{apStrokeColor:g,apFillColor:f}=Ad(c,d,l);return {type:"text",charSpace:0,wordSpace:0,fillColor:f||[0,0,0,255],strokeColor:g||[0,0,0,255],fontName:o,renderMode:0,fontIsBold:$d(r),fontIsItalic:"italic"===a,fontSize:s.value/e,fontPitchFamily:16,text:h,position:[u/e,p/i],objMatrix:[1,0,0,1,u/e,n-p/i]}}function jd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const i=t.toFixed(e);return Number.parseFloat(i)}function $d(t){return "bold"===t||Jn(t)&&t>=600}function Gd(t,e,i){return t.replace(new RegExp(e,"g"),i)}function Xd(t,e,i,n,s){const{segments:o,lineWidth:r,strokeColor:a,fillType:l,fillColor:h,dashArray:d,lineCap:c,lineJoin:u,miterLimit:p,isStroke:g,pattern:f}=t,y={type:"path",stampPoints:Kd(o,i,n,s),borderWidth:g?(r||1)*i:0,borderColor:ic(a,e),background:l>0?ic(h,e):null,lineDash:nc(d,i),lineCap:tc(c),lineJoin:ec(u),miterLimit:p};return f&&(y.background=function(t,e,i,n){var s,o,r,a;const{coords:l,type:h}=t;if("shading"!==h)return null;const d={x:l[0]*e,y:n-l[1]*i},c={x:l[2]*e,y:n-l[3]*i},u=d.x<c.x?"right":"left",p=d.y===c.y?"":d.y<c.y?"bottom":"top";if(!t||null==t||!t.function||null==t||null===(s=t.function[0])||void 0===s||!s.functions)return null;let g=null==t||null===(o=t.function[0])||void 0===o||null===(o=o.functions[0])||void 0===o?void 0:o.c0,f=null==t||null===(r=t.function[0])||void 0===r||null===(r=r.functions[0])||void 0===r?void 0:r.c1;if(!g||!f)return null;const y=(null==t||null===(a=t.function[0])||void 0===a?void 0:a.encode)||[1,0];if(y[0]>y[y.length-1]){const t=f;f=g,g=t;}const m=`rgb(${255*g[0]},${255*g[1]},${255*g[2]})`,v=`rgb(${255*f[0]},${255*f[1]},${255*f[2]})`;return `linear-gradient(to ${u} ${p}, ${Tr(m)}, ${Tr(v)})`}(f,i,n,s)||y.background),y}function Yd(t,e,i,n,s){const{text:o,renderMode:r,fontIsBold:a,fontIsItalic:l,fillColor:h,fontSize:d,fontName:c,strokeColor:u,objMatrix:p}=t,g=ar.create(p),{scale:f}=g.decompose(),y=function(t,e,i,n,s,o){const r=Jd(t,e,o),a=r[0],l=r[1];return [a*i,(s-l)*n]}(p[4],p[5],i,n,s,[1,0,0,1,0,0]);return {type:"text",text:o,color:ic(h,e),borderWidth:r?i:"0px",borderColor:ic(u,e),fontWeight:a?"bold":"normal",fontStyle:l?"italic":"normal",fontSize:d*i*Math.abs(f.x),fontFamily:c,textBaseLine:"alphabetic",x:y[0],y:y[1]}}function qd(t,e,i){const n=function(t,e){const i=t.replace(/[^A-Za-z0-9\+\/]/g,""),n=i.length,s=e?Math.ceil((3*n+1>>>2)/e)*e:3*n+1>>>2,o=new Uint8Array(s);for(let t,e,r=0,a=0,l=0;l<n;l++)if(e=3&l,r|=oc(i.charCodeAt(l))<<18-6*e,3===e||n-l==1){for(t=0;t<3&&a<s;t++,a++)o[a]=r>>>(16>>>t&24)&255;r=0;}return o}(t),s=new ImageData(new Uint8ClampedArray(n),e,i);let o=document.createElement("canvas");o.width=e,o.height=i;o.getContext("2d").putImageData(s,0,0);const r=o.toDataURL();return o=null,r}function Jd(t,e,i){return [i[0]*t+i[2]*e+i[4],i[1]*t+i[3]*e+i[5]]}function Zd(t,e,i,n,s,o){let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=ar.create(i),l=a.decompose(),h={x:(e[2]+e[0])/2,y:(e[1]+e[3])/2},d=(e[2]-e[0])/2,c=(e[1]-e[3])/2,u=a.transformPoint(h),p={x:(u.x-d)*n,y:(o-u.y+c)*s},g=-l.rotation,f={x:l.scale.x,y:l.scale.y};let y=p;var m;r&&(y=null!==(m=function(t,e,i,n,s,o){const r=[];let a=!0;if(t.forEach((t=>{let e;"path"===t.type?(e=Xd(t,1,n,s,o),a=!1):"text"===t.type&&(e=Yd(t,1,n,s,o),a=!1),e&&r.push(e);})),a)return null;if(r.length){const t=function(t,e,i,n,s){const o={x:e[0]*i,y:(s-e[3])*n},r=[],a=[];if(t.forEach((t=>{if("path"!==t.type)return;const{borderWidth:e,stampPoints:i,lineCap:n}=t;if(2===i.length){const t=pa(i[0],i[1],vr(e).value,n);r.push(t.x,t.x+t.width),a.push(t.y,t.y+t.height);}else {const t=aa(i),n=vr(e).value/2,s=t.left-n,o=t.top-n,l=t.width+2*n,h=t.height+2*n;r.push(s,s+l),a.push(o,o+h);}})),0===r.length)return {offsetX:0,offsetY:0};const l=Math.min(...r),h=Math.min(...a);return {offsetX:l-o.x,offsetY:h-o.y}}(r,e,n,s,o);i.x+=t.offsetX,i.y+=t.offsetY;}return i}(t,e,{...p},n,s,o))&&void 0!==m?m:y);return {position:y,angle:g,scale:f}}function Qd(t,e,i,n){const s=[];return t.forEach((t=>{s.push({x:t[0]*e,y:(n-t[1])*i});})),s}function Kd(t,e,i,n){const s=[];return t.forEach((t=>{const o=t[0],r=t[1];s.push({x:o*e,y:(n-r)*i,step:t[2],close:t[3]});})),s}function tc(t){return ["butt","round","square"][null!=t?t:0]}function ec(t){return ["miter","round","bevel"][null!=t?t:0]}function ic(t,e){return t?(null==t?void 0:t.length)<3?null:4===(null==t?void 0:t.length)?`rgba(${t.slice(0,3).join()},${t[3]/255/(e||1)})`:`rgb(${t.join()})`:null}function nc(t,e){if(!t||0===t.length)return [0,0];return t.map((t=>t*e))}function sc(t){if(!Fn(t))return [null];let e=[];for(let i=0;i<t.length;i++)t[i]instanceof Array?e=e.concat(sc(t[i])):e.push(Vn(t[i]));return e}function oc(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0}function rc(t,e){if(!t)return "";let i="";return t.split(";").forEach((t=>{const n=t.split(":");n[0].trim()===e&&(i=n[1].trim());})),i}function ac(t){if(!t)return {contents:[],textStyle:{}};const e=new DOMParser,i='xmlns="http://www.w3.org/1999/xhtml"';let n=t;t.includes('xmlns="')||(n=t.replace(/<body/,`<body ${i}`)),n=Gd(n,'xmlns=""',i);const s=e.parseFromString(n,"text/xml"),o=s.getElementsByTagName("body")[0],r=s.getElementsByTagName("span"),a=s.getElementsByTagName("p"),l=t=>{for(const e in t)null!==t[e]&&void 0!==t[e]&&""!==t[e]||delete t[e];return t},{color:h,fontFamily:d,fontSize:c,fontWeight:u,fontStyle:p,textDecoration:g}=o.style,f=l({color:h,fontFamily:d,fontSize:c,fontWeight:u,fontStyle:p,lineThrough:g.includes("line-through"),underline:g.includes("word")||g.includes("underline")}),y=[],m=t=>{for(let e=0;e<t.length;e++){const i=t[e],{color:n,fontFamily:s,fontSize:o,fontStyle:r,fontWeight:a}=i.style||{},h=rc(i.getAttribute("style"),"text-decoration"),d=l({content:i.textContent,color:n,fontFamily:s,fontSize:o,fontWeight:a,fontStyle:r,lineThrough:h.includes("line-through")||void 0,underline:h.includes("word")||h.includes("underline")||void 0});y.push(d);}};return r.length?m(r):m(a),{textStyle:f,contents:y}}function lc(t,e,i){if(1!==Math.abs(e[0])||1!==Math.abs(e[3])){const n=Jd(i[0],i[1],e),s=Jd(i[2],i[3],e);t.forEach((t=>{t.segments.forEach((t=>{const i=Jd(t[0],t[1],e);t[0]=i[0],t[1]=i[1];}));})),i[0]=n[0],i[1]=n[1],i[2]=s[0],i[3]=s[1];for(let t=0;t<6;t++)e[t]=0===t||3===t?1:0;}}function hc(t,e,i,n,s,o){var r;const{objs:a}=t||{},l=t&&(null==a?void 0:a.length)>0&&"path"===a[0].type,h=l?a[0]:null,d=(l?h.strokeColor:e)||[0,0,0],c=(l?h.fillColor:i)||null,u=l?h.fillType>0:!Hs(c),p=ic(d,n),g=c?ic(c,n):"",f=nc(l?h.dashArray:null==s?void 0:s.dash,o),y=tc(l?h.lineCap:0),m=ec(l?h.lineJoin:0),v=l?h.miterLimit:10;let x=(null!==(r=null==s?void 0:s.width)&&void 0!==r?r:1)*o||0;var w;l&&(x=(null!==(w=null==h?void 0:h.lineWidth)&&void 0!==w?w:1)*o||0);return {useObj:l,hasFill:u,borderColor:p,background:g,lineDash:f,lineCap:y,lineJoin:m,miterLimit:v,borderWidth:x}}class dc{constructor(){i(this,"pageWidth",void 0),i(this,"pageHeight",void 0),i(this,"ratioX",0),i(this,"ratioY",0);}setParserConfig(t,e,i,n){this.pageWidth=t,this.pageHeight=e,this.ratioX=i,this.ratioY=n;}parseAnnotation(t){let e=null;switch(t.type){case"Square":e=this.parseRect(t);break;case"Circle":e=this.parseCircle(t);break;case"Line":e=this.parseLine(t);break;case"Polygon":e=this.parsePolygon(t);break;case"PolyLine":e=this.parsePolyline(t);break;case"Ink":e=this.parseInk(t);break;case"FreeText":e=t.intent&&"freetext"!==t.intent.toLocaleLowerCase()?"freetexttypewriter"===t.intent.toLocaleLowerCase()?this.parseFreeText(t):this.parseIncomplete(t):this.parseTextBox(t);break;case"Stamp":e=this.parseStamp(t);break;default:e=t.normalAppearance?this.parseIncomplete(t):this.parseUnknown(t);}if(e||(t.normalAppearance?(e=this.parseIncomplete(t),e||(e=this.parseUnknown(t))):e=this.parseUnknown(t)),e){var i;const{opacity:n}=t,s=e.style;if(e.raw=t,s.opacity=Jn(s.opacity)?s.opacity:null!=n?n:1,null!=t&&t.normalAppearance){const{blendMode:i}=t.normalAppearance;e.style.renderBlendMode=i.toLowerCase();}null!==(i=e)&&void 0!==i&&i.transform&&e.transform.angle<0&&(e.transform.angle+=360),e.uid=ts();}return e}isSegmentsRect(t){if(5!==t.length&&4!==t.length)return !1;if(5===t.length&&(t[0][0]!==t[4][0]||t[0][1]!==t[4][1]))return !1;if(t[0][0]===t[2][0]&&t[0][1]===t[2][1]||t[1][0]===t[3][0]&&t[1][1]===t[3][1])return !1;for(let e=1;e<t.length;e++)if(0!==t[e][2])return !1;for(let e=1;e<t.length;e++)if(t[e][0]!==t[e-1][0]&&t[e][1]!==t[e-1][1])return !1;return t[0][0]===t[3][0]||t[0][1]===t[3][1]}parseRect(t){const{normalAppearance:e,interiorColor:i,borderStyle:n,opacity:s,color:o,rect:r}=t,{ratioX:a,ratioY:l,pageHeight:h}=this,{useObj:d,hasFill:c,borderColor:u,background:p,lineDash:g,lineCap:f,lineJoin:y,borderWidth:m}=hc(e,o,i,s,n,a);let v=null,x=0,w=0,b=0,C=0;if(e){const{bbox:t,objs:i,transform:s}=e,{position:o,angle:r,scale:c}=Zd(i||null,t,s,a,l,h,!(null==i||!i.length));if(b=o.x,C=o.y,v={angle:r,scale:c},d){const{lineWidth:t,segments:e}=i[0];if(!this.isSegmentsRect(e))return null;x=(e[1][0]-e[0][0]+t)*this.ratioX,w=(e[2][1]-e[0][1]+t)*this.ratioY;}else {var S,P;x=(t[2]-t[0]-(null!==(S=null==n?void 0:n.width)&&void 0!==S?S:1))*this.ratioX,w=(t[3]-t[1]-(null!==(P=null==n?void 0:n.width)&&void 0!==P?P:1))*this.ratioY;}}else {var A,T,k,D;b=(r[0]+(null!==(A=null==n?void 0:n.width)&&void 0!==A?A:1)/2)*this.ratioX,C=(h-r[3]+(null!==(T=null==n?void 0:n.width)&&void 0!==T?T:1)/2)*this.ratioY,x=(r[2]-r[0]-(null!==(k=null==n?void 0:n.width)&&void 0!==k?k:1))*this.ratioX,w=(r[3]-r[1]-(null!==(D=null==n?void 0:n.width)&&void 0!==D?D:1))*this.ratioY;}return {type:"rectangle",style:{x:b,y:C,width:x,height:w,borderWidth:m,borderColor:u,background:c?p:"",lineDash:g,lineCap:f,lineJoin:y},iconColor:c?p:u,transform:v}}parseCircle(t){const{normalAppearance:e,interiorColor:i,borderStyle:n,opacity:s,color:o,rect:r}=t,{ratioX:a,ratioY:l,pageHeight:h}=this,{objs:d}=e||{},{hasFill:c,borderColor:u,background:p,lineDash:g,borderWidth:f}=hc(e,o,i,s,n,a);let y=null,m=0,v=0,x=0,w=0;if(e){const{bbox:t,transform:i}=e,{position:n,angle:s,scale:o}=Zd(d||null,t,i,a,l,h,!(null==d||!d.length));x=n.x,w=n.y,y={angle:s,scale:o},m=(t[2]-t[0])*this.ratioX,v=(t[3]-t[1])*this.ratioY;}else x=r[0]*this.ratioX,w=(h-r[3])*this.ratioY,m=(r[2]-r[0])*this.ratioX,v=(r[3]-r[1])*this.ratioY;return {type:"ellipse",style:{x:x,y:w,width:m,height:v,borderWidth:f,borderColor:u,background:c?p:"",lineDash:g},transform:y,iconColor:c?p:u}}parseLine(t){if(null!=t&&t.intent&&"linedimension"===t.intent.toLocaleLowerCase())return null;const{normalAppearance:e,interiorColor:i,borderStyle:n,lineEnding:s,opacity:o,color:r,line:a}=t,{ratioX:l,ratioY:h,pageHeight:d}=this,{objs:c}=e||{},{useObj:u,borderColor:p,background:g,lineDash:f,lineCap:y,lineJoin:m,miterLimit:v,borderWidth:x}=hc(e,r,i,o,n,l);let w,b={x:a[0]*this.ratioX,y:(this.pageHeight-a[1])*this.ratioY},C={x:a[2]*this.ratioX,y:(this.pageHeight-a[3])*this.ratioY};if(e){const{bbox:t}=e,{transform:i}=e;if(u){const{segments:e,lineWidth:n}=c[0];lc(c,i,t),b={x:e[0][0]*this.ratioX,y:(this.pageHeight-e[0][1])*this.ratioY},C={x:e[1][0]*this.ratioX,y:(this.pageHeight-e[1][1])*this.ratioY};}const{position:n,angle:s,scale:o}=Zd(sc(c),t,i,l,h,d,!(null==c||!c.length));w={position:n,scale:o,angle:s};}return {type:"line",style:{startPoint:b,endPoint:C,lineEnding:s||["None","None"],borderColor:p,borderWidth:x,background:g||"",lineCap:y,lineJoin:m,lineDash:f,miterLimit:v},transform:w,iconColor:p}}parsePolygon(t){const{normalAppearance:e,interiorColor:i,borderStyle:n,opacity:s,color:o,vertices:r,intent:a}=t;if(a&&["polygondimension","polygoncloud"].includes(a.toLocaleLowerCase()))return null;const{ratioX:l,ratioY:h,pageHeight:d}=this,{objs:c}=e||{},{hasFill:u,borderColor:p,background:g,lineDash:f,lineCap:y,lineJoin:m,miterLimit:v,useObj:x,borderWidth:w}=hc(e,o,i,s,n,this.ratioX);let b,C;if(x){const{segments:t}=c[0];C=Qd(t,this.ratioX,this.ratioY,this.pageHeight);}else {const t=[];for(let e=0;e<r.length;e+=2)t.push([r[e],r[e+1]]);C=Qd(t,this.ratioX,this.ratioY,this.pageHeight);}var S,P;if(C.length>2&&(S=C[0],P=C[C.length-1],S.x===P.x&&S.y===P.y)&&C.pop(),e){const{bbox:t}=e,{transform:i}=e;lc(c,i,t),b=Zd(sc(c),t,i,l,h,d,!(null==c||!c.length));}return {type:"polygon",style:{points:C,borderWidth:w,borderColor:p,background:u?g:"",lineDash:f,lineCap:y,lineJoin:m,miterLimit:v},transform:b,iconColor:u?g:p}}parsePolyline(t){const{normalAppearance:e,interiorColor:i,opacity:n,color:s,vertices:o,borderStyle:r,intent:a}=t;if(a&&"polylinedimension"===a.toLocaleLowerCase())return null;const{ratioX:l,ratioY:h,pageHeight:d}=this,{objs:c}=e||{},{borderColor:u,background:p,lineDash:g,lineCap:f,lineJoin:y,miterLimit:m,useObj:v,borderWidth:x}=hc(e,s,i,n,r,this.ratioX);let w,b;if(v){const{segments:t}=c[0];b=Qd(t,this.ratioX,this.ratioY,this.pageHeight);}else {const t=[];for(let e=0;e<o.length;e+=2)t.push([o[e],o[e+1]]);b=Qd(t,this.ratioX,this.ratioY,this.pageHeight);}if(e){const{bbox:t}=e,{transform:i}=e;lc(c,i,t),w=Zd(sc(c),t,i,l,h,d,!(null==c||!c.length));}return {type:"polyline",style:{points:b,borderWidth:x,borderColor:u,background:p,lineDash:g,lineCap:f,lineJoin:y,lineEnding:t.lineEnding||["None","None"],miterLimit:m},transform:w,iconColor:u}}parseInk(t){const{normalAppearance:e,inkList:i,opacity:n,borderStyle:s,interiorColor:o,color:r}=t,{ratioX:a,ratioY:l,pageHeight:h}=this;if(!i)return null;const{borderColor:d,background:c,lineDash:u,lineCap:p,lineJoin:g,miterLimit:f,borderWidth:y}=hc(e,r,o,n,s,this.ratioX),m=[];for(let t=0;t<i.length;t++){const e=i[t],n=[];for(let t=0;t<e.length;t+=2){const i=e[t],s=e[t+1];n.push([i,s,1,!1]);}const s=Qd(n,this.ratioX,this.ratioY,this.pageHeight);m.push(s);}let v=null;if(e){const{objs:t,transform:i,bbox:n}=e;v=Zd(sc(t),n,i,a,l,h,!(null==t||!t.length));}return {type:"ink",style:{segments:m,borderWidth:y,borderColor:d,background:c,lineDash:u,lineCap:p,lineJoin:g,miterLimit:f},transform:v,iconColor:d}}parseFreeText(t){const{normalAppearance:e,richText:i,rect:n,defaultAppearanceData:s,defaultStyle:o}=t,{ratioX:r,ratioY:a,pageHeight:l}=this;let h,d,c,u,p=0;if(e){const{bbox:t,transform:i,objs:n}=e,{position:s,angle:o,scale:u}=Zd(sc(n),t,i,r,a,l,n.length&&"path"===n[0].type);p=o,d=s.x,c=s.y,h={angle:p,scale:u};}else d=n[0]*this.ratioX,c=(l-n[3])*this.ratioY;(Math.round(p)+360)/90%2==0?(u=(n[2]-n[0])*this.ratioX,0===p&&(u+=12),u+d>this.pageWidth*this.ratioX&&(u=this.pageWidth*this.ratioX-d)):(u=(n[3]-n[1])*this.ratioY,u+d>this.pageHeight*this.ratioY&&(u=this.pageHeight*this.ratioY-d));const{fontName:g,fontSize:f,fontColor:y}=s,m={content:"",fontFamily:g,color:rc(o,"color")||`rgb(${y[0]},${y[1]},${y[2]})`,fontSize:f},v=ac(i),x=[];v.contents.forEach((t=>{const e={...m,...v.textStyle,...t},i=vr(e.fontSize);e.fontFamily=e.fontFamily.replace(/^"|"$/g,""),(Jn(e.fontSize)||"pt"===i.unit)&&(e.fontSize=i.value*this.ratioX),x.push(e);}));return {type:"textTypewriter",style:{x:d,y:c,width:u,textContents:x},transform:h,iconColor:m.color}}parseTextBox(t){const{normalAppearance:e,richText:i,defaultAppearanceData:n,defaultStyle:s,opacity:o,borderStyle:r,color:a,rect:l}=t,{ratioX:h,ratioY:d,pageHeight:c}=this,{hasFill:u,borderColor:p,background:g,borderWidth:f,lineDash:y,useObj:m}=hc(e,null==n?void 0:n.fontColor,a,o,r,h);let v,x,w,b,C;if(e&&e.objs.length){var S,P;const{bbox:t,transform:i,objs:n}=e,{position:s,angle:o,scale:a}=Zd(sc(n),t,i,h,d,c,"path"===n[0].type);v=s.x,x=s.y,C={angle:o,scale:a};const{segments:l,lineWidth:u}=n[0];w=m&&"path"===n[0].type?(l[1][0]-l[0][0]+u)*this.ratioX:(t[2]-t[0]-(null!==(S=null==r?void 0:r.width)&&void 0!==S?S:1))*this.ratioX,b="path"===n[0].type?(l[2][1]-l[0][1]+u)*this.ratioY:(t[3]-t[1]-(null!==(P=null==r?void 0:r.width)&&void 0!==P?P:1))*this.ratioY;}else {var A,T,k,D;v=(l[0]+(null!==(A=null==r?void 0:r.width)&&void 0!==A?A:1)/2)*this.ratioX,x=(c-l[3]+(null!==(T=null==r?void 0:r.width)&&void 0!==T?T:1)/2)*this.ratioY,w=(l[2]-l[0]-(null!==(k=null==r?void 0:r.width)&&void 0!==k?k:1))*this.ratioX,b=(l[3]-l[1]-(null!==(D=null==r?void 0:r.width)&&void 0!==D?D:1))*this.ratioY;}const{fontName:E,fontSize:I}=n,R={content:"",fontFamily:E,fontSize:I},M=ac(i);let B=rc(i,"text-align")||rc(s,"text-align");"justify-center"===B&&(B="justify");const L=[];if(M.contents.forEach((t=>{const e={...R,...M.textStyle,...t},i=vr(e.fontSize);e.fontFamily=e.fontFamily.replace(/^"|"$/g,""),(Jn(e.fontSize)||"pt"===i.unit)&&(e.fontSize=i.value*this.ratioX),L.push(e);})),0===L.length&&t.contents){const e={...R,content:t.contents};Jn(e.fontSize)&&(e.fontSize*=this.ratioX),L.push(e);}return {type:"textBox",style:{x:v,y:x,width:w,height:b,borderWidth:f,borderColor:p,background:u?g:"",lineDash:y,textContents:L,textAlign:B},transform:C,iconColor:R.color}}parseStamp(t){const{icon:e,opacity:i,normalAppearance:n}=t;if(!n)return null;const{objs:s,transform:o,bbox:r}=t.normalAppearance;if(0===s.length)return null;const a=sc(s),l=[],{ratioX:h,ratioY:d,pageHeight:c}=this,{position:u,angle:p,scale:g}=Zd(a,r,o,h,d,c),f={position:u,angle:p,scale:g};for(let t=0;t<a.length;t++){let e;if("path"===a[t].type&&(e=Xd(a[t],i,this.ratioX,this.ratioY,this.pageHeight)),"text"===a[t].type&&(e=Yd(a[t],i,this.ratioX,this.ratioY,this.pageHeight)),"image"===a[t].type){const e={type:"stamp",style:{imageData:a[t].jpegBase64?`data:image/jpeg;base64,${a[t].jpegBase64}`:qd(a[t].RGBABase64,a[t].width,a[t].height),width:(a[t].rect[2]-a[t].rect[0])*this.ratioX,height:(a[t].rect[3]-a[t].rect[1])*this.ratioY},transform:f};return e.transform.position.x+=(a[t].rect[0]-r[0])*this.ratioX,e.transform.position.y-=(a[t].rect[3]-r[3])*this.ratioY,e}e&&l.push(e);}return {type:"stamp",style:{iconName:e,stampConfig:l},transform:f,iconColor:"#868E96"}}parseTextAssist(t,e){const{objs:i,transform:n,bbox:s}=t.normalAppearance,{opacity:o}=t;if(0===i.length)return null;const r=sc(i),a=[],{ratioX:l,ratioY:h,pageHeight:d}=this,{position:c,angle:u,scale:p}=Zd(r,s,n,l,h,d),g={position:c,angle:u,scale:p};for(let t=0;t<r.length;t++){let e;"path"===r[t].type&&(e=Xd(r[t],o,this.ratioX,this.ratioY,this.pageHeight)),e&&a.push(e);}return {type:e,style:{opacity:o||1,stampConfig:a,annotationRaw:t},transform:g}}parseIncomplete(t){const{normalAppearance:e,opacity:i}=t;if(!e)return null;const{objs:n,transform:s,bbox:o}=t.normalAppearance;if(!n||0===n.length)return null;const r=sc(n),a=[],{ratioX:l,ratioY:h,pageHeight:d}=this,{position:c,angle:u,scale:p}=Zd(r,o,s,l,h,d),g={position:c,angle:u,scale:p};for(let e=0;e<r.length;e++){let n;if("path"===r[e].type)n=Xd(r[e],i,l,h,d);else if("text"===r[e].type)n=Yd(r[e],i,l,h,d);else if("image"===r[e].type){let i;i=r[e].jpegBase64?`data:image/jpeg;base64,${r[e].jpegBase64}`:qd(r[e].RGBABase64,r[e].width,r[e].height);const n={type:"incomplete",style:{imageData:i,width:(r[e].rect[2]-r[e].rect[0])*this.ratioX,height:(r[e].rect[3]-r[e].rect[1])*this.ratioY,annotationRaw:t},transform:g};return n.transform.position.x+=(r[e].rect[0]-o[0])*this.ratioX,n.transform.position.y-=(r[e].rect[3]-o[3])*this.ratioY,n}n&&a.push(n);}return {type:"incomplete",style:{stampConfig:a,annotationRaw:t},transform:g}}parseUnknown(t){return {type:"unknown",style:{annotationRaw:t}}}}class cc{constructor(){i(this,"map",new Map),i(this,"ratioX",Do.displayResolution/Do.pdfResolution),i(this,"ratioY",Do.displayResolution/Do.pdfResolution);}async toPdfAnnotations(t,e){const i=[],n=[...t];n.sort(((t,e)=>t.layer-e.layer));for(let t=0;t<n.length;t++){const s=n[t];if(s){const t=await this.toPdfAnnotation(s,{width:e.width/this.ratioX,height:e.height/this.ratioY});if(t){t.oriIndex=s.oriIndex,t.modified=s.modified;const{flags:e}=s,n=[];["noResize","noMove","noRotate"].forEach((t=>{e.includes(t)&&n.push(t);})),n.length&&(t.customData={dynamsoftFlags:n}),i.push(t);}}}return i}async toPdfAnnotation(t,e){if("stamp"===t.type&&t.style.imageData&&(!Jn(t.style.width)||!Jn(t.style.height))){const e=new bo,i=await e.readImageInfo({fileSource:t.style.imageData});let n=i.imageWidth,s=i.imageHeight;if(n>400||s>400){const t=Math.max(n/400,s/400);n/=t,s/=t;}t.style.width=n,t.style.height=s;}const i=this.createShape(t);if(i instanceof mh&&"freeTextWriter"===i.textType){const{width:t,height:e}=i.getBoundingRect();i.setOrigin(t/2,e/2);}let n=null;switch(t.type){case"rectangle":case"ellipse":n=this.toPdfRectOrEllipse(t,e,i);break;case"polyline":case"polygon":n=this.toPdfPolygonal(t,e,i);break;case"line":n=this.toPdfLine(t,e,i);break;case"ink":n=this.toPdfInk(t,e,i);break;case"stamp":n=await this.toPdfStamp(t,e,i);break;case"textBox":n=this.toPdfFreeText(t,e,i,"textBox");break;case"textTypewriter":n=this.toPdfFreeText(t,e,i,"freeTextWriter");break;case"highlight":n=this.toPdfTextAssist(t,"Highlight",e,i);break;case"underline":n=this.toPdfTextAssist(t,"Underline",e,i);break;case"strikeout":n=this.toPdfTextAssist(t,"StrikeOut",e,i);break;case"incomplete":case"unknown":n=t.style.annotationRaw;}return n&&(n.title=t.comment.author,n.subject=t.comment.subject,n.creationdate=t.comment.creationDate),n}toPdfRectOrEllipse(t,e,i){const{borderColor:n,background:s,lineDash:o}=t.style,{borderWidth:r,opacity:a}=i.parsedStyle,{strokeColor:l,fillColor:h}=Pd(n,s),{apStrokeColor:d,apFillColor:c}=Ad(n,s,a),u=Td(r,o,this.ratioX),p=u.width,g="rectangle"===t.type?_d(i,p,this.ratioX,this.ratioY,e.height):function(t,e,i,n){const{x:s,y:o}=t.getLocalPosition();t.path||t.getPath();const{path:r}=t,a=[];for(let t=0;t<r.length;t++){const l=(r[t].x+s)/e,h=n-(r[t].y+o)/i;0===t?(a.push([l,h,2,!1]),a.push([l,h,0,!1])):t===r.length-1?a.push([l,h,1,!0]):a.push([l,h,1,!1]);}return a}(i,this.ratioX,this.ratioY,e.height),f=Hd(i,c,d,a,p,g,this.ratioX);i.path||i.getPath();return {type:"rectangle"===t.type?"Square":"Circle",normalAppearance:f,interiorColor:h,color:l,borderStyle:u,opacity:a,rect:Ed(i,i.path,p,this.ratioX,this.ratioY,e.height),flags:Nd([...t.flags]),date:t.comment.modificationDate,name:t.uid,contents:""}}toPdfPolygonal(t,e,i){const{borderWidth:n,opacity:s}=i.parsedStyle,{borderColor:o,background:r,lineEnding:a,lineDash:l}=t.style,h="polyline"===t.type,{strokeColor:d,fillColor:c}=Pd(o,r),{apStrokeColor:u,apFillColor:p}=Ad(o,r,s),g=Td(n,l,this.ratioX),f=g.width;let y,m,v;h?(y=Wd(i,this.ratioX,this.ratioY,e.height),m=y.flat(),v=Id(y[0])):(y=function(t,e,i,n){t.renderPath||t.getPath();const{x:s,y:o}=t.getLocalPosition(),{renderPath:r}=t,a=[];for(let t=0;t<r.length;t++){const l=(r[t].x+s)/e,h=n-(r[t].y+o)/i;if(0!==t){if(t===r.length-1){a.push([l,h,0,!0]);break}a.push([l,h,0,!1]);}else a.push([l,h,2,!1]);}return a}(i,this.ratioX,this.ratioY,e.height),m=y,v=Id(m));const x=Hd(i,p,u,s,f,m,this.ratioX,!h);if(h){const t=[];y.forEach((e=>{t.push(Vd(i,e,p,u,f,Md(l,this.ratioX)));})),x.objs=t;}const w={type:h?"PolyLine":"Polygon",borderStyle:g,color:d,interiorColor:c,normalAppearance:x,vertices:v,opacity:s,rect:Ed(i,i.renderPath,f,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:Nd([...t.flags]),date:t.comment.modificationDate};return h&&i.isLineArrow()&&(w.lineEnding=a),w}toPdfLine(t,e,i){const{borderWidth:n,opacity:s}=i.parsedStyle,{borderColor:o,background:r,lineEnding:a,lineDash:l}=t.style,{strokeColor:h,fillColor:d}=Pd(o,r),{apStrokeColor:c,apFillColor:u}=Ad(o,r,s),p=Td(n,l,this.ratioX),g=p.width,f=Wd(i,this.ratioX,this.ratioY,e.height),y=f.flat(),m=[];f.forEach((t=>{m.push(Vd(i,t,u,c,g,Md(l,this.ratioX)));}));const v=Hd(i,u,c,s,g,y,this.ratioX,!1);v.objs=m;const x={type:"Line",line:[y[0][0],y[0][1],y[1][0],y[1][1]],interiorColor:d,color:h,normalAppearance:v,borderStyle:p,opacity:s,rect:Ed(i,i.renderPath,g,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:Nd([...t.flags]),date:t.comment.modificationDate,toJsonString:()=>""};return i.isLineArrow()&&(x.lineEnding=a,x.intent="LineArrow"),x}toPdfInk(t,e,i){const{borderWidth:n,opacity:s}=i.parsedStyle,{borderColor:o,background:r,lineDash:a}=t.style,{strokeColor:l}=Pd(o,r),{apStrokeColor:h,apFillColor:d}=Ad(o,r,s),c=Td(n,a,this.ratioX),u=c.width,p=function(t,e,i,n){t.inkOriginalRenderPath||t.getInkOriginalRenderPath();const{x:s,y:o}=t.getLocalPosition(),{inkOriginalRenderPath:r}=t,a=[];for(let t=0;t<r.length;t++){const l=r[t],h=[];for(let t=0;t<l.length;t++){const r=(l[t].x+s)/e,a=n-(l[t].y+o)/i;0===t?h.push([r,a,2,!1]):h.push([r,a,1,!1]);}if(h.length&&h.length<4)for(;h.length<4;){const t=h[h.length-1];h.push([...t]);}a.push(h);}return a}(i,this.ratioX,this.ratioY,e.height),g=p.flat(),f=[],{x:y,y:m}=i.getLocalPosition();i.getPath();const{inkRenderSteps:v}=i,x=[];v.forEach((t=>{const i=[];t.forEach(((t,n)=>{if(0===n){const n=(t.data[0].x+y)/this.ratioX,s=e.height-(t.data[0].y+m)/this.ratioY;i.push([n,s,2,!1]);}else t.data.forEach((t=>{const n=(t.x+y)/this.ratioX,s=e.height-(t.y+m)/this.ratioY;i.push([n,s,1,!1]);}));})),x.push(i);})),x.forEach((t=>{f.push(Vd(i,t,d,h,u,Md(a,this.ratioX)));}));const w=Hd(i,d,h,s,u,g,this.ratioX,!1);w.objs=f;return {type:"Ink",color:l,normalAppearance:w,borderStyle:c,opacity:s,inkList:Rd(p),rect:Ed(i,i.inkOriginalRenderPath.flat(),u,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:Nd([...t.flags]),date:t.comment.modificationDate}}async toPdfStamp(t,e,i){const{imageData:n,iconName:s,opacity:o}=t.style;if(n){return await this.toPdfStampImage(t,e,i)}const r=i.childNodes,a=Fd(i,this.ratioX,this.ratioY,e.height),l=[],h=[];let d=0,c=0;for(let i=0;i<r.length;i++){let n;const s=r[i].parsedStyle.opacity;if(r[i].style.opacity=s/(t.style.opacity||1),r[i]instanceof Ha){const t=Ud(r[i]);h.push(...t);const{borderWidth:e,lineDash:s}=r[i].parsedStyle,{borderColor:u,background:p}=r[i].style,{apStrokeColor:g,apFillColor:f}=Ad(u,p,o),y=Td(e,s,this.ratioX).width,m=Od(p,a[d]);c=Math.max(y,c),n=Vd(r[i],a[d],f,g,y,Md(s,this.ratioX)),m&&(n.pattern=m),d+=1,l.push(n);}r[i]instanceof za&&(n=zd(r[i],this.ratioX,this.ratioY,e.height),l.push(n));}const u=Hd(i,null,null,o,c,a.flat(),this.ratioX,!1);u.objs=l;return {type:"Stamp",icon:s,rect:Ed(i,h,c,this.ratioX,this.ratioY,e.height),normalAppearance:u,opacity:o,name:t.uid,contents:"",flags:Nd([...t.flags]),date:t.comment.modificationDate}}async toPdfStampImage(t,e,i){const{imageData:n,opacity:s}=t.style;let o=n,r=[];Zn(n)&&(r=n.split(","),r[0].match(/:(.*?);/)[1],o=function(t){let e=null;const i=t.split(","),n=i[0].match(/:(.*?);/)[1],s=window.atob(i[1]);let o=s.length;const r=new Uint8Array(o);for(;o--;)r[o]=s.charCodeAt(o);return e=new Blob([r],{type:n}),e}(n));const{width:a,height:l}=i.parsedStyle,h=kd(i),d=[0,0,a.value/this.ratioX,l.value/this.ratioY],c=await async function(t,e,i,n){const{width:s,height:o}=t.parsedStyle,r=s.value/i,a=o.value/n;let l;if("image/jpeg"===e.type){const t=new bo,i=await t.readImage({source:{fileSource:e},outputType:1,returnBase64:!0});t.destroy(),l={type:"image",jpegBase64:i.imageData,objMatrix:[r,0,0,a,0,0],rect:[0,0,r,a]};}else {const t=new bo,i=await t.readImage({source:{fileSource:e},outputType:-2,returnBase64:!0});t.destroy(),l={type:"image",RGBABase64:i.imageData,height:i.imageHeight,width:i.imageWidth,objMatrix:[r,0,0,a,0,0],rect:[0,0,r,a]};}return l}(i,o,this.ratioX,this.ratioY),u=function(t,e,i,n){const{width:s,height:o}=t.parsedStyle,{x:r,y:a}=t.getLocalScale(),{x:l,y:h}=t.getLocalPosition(),d=t.getAngle(),c=l+s.value/2,u=h+o.value/2,p=s.value*r*.5,g=n*i-o.value*a*.5-u;let f=new Fa({style:{x:c-p,y:n*i-o.value*a-g,width:s.value*r,height:o.value*a}});f.setAngle(d),f.getPath();const y=Ed(f,f.path,0,e,i,n);return f=null,y}(i,this.ratioX,this.ratioY,e.height);return {type:"Stamp",normalAppearance:{bbox:d,matrix:h,objs:[c],transform:h},rect:u,opacity:s,name:t.uid,contents:"",flags:Nd([...t.flags]),date:t.comment.modificationDate}}toPdfFreeText(t,e,i,n){const{opacity:s,textContents:o,borderColor:r,background:a,lineDash:l,textAlign:h}=t.style;"freeTextWriter"===n&&(i.style.borderWidth=0);const{borderWidth:d}=i.parsedStyle,{strokeColor:c,fillColor:u}=Pd(r,a),{apStrokeColor:p,apFillColor:g}=Ad(r,a,s),f="textBox"===n?Td(d,l,this.ratioX):{width:0},y=f.width,m=Hd(i,g,p,s,y,_d(i,y,this.ratioX,this.ratioY,e.height),this.ratioX,"textBox"===n),v=function(t,e,i,n){const{lines:s}=t,{opacity:o}=t.parsedStyle,r=[],a=(t,e,i)=>({type:"path",strokeColor:t,fillColor:t,fillType:0,isStroke:!0,lineCap:0,lineJoin:0,miterLimit:10,lineWidth:i,objMatrix:[1,0,0,1,0,0],segments:e,dashArray:[],dashPhase:0});return s.forEach((s=>{const l=s.height/30,h=t.getTextAlignOffset(s);s.words.forEach((t=>{const{fontFamily:d,fontSize:c,fontStyle:u,fontWeight:p,color:g,underline:f,lineThrough:y}=t.style,m=Sd(g,1,!1),v=m?[...m,255*o]:[0,0,0,255],x=(t.x+h)/e,w=n-s.y/i,b={type:"text",charSpace:0,wordSpace:0,renderMode:0,fontPitchFamily:0,strokeColor:[0,0,0,255],fillColor:v,fontName:d,fontIsBold:$d(p),fontIsItalic:"italic"===u,fontSize:c.value/e,text:(C=t.text,C.replace(/\r?\n?$/,"")),objMatrix:[1,0,0,1,x,w],position:[x,w]};var C;if(r.push(b),f){const o=n-(s.y+l)/i,h=a(v,[[x,o,2,!1],[x+t.widthWithoutLf/e,o,0,!1]],l/i);r.push(h);}if(y){const o=n-(s.y-t.wordHeight/3)/i,h=a(v,[[x,o,2,!1],[x+t.widthWithoutLf/e,o,0,!1]],l/i);r.push(h);}}));})),r}(i,this.ratioX,this.ratioY,e.height);"textBox"===n?m.objs.push(...v):m.objs=v;const{defaultAppearance:x,defaultAppearanceData:w,defaultStyle:b}=function(t,e,i,n,s){const o=i[0]||{color:"rgb(0,0,0)",fontFamily:"Times Roman",fontStyle:"normal",fontWeight:"normal",fontSize:"12px"},{fontFamily:r,fontSize:a,fontStyle:l,fontWeight:h,color:d}=o,c=Sd(d,1,!1),u=Tr(`rgb(${c[0]}, ${c[1]}, ${c[2]})`),p=vr(a).value/s,g=Gd(r," ","");return {defaultAppearance:"textBox"===t?`${e[0]/255} ${e[1]/255} ${e[2]/255} rg /${g} ${p} Tf`:`${c[0]/255} ${c[1]/255} ${c[2]/255} rg /${g} ${p} Tf`,defaultStyle:`font:${"bold"===h?"bold":""} ${"italic"===l?"italic":""} '${r}' ${p}pt; text-align:${"justify"===n?"justify-center":n}; color:${u.toLocaleUpperCase()}`,defaultAppearanceData:{fontColor:c,fontSize:p,fontName:r}}}(n,c||[0,0,0],o,"freeTextWriter"===n?"left":h,this.ratioX);i.getPath();const C=Ed(i,i.path,y,this.ratioX,this.ratioY,e.height);let S="";o.forEach((t=>{S+=t.content;}));const P=function(t,e,i){if(!t||!t.length)return null;const n=document.implementation.createDocument(null,"body",null),s=n.documentElement;s.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),s.setAttribute("xmlns:xfa","http://www.xfa.org/schema/xfa-data/1.0/"),s.setAttribute("xfa:APIVersion","Acrobat:18.11.0"),s.setAttribute("xfa:spec","2.0.2");const o=t=>`font-size:${vr(t).value/i}pt;`,r=t=>`font-weight:${"bold"===t?"bold":"normal"};`,a=t=>`font-style:${"italic"===t?"italic":"normal"};`,l=t=>`color:${Tr(Dr(t).formatted)};`,h=t=>`font-family:'${t}';`,d=t[0],{fontFamily:c,fontSize:u,fontStyle:p,fontWeight:g,color:f}=d,y=Dr(f),m=`${o(u)}text-align:${"justify"===e?"justify-center":e};${l(y.formatted)}${r(g)}${a(p)}${h(c)}font-stretch:normal;`;s.setAttribute("style",m);const v=n.createElement("p");v.setAttribute("dir","ltr"),t.forEach((t=>{if(!t.content.length)return;const e=n.createElement("span"),i=n.createTextNode(t.content);e.appendChild(i);let s="";c!==t.fontFamily&&(s+=h(t.fontFamily)),u!==t.fontSize&&(s+=o(t.fontSize)),p!==t.fontStyle&&(s+=a(t.fontStyle)),g!==t.fontWeight&&(s+=r(t.fontWeight)),f!==t.color&&(s+=l(t.color)),(t.lineThrough||t.underline)&&(s+=`text-decoration:${t.underline?"word":""} ${t.lineThrough?"line-through":""}`),s&&e.setAttribute("style",s),v.appendChild(e);})),s.appendChild(v);const x=`<?xml version="1.0"?>${(new XMLSerializer).serializeToString(n)}`,w='xmlns="http://www.w3.org/1999/xhtml"';return x.includes(w)?Gd(x,'xmlns=""',w):Gd(x.replace(/<body/,`<body ${w}`),'xmlns=""',w)}(o,h,this.ratioX),A={borderStyle:f,type:"FreeText",color:u,normalAppearance:m,defaultAppearance:x,defaultAppearanceData:w,defaultStyle:b,rect:C,name:t.uid,contents:S,opacity:s,flags:Nd([...t.flags]),date:t.comment.modificationDate};return "freeTextWriter"===n&&(A.intent="FreeTextTypeWriter"),P&&(A.richText=P),A}toPdfTextAssist(t,e,i,n){if(t.style.annotationRaw)return t.style.annotationRaw;const{opacity:s}=t.style,o=n.childNodes,r=Fd(n,this.ratioX,this.ratioY,i.height),a=[],l=[];for(let t=0;t<o.length;t++){const e=Ud(o[t]);l.push(...e);const{borderWidth:i,lineDash:n}=o[t].parsedStyle,{borderColor:h,background:d}=o[t].style,{apStrokeColor:c,apFillColor:u}=Ad(h,d,s),p=Td(i,n,this.ratioX).width,g=Vd(o[t],r[t],u,c,p,Md(n,this.ratioX));a.push(g);}const h=Hd(n,null,null,s,0,r.flat(),this.ratioX,!1);h.objs=a;const d=Ed(n,l,0,this.ratioX,this.ratioY,i.height),c=[];r.forEach((t=>{const e=[];t.forEach((t=>{e.push({x:t[0],y:t[1]});}));const i=aa(e),{left:n,bottom:s,top:o,right:r}=i;c.push([n,s,r,s,n,o,r,o]);}));return {type:e,rect:d,normalAppearance:h,opacity:s,quadPoints:c,name:t.uid,flags:Nd([...t.flags]),date:t.comment.modificationDate}}createShape(t){const{type:e,transform:i,style:n}=Vn(t),s={id:t.uid,style:n,transform:i};let o;switch("ellipse"===e&&(n.x+=n.width/2||0,n.y+=n.height/2||0,n.rx=n.width/2||n.rx,n.ry=n.height/2||n.ry),e){case"rectangle":o=new gh(s);break;case"ellipse":o=new ch(s);break;case"line":o=new Sh(s);break;case"ink":o=new ph(s);break;case"polygon":o=new bh(s);break;case"polyline":o=new Ch(s);break;case"textTypewriter":o=new mh(s,"freeTextWriter",{},!1);break;case"textBox":o=new mh(s,"textBox");break;case"stamp":o=new Oh(s);break;case"highlight":o=new Wh(s,_h.HIGHLIGHT);break;case"underline":o=new Wh(s,_h.UNDERLINE);break;case"strikeout":o=new Wh(s,_h.STRIKEOUT);}return o}}class uc{constructor(){i(this,"annotationParser",new dc),i(this,"annotationWriter",new cc);}getParsedAnnotations(t,e,i){const n=Do.displayResolution/Do.pdfResolution;t=t.filter((t=>null!==t)),this.annotationParser.setParserConfig(e,i,n,n),this.moveReplyToAnnotation(t);const s=[];return t.forEach((t=>{if(t){const n=this.annotationParser.parseAnnotation(t);if(n){var e,i;n.flags=this.parseFlags(t.flags||[]),null!=t&&null!==(e=t.customData)&&void 0!==e&&null!==(e=e.dynamsoftFlags)&&void 0!==e&&e.length&&n.flags.push(...t.customData.dynamsoftFlags);const o=this.parseReply(t);null!==(i=t.replies)&&void 0!==i&&i.length&&(o.replies=t.replies.map((t=>this.parseReply(t)))||[]),n.comment=o,s.push(n);}}})),s}moveReplyToAnnotation(t){t.forEach((e=>{if(e&&"Text"===e.type&&!zn(e.inreplyto)){const i=t[e.inreplyto];"Review"===e.statemodel?(i.reviewStates||(i.reviewStates=[]),i.reviewStates.push(e)):"Marked"===e.statemodel?(i.markedStates||(i.markedStates=[]),i.markedStates.push(e)):(i.replies||(i.replies=[]),i.replies.push(e));}})),t.slice().forEach((e=>{if(!e||"Popup"===e.type||!zn(e.inreplyto)){const i=t.findIndex((t=>t===e));t.splice(i,1);}}));}parseReply(t){var e,i;const n=this.parseCommon(t);return n.subject=t.subject,null!==(e=t.reviewStates)&&void 0!==e&&e.length&&(n.reviewStates=t.reviewStates.map((t=>this.parseState(t)))),null!==(i=t.markedStates)&&void 0!==i&&i.length&&(n.markedStates=t.markedStates.map((t=>this.parseState(t)))),n}parseFlags(t){const e=[],i={readonly:"readOnly",noview:"noView"};return t.forEach((t=>{e.push(i[t]||t);})),t.includes("hidden")&&!e.includes("noView")&&e.push("noView"),e}parseState(t){return {...this.parseCommon(t),state:t.state,stateModel:t.statemodel}}parseCommon(t){const e=t.creationdate,i=t.date;return {uid:ts(),author:t.title,contents:t.contents,type:t.type,creationDate:e||i,modifiedDate:i||e,flags:t.flags?[...t.flags]:[]}}parseDate(t){if(!t)return;let e=2;if(!t)return "";const i=[4,2,2,2,2,2].map((i=>{const n=t.slice(e,e+i);return e+=i,parseInt(n,10)}));i[1]-=1;const n=new Date(...i).getTime();return jn("yyyy.MM.dd hh:mm:ss",n)}async getOriginalAnnotations(t,e){return await this.annotationWriter.toPdfAnnotations(t,e)}}function pc(t){return {left:t[0],top:t[1],width:t[2]-t[0],height:t[3]-t[1]}}!function(t){t.CM_RENDERALL="cm/renderall",t.CM_IMAGEONLY="cm/imageonly",t.CM_AUTO="cm/auto";}(exports.EnumConvertMode||(exports.EnumConvertMode={})),function(t){t.NO_ANNOTATIONS="noAnnotations",t.RENDER_ANNOTATIONS="renderAnnotations",t.LOAD_ANNOTATIONS="loadAnnotations";}(exports.EnumAnnotationRenderMode||(exports.EnumAnnotationRenderMode={}));var gc=new WeakSet;class fc{constructor(){y(this,gc),i(this,"type","pdfParser"),i(this,"once",!1),i(this,"pdfReader",void 0),i(this,"parserOptions",{convertMode:exports.EnumConvertMode.CM_AUTO}),i(this,"source",void 0),i(this,"isDestroy",!1),i(this,"annotationMapper",void 0),this.pdfReader=new So,this.annotationMapper=new uc;}initParser(t,e){this.parserOptions=null!=e?e:{convertMode:exports.EnumConvertMode.CM_AUTO},this.source={fileSource:t,password:this.parserOptions.password};}async getPageCount(){return this.pdfReader.getPdfPageCount(this.source,p(this,gc,yc).call(this))}destroy(){var t;null===(t=this.pdfReader)||void 0===t||t.destroy(),this.pdfReader=null,this.isDestroy=!0;}splitArrayIntoChunks(t,e){const i=[];for(let n=0;n<t.length;n+=e){const s=t.slice(n,n+e);i.push(s);}return i}async parseAnnotations(t,e){var i;const n=[];if(this.parserOptions.convertMode===exports.EnumConvertMode.CM_IMAGEONLY||(null===(i=this.parserOptions.renderOptions)||void 0===i?void 0:i.renderAnnotations)!==exports.EnumAnnotationRenderMode.LOAD_ANNOTATIONS)return n;for(let i=0;i<t.length;i++){const s=e[t[i]],o=s.nativeMediaBox;if(1===s.realReadMode&&s.pdfOptions.annotCount>0){const e=await this.pdfReader.readAnnotations(this.source,t[i]),r={pageUid:s.pageUid,fileIndex:t[i],annotations:[]};e.length&&(r.annotations=this.annotationMapper.getParsedAnnotations(e,2*o.left+o.width,2*o.top+o.height),s.annotations=r.annotations),n.push(r);}}return n}async parse(t){const e=[],i=this.parserOptions.convertMode===exports.EnumConvertMode.CM_RENDERALL?[t]:this.splitArrayIntoChunks(t,100);for(let t=0;t<i.length;t++){const o=await this.pdfReader.readPageImageInfos({source:this.source,indices:i[t],readOptions:p(this,gc,yc).call(this),outputType:po.IT_JPG,isInfoOnly:!1,returnBase64:!1}),{displayResolution:r,pdfResolution:a}=Do;for(let t=0;t<o.length;++t){var n,s;const i=o[t];i.mediaBox[0]>i.mediaBox[2]&&([i.mediaBox[0],i.mediaBox[2]]=[i.mediaBox[2],i.mediaBox[0]]),i.mediaBox[1]>i.mediaBox[3]&&([i.mediaBox[1],i.mediaBox[3]]=[i.mediaBox[3],i.mediaBox[1]]),i.cropBox[0]>i.cropBox[2]&&([i.cropBox[0],i.cropBox[2]]=[i.cropBox[2],i.mediaBox[0]]),i.cropBox[1]>i.cropBox[3]&&([i.cropBox[1],i.cropBox[3]]=[i.cropBox[3],i.cropBox[1]]);const l=1===i.realReadMode,h=l?pc(i.mediaBox):{left:0,top:0,width:i.imageWidth/i.imageXResolution*a,height:i.imageHeight/i.imageYResolution*a},d=l?pc([i.cropBox[0],i.mediaBox[1]+i.mediaBox[3]-i.cropBox[3],i.cropBox[2],i.mediaBox[1]+i.mediaBox[3]-i.cropBox[1]]):{...h},c=Ys(h,a,r),u=Ys(d,a,r),p={fileIndex:i.pageIndex,rotation:i.rotation,mediaBox:c,cropBox:u,nativeMediaBox:h,nativeCropBox:d,resource:{width:i.imageWidth,height:i.imageHeight,resolutionX:i.imageXResolution,resolutionY:i.imageYResolution,bitDepth:i.imageBitDepth},pdfOptions:{convertMode:l?exports.EnumConvertMode.CM_RENDERALL:exports.EnumConvertMode.CM_IMAGEONLY,renderOptions:{renderAnnotations:null===(n=this.parserOptions.renderOptions)||void 0===n?void 0:n.renderAnnotations,renderGrayscale:null===(s=this.parserOptions.renderOptions)||void 0===s?void 0:s.renderGrayscale},rotation:i.rotation,mediaBox:{...c},cropBox:{...u},annotCount:i.annotCount},realReadMode:i.realReadMode,annotations:[]};e.push(p);}}return e}async getPage(t){if(this.isDestroy||!this.source)return null;const e=await this.pdfReader.readPage({source:this.source,index:t,readOptions:p(this,gc,yc).call(this),outputType:po.IT_JPG,isInfoOnly:!1,returnBase64:!1});if(e&&0===e.code){const{displayResolution:t,pdfResolution:i}=Do,n=e.imageInfos[0];return {fileIndex:e.pageIndex,rotation:e.rotation,mediaBox:Ys(pc(e.mediaBox),i,t),cropBox:Ys(pc(e.cropBox),i,t),resource:{data:e.imageData,width:n.imageWidth,height:n.imageHeight,resolutionX:n.imageXResolution,resolutionY:n.imageYResolution,bitDepth:n.imageBitDepth}}}return null}cancelGetPage(t){!this.isDestroy&&this.source&&this.pdfReader.cancelReadPage(this.source,t);}}function yc(){var t,e;if(this.isDestroy)return null;if(!this.parserOptions)return null;const i={[exports.EnumAnnotationRenderMode.NO_ANNOTATIONS]:0,[exports.EnumAnnotationRenderMode.RENDER_ANNOTATIONS]:1,[exports.EnumAnnotationRenderMode.LOAD_ANNOTATIONS]:2};return {convertMode:{[exports.EnumConvertMode.CM_IMAGEONLY]:2,[exports.EnumConvertMode.CM_RENDERALL]:1,[exports.EnumConvertMode.CM_AUTO]:3}[(null===(t=this.parserOptions)||void 0===t?void 0:t.convertMode)||exports.EnumConvertMode.CM_AUTO],renderOptions:{...this.parserOptions.renderOptions||{},renderAnnotations:i[null===(e=this.parserOptions.renderOptions)||void 0===e?void 0:e.renderAnnotations]||0,renderIgnoreCrop:!0}}}class mc{constructor(){i(this,"type","rgbaParser"),i(this,"once",!1),i(this,"processor",void 0),i(this,"cachePage",[]),i(this,"source",void 0),i(this,"parserOptions",void 0),this.processor=new wo;}initParser(t,e){this.source=t,this.parserOptions=e;}async getPageCount(){return 1}destroy(){var t;null===(t=this.processor)||void 0===t||t.terminate(),this.processor=void 0;}async parse(){var t;const{outputType:e,jpegQuality:i,returnBase64:n,width:s,height:o,bitDepth:r,xResolution:a,yResolution:l}=null!==(t=this.parserOptions)&&void 0!==t?t:{},h=await this.source.arrayBuffer();await this.processor.initImage({source:h,isRGBA:!0,width:s,height:o,isBGRA:!1});const d=await this.processor.getImage({jpegQuality:i,ifDeleteObject:!0,isRGBA:!0,bitDepth:r,xDpi:a,yDpi:l,returnBlob:!0,returnType:e}),c=wd(d);return d.srcBuffer,this.cachePage=[c],this.cachePage}async parseAnnotations(t,e){return []}async getPage(){return Promise.resolve(this.cachePage[0])}cancelGetPage(t){}}class vc{constructor(){i(this,"db",void 0),this.db=new Map;}saveByMime(t,e){this.db.set(t,e);}hasByMime(t){return this.db.has(t)}deleteConstructorByMime(t){return !!this.hasByMime(t)&&(this.db.delete(t),!0)}getConstructorByMime(t){return this.db.get(t)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear();}}const xc=new class{constructor(){i(this,"db",void 0),this.db=new Map;}saveByFileUid(t,e){this.db.set(t,e);}getParserByFileUid(t){return this.db.get(t)}deleteParserByFileUid(t){return this.db.delete(t)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear();}getAllParsers(){return Array.from(this.db.values())}},wc=new vc,bc=new vc,Cc=new class{constructor(){i(this,"db",void 0),this.db=new Map;}getDefaultOptionsByMime(t){return this.db.get(t)}deleteDefaultOptionsByMime(t){return this.db.delete(t)}saveDefaultOptionsByMime(t,e){this.db.set(t,e);}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear();}};const Sc=new class{constructor(t,e,n){i(this,"parserRepo",void 0),i(this,"parserConstructorRepo",void 0),i(this,"customParserConstructorRepo",void 0),this.parserRepo=t,this.parserConstructorRepo=e,this.customParserConstructorRepo=n;}getParser(t,e){let i=this.parserRepo.getParserByFileUid(t);if(i)return i;return i=new(this.customParserConstructorRepo.getConstructorByMime(e)||this.parserConstructorRepo.getConstructorByMime(e)),i.once||this.parserRepo.saveByFileUid(t,i),i}}(xc,wc,bc);const Pc=new class{constructor(t){i(this,"parserRepo",void 0),this.parserRepo=t;}execute(t){let{fileIndex:e,fileUid:i}=t;const n=this.parserRepo.getParserByFileUid(i);n&&n.cancelGetPage(e);}}(xc),Ac=new class{constructor(t){i(this,"parserRepo",void 0),this.parserRepo=t;}execute(t){const e=this.parserRepo.getParserByFileUid(t);e&&(e.destroy(),this.parserRepo.deleteParserByFileUid(t));}}(xc),Tc=new class{constructor(t,e){i(this,"parserService",void 0),i(this,"parserRepo",void 0),this.parserService=t,this.parserRepo=e;}async execute(t){const{fileData:e,mime:i,fileUid:n,fileIndex:s}=t;let o=this.parserRepo.getParserByFileUid(n);return o||(o=this.parserService.getParser(n,i),o.initParser(e)),o.getPage(s)}}(Sc,xc),kc=new class{constructor(t,e){i(this,"parserService",void 0),i(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e;}async execute(t){const{fileData:e,mime:i,fileUid:n,indices:s}=t;let{parseOptions:o}=t;o=o||this.defaultParserOptionsRepo.getDefaultOptionsByMime(i);const r=this.parserService.getParser(n,i);return r.initParser(e,o),r.parse(s)}}(Sc,Cc),Dc=new class{constructor(t,e){i(this,"parserService",void 0),i(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e;}async execute(t){const{fileData:e,mime:i,fileUid:n,indices:s,parsedPages:o}=t;let{parseOptions:r}=t;r=r||this.defaultParserOptionsRepo.getDefaultOptionsByMime(i);return this.parserService.getParser(n,i).parseAnnotations(s,o)}}(Sc,Cc),Ec=new class{constructor(t){i(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=t;}execute(t){let{mime:e,parser:i}=t;this.parserConstructorRepo.saveByMime(e,i);}}(wc),Ic=new class{constructor(t){i(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=t;}execute(t){this.parserConstructorRepo.deleteConstructorByMime(t);}}(bc),Rc=new class{constructor(t){i(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t;}execute(t){let{mime:e,parser:i}=t;this.customParserConstructorRepo.saveByMime(e,i);}}(wc),Mc=new class{constructor(t){i(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t;}execute(t){this.customParserConstructorRepo.deleteConstructorByMime(t);}}(bc),Bc=new class{constructor(t){i(this,"defaultParserOptionsRepo",void 0),this.defaultParserOptionsRepo=t;}execute(t){return this.defaultParserOptionsRepo.getDefaultOptionsByMime(t)}}(Cc),Lc=new class{constructor(t,e,n){i(this,"defaultParserOptionsRepo",void 0),i(this,"parserConstructorRepo",void 0),i(this,"customParserConstructorRepo",void 0),this.defaultParserOptionsRepo=t,this.parserConstructorRepo=e,this.customParserConstructorRepo=n;}execute(t){let{mime:e,options:i}=t;return !(!i||!Hn(i)||!this.customParserConstructorRepo.hasByMime(e)&&!this.parserConstructorRepo.hasByMime(e))&&(this.defaultParserOptionsRepo.saveDefaultOptionsByMime(e,Vn(i)),!0)}}(Cc,wc,bc),Uc=new class{constructor(t){i(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t;}execute(t){return this.customParserConstructorRepo.getConstructorByMime(t)}}(bc),Oc=new class{constructor(t,e){i(this,"parserService",void 0),i(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e;}async execute(t){var e,i;let{fileData:n,mime:s,fileUid:o,options:r}=t;r=r||this.defaultParserOptionsRepo.getDefaultOptionsByMime(s);const a=this.parserService.getParser(o,s);a.initParser(n,r);return {pageCount:await a.getPageCount(),batchSize:null!==(e=null===(i=r)||void 0===i?void 0:i.batchSize)&&void 0!==e?e:0}}}(Sc,Cc);class Nc{constructor(){i(this,"type",void 0),i(this,"once",!1),i(this,"cachedPage",void 0),i(this,"parserOptions",void 0);}initParser(t,e){this.parserOptions=e;}async getPageCount(){return Promise.resolve(1)}destroy(){}async parse(){const{width:t,height:e,bitDepth:i,resolutionX:n,resolutionY:s}=this.parserOptions,o=wd({imageBitDepth:i,imageHeight:e,imageWidth:t,imageXResolution:n,imageYResolution:s});return this.cachedPage=o,[this.cachedPage]}async parseAnnotations(t,e){return []}async getPage(){const t=await this.createBlankPage(this.parserOptions.width,this.parserOptions.height);return this.cachedPage.resource.data=t,this.cachedPage}cancelGetPage(){}async createBlankPage(t,e){var i,n,s;const o=new Uint8Array([255,255,255,255]),r=new wo;await r.initImage({source:o,isRGBA:!0,width:1,height:1,isBGRA:!1}),await r.resize(t,e);const a=await r.getImage({jpegQuality:null!==(i=this.parserOptions.jpegQuality)&&void 0!==i?i:80,ifDeleteObject:!0,isRGBA:!0,bitDepth:24,xDpi:null!==(n=this.parserOptions.resolutionX)&&void 0!==n?n:96,yDpi:null!==(s=this.parserOptions.resolutionY)&&void 0!==s?s:96,returnBlob:!1,returnType:To[exports.EnumImageDataType.JPEG]});return new Blob([a.imageData],{type:a.blobType})}}exports.EnumDocumentDetectionStatus = void 0;!function(t){t.GOOD="Good",t.AUTO_CAPTURE="AutoCaptured",t.SMALL_SIZE="SmallSize",t.OFF_CENTER="OffCenter",t.SKEW="Skew",t.NOTHING_DETECTED="NothingDetected";}(exports.EnumDocumentDetectionStatus||(exports.EnumDocumentDetectionStatus={}));var Wc,Fc=new WeakSet,Hc=new WeakSet,Vc=new WeakSet,zc=new WeakSet,jc=new WeakSet,$c=new WeakSet,Gc=new WeakSet,Xc=new WeakSet,Yc=new WeakSet,qc=new WeakSet;class Jc{constructor(){y(this,qc),y(this,Yc),y(this,Xc),y(this,Gc),y(this,$c),y(this,jc),y(this,zc),y(this,Vc),y(this,Hc),y(this,Fc),i(this,"detector",void 0),i(this,"succeedDetect",0),i(this,"failedDetect",0),i(this,"autoCaptureStartTime",0),this.succeedDetect=0,this.failedDetect=0;}destroy(){this.clear();}clear(){var t;null===(t=this.detector)||void 0===t||t.terminate(),this.detector=void 0;}async detect(t,e){return Promise.resolve({success:!1})}getStatusMsg(t){switch(t){case exports.EnumDocumentDetectionStatus.AUTO_CAPTURE:return "Auto capture completed.";case exports.EnumDocumentDetectionStatus.GOOD:return "Capturing your document... Please do not move the camera.";case exports.EnumDocumentDetectionStatus.SMALL_SIZE:return "The document is too small. Try moving closer.";case exports.EnumDocumentDetectionStatus.OFF_CENTER:return "Try holding the device at the center of the document.";case exports.EnumDocumentDetectionStatus.SKEW:return "Please hold the device over a document to start scanning.";case exports.EnumDocumentDetectionStatus.NOTHING_DETECTED:return "No document is detected."}}processDetectResult(t){if([].concat(...t.location).every((t=>0===t)))return {success:!1,confidence:0,status:exports.EnumDocumentDetectionStatus.NOTHING_DETECTED};let e;const i=this.calculateConfidence(t.location,t.width,t.height);e=zn(t.confidence)?this.calculateTotalConfidence(i):t.confidence;const n={success:!0,location:t.location,confidence:e},{angleConfidence:s,areaConfidence:o,centerConfidence:r}=i,{config:a}=t;if(e>=(null==a?void 0:a.acceptedPolygonConfidence))if(this.succeedDetect+=1,n.status=exports.EnumDocumentDetectionStatus.GOOD,this.succeedDetect,5===this.succeedDetect||this.succeedDetect,null!=a&&a.enableAutoCapture)if(this.autoCaptureStartTime<=0)this.autoCaptureStartTime=(new Date).getTime();else {(new Date).getTime()-this.autoCaptureStartTime>a.autoCaptureDelay&&(this.autoCaptureStartTime=0,n.status=exports.EnumDocumentDetectionStatus.AUTO_CAPTURE);}else this.autoCaptureStartTime=0;else .45*s+.45*r+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),n.status=exports.EnumDocumentDetectionStatus.SMALL_SIZE):.45*s+.45*o+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),n.status=exports.EnumDocumentDetectionStatus.OFF_CENTER):.45*o+.45*r+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),n.status=exports.EnumDocumentDetectionStatus.SKEW):(n.success=!1,n.status=exports.EnumDocumentDetectionStatus.NOTHING_DETECTED,this.failedDetect+=1,this.autoCaptureStartTime=0);return this.failedDetect>5&&this.reset(),n.statusMsg=this.getStatusMsg(n.status),n}calculateConfidence(t,e,i){return p(this,Vc,Qc).call(this,p(this,Fc,Zc).call(this,t),e,i)}calculateTotalConfidence(t){const{angleConfidence:e,areaConfidence:i,centerConfidence:n}=t;return e&&i&&n?.3*e+.3*i+.3*n+10:0}reset(){this.succeedDetect=0,this.failedDetect=0,this.autoCaptureStartTime=0;}}function Zc(t){if(!t)return [0,0,0,0,0,0,0,0];return [t[0][0],t[0][1],t[1][0],t[1][1],t[2][0],t[2][1],t[3][0],t[3][1]]}function Qc(t,e,i){return {angleConfidence:p(this,zc,Kc).call(this,t),areaConfidence:p(this,jc,tu).call(this,t,e,i),centerConfidence:p(this,$c,eu).call(this,t,e,i)}}function Kc(t){let e=0;const i=p(this,Xc,nu).call(this,[t[0],t[1]],[t[2],t[3]],[t[4],t[5]]),n=p(this,Xc,nu).call(this,[t[2],t[3]],[t[4],t[5]],[t[6],t[7]]),s=p(this,Xc,nu).call(this,[t[4],t[5]],[t[6],t[7]],[t[0],t[1]]),o=p(this,Xc,nu).call(this,[t[6],t[7]],[t[0],t[1]],[t[2],t[3]]);return e+=Math.abs(i-90),e+=Math.abs(n-90),e+=Math.abs(s-90),e+=Math.abs(o-90),Math.max(0,100*Math.min(1,1-.025*e))}function tu(t,e,i){const n=p(this,qc,ou).call(this,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);return Math.min(100,400*Math.max(0,n/(e*i)))}function eu(t,e,i){const n=[(t[0]+t[2]+t[4]+t[6])/4,(t[1]+t[3]+t[5]+t[7])/4],s=p(this,Gc,iu).call(this,n,[e/2,i/2]);return Math.max(0,100*Math.min(1,1-s/Math.min(e,i)))}function iu(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function nu(t,e,i){const n=p(this,Gc,iu).call(this,e,t),s=p(this,Gc,iu).call(this,e,i),o=p(this,Gc,iu).call(this,t,i);return 0===n||0===s?0:Math.acos((n*n+s*s-o*o)/(2*n*s))/Math.PI*180}function su(t,e,i,n,s,o){return (t*n+e*s+i*o-s*n-o*t-i*e)/2}function ou(t,e,i,n,s,o,r,a){return p(this,Yc,su).call(this,t,e,i,n,s,o)+p(this,Yc,su).call(this,t,e,s,o,r,a)}!function(t){t.NONE="none",t.BLACK_AND_WHITE="blackAndWhite",t.GRAY="gray",t.REMOVE_SHADOW="removeShadow",t.SAVE_INK="saveInk",t.ENHANCE="enhance",t.INVERT="invert",t.BRIGHTNESS="brightness",t.CONTRAST="contrast",t.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast";}(Wc||(Wc={}));var ru=new WeakMap,au=new WeakMap,lu=new WeakSet,hu=new WeakSet,du=new WeakSet;async function cu(t,e,i,n){var s;return await(null===(s=this.filter)||void 0===s?void 0:s.applyFilter(t,e))}function uu(t){return n(this,ru).push(t),n(this,au)||(s(this,au,!0),p(this,du,pu).call(this)),t.promise}async function pu(){do{if(n(this,ru).isEmpty())break;const t=n(this,ru).pop();try{let e;if("filter"===(null==t?void 0:t.api))e=await p(this,lu,cu).apply(this,t.params);null==t||t.resolve(e);}catch(e){t.retry<1?(t.retry+=1,n(this,ru).push(t)):null==t||t.reject(e);}}while(!n(this,ru).isEmpty());s(this,au,!1);}const gu=new Map([[Wc.NONE,"None"],[Wc.BLACK_AND_WHITE,"toBW"],[Wc.GRAY,"toGray"],[Wc.REMOVE_SHADOW,"removeShadow"],[Wc.SAVE_INK,"toBW"],[Wc.ENHANCE,"enhance"],[Wc.INVERT,"invert"],[Wc.CONTRAST,"brightnessAndContrast"],[Wc.BRIGHTNESS,"brightnessAndContrast"],[Wc.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var fu,yu=new WeakSet,mu=new WeakSet;function vu(t,e){const i={...e||{}};return t===Wc.SAVE_INK&&(i.method="adaptiveThreshold"),i}function xu(t){var e,i;(t.returnType=To[t.outputType],t.bRGBA=t.outputType===exports.EnumImageDataType.RGBA,t.returnBlob=null!==(e=t.returnBlob)&&void 0!==e&&e,t.bRGBA&&void 0===t.returnType)?t.returnType=po.IT_JPG:t.returnType=null!==(i=t.returnType)&&void 0!==i?i:po.IT_ALL;return t.is1BitTo8Bit=so.isApple,t}class wu{static replaceMessage(t,e,i){let n=t;return e&&(n=n.replace("<%api%>",e)),i&&(n=n.replace("<%param%>",i)),n}static getLastError(){return this.lastError}static clearLastError(){this.lastError=null;}static buildError(t,e,i){if(t&&!t.code&&t.cause&&t.cause.code&&t.cause.message)return Zn(t.message)&&(t.message=this.replaceMessage(t.message,e,i)),t;const n={code:t.code,message:t.message};null!=t&&t.details&&(n.details=t.details);let s={...t};return n.code>-8e4&&0!==n.code?n.code<=-2e4||(n.code=wu.WASM_ERR.code,n.message=wu.WASM_ERR.message,s.actualCode=s.code,s.code=n.code):n.code?(n.message=this.replaceMessage(n.message,e,i),s={...n},Array.isArray(n.details)&&0!==n.details.length&&(s.details=n.details)):(n.code=wu.EXTERNAL_ERR.code,n.message=wu.EXTERNAL_ERR.message,s.actualCode=t.code,s.message=t.message,t.name&&(s.name=t.name),t.stack&&(s.stack=t.stack),s.code=n.code,s.actualError=t),new Error(n.message,{cause:s})}static warning(t,e,i){const n=wu.buildError(t,e,i);this.lastError=n,this.onWarning.emit(n);}static error(t,e,i){const n=wu.buildError(t,e,i);throw this.lastError=n,this.onError.emit(n),n}static verbose(t,e,i){this.onVerbose.emit(t);}static throw(t,e,i){const n=wu.buildError(t,e,i);throw this.lastError=n,this.onError.emit(n),n}static reject(t,e,i){const n=wu.buildError(t,e,i);return this.lastError=n,this.onError.emit(n),Promise.reject(n)}static buildInfo(t,e){const i={details:e,id:wu.infoObjCount,status:"Pending",timestamp:Date.now(),type:t};return wu.infoObjCount+=1,i}static info(t){t.timestamp=Date.now(),this.onInfo.emit(Vn(t));}static on(t,e){"error"===t?this.onError.on(e):"verbose"===t?(this.onVerbose.on(e),0!==this.verboseListenerCount&&so.hasDebugOutput()||(so.enableDebugOutput(!0,(t=>{this.verbose(t);})),this.verboseListenerCount+=1)):"warning"===t?this.onWarning.on(e):"info"===t&&this.onInfo.on(e);}static off(t,e){"error"===t?this.onError.off(e):"verbose"===t?(this.onVerbose.off(e),this.verboseListenerCount-=1,0===this.verboseListenerCount&&so.enableDebugOutput(!1,void 0)):"warning"===t?this.onWarning.off(e):"info"===t&&this.onInfo.off(e);}}function bu(t,e,i,n){return e?i?`${e}${n?"":"."}${i}`:`${e}`:i?`${t}${n?"":"."}${i}`:`${t}`}i(wu,"onError",new os),i(wu,"onWarning",new os),i(wu,"onVerbose",new os),i(wu,"onInfo",new os),i(wu,"verboseListenerCount",0),i(wu,"infoObjCount",0),i(wu,"lastError",void 0),i(wu,"LIC_EMPTY",{code:-8e4,message:"No license."}),i(wu,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),i(wu,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),i(wu,"LIC_MISS_MODULE",{code:-80003,message:"XXX module license is missing."}),i(wu,"LIC_VER_NOT_MATCHED",{code:-80004,message:"XXX module license version does not match."}),i(wu,"LIC_DOMAIN_NOT_MATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),i(wu,"INIT_SHOULD_SET_CONFIG",{code:-80050,message:"DDV.Core.init() has not been set up yet."}),i(wu,"INIT_CONFIG_NOT_DONE",{code:-80051,message:"DDV.Core.init() has not been completed."}),i(wu,"RESOURCE_NOT_FOUND",{code:-80052,message:"<%api%>: Resource is not found from the specified engineResourcePath."}),i(wu,"WASM_ERR",{code:-81e3,message:"WASM Error"}),i(wu,"PARAM_INVALID",{code:-80100,message:"<%api%>: '<%param%>' is invalid."}),i(wu,"PARAM_OUT_OF_RANGE",{code:-80101,message:"<%api%>: '<%param%>' is out of range."}),i(wu,"PARAM_MISS",{code:-80102,message:"<%api%>: '<%param%>' is missing."}),i(wu,"PARAM_NOT_SUPPORT",{code:-80103,message:"<%api%>: The value for '<%param%>' is not supported."}),i(wu,"DOC_NOT_EXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),i(wu,"PAGE_NOT_EXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),i(wu,"ANNOTATION_NOT_EXIST",{code:-80106,message:"<%api%>: The specified annotation does not exist."}),i(wu,"FILE_NOT_SUPPORT",{code:-80200,message:"File type is not supported."}),i(wu,"DOC_UID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),i(wu,"CONTAINER_NOT_EXIST",{code:-80301,message:"The specified container does not exist."}),i(wu,"MIN_ZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),i(wu,"MAX_ZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),i(wu,"DOC_NOT_OPEN",{code:-80304,message:"No document opened."}),i(wu,"DOC_NO_IMAGE",{code:-80305,message:"There is no image in the current document."}),i(wu,"ZOOM_TOO_LARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),i(wu,"ZOOM_TOO_SMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),i(wu,"ROW_COLUMN_CAN_NOT_CHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),i(wu,"RECT_EXCEED_PAGE_BOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),i(wu,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),i(wu,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),i(wu,"QUAD_EXCEED_PAGE_BOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),i(wu,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element '<%param%>' is not supported in <%api%> class."}),i(wu,"TOOL_MODE_NOT_AVAILABLE",{code:-80314,message:"<%api%>: Not available in current toolMode."}),i(wu,"DOC_DETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),i(wu,"IMG_FILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),i(wu,"ANNOTATION_SELECT",{code:-80317,message:"The specified annotation(s) is not on the current page or does not exist."}),i(wu,"WASM_FONT_LOSS",{code:-80318,message:"The document contains unsupported fonts, which may result in font loss after saving."}),i(wu,"UNSELECTED_READONLY",{code:-80319,message:"ReadOnly annotation or noView annotation cannot be selected."}),i(wu,"UNSELECTED_UNKNOWN",{code:-80320,message:"Unknown annotation or incomplete annotation cannot be selected."}),i(wu,"UNSELECTED_FLATTENED",{code:-80320,message:"Flattened annotation cannot be selected."}),i(wu,"CAMERA_NOT_EXIST",{code:-80400,message:"The specified camera does not exist."}),i(wu,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),i(wu,"CAMERA_NO_VIDEO",{code:-80402,message:"No video stream is played."}),i(wu,"CAMERA_NEED_HTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),i(wu,"CAMERA_NOT_SUPPORT_TORCH",{code:-80404,message:"The camera does not support a flashlight."}),i(wu,"CAMERA_NO_CAMERA",{code:-80405,message:"No camera available."}),i(wu,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),i(wu,"CONTAINER_NO_BOUND",{code:-80407,message:"No bound container."}),i(wu,"EXTERNAL_ERR",{code:-81100,message:"External Error"});class Cu{static makeSureValid(t,e,i,n){const s=this.composeError(i,n);wu.throw(s,t,e);}static output(t,e,i,n,s){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=this.composeError(n,s);return 2===t?wu.reject(r,e,i):1===t?(wu.warning(r,e,i),o):0===t?wu.error(r,e,i):3===t?wu.verbose(r,e,i):void 0}static error(t,e,i,n){const s=this.composeError(i,n);wu.throw(s,t,e);}static warning(t,e,i,n){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=this.composeError(i,n);return wu.warning(o,t,e),s}static verbose(t,e,i,n){const s=this.composeError(i,n);wu.verbose(s,t,e);}static reject(t,e,i,n){const s=this.composeError(i,n);return wu.reject(s,t,e)}static composeError(t,e){const i={...zn(e)?wu.PARAM_INVALID:e};return t&&(i.details=t),i}static formatDetails(t,e){const i=[];if(Xn(e))e||i.push(`'${t}' is invalid.`);else {const{isValid:n,isInRange:s,isSupported:o}=e;!1===n&&i.push(`'${t}' is invalid.`),!1===s&&i.push(`'${t}' is out of range.`),!1===o&&i.push(`'${t}' is not supported.`);}return i}static formatError(t,e){const{isValid:i,isInRange:n,isSupported:s}=t;if(!1===i||!1===n||!1===s){if(e)return e;if(!i)return wu.PARAM_INVALID;if(!n)return wu.PARAM_OUT_OF_RANGE;if(!s)return wu.PARAM_NOT_SUPPORT}return null}static isArrayBufferOrBlob(t){return $n(t)||Gn(t)}static isArrayAndMeetMinLength(t,e){return Fn(t)?Jn(e)?{isValid:0!==t.length,isInRange:t.length>=e}:{isValid:!0}:{isValid:!1}}static isNumberAndIsInRange(t,e,i){return Jn(t)?{isValid:!0,isInRange:!(!zn(e)&&t<e||!zn(i)&&t>i)}:{isValid:!1}}static isStringAndNotEmpty(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Zn(t)?e?{isValid:!0}:{isValid:0!==t.trim().length}:{isValid:!1}}static isPdfDate(t){if(!Zn(t))return {isValid:!1};const e=t.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['’](\d{2})['’]|)$/);let i=!1;if(e){const[,t,n,s,o,r,a,l,h,d]=e,c=new Date(`${t}-${n}-${s}T${o}:${r}:${a}`);if(i=!0,c.getFullYear()===parseInt(t,10)&&c.getMonth()+1===parseInt(n,10)&&c.getDate()===parseInt(s,10)&&c.getHours()===parseInt(o,10)&&c.getMinutes()===parseInt(r,10)&&c.getSeconds()===parseInt(a,10)||(i=!1),i&&l){const t=parseInt(h,10),e=parseInt(d,10);(t<0||t>12||e<0||e>59||"+"!==l&&"-"!==l)&&(i=!1);}}return {isSupported:i}}}!function(t){t[t.BlackAndWhite=1]="BlackAndWhite",t[t.Gray=2]="Gray",t[t.RemoveShadow=3]="RemoveShadow",t[t.Enhance=4]="Enhance",t[t.Invert=5]="Invert",t[t.Brightness=6]="Brightness",t[t.Contrast=7]="Contrast",t[t.BrightnessAndContrast=8]="BrightnessAndContrast",t[t.Perspective=9]="Perspective",t[t.Deskew=10]="Deskew",t[t.Rotate=11]="Rotate",t[t.Flip=12]="Flip",t[t.Resize=13]="Resize",t[t.SetHeight=14]="SetHeight",t[t.SetWidth=15]="SetWidth",t[t.SetDPI=16]="SetDPI",t[t.Crop=17]="Crop",t[t.Erase=18]="Erase",t[t.DrawPolygon=19]="DrawPolygon";}(fu||(fu={}));var Su=new WeakSet,Pu=new WeakSet;class Au{constructor(){y(this,Pu),y(this,Su);}async process(t,e,i){Fn(e)||(e=[e]),p(this,Su,Tu).call(this,e);const n=new wo,s={inputImageInfo:null,output:null,outputImageInfo:null,outputContentType:"",outputType:null};try{var o,r,a,l;const h=await n.initImage({source:t.data,isRGBA:t.type===exports.EnumImageDataType.RGBA,width:t.width,height:t.height,isBGRA:t.type===exports.EnumImageDataType.BGRA});h.srcBuffer&&(t.data=h.srcBuffer);for(const t of e)p(this,Pu,ku).call(this,n,t);const d=await n.getImage({jpegQuality:null==i||null===(o=i.params)||void 0===o?void 0:o.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===exports.EnumImageDataType.RGBA,bitDepth:null==i||null===(r=i.params)||void 0===r?void 0:r.bitDepth,xDpi:null==i||null===(a=i.params)||void 0===a?void 0:a.xDpi,yDpi:null==i||null===(l=i.params)||void 0===l?void 0:l.yDpi,returnBlob:!1,returnType:To[null==i?void 0:i.type]});await n.freeReservedData(),s.output=d.imageData,s.outputContentType=d.blobType,s.outputImageInfo={width:d.imageWidth,height:d.imageHeight,bitDepth:d.imageBitDepth,resolutionX:d.imageXResolution,resolutionY:d.imageYResolution},s.outputType=ko[d.imageType];}finally{try{await n.terminate();}catch(t){wu.warning(t);}}return s}}function Tu(t){for(const e of t)e.type&&(e.type<=0||(e.type,fu.DrawPolygon),e.params);}async function ku(t,e){var i;const n=null!==(i=e.params)&&void 0!==i?i:{};switch(e.type){case fu.BlackAndWhite:return t.toBinaryLevel(n.saveInk,n.level);case fu.Gray:return t.toGrayscale(n.level);case fu.RemoveShadow:return t.removeShadowLevel(n.level,n.alpha);case fu.Enhance:return t.brighten();case fu.Invert:return t.invert();case fu.Contrast:return t.changeBrightnessAndContrast(void 0,n.contrast);case fu.Brightness:return t.changeBrightnessAndContrast(n.brightness,void 0);case fu.BrightnessAndContrast:return t.changeBrightnessAndContrast(n.brightness,n.contrast);case fu.Perspective:return t.perspective(n.location);case fu.Deskew:{var s;const e=await t.getSkewAngle(n.options);return t.rotate({angle:e,fillColor:n.fillColor,keepSize:null===(s=n.keepSize)||void 0===s||s,mode:n.mode})}case fu.Rotate:return t.rotate({angle:n.angle,fillColor:n.fillColor,keepSize:n.keepSize,mode:n.mode});case fu.Flip:return t.flip();case fu.Resize:{const{newWidth:e,newHeight:i,mode:s}=n;return t.resize(e,i,s)}case fu.SetHeight:{const{newHeight:e,fillColor:i}=n;return t.setImageHeight(e,i)}case fu.SetWidth:{const{newWidth:e,fillColor:i}=n;return t.setImageWidth(e,i)}case fu.SetDPI:return t.setDpi({rawResolutionX:0,rawResolutionY:0,resolutionX:n.xRes,resolutionY:n.yRes,resample:!1});case fu.Crop:return t.crop({left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top});case fu.Erase:return t.erase({left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top},n.fillColor);case fu.DrawPolygon:return t.drawQuadrangle({location:n.location,strokeColor:n.strokeColor,lineWidth:n.lineWidth})}}!un&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!un&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Du=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t;if(i._pLoad.isEmpty){let t,n,s,o=i._license||"",r=JSON.parse(JSON.stringify(i._licenseServer)),a=i._sessionPassword,l=0;if(o.startsWith("t")||o.startsWith("f"))l=0;else if(0===o.length||o.startsWith("P")||o.startsWith("L")||o.startsWith("Y")||o.startsWith("A"))l=1;else {l=2;const e=o.indexOf(":");-1!=e&&(o=o.substring(e+1));const i=o.indexOf("?");if(-1!=i&&(n=o.substring(i+1),o=o.substring(0,i)),o.startsWith("DLC2"))l=0;else {if(o.startsWith("DLS2")){let e;try{let t=o.substring(4);t=atob(t),e=JSON.parse(t);}catch(t){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(o=e.handshakeCode?e.handshakeCode:e.organizationID?e.organizationID:"","number"==typeof o&&(o=JSON.stringify(o)),0===r.length){let t=[];e.mainServerURL&&(t[0]=e.mainServerURL),e.standbyServerURL&&(t[1]=e.standbyServerURL),r=(t=>{if(null==t)t=[];else {t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!un){let i=document.createElement("a");i.href=t[e],t[e]=i.href;}t[e].endsWith("/")||(t[e]+="/");}}return t})(t);}!a&&e.sessionPassword&&(a=e.sessionPassword),t=e.remark;}o&&"200001"!==o&&!o.startsWith("200001-")||(l=1);}}if(l&&(e||(pn.crypto||(s="Please upgrade your browser to support online key."),pn.crypto.subtle||(s="Require https to use online key in this browser."))),s){if(1!==l)throw new Error(s);l=0,i._lastErrorCode=-1,i._lastErrorString=s;}return 1===l&&(o=""),{lt:l,l:o,ls:r,sp:a,rmk:t,cv:n}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")},Eu=async(t,e,i)=>{if(!t._bNeverShowDialog)try{let n=await fetch(t.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let s=await n.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=s;let r=[];for(let t=0;t<o.childElementCount;++t){let e=o.children[t];e instanceof HTMLStyleElement&&(r.push(e),document.head.append(e));}let a=1==o.childElementCount?o.children[0]:o;a.remove();let l,h,d,c,u,p=[a],g=a.children;for(let t of g)p.push(t);for(let t=0;t<p.length;++t)for(let e of p[t].children)p.push(e);for(let t of p)if(!l&&t.classList.contains("dls-license-mask"))l=t,t.addEventListener("click",(e=>{if(t==e.target){a.remove();for(let t of r)t.remove();}}));else if(!h&&t.classList.contains("dls-license-icon-close"))h=t,t.addEventListener("click",(()=>{a.remove();for(let t of r)t.remove();}));else if(!d&&t.classList.contains("dls-license-icon-error"))d=t,"error"!=e&&t.remove();else if(!c&&t.classList.contains("dls-license-icon-warn"))c=t,"warn"!=e&&t.remove();else if(!u&&t.classList.contains("dls-license-msg-content")){u=t;let e=i;for(;e;){let i=e.indexOf("["),n=e.indexOf("]",i),s=e.indexOf("(",n),o=e.indexOf(")",s);if(-1==i||-1==n||-1==s||-1==o){t.appendChild(new Text(e));break}i>0&&t.appendChild(new Text(e.substring(0,i)));let r=document.createElement("a"),a=e.substring(i+1,n);r.innerText=a;let l=e.substring(s+1,o);r.setAttribute("href",l),r.setAttribute("target","_blank"),t.appendChild(r),e=e.substring(o+1);}}document.body.appendChild(a);}catch(e){t._onLog&&t._onLog(e.message||e);}};var Iu=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function Ru(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(s){if("TypeError"!==s.name)throw s;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}function Mu(t,e){e&&t.then((function(t){e(null,t);}),(function(t){e(t);}));}function Bu(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i);}function Lu(t){return "string"!=typeof t&&(t=String(t)),t}function Uu(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const Ou="local-forage-detect-blob-support";let Nu;const _u={},Wu=Object.prototype.toString,Fu="readonly",Hu="readwrite";function Vu(t){return "boolean"==typeof Nu?Promise.resolve(Nu):function(t){return new Promise((function(e){var i=t.transaction(Ou,Hu),n=Ru([""]);i.objectStore(Ou).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1);},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43);};})).catch((function(){return !1}))}(t).then((function(t){return Nu=t,Nu}))}function zu(t){var e=_u[t.name],i={};i.promise=new Promise((function(t,e){i.resolve=t,i.reject=e;})),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then((function(){return i.promise})):e.dbReady=i.promise;}function ju(t){var e=_u[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function $u(t,e){var i=_u[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function Gu(t,e){return new Promise((function(i,n){if(_u[t.name]=_u[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);zu(t),t.db.close();}var s=[t.name];e&&s.push(t.version);var o=Iu.open.apply(Iu,s);e&&(o.onupgradeneeded=function(e){var i=o.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(Ou);}catch(t){if("ConstraintError"!==t.name)throw t}}),o.onerror=function(t){t.preventDefault(),n(o.error);},o.onsuccess=function(){var e=o.result;e.onversionchange=function(t){t.target.close();},i(e),ju(t);};}))}function Xu(t){return Gu(t,!1)}function Yu(t){return Gu(t,!0)}function qu(t,e){if(!t.db)return !0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,s=t.version>t.db.version;if(n&&(t.version,t.version=t.db.version),s||i){if(i){var o=t.db.version+1;o>t.version&&(t.version=o);}return !0}return !1}function Ju(t){var e=function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),s=0;s<e;s++)n[s]=t.charCodeAt(s);return i}(atob(t.data));return Ru([e],{type:t.type})}function Zu(t){var e=this,i=e._initReady().then((function(){var t=_u[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return Bu(i,t,t),i}function Qu(t,e,i,n){void 0===n&&(n=1);try{var s=t.db.transaction(t.storeName,e);i(null,s);}catch(s){if(n>0&&(!t.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return Promise.resolve().then((()=>{if(!t.db||"NotFoundError"===s.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),Yu(t)})).then((()=>function(t){zu(t);for(var e=_u[t.name],i=e.forages,n=0;n<i.length;n++){const t=i[n];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null);}return t.db=null,Xu(t).then((e=>(t.db=e,qu(t)?Yu(t):e))).then((n=>{t.db=e.db=n;for(var s=0;s<i.length;s++)i[s]._dbInfo.db=n;})).catch((e=>{throw $u(t,e),e}))}(t).then((function(){Qu(t,e,i,n-1);})))).catch(i);i(s);}}var Ku={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]=t[n];var s=_u[i.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},_u[i.name]=s),s.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=Zu);var o=[];function r(){return Promise.resolve()}for(var a=0;a<s.forages.length;a++){var l=s.forages[a];l!==e&&o.push(l._initReady().catch(r));}var h=s.forages.slice(0);return Promise.all(o).then((function(){return i.db=s.db,Xu(i)})).then((function(t){return i.db=t,qu(i,e._defaultConfig.version)?Yu(i):t})).then((function(t){i.db=s.db=t,e._dbInfo=i;for(var n=0;n<h.length;n++){var o=h[n];o!==e&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version);}}))},_support:function(){try{if(!Iu||!Iu.open)return !1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return (!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return !1}}(),getItem:function(t,e){var i=this;t=Lu(t);var n=new Promise((function(e,n){i.ready().then((function(){Qu(i._dbInfo,Fu,(function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).get(t);r.onsuccess=function(){var t=r.result;void 0===t&&(t=null),function(t){return t&&t.__local_forage_encoded_blob}(t)&&(t=Ju(t)),e(t);},r.onerror=function(){n(r.error);};}catch(t){n(t);}}));})).catch(n);}));return Mu(n,e),n},setItem:function(t,e,i){var n=this;t=Lu(t);var s=new Promise((function(i,s){var o;n.ready().then((function(){return o=n._dbInfo,"[object Blob]"===Wu.call(e)?Vu(o.db).then((function(t){return t?e:(i=e,new Promise((function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){var n=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:i.type});},n.readAsBinaryString(i);})));var i;})):e})).then((function(e){Qu(n._dbInfo,Hu,(function(o,r){if(o)return s(o);try{var a=r.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);r.oncomplete=function(){void 0===e&&(e=null),i(e);},r.onabort=r.onerror=function(){var t=l.error?l.error:l.transaction.error;s(t);};}catch(t){s(t);}}));})).catch(s);}));return Mu(s,i),s},removeItem:function(t,e){var i=this;t=Lu(t);var n=new Promise((function(e,n){i.ready().then((function(){Qu(i._dbInfo,Hu,(function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).delete(t);o.oncomplete=function(){e();},o.onerror=function(){n(r.error);},o.onabort=function(){var t=r.error?r.error:r.transaction.error;n(t);};}catch(t){n(t);}}));})).catch(n);}));return Mu(n,e),n},clear:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){Qu(e._dbInfo,Hu,(function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).clear();s.oncomplete=function(){t();},s.onabort=s.onerror=function(){var t=o.error?o.error:o.transaction.error;i(t);};}catch(t){i(t);}}));})).catch(i);}));return Mu(i,t),i},length:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){Qu(e._dbInfo,Fu,(function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result);},o.onerror=function(){i(o.error);};}catch(t){i(t);}}));})).catch(i);}));return Mu(i,t),i},keys:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){Qu(e._dbInfo,Fu,(function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).openKeyCursor(),r=[];o.onsuccess=function(){var e=o.result;e?(r.push(e.key),e.continue()):t(r);},o.onerror=function(){i(o.error);};}catch(t){i(t);}}));})).catch(i);}));return Mu(i,t),i},dropInstance:function(t,e){e=Uu.apply(this,arguments);var i,n=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName),t.name){const e=t.name===n.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):Xu(t).then((e=>{const i=_u[t.name],n=i.forages;i.db=e;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=e;return e}));i=t.storeName?e.then((e=>{if(!e.objectStoreNames.contains(t.storeName))return;const i=e.version+1;zu(t);const n=_u[t.name],s=n.forages;e.close();for(let t=0;t<s.length;t++){const e=s[t];e._dbInfo.db=null,e._dbInfo.version=i;}const o=new Promise(((e,n)=>{const s=Iu.open(t.name,i);s.onerror=t=>{s.result.close(),n(t);},s.onupgradeneeded=()=>{s.result.deleteObjectStore(t.storeName);},s.onsuccess=()=>{const t=s.result;t.close(),e(t);};}));return o.then((t=>{n.db=t;for(let e=0;e<s.length;e++){const i=s[e];i._dbInfo.db=t,ju(i._dbInfo);}})).catch((e=>{throw ($u(t,e)||Promise.resolve()).catch((()=>{})),e}))})):e.then((e=>{zu(t);const i=_u[t.name],n=i.forages;e.close();for(var s=0;s<n.length;s++){n[s]._dbInfo.db=null;}const o=new Promise(((e,i)=>{var n=Iu.deleteDatabase(t.name);n.onerror=()=>{const t=n.result;t&&t.close(),i(n.error);},n.onblocked=()=>{},n.onsuccess=()=>{const t=n.result;t&&t.close(),e(t);};}));return o.then((t=>{i.db=t;for(var e=0;e<n.length;e++){ju(n[e]._dbInfo);}})).catch((e=>{throw ($u(t,e)||Promise.resolve()).catch((()=>{})),e}))}));}else i=Promise.reject("Invalid arguments");return Mu(i,e),i}};const tp=new Map;function ep(t,e){let i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}var ip={_driver:"tempStorageWrapper",_initStorage:async function(t){const e={};if(t)for(let i in t)e[i]=t[i];const i=e.keyPrefix=ep(t,this._defaultConfig);this._dbInfo=e,tp.has(i)||tp.set(i,new Map);},getItem:function(t,e){t=Lu(t);const i=this.ready().then((()=>tp.get(this._dbInfo.keyPrefix).get(t)));return Mu(i,e),i},setItem:function(t,e,i){t=Lu(t);const n=this.ready().then((()=>(void 0===e&&(e=null),tp.get(this._dbInfo.keyPrefix).set(t,e),e)));return Mu(n,i),n},removeItem:function(t,e){t=Lu(t);const i=this.ready().then((()=>{tp.get(this._dbInfo.keyPrefix).delete(t);}));return Mu(i,e),i},clear:function(t){const e=this.ready().then((()=>{const t=this._dbInfo.keyPrefix;tp.has(t)&&tp.delete(t);}));return Mu(e,t),e},length:function(t){const e=this.ready().then((()=>tp.get(this._dbInfo.keyPrefix).size));return Mu(e,t),e},keys:function(t){const e=this.ready().then((()=>[...tp.get(this._dbInfo.keyPrefix).keys()]));return Mu(e,t),e},dropInstance:function(t,e){if(e=Uu.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){const e=this.config();t.name=t.name||e.name,t.storeName=t.storeName||e.storeName;}let i;return i=t.name?new Promise((e=>{t.storeName?e(ep(t,this._defaultConfig)):e(`${t.name}/`);})).then((t=>{tp.delete(t);})):Promise.reject("Invalid arguments"),Mu(i,e),i}};const np=(t,e)=>t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e),sp=(t,e)=>{const i=t.length;let n=0;for(;n<i;){if(np(t[n],e))return !0;n++;}return !1},op=Array.isArray||function(t){return "[object Array]"===Object.prototype.toString.call(t)},rp={},ap={},lp={INDEXEDDB:Ku,TEMPSTORAGE:ip},hp=[lp.INDEXEDDB._driver,lp.TEMPSTORAGE._driver],dp=["dropInstance"],cp=["clear","getItem","keys","length","removeItem","setItem"].concat(dp),up={description:"",driver:hp.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function pp(t,e){t[e]=function(){const i=arguments;return t.ready().then((function(){return t[e].apply(t,i)}))};}function gp(){for(let t=1;t<arguments.length;t++){const e=arguments[t];if(e)for(let t in e)e.hasOwnProperty(t)&&(op(e[t])?arguments[0][t]=e[t].slice():arguments[0][t]=e[t]);}return arguments[0]}class fp{constructor(t){for(let t in lp)if(lp.hasOwnProperty(t)){const e=lp[t],i=e._driver;this[t]=i,rp[i]||this.defineDriver(e);}this._defaultConfig=gp({},up),this._config=gp({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}));}config(t){if("object"==typeof t){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e];}return !("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return "string"==typeof t?this._config[t]:this._config}defineDriver(t,e,i){const n=new Promise((function(e,i){try{const n=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(s);const o=cp.concat("_initStorage");for(let e=0,n=o.length;e<n;e++){const n=o[e];if((!sp(dp,n)||t[n])&&"function"!=typeof t[n])return void i(s)}const r=function(){const e=function(t){return function(){const e=new Error(`Method ${t} is not implemented by the current driver`),i=Promise.reject(e);return Mu(i,arguments[arguments.length-1]),i}};for(let i=0,n=dp.length;i<n;i++){const n=dp[i];t[n]||(t[n]=e(n));}};r();const a=function(i){rp[n],rp[n]=t,ap[n]=i,e();};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(a,i):a(!!t._support):a(!0);}catch(t){i(t);}}));return Bu(n,e,i),n}driver(){return this._driver||null}getDriver(t,e,i){const n=rp[t]?Promise.resolve(rp[t]):Promise.reject(new Error("Driver not found."));return Bu(n,e,i),n}ready(t){const e=this,i=e._driverSet.then((()=>(null===e._ready&&(e._ready=e._initDriver()),e._ready)));return Bu(i,t,t),i}setDriver(t,e,i){const n=this;op(t)||(t=[t]);const s=this._getSupportedDrivers(t);function o(){n._config.driver=n.driver();}function r(t){return n._extend(t),o(),n._ready=n._initStorage(n._config),n._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>Promise.resolve())):Promise.resolve();return this._driverSet=a.then((()=>{const t=s[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then((t=>{n._driver=t._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(t){return function(){let e=0;return function i(){for(;e<t.length;){let s=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(s).then(r).catch(i)}o();const s=new Error("No available storage method found.");return n._driverSet=Promise.reject(s),n._driverSet}()}}(s);}))})).catch((()=>{o();const t=new Error("No available storage method found.");return n._driverSet=Promise.reject(t),n._driverSet})),Bu(this._driverSet,e,i),this._driverSet}supports(t){return !!ap[t]}_extend(t){gp(this,t);}_getSupportedDrivers(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];this.supports(n)&&e.push(n);}return e}_wrapLibraryMethodsWithReady(){for(let t=0,e=cp.length;t<e;t++)pp(this,cp[t]);}createInstance(t){return new fp(t)}}var yp=new fp;Date.prototype.kUtilFormat=function(t){const e={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("000"+e[i]).substr(("000"+e[i]).length-RegExp.$1.length)));return t},String.prototype.startsWith||(String.prototype.startsWith=function(t){return 0==this.indexOf(t)});let mp=t=>{let e,i,n,s,o,r,a,l,h,d,c,u,p,g,f,y,m,v,x,w,b,C,S=t.fetch||pn.fetch,P=t.btoa||pn.btoa,A=t.atob||pn.atob,T=t.bd,k=t.dm,D=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],E=!1,I=Promise.resolve(),R=t.lf,M=t.log&&function(){try{for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];t.log.apply(null,i);}catch(t){setTimeout((()=>{throw t}),0);}}||(()=>{}),B=T&&M||(()=>{}),L=t.fol,U=t.sutlcb,O=t.feab,N=t=>A(A(t.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),_=t=>P(String.fromCharCode(97+25*Math.random())+P(t)).replace(/\+/g,"\n").replace(/=/g," "),W=()=>{if(C)return C;if(pn.crypto){let t=new Uint8Array(36);pn.crypto.getRandomValues(t);let e="";for(let i=0;i<36;++i){let n=t[i]%36;e+=n<10?n:String.fromCharCode(n+87);}return e}return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return ("x"==t?e:3&e|8).toString(16)}))};const F=" Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";let H,V,z,j,$={dlsErrorAndCacheExpire:"Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",publicTrialNetworkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out."+F,networkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",publicTrialFailConnect:"Failed to connect to the Dynamsoft License Server: network connection error."+F,failConnect:"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.",checkLocalTime:"Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again."},G=async()=>(H=H||(async()=>{await(async()=>{R||(R=yp);})();{let t=await R.createInstance({name:"dynamjssdkhello"});await t.setItem("dynamjssdkhello","available");}if(y=await R.createInstance({name:"dynamdlsinfo"}),m=C?null:P(P("v2")+String.fromCharCode(k.charCodeAt(k.length/2)+1)+P(k)),!C){try{let t=await y.getItem(m);if(!t){let e=await R.createInstance({name:"dynamltsinfo"});t=await e.getItem(m),t&&await y.setItem(m,t);}t&&([a,p]=JSON.parse(await N(t)));}catch(t){}try{null==a&&(a=W(),y.setItem(m,await _(JSON.stringify([a,null]))));}catch(t){}}})(),H),X=async t=>{z=Date.now(),V||(V=(async()=>{try{let g={pd:e,vm:n,v:i,dt:r||"browser",ed:"javascript",cu:a,ad:k,os:l,fn:h};u&&(g.rmk=u),s&&(-1!=s.indexOf("-")?g.hs=s:g.og=s);let f={};if(p&&!C){let t=await y.getItem(m);t&&([a,p]=JSON.parse(await N(t))),f["lts-time"]=p;}c&&(g.sp=c);let x=await Promise.race([(async()=>{let e,i=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");p&&!C&&(y.setItem(m,await _(JSON.stringify([a,i]))),p=i);let n,s="auth/?ext="+encodeURIComponent(P(JSON.stringify(g))),r=!1,l=!1,h=async t=>{if(t&&!t.ok)try{let e=await t.text();if(e){let t=JSON.parse(e);t.errorCode&&(n=t,t.errorCode>100&&t.errorCode<200&&(o=null,r=!0,l=!0));}}catch(t){}};try{e=await S(D[0]+s,{headers:f,cache:t?"reload":"default",mode:"cors",timeout:1e4}),await h(e);}catch(t){}if(!(o||e&&e.ok||r))try{e=await S(D[1]+s,{headers:f,mode:"cors",timeout:3e4});}catch(t){}if(!(o||e&&e.ok||r))try{e=await S(D[0]+s,{headers:f,mode:"cors",timeout:3e4}),await h(e);}catch(t){}n&&151==n.errorCode&&!C&&(y.removeItem(m),y.removeItem(v),a=W(),g.cu=a,p=void 0,s="auth/?ext="+encodeURIComponent(P(JSON.stringify(g))),e=await S(D[0]+s,{headers:f,mode:"cors",timeout:3e4}),await h(e)),(()=>{if(!e||!e.ok){let t;l&&y.setItem(v,""),n?111==n.errorCode?t=n.message:(t=n.message.trim(),t.endsWith(".")||(t+="."),t=d?`An error occurred during authorization: ${t} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${t} Contact the site administrator for more information.`):t=d?$.publicTrialFailConnect:$.failConnect;let e=Error(t);throw n&&n.errorCode&&(e.ltsErrorCode=n.errorCode),e}})();let c=await e.text();try{p||C||(y.setItem(m,await _(JSON.stringify([a,i]))),p=i),y.setItem(v,c);}catch(t){}return c})(),new Promise(((t,e)=>{let i;i=d?$.publicTrialNetworkTimeout:$.networkTimeout,setTimeout((()=>e(new Error(i))),o?3e3:15e3);}))]);o=x;}catch(t){g=t;}V=null;})()),await V;},Y=async()=>{j||(j=(async()=>{if(B(a),!o){if(!E)throw M(g.message),g;return}let t={dm:k};T&&(t.bd=!0),t.brtk=!0,t.ls=D[0],s&&(-1!=s.indexOf("-")?t.hs=s:t.og=s),t.cu=a,h&&(t.fn=h),e&&(t.pd=e),i&&(t.v=i),r&&(t.dt=r),l&&(t.os=l),u&&(t.rmk=u),B(o);try{t.ar=o,t.bafc=!!g;}catch(t){}B(t);try{await x(t);}catch(t){B("error updl");}await q(),E||(E=!0),j=null;})()),await j;},q=async()=>{let t=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),e=await b();if(B(e),e&&e<t)throw g?new Error($.dlsErrorAndCacheExpire):new Error($.checkLocalTime)},J=null;const Z=new Promise((t=>{J=()=>{Z.isPending=!1,Z.isFulfilled=!0,t();};}));let Q=null,K=async(t,e)=>(I=I.then((async()=>{try{let i=await f.keys();if(e||(Z.isFulfilled?t&&(i=i.filter((e=>e<t))):t&&i.includes(t)?i=[t]:(i=[],B("Unexpected null key"))),!i.length)return;for(let t=0;t<i.length/1e3;++t){let e=i.slice(1e3*t,1e3*(t+1)),n=[];for(let t=0;t<e.length;++t)n.push(await f.getItem(e[t]));if(p=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!C){let t=await y.getItem(m);t&&([a]=JSON.parse(await N(t))),y.setItem(m,await _(JSON.stringify([a,p])));}try{let t,i,s=D[0]+"verify/v2";p&&!C&&(s+="?ltstime="+encodeURIComponent(p));try{t=S(s,{method:"POST",body:n.join(";"),keepalive:!0});}finally{!Z.isFulfilled&&xn&&J();}try{i=await t;}finally{Z.isFulfilled||J();}if(!i.ok)throw new Error("verify failed. Status Code: "+i.status);for(let t=0;t<e.length;++t)await f.removeItem(e[t]);}catch(t){throw Z.isFulfilled||J(),L&&(L(t),L=null),t}}U&&U();}catch(t){}})),await I);return {i:async t=>(e=t.pd,i=t.v,n=i.split(".")[0],t.dt&&(r=t.dt),s=t.l||"",l="string"!=typeof t.os?JSON.stringify(t.os):t.os,h=t.fn,"string"==typeof h&&(h=h.substring(0,255)),t.ls&&t.ls.length&&(D=t.ls,1==D.length&&D.push(D[0])),d=!s||"200001"===s||s.startsWith("200001-"),c=t.sp,u=t.rmk,"string"==typeof u&&(u=u.substring(0,255)),t.lf&&(R=t.lf),t.lsu&&(a=C=t.lsu),t.feab&&(O=t.feab),x=t.updl,w=t.mnet,b=t.mxet,t.sutlcb&&(U=t.sutlcb),await G(),await(async()=>{v=P(String.fromCharCode(s.charCodeAt(0)+10)+P(e)+P(s)+n+P(""+r)),f=await R.createInstance({name:"dynamdlsuns"+P(P("v2"))+P(String.fromCharCode(s.charCodeAt(0)+10)+P(e)+P(s)+n+P(""+r))});try{o=await y.getItem(v);}catch(t){}})(),await X(),await Y(),(!g||g.ltsErrorCode>=102&&g.ltsErrorCode<=120)&&K(null,!0),{ar:o,cu:a}),c:async()=>{let t=new Date;if(t.getTime()<z+36e4)return;let e=t.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),i=await w(),n=await b();if(n&&n<e)await X(!0),await Y();else if(i&&i<e){let e=new Date(t.getTime());e.setMinutes(t.getMinutes()-6);let i=e.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");p<i&&X().then((()=>Y()));}},s:async(t,e,i,n)=>{if(e){try{let t;t=e.startsWith("{")&&e.endsWith("}")?await O(e):e,t?(B("bs "+i),await f.setItem(i,t),B("ss "+i)):B("ept ecpt");}catch(t){}n&&(B("bd "+i),await K(i,2==n),B("sd "+i)),Q&&clearTimeout(Q),Q=setTimeout((async()=>{await K();}),36e4);}else await K(i);},p:Z,u:async()=>(await G(),a),caret:q}};var vp;class xp{static init(){a(this,xp,Sp,void 0),a(this,xp,Pp,void 0),a(this,xp,Ap,"init");}static reset(){a(this,xp,Sp,void 0),a(this,xp,Pp,void 0),a(this,xp,Ap,"");}static setLicenseInfo(t){var e;a(this,xp,Ap,"done"),a(this,xp,Sp,[]),a(this,xp,Sp,null!==(e=null==t?void 0:t.modules)&&void 0!==e?e:[]);}static setLicenseErr(t){a(this,xp,Pp,t),a(this,xp,Ap,"done");}static makeSureLoadLicenseExist(){return l(this,xp,bp).call(this,3101,5001)}static makeSureCoreLicenseExist(){return l(this,xp,bp).call(this,3101)}static makeSureCameraLicenseExist(){return l(this,xp,bp).call(this,3006,8002)}static makeSureAnnotationLicenseExist(){return l(this,xp,bp).call(this,15)}static annotationLicenseModuleIsExist(){return l(this,xp,Cp).call(this,15)}static pdfRLicenseModuleIsExist(){return l(this,xp,Cp).call(this,5001)}}function wp(t){for(const e of r(this,vp,Sp))if(e.module===t)return e;return {code:wu.LIC_MISS_MODULE.code,message:wu.LIC_MISS_MODULE.message,module:t}}function bp(t,e){""===r(this,vp,Ap)&&wu.throw(wu.INIT_SHOULD_SET_CONFIG),"done"!==r(this,vp,Ap)&&wu.throw(wu.INIT_CONFIG_NOT_DONE),r(this,vp,Pp)&&wu.throw(r(this,vp,Pp));const i=l(this,vp,wp).call(this,t);0!==i.code&&(!e||e&&0!==l(this,vp,wp).call(this,e).code)&&wu.throw({code:i.code,message:i.message});}function Cp(t){return 0===l(this,vp,wp).call(this,t).code}vp=xp;var Sp={writable:!0,value:void 0},Pp={writable:!0,value:void 0},Ap={writable:!0,value:""};function Tp(t){let e;if(t){let i;const n=t.message;i=t.ltsErrorCode,Jn(i)?111===i?i=wu.LIC_EXPIRED.code:106===i||108===i?i=wu.LIC_INVALID.code:i>0&&(i=-(2e4+i)):i=wu.LIC_INVALID.code,e={code:i,message:n};}else e=wu.LIC_INVALID;return e}const kp="2.1.0";var Dp;!function(t){t[t.publicTrial=0]="publicTrial",t[t.privateTrial=1]="privateTrial",t[t.normal=2]="normal";}(Dp||(Dp={}));var Ep,Ip=new WeakMap,Rp=new WeakMap,Mp=new WeakMap,Bp=new WeakMap,Lp=new WeakMap,Up=new WeakMap,Op=new WeakMap,Np=new WeakMap,_p=new WeakSet,Wp=new WeakSet,Fp=new WeakSet,Hp=new WeakSet,Vp=new WeakSet,zp=new WeakSet;class jp{constructor(t){y(this,zp),y(this,Vp),y(this,Hp),y(this,Fp),y(this,Wp),y(this,_p),f(this,Ip,{writable:!0,value:void 0}),f(this,Rp,{writable:!0,value:void 0}),f(this,Mp,{writable:!0,value:void 0}),f(this,Bp,{writable:!0,value:void 0}),f(this,Lp,{writable:!0,value:void 0}),f(this,Up,{writable:!0,value:void 0}),f(this,Op,{writable:!0,value:void 0}),f(this,Np,{writable:!0,value:void 0}),s(this,Rp,void 0),s(this,Ip,void 0),s(this,Mp,""),s(this,Bp,""),s(this,Up,Dp.publicTrial),s(this,Np,void 0),s(this,Op,"");const e=Du({_pLoad:{isEmpty:!0},_license:t,_licenseServer:[]},!0);let i;if(e&&Zn(e.l)?(i=e.l.trim(),1===e.lt?s(this,Up,Dp.publicTrial):2===e.lt?s(this,Up,Dp.privateTrial):s(this,Up,Dp.normal)):(i="",s(this,Up,Dp.publicTrial)),""===i?s(this,Ip,i):i.includes("-")?s(this,Rp,i):s(this,Ip,i),Fn(e.ls)){e.ls.length>0&&s(this,Np,e.ls);const t=n(this,Np);let o,r;if(t&&t.length>0){for(o=0;o<t.length;o++)r=t[o],r.endsWith("/")||(t[o]=`${r}/`);p(this,_p,$p).call(this,t,i)&&s(this,Up,Dp.publicTrial);}}s(this,Op,e.sp);}async init(t,e,i){let s=t;s.endsWith("/")||(s=`${s}/`),n(this,Lp)||await p(this,Fp,Xp).call(this,i);try{await p(this,zp,Jp).call(this,e);}catch(t){const e=Tp(t);let i=!1;e.code===wu.LIC_EXPIRED.code?-1!==e.message.toLowerCase().indexOf("trial license")&&(i=!0):this.isPublicTrial()&&(i=!0),i&&Eu({_bNeverShowDialog:!1,engineResourcePath:s,_onLog:console.log},"error",e.message),wu.throw(e);}}getClientUUID(){return n(this,Bp)}getAuthResult(){return n(this,Mp)}isPublicTrial(){return n(this,Up)===Dp.publicTrial}setClientUUID(t){s(this,Bp,t);}setAuthResult(t){s(this,Mp,t);}}function $p(t,e){let i=!0;if(Fn(t)&&t.length>0){const e=t[0];if(Zn(e)&&""!==e){"mlts.dynamsoft.com"!==new URL(e).hostname&&(i=!1);}}return i&&(!e||"200001"===e||e.startsWith("200001-"))}function Gp(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function Xp(t){const e={dm:p(this,Wp,Gp).call(this),fetch:window.fetch};t&&(e.bd=!0,e.log=console.log),s(this,Lp,mp(e));}function Yp(){return this.isPublicTrial()?"":n(this,Rp)||n(this,Ip)}function qp(){const t=[];return t.push(vn.browser),t.push(vn.version.toString()),t.push(vn.OS),t.join(" ")}async function Jp(t){if(this.getAuthResult()&&this.getClientUUID())return {ar:this.getAuthResult(),cu:this.getClientUUID()};const e={pd:"ddv",dt:"browser",v:kp,os:p(this,Vp,qp).call(this),l:p(this,Hp,Yp).call(this),ls:n(this,Np),sp:n(this,Op),fn:t||"",mnet(){},mxet(){}};""!==this.getClientUUID()&&(e.lsu=this.getClientUUID()),e.updateLicense=t=>{this.setAuthResult(t.ar),this.getClientUUID()||this.setClientUUID(t.cu);};const i=await n(this,Lp).i(e);return this.getAuthResult()||this.setAuthResult(i.ar),this.getClientUUID()||this.setClientUUID(i.cu),i}async function Zp(e){const i=wu.buildInfo("init",{});wu.info(i);let n=e.engineResourcePath.trim();n.endsWith("/")||(n=`${n}/`),so.resourceDir=n,xp.init();if(!await so.isResourceDirValid())return xp.reset(),i.status="Failed",wu.info(i),wu.reject(wu.RESOURCE_NOT_FOUND,"DDV.Core.init");await so.preloadModule("core");let s=function(){var e;let i=null;var n;if(dynamsoftCore.mapPackageRegister&&dynamsoftCore.mapPackageRegister.license)i=null===(n=dynamsoftCore.mapPackageRegister.license.LicenseManager)||void 0===n?void 0:n.license;else if(null!==(e=window)&&void 0!==e&&null!==(e=e.Dynamsoft)&&void 0!==e&&null!==(e=e.Core)&&void 0!==e&&null!==(e=e.mapPackageRegister)&&void 0!==e&&e.license){var s;i=null===(s=window.Dynamsoft.Core.mapPackageRegister.license.LicenseManager)||void 0===s?void 0:s.license;}return null!==i?""===i?"":(Zn(i)&&(i=i.trim()),i):null}();null!==s&&""!==s||(s=e.license.trim());let o,r,a=s.startsWith("DLS")||0===s.length,l=!1,h=!1;if(a)try{var d;let i;if(null!=dynamsoftCore.mapPackageRegister&&dynamsoftCore.mapPackageRegister.license?i=await dynamsoftCore.mapPackageRegister.license.getAR():null!==(d=window)&&void 0!==d&&null!==(d=d.Dynamsoft)&&void 0!==d&&null!==(d=d.Core)&&void 0!==d&&null!==(d=d.mapPackageRegister)&&void 0!==d&&d.license&&(i=await window.Dynamsoft.Core.mapPackageRegister.license.getAR()),i)o=i.ar,r=i.u,l=i.pt,i.pk?(o=i.pk,a=!1):h=!0,zn(o)&&i.ae&&wu.throw(Tp(i.ae));else {const t=await async function(t,e,i,n){const s=new jp(t);return await s.init(e,i,n),{authResult:s.getAuthResult(),clientUUID:s.getClientUUID(),bPublicTrial:s.isPublicTrial()}}(s,n,e.deviceFriendlyName||"");o=t.authResult,r=t.clientUUID,l=t.bPublicTrial;}}catch(t){throw xp.setLicenseErr(t),i.status="Failed",wu.info(i),t}else o=s,r="";const c={licenseInfo:null};try{const t=await so.getLicenseInfo(o,a,r);c.licenseInfo=t,xp.setLicenseInfo(t),!h&&l&&t.trial&&t.msg&&Eu({_bNeverShowDialog:!1,engineResourcePath:n,_onLog:console.log},"warn",t.msg);}catch(t){throw t&&t.code<=-8e4&&xp.setLicenseErr(t),i.status="Failed",wu.info(i),t}return a&&(c.deviceUuid=r),i.status="Completed",wu.info(i),c}const Qp={scrollToLatest:!1};class Kp{constructor(t){i(this,"viewerUids",void 0),i(this,"groupUid",void 0),i(this,"config",void 0),i(this,"isSetScrollToLatest",!1),this.groupUid=t,this.viewerUids=new Set,this.config=Vn(Qp);}getViewerUids(){return [...this.viewerUids.values()]}updateConfig(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this.config,t);}}var tg,eg;!function(t){t.LEFT="left",t.TOP="top",t.RIGHT="right",t.BOTTOM="bottom";}(tg||(tg={})),function(t){t.DEFAULT="default",t.CAPTURE="capture",t.PERSPECTIVE="perspective",t.THUMBNAIL="thumbnail";}(eg||(eg={}));class ig{constructor(){i(this,"db",void 0),this.db=new Map;}async set(t,e){return new Promise(((i,n)=>{this.db.has(t)?n(new Error(`The item ${t} already exists.`)):(this.db.set(t,e),i(`Save ${t} to database successful.`));}))}async get(t){return new Promise(((e,i)=>{this.db.has(t)?e(this.db.get(t)):i(new Error(`The item ${t} does not exist.`));}))}async remove(t){return new Promise(((e,i)=>{const n=this.db.get(t);this.db.delete(t),e(n);}))}async update(t,e){return new Promise(((i,n)=>{this.db.has(t)?(this.db.set(t,e),i(`Update ${t} successful.`)):n(new Error(`The item ${t} does not exist.`));}))}dispose(){this.db.clear();}reset(){this.db.clear();}}class ng extends Qs{constructor(){super(),i(this,"openDocument",void 0),i(this,"closeDocument",void 0),i(this,"syncDocument",void 0),i(this,"addPagesToDoc",void 0),i(this,"deletePages",void 0),i(this,"updatePage",void 0),i(this,"selectedPageChanged",void 0),i(this,"viewerModeChanged",void 0),i(this,"pageChanged",void 0),i(this,"currentPageChanged",void 0),i(this,"pageChangedAfterRender",void 0),i(this,"pageExistenceChanged",void 0),i(this,"tabChanged",void 0),i(this,"displayModeChanged",void 0),i(this,"fitModeChanged",void 0),i(this,"filterChanged",void 0),i(this,"toolModeChanged",void 0),i(this,"zoomChanged",void 0),i(this,"visibleChanged",void 0),i(this,"cropRectDrawn",void 0),i(this,"cropRectDeleted",void 0),i(this,"cropModeChanged",void 0),i(this,"quadModified",void 0),i(this,"autoCaptureChanged",void 0),i(this,"autoDetectChanged",void 0),i(this,"torchChanged",void 0),i(this,"cameraPlayed",void 0),i(this,"cameraClosed",void 0),i(this,"cameraInit",void 0),i(this,"beforeLayout",void 0),i(this,"afterLayout",void 0),i(this,"beforeRender",void 0),i(this,"afterRender",void 0),i(this,"destroy",void 0),i(this,"canvasCursorStyleChanged",void 0),i(this,"quadSelectionStyleChanged",void 0),i(this,"perspectiveQuadChanged",void 0),i(this,"beforeCropPages",void 0),i(this,"operationsChanged",void 0),i(this,"resize",void 0),i(this,"annotationsUpdated",void 0),i(this,"annotationModeChanged",void 0),i(this,"annotationDefaultStyleChanged",void 0),i(this,"selectedAnnotationsChanged",void 0),i(this,"annotationLayerStateChanged",void 0),i(this,"beforeAnnotationEdit",void 0),i(this,"afterAnnotationEdit",void 0),i(this,"beforeAnnotationDraw",void 0),i(this,"afterAnnotationDraw",void 0),i(this,"annotationTextCharsSelected",void 0),i(this,"annotationTextContentUpdated",void 0),i(this,"scroll",void 0),this.openDocument=eo(this),this.closeDocument=eo(this),this.syncDocument=eo(this),this.addPagesToDoc=eo(this),this.deletePages=eo(this),this.updatePage=eo(this),this.selectedPageChanged=eo(this),this.viewerModeChanged=eo(this),this.pageChanged=eo(this),this.currentPageChanged=eo(this),this.pageChangedAfterRender=eo(this),this.pageExistenceChanged=eo(this),this.tabChanged=eo(this),this.displayModeChanged=eo(this),this.fitModeChanged=eo(this),this.filterChanged=eo(this),this.toolModeChanged=eo(this),this.zoomChanged=eo(this),this.visibleChanged=eo(this),this.cropRectDrawn=eo(this),this.cropRectDeleted=eo(this),this.cropModeChanged=eo(this),this.quadModified=eo(this),this.autoCaptureChanged=eo(this),this.autoDetectChanged=eo(this),this.torchChanged=eo(this),this.cameraPlayed=eo(this),this.cameraClosed=eo(this),this.cameraInit=eo(this),this.beforeLayout=eo(this),this.afterLayout=eo(this),this.beforeRender=eo(this),this.afterRender=eo(this),this.destroy=eo(this),this.canvasCursorStyleChanged=eo(this),this.quadSelectionStyleChanged=eo(this),this.perspectiveQuadChanged=eo(this),this.beforeCropPages=eo(this),this.operationsChanged=eo(this),this.resize=eo(this),this.annotationModeChanged=eo(this),this.selectedAnnotationsChanged=eo(this),this.annotationLayerStateChanged=eo(this),this.annotationDefaultStyleChanged=eo(this),this.beforeAnnotationEdit=eo(this),this.afterAnnotationEdit=eo(this),this.beforeAnnotationDraw=eo(this),this.afterAnnotationDraw=eo(this),this.annotationsUpdated=eo(this),this.annotationTextCharsSelected=eo(this),this.annotationTextContentUpdated=eo(this),this.scroll=eo(this);}}class sg{static numberArrayIsValid(t,e,i,n,s){return l(this,sg,og).call(this,t,1,e,i,s,n)}static stringArrayIsValid(t,e){return l(this,sg,og).call(this,t,2,void 0,void 0,0,e)}static blobArrayIsValid(t,e){return l(this,sg,og).call(this,t,4,void 0,void 0,void 0,e)}static quadIsValid(t,e){const i=[],n="Quad";l(this,sg,hg).call(this,i,t,6,l(this,sg,ag).call(this,n,e,void 0),4);let s=0;for(const o of t){const t=`[${s}]`;i.push(...l(this,sg,og).call(this,o,1,void 0,void 0,2,l(this,sg,ag).call(this,n,e,t,!0))),s+=1;}return i}static docDetectConfigIsValid(t,e){const i=[],n="DocumentDetectConfig";return l(this,sg,hg).call(this,i,t,5,l(this,sg,ag).call(this,n,e)),l(this,sg,hg).call(this,i,t.autoCaptureDelay,1,l(this,sg,ag).call(this,n,e,"autoCaptureDelay")),zn(t.acceptedPolygonConfidence)||l(this,sg,hg).call(this,i,t.acceptedPolygonConfidence,1,l(this,sg,ag).call(this,n,e,"acceptedPolygonConfidence")),zn(t.enableAutoCapture)||l(this,sg,hg).call(this,i,t.enableAutoCapture,3,l(this,sg,ag).call(this,n,e,"enableAutoCapture")),i}static docDetectConfIsValid(t,e){const i=[],n="DocumentDetectConfidence";return l(this,sg,hg).call(this,i,t,5,l(this,sg,ag).call(this,n,e)),l(this,sg,hg).call(this,i,t.angleConfidence,1,l(this,sg,ag).call(this,n,e,"angleConfidence"),0,100),l(this,sg,hg).call(this,i,t.areaConfidence,1,l(this,sg,ag).call(this,n,e,"areaConfidence"),0,100),l(this,sg,hg).call(this,i,t.centerConfidence,1,l(this,sg,ag).call(this,n,e,"centerConfidence"),0,100),i}static imageDataIsValid(t,e){const i=[],n="VImageData";return l(this,sg,hg).call(this,i,t,5,l(this,sg,ag).call(this,n,e)),l(this,sg,hg).call(this,i,t.data,8,l(this,sg,ag).call(this,n,e,"data")),l(this,sg,hg).call(this,i,t.type,9,l(this,sg,ag).call(this,n,e,"type")),zn(t.height)||l(this,sg,hg).call(this,i,t.height,1,l(this,sg,ag).call(this,n,e,"height")),zn(t.width)||l(this,sg,hg).call(this,i,t.width,1,l(this,sg,ag).call(this,n,e,"width")),i}static filterTypeIsValid(t,e){const i=[];return l(this,sg,hg).call(this,i,t,10,l(this,sg,ag).call(this,"EnumImageFilterType",e)),i}static imageEncodeOptionIsValid(t,e){const i=[],n="ImageEncodeOption";return l(this,sg,hg).call(this,i,t,5,l(this,sg,ag).call(this,n,e)),l(this,sg,hg).call(this,i,t.type,9,l(this,sg,ag).call(this,n,e,"type")),zn(t.params)||l(this,sg,hg).call(this,i,t.params,5,l(this,sg,ag).call(this,n,e,"params")),i}static makeSureNumberValid(t,e,i,n,s,o){return l(this,sg,rg).call(this,l(this,sg,xg).call(this,t,e,i),n,s,o)}static makeSureStringValid(t,e,i,n){return l(this,sg,rg).call(this,{isValid:l(this,sg,wg).call(this,t)},e,i,n)}static makeSureDetectResultValid(t,e,i,n){const s=[],o="DetectResult";l(this,sg,hg).call(this,s,t,5,l(this,sg,ag).call(this,o,n)),s.push(...sg.quadIsValid(null==t?void 0:t.location,o)),l(this,sg,hg).call(this,s,null==t?void 0:t.width,1,l(this,sg,ag).call(this,o,n,"width"),1,void 0),l(this,sg,hg).call(this,s,null==t?void 0:t.height,1,l(this,sg,ag).call(this,o,n,"height"),1,void 0),s.push(...sg.docDetectConfigIsValid(null==t?void 0:t.config,o)),null!=t&&t.confidence&&l(this,sg,hg).call(this,s,t.confidence,1,l(this,sg,ag).call(this,o,n,"confidence")),this.makeSureValid(s,e,i);}static makeSureValid(t,e,i,n){0!==t.length&&l(this,sg,lg).call(this,t,e,i,n);}static makeSureMissing(t,e,i){zn(t)&&l(this,sg,lg).call(this,void 0,e,i,wu.PARAM_MISS);}static makeSureCameraObject(t,e,i){const n=[],s=i;this.makeSureMissing(t,e,i),Zn(t)?this.makeSureStringValid(t,e,i):(l(this,sg,hg).call(this,n,t,5,l(this,sg,ag).call(this,s)),l(this,sg,hg).call(this,n,t.deviceId,2,l(this,sg,ag).call(this,s,void 0,"deviceId")),l(this,sg,hg).call(this,n,t.label,2,l(this,sg,ag).call(this,s,void 0,"label")),this.makeSureValid(n,e,i));}static initTypeCheckMap(){r(this,sg,Sg)[7]=$n,r(this,sg,Sg)[15]=Zn,r(this,sg,Sg)[3]=Xn,r(this,sg,Sg)[5]=Hn,r(this,sg,Sg)[4]=Gn,r(this,sg,Sg)[2]=l(this,sg,wg),r(this,sg,Sg)[8]=l(this,sg,cg),r(this,sg,Sg)[11]=l(this,sg,fg),r(this,sg,Sg)[12]=l(this,sg,yg),r(this,sg,Sg)[13]=l(this,sg,mg),r(this,sg,Sg)[14]=l(this,sg,vg),r(this,sg,Sg)[1]=l(this,sg,xg),r(this,sg,Sg)[6]=l(this,sg,ug),r(this,sg,Sg)[9]=l(this,sg,pg),r(this,sg,Sg)[10]=l(this,sg,gg),r(this,sg,Sg)[16]=l(this,sg,bg);}}function og(t,e,i,n,s,o){const r=[],a="Array";if(l(this,Ep,hg).call(this,r,t,6,l(this,Ep,ag).call(this,a,o),s),r.length>0)return r;let h=0;for(const s of t){const t=`[${h}]`;l(this,Ep,hg).call(this,r,s,e,l(this,Ep,ag).call(this,a,o,t,!0),i,n),h+=1;}return r}function rg(t,e,i,n){const{isValid:s,isInRange:o,isSupported:r}=t,a=!!zn(s)||s,h=!!zn(o)||o,d=!!zn(r)||r;a&&h&&d||(n||(n=a?h?wu.PARAM_NOT_SUPPORT:wu.PARAM_OUT_OF_RANGE:wu.PARAM_INVALID),l(this,Ep,lg).call(this,void 0,e,i,n));}function ag(t,e,i,n){return e?i?`${e}${n?"":"."}${i}`:`${e}`:i?`${t}${n?"":"."}${i}`:`${t}`}function lg(t,e,i,n){const s=zn(n)?{...wu.PARAM_INVALID}:{...n};t&&(s.details=t),wu.throw(s,e,i);}function hg(t,e,i,n,s,o){const r=l(this,Ep,dg).call(this,e,i,n,s,o);r&&t.push(r);}function dg(t,e,i,n,s){if(zn(t))return `${i} is missing.`;const o=r(this,Ep,Sg)[e];if(o){const e=o.bind(this)(t,n,s);if(Xn(e)){if(!e)return `${i} is invalid.`}else if(Hn(e)){const{isValid:t,isInRange:n,isSupported:s}=e;if(!1===t)return `${i} is invalid.`;if(!1===n)return `${i} is out of range.`;if(!1===s)return `${i} is not supported.`}}}function cg(t){return $n(t)||Gn(t)}function ug(t,e){return Fn(t)?Jn(e)&&0===t.length||!zn(e)&&t.length<e?{isValid:!1}:{isValid:!0,isInRange:!!zn(e)||t.length>=e}:{isValid:!1}}function pg(t){return Jn(t)?{isValid:!0,isInRange:t>=exports.EnumImageDataType.RGBA&&t<=exports.EnumImageDataType.PNG}:{isValid:!1}}function gg(t){return Zn(t)?{isValid:!0,isInRange:(e=t,!!gu.get(e))}:{isValid:!1};var e;}function fg(t){return void 0!==Fo.get(t)}function yg(t){return void 0!==Ho.get(t)}function mg(t){return void 0!==Wo.get(t)}function vg(t){if(Zn(t)){const e=t.trim();return -1!==r(this,Ep,Cg).indexOf(e)}return !1}function xg(t,e,i){let n=!0;return Jn(t)?(zn(e)||(n=t>=e),!zn(i)&&n&&(n=t<=i),{isValid:!0,isInRange:n}):{isValid:!1}}function wg(t){return !!Zn(t)&&0!==t.trim().length}function bg(t){if(!l(this,Ep,wg).call(this,t))return {isValid:!1};const e=t.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['’](\d{2})['’]|)$/);let i=!1;if(e){const[,t,n,s,o,r,a,l,h,d]=e,c=new Date(`${t}-${n}-${s}T${o}:${r}:${a}`);if(i=!0,c.getFullYear()===parseInt(t,10)&&c.getMonth()+1===parseInt(n,10)&&c.getDate()===parseInt(s,10)&&c.getHours()===parseInt(o,10)&&c.getMinutes()===parseInt(r,10)&&c.getSeconds()===parseInt(a,10)||(i=!1),i&&l){const t=parseInt(h,10),e=parseInt(d,10);("+"===l&&(t<0||t>12||e<0||e>59)||"-"===l&&(t<0||t>12||e<0||e>59))&&(i=!1);}}return {isSupported:i}}Ep=sg;var Cg={writable:!0,value:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},Sg={writable:!0,value:Object.create(null)};sg.initTypeCheckMap();class Pg{constructor(t){i(this,"maxConcurrency",void 0),i(this,"currentConcurrency",void 0),i(this,"queue",void 0),this.maxConcurrency=t,this.currentConcurrency=0,this.queue=[];}async acquire(){return new Promise((t=>{this.currentConcurrency<this.maxConcurrency?(this.currentConcurrency+=1,t(!0)):this.queue.push(t);}))}release(){if(this.queue.length>0){this.queue.shift()();}else this.currentConcurrency-=1;}}class Ag{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;i(this,"tasks",void 0),i(this,"semaphore",void 0),this.tasks=[],this.semaphore=new Pg(t);}async process(t){await this.semaphore.acquire();let e=null;try{t.cancelled||(e=await this.handler(t.taskUid));}catch(t){e=null;}if(t.completed=!0,this.tasks.includes(t)){const e=this.tasks.indexOf(t);this.tasks.splice(e,1);}t.emitter.emit(t.taskUid,e),this.semaphore.release();}async executeTask(t){return new Promise(((e,i)=>{let n=this.tasks.find((e=>e.taskUid===t));n||(n={taskUid:t,emitter:new ns,completed:!1,cancelled:!1,running:!1},this.tasks.push(n)),n.cancelled=!1,n.emitter.on(t,(t=>{e(t);})),n.running||(n.running=!0,this.process(n));}))}cancel(t){const e=this.tasks.find((e=>e.taskUid===t));e&&(e.cancelled=!0);}destroy(){this.tasks=[];}async handler(t){return Promise.resolve(null)}}class Tg extends Ag{async handler(t){return new Promise(((e,i)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{n.onload=null,n.onerror=null,e(n);},n.onerror=t=>{n.onload=null,n.onerror=null,e(null);},n.src=t;}))}}class kg extends Tg{constructor(t,e){super(),i(this,"core",void 0),i(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){let e=this.core.pageService.getPage(t);if(!e||e.isDestroyed)return null;let{img:i}=e.raw;if(!i){let{url:n}=e.raw;if(!n){let i=e.raw.data;if(!i){let n=await this.core.imageDataService.getRaw(t);const s=this.core.pageService.getPage(t);if(!s)return null;if(e.isDestroyed&&!s.isDestroyed&&(n=await this.core.imageDataService.getRaw(t,!0)),!n||s.isDestroyed)return null;i=n.data;}n=URL.createObjectURL(i),e.raw.url=n;}if(i=await this.imageLoader.executeTask(n),e=this.core.pageService.getPage(t),!e||e.isDestroyed)return null;e.raw.img=i;}return i}}class Dg extends Tg{constructor(t,e){super(),i(this,"core",void 0),i(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=null===(e=i.original)||void 0===e?void 0:e.img;if(!n){var s;let e=null===(s=i.original)||void 0===s?void 0:s.url;if(!e){var o;let n=null===(o=i.original)||void 0===o?void 0:o.data;if(!n){let e=await this.core.imageDataService.getOriginal(t);const s=this.core.pageService.getPage(t);if(!s)return null;if(i.isDestroyed&&!s.isDestroyed&&(e=await this.core.imageDataService.getRaw(t,!0)),!e||s.isDestroyed)return null;n=e.data;}e=URL.createObjectURL(n),i.original.url=e;}if(n=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),!i||i.isDestroyed)return null;i.original.img=n;}return n}}class Eg extends Tg{constructor(t,e){super(),i(this,"core",void 0),i(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=null===(e=i.display)||void 0===e?void 0:e.img;if(!n){var s;let e=null===(s=i.display)||void 0===s?void 0:s.url;if(!e){var o;let n=null===(o=i.display)||void 0===o?void 0:o.data;if(!n){let e=await this.core.imageDataService.getDisplay(t,!0);const s=this.core.pageService.getPage(t);if(!s)return null;if(i.isDestroyed&&!s.isDestroyed&&(e=await this.core.imageDataService.getDisplay(t,!0)),!e||s.isDestroyed)return null;n=e.data;}e=URL.createObjectURL(n),i.display.url=e;}const{filter:r}=i;if(n=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),!i||i.isDestroyed)return null;if(r!==i.filter)return this.handler(i.uid);i.display.img=n;}return n}}class Ig extends Tg{constructor(t,e){super(),i(this,"core",void 0),i(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=null===(e=i.thumbnail)||void 0===e?void 0:e.img;if(!n){var s;let e=null===(s=i.thumbnail)||void 0===s?void 0:s.url;if(!e){var o;let n=null===(o=i.thumbnail)||void 0===o?void 0:o.data;if(!n){const e=await this.core.imageDataService.getThumbnail(t);if(i=this.core.pageService.getPage(t),!e||i.isDestroyed)return null;n=e.data;}e=URL.createObjectURL(n),i.thumbnail.url=e;}if(n=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),i.isDestroyed)return null;i.thumbnail.img=n;}return n}}class Rg{constructor(t){i(this,"rawImageLoader",void 0),i(this,"originalImageLoader",void 0),i(this,"displayImageLoader",void 0),i(this,"thumbnailImageLoader",void 0);const e=new Tg;this.rawImageLoader=new kg(t,e),this.originalImageLoader=new Dg(t,e),this.displayImageLoader=new Eg(t,e),this.thumbnailImageLoader=new Ig(t,e);}async loadRawImage(t){return this.rawImageLoader.executeTask(t)}cancelLoadRawImage(t){this.rawImageLoader.cancel(t);}async loadOriginalImage(t){return this.originalImageLoader.executeTask(t)}cancelLoadOriginalImage(t){this.originalImageLoader.cancel(t);}async loadDisplayImage(t){return this.displayImageLoader.executeTask(t)}cancelLoadDisplayImage(t){this.displayImageLoader.cancel(t);}async loadThumbnailImage(t){return this.thumbnailImageLoader.executeTask(t)}cancelLoadThumbnailImage(t){this.thumbnailImageLoader.cancel(t);}}class Mg{constructor(t,e,n){i(this,"worker",void 0),i(this,"id",void 0),i(this,"manager",void 0),i(this,"callbacks",{}),i(this,"busy",!1),i(this,"counter",0),i(this,"tasks",[]),this.worker=t,this.id=e,this.manager=n,this.worker.addEventListener("message",(t=>{this.onMessage(t);}),!1);}cancel(t){const e=this.tasks.findIndex((e=>{var i;return (null===(i=e.data)||void 0===i?void 0:i.taskUid)===t}));if(e>=0){const t=this.tasks.splice(e,1)[0];this.callbacks[t.callbackId]&&delete this.callbacks[t.callbackId],this.setBusy(!1);}}setBusy(t){if(this.busy=t,!t)if(this.tasks.length){const t=this.tasks.shift();this.send(t);}else this.worker.terminate(),this.manager.removeActor(this);}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(t){this.setBusy(!1);const{callbackId:e}=t.data,i=e?this.callbacks[e]:null;i&&i(t.data),delete this.callbacks[e];}send(t,e){if(this.busy)return void this.tasks.push({...t});this.setBusy(!0);const i=`${this.id}-${t.action}-cb-${this.counter}`;t.callback&&(this.callbacks[i]=t.callback,this.counter+=1),t.callbackId=i;const n={...t.data,callbackId:i};e?this.worker.postMessage(n,[e.data.buffer]):this.worker.postMessage(n);}}class Bg{constructor(t,e){i(this,"concurrency",1),i(this,"actors",[]),i(this,"workerUrl",void 0),this.workerUrl=t,this.concurrency=e;}send(t,e){this.getActor().send(t,e);}getActor(){const t=this.actors.filter((t=>!t.isBusy()))[0];if(t)return t;if(this.actors.length<this.concurrency){const t=new Worker(this.workerUrl),e=new Mg(t,this.actors.length,this);return this.actors.push(e),e}const e=Math.floor(Math.random()*this.concurrency);return this.actors[e]}removeActor(t){const e=this.actors.indexOf(t);this.actors.splice(e,1);}cancel(t){for(const e of this.actors)e.cancel(t);}clear(){for(const t of this.actors)t.getWorker().terminate();this.actors=[];}}function Lg(){onmessage=t=>{const{index:e}=t.data,i=t.data.sourceWidth,n=t.data.sourceHeight,s=t.data.width,o=t.data.height,r=t.data.source.data,a=s*o*4,l=new ArrayBuffer(a);let h=null;try{h=new Uint8ClampedArray(l,0,a);}catch(t){h=new Uint8Array(l,0,a);}for(let t=0;t<o;t++){const e=t*n/o,a=Math.floor(e),l=1-(e-a),d=a,c=(t+1)*n/o,u=Math.floor(c-1e-5),p=c-u,g=u;let f=t*s*4;for(let t=0;t<s;t++){const e=t*i/s,n=Math.floor(e),o=1-(e-n),a=n,c=(t+1)*i/s,u=Math.floor(c-1e-5),y=c-u,m=u;let v=0,x=0,w=0,b=0,C=0;const S=255;let P,A,T=(d+1)*i*4+4*a;for(P=d+1;P<g;++P){const t=S;v+=r[T+2]*o*t,x+=r[T+1]*o*t,w+=r[T]*o*t,b+=r[T+3]*o*t,C+=S*o,T+=4*i;}let k=(d+1)*i*4+4*m;for(P=d+1;P<g;++P){const t=S;v+=r[k+2]*y*t,x+=r[k+1]*y*t,w+=r[k]*y*t,b+=r[k+3]*y*t,C+=S*y,k+=4*i;}let D=d*i*4+4*(a+1);for(A=a+1;A<m;++A){const t=S;v+=r[D+2]*l*t,x+=r[D+1]*l*t,w+=r[D]*l*t,b+=r[D+3]*l*t,C+=S*l,D+=4;}let E=g*i*4+4*(a+1);for(A=a+1;A<m;++A){const t=S;v+=r[E+2]*p*t,x+=r[E+1]*p*t,w+=r[E]*p*t,b+=r[E+3]*p*t,C+=S*p,E+=4;}for(P=d+1;P<g;++P){let t=P*i*4+4*(a+1);for(A=a+1;A<m;++A){const e=S;v+=r[t+2]*e,x+=r[t+1]*e,w+=r[t]*e,b+=r[t+3]*e,C+=e,t+=4;}}let I=d*i*4+4*a;const R=S;v+=r[I+2]*(l*o)*R,x+=r[I+1]*(l*o)*R,w+=r[I]*(l*o)*R,b+=r[I+3]*(l*o)*R,C+=S*(l*o),I=d*i*4+4*m;const M=S;v+=r[I+2]*(l*y)*M,x+=r[I+1]*(l*y)*M,w+=r[I]*(l*y)*M,b+=r[I+3]*(l*y)*M,C+=S*(l*y),I=g*i*4+4*a;const B=S;v+=r[I+2]*(p*o)*B,x+=r[I+1]*(p*o)*B,w+=r[I]*(p*o)*B,b+=r[I+3]*(p*o)*B,C+=S*(p*o),I=g*i*4+4*m;const L=S;v+=r[I+2]*(p*y)*L,x+=r[I+1]*(p*y)*L,w+=r[I]*(p*y)*L,b+=r[I+3]*(p*y)*L,C+=S*(p*y);let U=b/C,O=0,N=0,_=0;0!==U&&(O=v/C,N=x/C,_=w/C),O+=.5,N+=.5,_+=.5,U+=.5,h[f]=Math.floor(_),f+=1,h[f]=Math.floor(N),f+=1,h[f]=Math.floor(O),f+=1,h[f]=Math.floor(U),f+=1;}}const d={index:e,target:h,taskUid:t.data.taskUid,callbackId:t.data.callbackId};try{postMessage(d,[h.buffer]);}catch(t){postMessage(d,null);}h=null;};}let Ug=class{constructor(){i(this,"actorSystem",void 0),i(this,"concurrency",3);const t=window.URL.createObjectURL(new Blob(["(",Lg.toString(),")()"],{type:"text/plain"}));this.actorSystem=new Bg(t,this.concurrency);}cancel(t){this.actorSystem.cancel(t);}optimize(t,e,i,n,s,o){return new Promise(((r,a)=>{const l=t.getContext("2d"),h=Math.floor(e)||1,d=Math.floor(i)||1,c=l.getImageData(0,0,h,d),u={action:"optimize",data:{taskUid:o,sourceWidth:h,sourceHeight:d,width:Math.ceil(n)||1,height:Math.ceil(s)||1,source:c},callback(t){r(t);}};this.actorSystem.send(u,u.data.source);}))}};class Og{constructor(){}reset(){}async perspectivePreview(t,e,i,n){var s,o,r;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const l=new wo,h=await l.initImage({source:t,isRGBA:e===exports.EnumImageDataType.RGBA,width:n.width,height:n.height,isBGRA:e===exports.EnumImageDataType.BGRA});h.srcBuffer&&(t=h.srcBuffer);let d=n.width,c=n.height;const u=null!==(s=n.angle)&&void 0!==s?s:0;90!==u&&270!==u||(d=n.height,c=n.width);const p=Math.min((null!==(o=a.width)&&void 0!==o?o:d)/d,(null!==(r=a.height)&&void 0!==r?r:c)/c),g=Math.floor(d*p+.5),f=Math.floor(c*p+.5);await l.resize(g,f,a.mode),null!=n&&n.angle&&await l.rotate({angle:n.angle});const y=[[Math.floor(i[0][0]*p+.5),Math.floor(i[0][1]*p+.5)],[Math.floor(i[1][0]*p+.5),Math.floor(i[1][1]*p+.5)],[Math.floor(i[2][0]*p+.5),Math.floor(i[2][1]*p+.5)],[Math.floor(i[3][0]*p+.5),Math.floor(i[3][1]*p+.5)]];await l.drawQuadrangle({location:y,strokeColor:a.strokeColor,lineWidth:a.lineWidth});const m=await l.getImage({ifDeleteObject:!0,isRGBA:e===exports.EnumImageDataType.RGBA,returnBlob:!1});await l.freeReservedData();const v={data:new Blob([m.imageData],{type:m.blobType}),width:m.imageWidth,height:m.imageHeight,resolutionX:m.imageXResolution,resolutionY:m.imageYResolution};return l.terminate(),v}async resize(t,e,i,n,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const r=new wo,a=await r.initImage({source:t,isRGBA:e===exports.EnumImageDataType.RGBA,width:i,height:n,isBGRA:e===exports.EnumImageDataType.BGRA});if(a.srcBuffer&&(t=a.srcBuffer),s>0){let t=1;t=i>n?i/s:n/s;const e=Math.floor(i/t+.5),a=Math.floor(n/t+.5);await r.resize(e,a,o.mode);}const l=await r.getImage({ifDeleteObject:!0,isRGBA:e===exports.EnumImageDataType.RGBA,returnBlob:!1});await r.freeReservedData();const h={data:new Blob([l.imageData],{type:l.blobType}),width:l.imageWidth,height:l.imageHeight,resolutionX:l.imageXResolution,resolutionY:l.imageYResolution};return r.terminate(),h}}class Ng{constructor(t){}}class _g extends Ng{static create(t,e){return new _g(t,e)}constructor(t,e){super("cameraChanged"),i(this,"oldDeviceId",void 0),i(this,"newDeviceId",void 0),this.oldDeviceId=t,this.newDeviceId=e;}}class Wg extends Ng{static create(t){return new Wg(t)}constructor(t){super("captured"),i(this,"pageUid",void 0),this.pageUid=t;}}class Fg extends Ng{static create(t){return new Fg(t)}constructor(t){super("cropRectDeleted"),i(this,"rect",void 0),this.rect=t;}}class Hg extends Ng{static create(t){return new Hg(t)}constructor(t){super("cropRectDrawn"),i(this,"rect",void 0),this.rect=t;}}class Vg extends Ng{static create(t,e){return new Vg(t,e)}constructor(t,e){super("cropRectModified"),i(this,"oldRect",void 0),i(this,"newRect",void 0),this.oldRect=t,this.newRect=e;}}class zg extends Ng{static create(t,e){return new zg(t,e)}constructor(t,e){super("currentIndexChanged"),i(this,"oldIndex",void 0),i(this,"newIndex",void 0),this.oldIndex=t,this.newIndex=e;}}class jg extends Ng{static create(t,e){return new jg(t,e)}constructor(t,e){super("displayModeChanged"),i(this,"oldDisplayMode",void 0),i(this,"newDisplayMode",void 0),this.oldDisplayMode=t,this.newDisplayMode=e;}}class $g extends Ng{static create(t,e){return new $g(t,e)}constructor(t,e){super("document"),i(this,"docUid",void 0),i(this,"docName",void 0),this.docUid=t,this.docName=e;}}class Gg extends Ng{static create(t,e){return new Gg(t,e)}constructor(t,e){super("fitModeChanged"),i(this,"oldFitMode",void 0),i(this,"newFitMode",void 0),this.oldFitMode=t,this.newFitMode=e;}}class Xg extends Ng{static create(t,e){return new Xg(t,e)}constructor(t,e){super("pagesDragged"),i(this,"indices",void 0),i(this,"pageUids",void 0),this.indices=t,this.pageUids=e;}}class Yg extends Ng{static create(t,e,i){return new Yg(t,e,i)}constructor(t,e,n){super("pagesDropped"),i(this,"indicesBefore",void 0),i(this,"indicesAfter",void 0),i(this,"pageUids",void 0),this.indicesBefore=t,this.indicesAfter=e,this.pageUids=n;}}class qg extends Ng{static create(t,e){return new qg(t,e)}constructor(t,e){super("pageRendered"),i(this,"index",void 0),i(this,"pageUid",void 0),this.index=t,this.pageUid=e;}}class Jg extends Ng{static create(t,e,i){return new Jg(t,e,i)}constructor(t,e,n){super("pagesAdded"),i(this,"docUid",void 0),i(this,"indices",void 0),i(this,"pageUids",void 0),this.docUid=t,this.indices=e,this.pageUids=n;}}class Zg extends Ng{static create(t,e,i){return new Zg(t,e,i)}constructor(t,e,n){super("pagesDeleted"),i(this,"docUid",void 0),i(this,"pageUids",void 0),i(this,"indices",void 0),this.docUid=t,this.pageUids=e,this.indices=n;}}class Qg extends Ng{static create(t,e){return new Qg(t,e)}constructor(t,e){super("played"),i(this,"deviceId",void 0),i(this,"resolution",void 0),this.deviceId=t,this.resolution=e;}}class Kg extends Ng{static create(t,e){return new Kg(t,e)}constructor(t,e){super("quadModified"),i(this,"oldQuad",void 0),i(this,"newQuad",void 0),this.oldQuad=t,this.newQuad=e;}}class tf extends Ng{static create(t,e,i,n){return new tf(t,e,i,n)}constructor(t,e,n,s){super("resized"),i(this,"oldWidth",void 0),i(this,"oldHeight",void 0),i(this,"newWidth",void 0),i(this,"newHeight",void 0),this.oldWidth=t,this.oldHeight=e,this.newWidth=n,this.newHeight=s;}}class ef extends Ng{static create(t,e,i,n){return new ef(t,e,i,n)}constructor(t,e,n,s){super("selectedPagesChanged"),i(this,"oldIndices",void 0),i(this,"newIndices",void 0),i(this,"oldPageUids",void 0),i(this,"newPageUids",void 0),this.oldIndices=t,this.newIndices=e,this.oldPageUids=n,this.newPageUids=s;}}class nf extends Ng{static create(t){return new nf(t)}constructor(t){super("stopped"),i(this,"deviceId",void 0),this.deviceId=t;}}class sf extends Ng{static create(t,e){return new sf(t,e)}constructor(t,e){super("toolModeChanged"),i(this,"oldToolMode",void 0),i(this,"newToolMode",void 0),this.oldToolMode=t,this.newToolMode=e;}}class of extends Ng{static create(t,e,i,n,s,o,r){return new of(t,e,i,n,s,o,r)}constructor(t,e,n,s,o,r,a){super("vPointer"),i(this,"index",void 0),i(this,"pageUid",void 0),i(this,"imageX",void 0),i(this,"imageY",void 0),i(this,"canvasX",void 0),i(this,"canvasY",void 0),i(this,"nativeEvent",void 0),this.index=t,this.pageUid=e,this.imageX=n,this.imageY=s,this.canvasX=o,this.canvasY=r,this.nativeEvent=a;}}class rf extends Ng{static create(t,e){return new rf(t,e)}constructor(t,e){super("zoomChanged"),i(this,"oldZoomRatio",void 0),i(this,"newZoomRatio",void 0),this.oldZoomRatio=t,this.newZoomRatio=e;}}class af extends Ng{static create(t,e){return new af(t,e)}constructor(t,e){super("currentPageChanged"),i(this,"oldPageUid",void 0),i(this,"newPageUid",void 0),this.oldPageUid=t,this.newPageUid=e;}}class lf extends Ng{static create(t,e){return new lf(t,e)}constructor(t,e){super("selectedAnnotationsChanged"),i(this,"oldAnnotationUids",void 0),i(this,"newAnnotationUids",void 0),this.oldAnnotationUids=t,this.newAnnotationUids=e;}}class hf extends Ng{static create(t,e){return new hf(t,e)}constructor(t,e){super("annotationModeChanged"),i(this,"oldAnnotationMode",void 0),i(this,"newAnnotationMode",void 0),this.oldAnnotationMode=t,this.newAnnotationMode=e;}}class df extends Ng{static create(t){return new df(t)}constructor(t){super("annotationLayerStateChanged"),i(this,"state",void 0),this.state=t;}}class cf extends Ng{static create(t,e,i,n){return new cf(t,e,i,n)}constructor(t,e,n,s){super("addPagesToDoc"),i(this,"docUid",void 0),i(this,"pageUids",void 0),i(this,"indices",void 0),i(this,"index",void 0),this.docUid=t,this.pageUids=e,this.indices=n,this.index=s;}}class uf extends Ng{static create(t,e,i){return new uf(t,e,i)}constructor(t,e,n){super("createPage"),i(this,"pageUid",void 0),i(this,"fileUid",void 0),i(this,"fileIndex",void 0),this.pageUid=t,this.fileUid=e,this.fileIndex=n;}}class pf extends Ng{static create(t,e,i){return new pf(t,e,i)}constructor(t,e,n){super("movePages"),i(this,"docUid",void 0),i(this,"indices",void 0),i(this,"insertBeforeIndex",void 0),this.docUid=t,this.indices=e,this.insertBeforeIndex=n;}}class gf extends Ng{static create(t,e,i){return new gf(t,e,i)}constructor(t,e,n){super("renameDocument"),i(this,"docUid",void 0),i(this,"oldName",void 0),i(this,"newName",void 0),this.docUid=t,this.oldName=e,this.newName=n;}}class ff extends Ng{static create(t,e){return new ff(t,e)}constructor(t,e){super("reorderPages"),i(this,"docUid",void 0),i(this,"indices",void 0),this.docUid=t,this.indices=e;}}class yf extends Ng{static create(t,e,i){return new yf(t,e,i)}constructor(t,e,n){super("switchPage"),i(this,"docUid",void 0),i(this,"one",void 0),i(this,"another",void 0),this.docUid=t,this.one=e,this.another=n;}}class mf extends Ng{static create(t,e,i){return new mf(t,e,i)}constructor(t,e,n){super("updatePage"),i(this,"docUid",void 0),i(this,"pageUid",void 0),i(this,"data",void 0),this.docUid=t,this.pageUid=e,this.data=n;}}class vf extends Ng{static create(t){return new vf(t)}constructor(t){super("autoCaptureChanged"),i(this,"enableAutoCapture",void 0),this.enableAutoCapture=t;}}class xf extends Ng{static create(t){return new xf(t)}constructor(t){super("autoDetectChanged"),i(this,"enableAutoDetect",void 0),this.enableAutoDetect=t;}}class wf extends Ng{static create(t){return new wf(t)}constructor(t){super("torchChanged"),i(this,"torchState",void 0),this.torchState=t;}}class bf extends Ng{static create(t){return new bf(t)}constructor(t){super("cameraPlayed"),i(this,"resolution",void 0),this.resolution=t;}}class Cf extends Ng{static create(t,e){return new Cf(t,e)}constructor(t,e){super("paginationChanged"),i(this,"current",void 0),i(this,"total",void 0),this.current=t,this.total=e;}}class Sf extends Ng{static create(t,e){return new Sf(t,e)}constructor(t,e){super("visibleChanged"),i(this,"newVisibility",void 0),i(this,"oldVisibility",void 0),this.newVisibility=t,this.oldVisibility=e;}}class Pf extends Ng{static create(t,e,i){return new Pf(t,e,i)}constructor(t,e,n){super("openDocument"),i(this,"doc",void 0),i(this,"viewerUid",void 0),i(this,"groupUid",void 0),this.doc=t,this.viewerUid=e,this.groupUid=n;}}class Af extends Ng{static create(t,e,i){return new Af(t,e,i)}constructor(t,e,n){super("closeDocument"),i(this,"doc",void 0),i(this,"viewerUid",void 0),i(this,"groupUid",void 0),this.doc=t,this.viewerUid=e,this.groupUid=n;}}class Tf extends Ng{static create(t,e,i,n){return new Tf(t,e,i,n)}constructor(t,e,n,s){super("gotoPage"),i(this,"docUid",void 0),i(this,"groupUid",void 0),i(this,"viewerUid",void 0),i(this,"index",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=n,this.index=s;}}class kf extends Ng{static create(t){return new kf(t)}constructor(t){super("cameraInit"),i(this,"enableConvert",void 0),this.enableConvert=t;}}class Df extends Ng{static create(t,e,i,n){return new Df(t,e,i,n)}constructor(t,e,n,s){super("selectPages"),i(this,"docUid",void 0),i(this,"groupUid",void 0),i(this,"viewerUid",void 0),i(this,"indices",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=n,this.indices=s;}}class Ef extends Ng{static create(t,e,i){return new Ef(t,e,i)}constructor(t,e,n){super("filterChanged"),i(this,"docUid",void 0),i(this,"pageUids",void 0),i(this,"filterType",void 0),this.docUid=t,this.pageUids=e,this.filterType=n;}}class If extends Ng{static create(t,e,i,n){return new If(t,e,i,n)}constructor(t,e,n,s){super("currentChangedByScroll"),i(this,"docUid",void 0),i(this,"groupUid",void 0),i(this,"viewerUid",void 0),i(this,"current",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=n,this.current=s;}}class Rf extends Ng{static create(t,e,i){return new Rf(t,e,i)}constructor(t,e,n){super("rotatePages"),i(this,"docUid",void 0),i(this,"angle",void 0),i(this,"pageUids",void 0),this.docUid=t,this.angle=e,this.pageUids=n;}}class Mf extends Ng{static create(t,e,i){return new Mf(t,e,i)}constructor(t,e,n){super("cropPages"),i(this,"docUid",void 0),i(this,"rect",void 0),i(this,"pageUids",void 0),this.docUid=t,this.rect=e,this.pageUids=n;}}class Bf extends Ng{static create(t,e){return new Bf(t,e)}constructor(t,e){super("perspectiveQuadChanged"),i(this,"quad",void 0),i(this,"isFull",void 0),this.quad=t,this.isFull=e;}}class Lf extends Ng{static create(t){return new Lf(t)}constructor(t){super("deletePages"),i(this,"pageUids",void 0),this.pageUids=t;}}class Uf extends Ng{static create(t,e,i){return new Uf(t,e,i)}constructor(t,e,n){super("operationsChanged"),i(this,"docUid",void 0),i(this,"undo",void 0),i(this,"redo",void 0),this.docUid=t,this.undo=e,this.redo=n;}}class Of extends Ng{static create(t,e,i,n,s){return new Of(t,e,i,n,s)}constructor(t,e,n,s,o){super("perspective"),i(this,"docUid",void 0),i(this,"pageUid",void 0),i(this,"quad",void 0),i(this,"width",void 0),i(this,"height",void 0),this.docUid=t,this.pageUid=e,this.quad=n,this.width=s,this.height=o;}}class Nf extends Ng{static create(t){return new Nf(t)}constructor(t){super("pageExistenceChanged"),i(this,"pageCount",void 0),this.pageCount=t;}}class _f extends Ng{static create(t){return new _f(t)}constructor(t){super("deleteDocs"),i(this,"docUids",void 0),this.docUids=t;}}class Wf extends Ng{static create(t,e,i,n){return new Wf(t,e,i,n)}constructor(t,e,n,s){super("pagePreloadChanged"),i(this,"docUid",void 0),i(this,"viewerUid",void 0),i(this,"viewerMode",void 0),i(this,"changes",void 0),this.docUid=t,this.viewerUid=e,this.viewerMode=n,this.changes=s;}}class Ff extends Ng{static create(t){return new Ff(t)}constructor(t){super("viewerCreated"),i(this,"viewer",void 0),this.viewer=t;}}class Hf extends Ng{static create(t,e){return new Hf(t,e)}constructor(t,e){super("annotationsUpdated"),i(this,"uids",void 0),i(this,"actions",void 0),this.uids=t,this.actions=e;}}class Vf extends Ng{static create(t,e,i,n){return new Vf(t,e,i,n)}constructor(t,e,n,s){super("copyPage"),i(this,"pageUid",void 0),i(this,"fileUid",void 0),i(this,"fileIndex",void 0),i(this,"annotations",void 0),this.pageUid=t,this.fileUid=e,this.fileIndex=n,this.annotations=s;}}let zf=0;const jf=()=>{const t=`doc-${Date.now().toString()}-${zf.toString()}`;return zf+=1,t};function $f(t){t||(t=`D:${jn("yyyyMMddhhmmss")}`);if(/[+-]\d{2}'\d{2}'$/.test(t))return t;const e=-(new Date).getTimezoneOffset();return `${t}${e>=0?"+":"-"}${String(Math.floor(Math.abs(e)/60)).padStart(2,"0")}'${String(Math.abs(e)%60).padStart(2,"0")}'`}class Gf{constructor(){var t,e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,"type",void 0),i(this,"uid",void 0),i(this,"name",void 0),i(this,"pages",void 0),i(this,"tags",void 0),i(this,"creationDate",void 0),i(this,"author",void 0),i(this,"isDestroyed",void 0),i(this,"pageSize",void 0),this.uid=ts(),this.name=null!==(t=n.name)&&void 0!==t?t:jf(),this.type=n.type||"document",this.pages=[],this.tags=n.tags||[],this.creationDate=$f(n.creationDate),this.author=null!==(e=n.author)&&void 0!==e?e:"",this.pageSize="none";}dispose(){this.isDestroyed=!0;}}class Xf{constructor(){i(this,"users",void 0),this.users=[];}addUser(t){this.users.push(t);}deleteUser(t){const e=this.users.indexOf(t);e>-1&&this.users.splice(e,1);}}var Yf;!function(t){t.IMAGE_PNG="image/png",t.IMAGE_JPEG="image/jpeg",t.IMAGE_BMP="image/bmp",t.IMAGE_TIFF="image/tiff",t.IMAGE_JP2="image/jp2",t.APPLICATION_PDF="application/pdf";}(Yf||(Yf={}));class qf{constructor(t){let{uid:e,mime:n,pageCount:s}=t;i(this,"uid",void 0),i(this,"mime",void 0),i(this,"pageCount",void 0),i(this,"name",void 0),i(this,"count",void 0),i(this,"pages",void 0),this.uid=e,this.mime=n,this.count=0,this.pages=[],this.pageCount=s;for(let t=0;t<s;t++){const t=new Xf;this.pages.push(t);}}getPageByIndex(t){return this.pages[t]}addUser(t,e){const i=this.pages[t];return !!i&&(i.addUser(e),this.count+=1,!0)}deleteUser(t,e){const i=this.pages[t];return !!i&&(i.deleteUser(e),this.count-=1,!0)}}function Jf(t,e,i,n){if(0===(e=(e%360+360)%360))return t;const s=e/90;for(let e=0;e<4;e++){const o=t[2*e],r=t[2*e+1];1===s?(t[2*e]=r,t[2*e+1]=n-o):2===s?(t[2*e]=i-o,t[2*e+1]=n-r):3===s&&(t[2*e]=i-r,t[2*e+1]=o);}return Kf(t,8-2*s),t}function Zf(t,e,i,n){if(0===(e=(e%360+360)%360))return t;const s=e/90;for(let e=0;e<4;e++){const o=t[2*e],r=t[2*e+1];1===s?(t[2*e]=n-r,t[2*e+1]=o):2===s?(t[2*e]=i-o,t[2*e+1]=n-r):3===s&&(t[2*e]=r,t[2*e+1]=i-o);}return Kf(t,2*s),t}function Qf(t,e,i){for(;e<i;){const n=t[e];t[e]=t[i],t[i]=n,e+=1,i-=1;}}function Kf(t,e){const i=e%t.length;0!==i&&(Qf(t,0,t.length-1),Qf(t,0,i-1),Qf(t,i,t.length-1));}const ty=t=>Array(4).fill(0).map(((e,i)=>[t[2*i],t[2*i+1]])),ey=(t,e,i)=>0===t[0][0]&&0===t[0][1]&&t[1][0]===e&&0===t[1][1]&&t[2][0]===e&&t[2][1]===i&&0===t[3][0]&&t[3][1]===i;class iy{constructor(t){i(this,"data",void 0),i(this,"width",void 0),i(this,"height",void 0),i(this,"url",void 0),i(this,"img",void 0),i(this,"users",void 0),i(this,"isDestroyed",void 0),i(this,"isAvailable",void 0),i(this,"pageWidth",void 0),i(this,"pageHeight",void 0),i(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=t;}getImageDetail(){const{docPage:t}=this;return {data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:t.resolutionX,resolutionY:t.resolutionY,url:this.url,img:this.img}}getPageSize(){return {width:this.pageWidth,height:this.pageHeight}}updateImageDetail(t){if(!t)return;t.data&&(this.isAvailable=!0,this.data=t.data);const{docPage:e}=this;this.width=t.width,this.height=t.height,this.pageWidth=t.width/e.resolutionX*Do.displayResolution,this.pageHeight=t.height/e.resolutionY*Do.displayResolution;}addUser(t){this.getUserIndex(t)<0&&this.users.push(t);}deleteUser(t){const e=this.getUserIndex(t);e>-1&&this.users.splice(e,1);}hasUser(){return !!this.users.length}reset(){this.resetBlob(),this.resetImg();}resetBlob(){this.isAvailable=!1,this.data=null,this.url&&URL.revokeObjectURL(this.url),this.url=null;}resetImg(){this.img&&(this.img.src&&URL.revokeObjectURL(this.img.src),this.img.src=""),this.img=null;}getUserIndex(t){return this.users.findIndex((e=>{let{viewerUid:i,docUid:n,pageUid:s}=e;return i===t.viewerUid&&n===t.docUid&&s===t.pageUid}))}dispose(){this.isDestroyed=!0,this.isAvailable=!1,this.reset();}}function ny(t){const e=function(t){const e=[...t];e.sort(((t,e)=>e[1]-t[1]));let i=Number.MAX_SAFE_INTEGER,n=0;t.forEach(((t,e)=>{t[1]<i&&([,i]=t,n=e);}));const s=(n+3)%4,o=(n+1)%4,r=sy(t[s],t[n]),a=sy(t[o],t[n]);if(a>r)return s;return n}(t),i=t.map(((e,i)=>{let n=t[i+1];return 3===i&&([n]=t),oy(n,e)}));let n=Math.max(i[e],i[(e+2)%4]),s=Math.max(i[(e+1)%4],i[(e+3)%4]);return n=Math.round(n),s=Math.round(s),{width:n,height:s}}function sy(t,e){const i=Math.abs(t[0]-e[0]),n=oy(t,e);return Math.acos(i/n)}function oy(t,e){return ((t[0]-e[0])**2+(t[1]-e[1])**2)**.5}const ry=t=>{if(!t)return;t.forEach((t=>{const e=Math.ceil(t[0]);e-t[0]<=1e-7?t[0]=e:t[0]=Math.floor(t[0]);const i=Math.ceil(t[1]);i-t[1]<=1e-7?t[1]=i:t[1]=Math.floor(t[1]);}));};function ay(t,e,i,n){e=(e%360+360)%360;const s={...t},{left:o,top:r,width:a,height:l}=t,h=Math.floor(e/90);return 1===h?(s.left=n-r-l,s.top=o):2===h?(s.left=i-o-a,s.top=n-r-l):3===h&&(s.left=r,s.top=i-o-a),h%2>0&&(s.width=l,s.height=a),s}class ly{constructor(t,e){let{fileIndex:n,pageUid:s,fileUid:o,rotation:r,filter:a,perspectiveQuad:l,annotations:h,pdfOptions:d,resource:c,cropBox:u,mediaBox:p,pageSize:g}=t;i(this,"uid",void 0),i(this,"doc",void 0),i(this,"metadata",void 0),i(this,"customData",void 0),i(this,"fileUid",void 0),i(this,"fileIndex",void 0),i(this,"resolutionX",void 0),i(this,"resolutionY",void 0),i(this,"filter",void 0),i(this,"rotation",void 0),i(this,"quad",void 0),i(this,"activeQuad",void 0),i(this,"isFull",void 0),i(this,"raw",void 0),i(this,"original",void 0),i(this,"display",void 0),i(this,"thumbnail",void 0),i(this,"editedDisplay",void 0),i(this,"initRotation",void 0),i(this,"editRotation",void 0),i(this,"actionRotation",void 0),i(this,"actions",void 0),i(this,"pActions",void 0),i(this,"actionResult",void 0),i(this,"pActionResult",void 0),i(this,"isDestroyed",void 0),i(this,"annotations",void 0),i(this,"pageSize",void 0),i(this,"cropBox",void 0),i(this,"mediaBox",void 0),i(this,"resource",void 0),i(this,"editCaches",void 0),i(this,"pdfOptions",void 0),i(this,"initState",void 0),this.uid=s,this.doc=e,this.annotations=h||[],this.resolutionX=c.resolutionX,this.resolutionY=c.resolutionY,this.fileIndex=n,this.fileUid=o,this.pageSize=null!=g?g:"none",this.resource=c,"none"===this.pageSize?(this.mediaBox={...p},this.cropBox={...u}):this.pageSize,this.filter=a,this.rotation=r||0,this.initRotation=r||0,this.editRotation=r||0,this.actionRotation=0,this.isFull=!0,this.pdfOptions=d,this.raw=new iy(this),this.original=new iy(this),this.display=new iy(this),this.thumbnail=new iy(this),this.editedDisplay=new iy(this);let f={width:c.width,height:c.height};if(this.raw.updateImageDetail(f),this.initState={mediaBox:this.mediaBox,cropBox:this.cropBox,rotation:r},l){f=ny(l),this.mediaBox={left:0,top:0,width:Ys(f.width,c.resolutionX,Do.displayResolution),height:Ys(f.height,c.resolutionY,Do.displayResolution)},this.cropBox={...this.mediaBox};const t=this.quadToDisplayPPI(l);this.setQuad(t);}this.original.updateImageDetail(f),this.display.updateImageDetail(f),this.actions=[],this.pActions=[],this.actionResult=new Map,this.pActionResult=new Map;}isMediaBoxEqualCropBox(){const{mediaBox:t,cropBox:e}=this;return t.left===e.left&&t.top===e.top&&t.width===e.width&&t.height===e.height}getPageSize(){return "inherit"===this.pageSize?this.doc.pageSize:this.pageSize}copy(t,e){const i=new ly({pageSize:this.getPageSize(),fileIndex:this.fileIndex,pageUid:t,fileUid:this.fileUid,rotation:this.rotation,filter:this.filter,pdfOptions:this.pdfOptions&&Vn(this.pdfOptions),mediaBox:Vn(this.mediaBox),cropBox:Vn(this.cropBox),resource:Vn(this.resource),annotations:[]},e),n=Vn(this.actions);n.forEach((t=>{t.docUid=e.uid;}));const s=Vn(this.pActions);s.forEach((t=>{t.docUid=e.uid;})),i.actions=n,i.pActions=s,i.initRotation=this.initRotation,i.actionRotation=this.actionRotation,i.editRotation=this.editRotation,i.quad=Vn(this.quad),i.activeQuad=Vn(this.activeQuad),i.isFull=this.isFull,i.actionResult=new Map(this.actionResult),i.pActionResult=new Map(this.pActionResult);const o={width:this.mediaBox.width||this.display.width||i.raw.width,height:this.mediaBox.height||this.display.height||i.raw.height};return i.original.updateImageDetail(o),i.display.updateImageDetail(o),i}setQuad(t){const e=this.isQuadFull(t);let i=!1;if(this.isFull=e,e)this.quad&&(i=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else {const{width:e,height:n}=this.raw.getPageSize(),s=Jf(t.flat(),this.rotation,e,n),o=ty(s);let r,a;this.quad&&(a=this.quadToPixelPPI(o),r=this.quadToPixelPPI(this.quad),ry(r),ry(a)),this.quad&&qs(r,a)||(this.quad=o,this.activeQuad=o,i=!0),this.editRotation=this.actionRotation;}return i&&this.clearActions(),i}isQuadChanged(t){let e=!1;if(this.isQuadFull(t))this.quad&&(e=!0);else {const{width:i,height:n}=this.raw.getPageSize(),s=Jf(t.flat(),this.rotation,i,n),o=ty(s);let r,a;this.quad&&(a=this.quadToPixelPPI(o),r=this.quadToPixelPPI(this.quad),ry(r),ry(a)),this.quad&&qs(r,a)||(e=!0);}return e}setActiveQuad(t){const{width:e,height:i}=this.raw.getPageSize();if(!this.isFull){const n=Jf(t.flat(),this.rotation,e,i),s=ty(n);this.activeQuad=s;}}getQuadVertices(){let t;const{width:e,height:i}=this.raw.getPageSize();return t=this.isFull?[0,0,e,0,e,i,0,i]:this.activeQuad.flat(),t=Zf(t,this.rotation,e,i),t}getProcessedQuad(){if(this.quad){let{width:t,height:e}=this.raw.getPageSize(),{quad:i}=this;i=this.quad.map((t=>[this.toPixelPPI(t[0],!1),this.toPixelPPI(t[1],!0)])),t=this.toPixelPPI(t,!1),e=this.toPixelPPI(e,!0);const n=Zf(i.flat(),this.initRotation,t,e);return ty(n)}return null}toggleFull(){let t=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,t=!0):this.isFull||(this.isFull=!0,t=!0),t}isQuadFull(t){let{width:e,height:i}=this.raw.getPageSize();const n=Math.abs((this.rotation%360+360)%360);if(90===n||270===n){const t=e;e=i,i=t;}return ey(t,e,i)}getEditResultForPixel(){const t=this.getEditResult();return {rWidth:this.toPixelPPI(t.rWidth,!1),rHeight:this.toPixelPPI(t.rHeight,!0),cropLeft:this.toPixelPPI(t.cropLeft,!1),cropTop:this.toPixelPPI(t.cropTop,!0),cropWidth:this.toPixelPPI(t.cropWidth,!1),cropHeight:this.toPixelPPI(t.cropHeight,!0),rotation:t.rotation}}getEditResult(){if(!this.actions.length){const t=ay(this.cropBox,this.rotation,this.mediaBox.width,this.mediaBox.height);return {rWidth:t.width,rHeight:t.height,cropLeft:this.cropBox.left,cropTop:this.cropBox.top,cropWidth:this.cropBox.width,cropHeight:this.cropBox.height,rotation:this.rotation,mediaBox:{...this.mediaBox},cropBox:{...this.cropBox}}}const t=this.actions[this.actions.length-1],{rotatedCropBox:e,cropBox:i,rotation:n}=this.actionResult.get(t.actionUid).to;return {rWidth:e.width,rHeight:e.height,cropLeft:i.left,cropTop:i.top,cropWidth:i.width,cropHeight:i.height,rotation:n,mediaBox:{...this.mediaBox},cropBox:{...i}}}getEditResultForPerspective(){const t=this.raw.getPageSize(),e={left:0,top:0,width:t.width,height:t.height};if(!this.pActions.length){const i=ay(e,this.rotation,e.width,e.height);return {rWidth:i.width,rHeight:i.height,cropLeft:0,cropTop:0,cropWidth:t.width,cropHeight:t.height,rotation:this.rotation,cropBox:{...e},mediaBox:e}}const i=this.pActions[this.pActions.length-1],{rotatedCropBox:n,cropBox:s,rotation:o}=this.pActionResult.get(i.actionUid).to;return {rWidth:n.width,rHeight:n.height,cropLeft:s.left,cropTop:s.top,cropWidth:s.width,cropHeight:s.height,rotation:o,mediaBox:e,cropBox:{...s}}}getActions(){return [...this.actions]}getPerspectiveActions(){return this.pActions}addAction(t){let e=null;if(this.actions.length){const t=this.actionResult.get(this.actions[this.actions.length-1].actionUid);e={mediaBox:{...t.to.mediaBox},cropBox:{...t.to.cropBox},rotation:t.to.rotation,rotatedCropBox:{...t.to.rotatedCropBox}};}else e={mediaBox:{...this.mediaBox},cropBox:{...this.cropBox},rotation:this.rotation,rotatedCropBox:{...this.cropBox}};if(this.actions.push(t),!this.actionResult.has(t.actionUid)){const i=function(t,e,i,n){let s={...t};const o=e.left+e.width,r=e.top+e.height;let a=i,l=ay(t,a,o,r);if("rotate"===n.type)a+=n.angle,l=ay(t,a,o,r);else if("crop"===n.type){const t=n.rect;l={left:t.left+l.left,top:t.top+l.top,width:t.width,height:t.height},s=function(t,e,i,n){e=(e%360+360)%360;const s={...t},{left:o,top:r,width:a,height:l}=t,h=Math.floor(e/90);return 1===h?(s.left=r,s.top=n-a-o):2===h?(s.left=i-a-o,s.top=n-l-r):3===h&&(s.left=i-l-r,s.top=o),h%2>0&&(s.width=l,s.height=a),s}(l,a,o,r);}return {rotatedCropBox:l,cropBox:s,mediaBox:e,rotation:a}}(e.cropBox,this.mediaBox,this.rotation,t);this.actionResult.set(t.actionUid,{from:e,to:i}),this.cropBox={...i.cropBox},this.mediaBox={...i.mediaBox};}if("rotate"===t.type){let e=null;const{width:i,height:n}=this.raw.getPageSize(),s={left:0,top:0,width:i,height:n};if(this.pActions.length){const t=this.pActionResult.get(this.pActions[this.pActions.length-1].actionUid);e={mediaBox:{...t.to.mediaBox},cropBox:{...t.to.cropBox},rotation:t.to.rotation,rotatedCropBox:{...t.to.rotatedCropBox}};}else e={mediaBox:{...s},cropBox:{...s},rotation:this.rotation,rotatedCropBox:{...s}};if(this.pActions.push(t),!this.pActionResult.has(t.actionUid)){const s=function(t,e,i,n){const s=i+n.angle;return {rotatedCropBox:ay(t,s,e.left+e.width,e.top+e.height),cropBox:t,mediaBox:e,rotation:s}}({left:0,top:0,width:i,height:n},{left:0,top:0,width:i,height:n},this.rotation,t);this.pActionResult.set(t.actionUid,{from:e,to:s});}this.rotation+=t.angle;}}deleteAction(t){var e,i;if((null===(e=this.actions[this.actions.length-1])||void 0===e?void 0:e.actionUid)===t){this.actions.pop();const e=this.actionResult.get(t);this.cropBox={...e.from.cropBox},this.mediaBox={...e.from.mediaBox},this.rotation=e.from.rotation,this.actionResult.delete(t);}(null===(i=this.pActions[this.pActions.length-1])||void 0===i?void 0:i.actionUid)===t&&(this.pActions.pop(),this.pActionResult.delete(t));}clearActions(){this.actions=[];}toDisplayPPI(t,e){const{resolutionX:i,resolutionY:n}=this;return e?t/n*Do.displayResolution:t/i*Do.displayResolution}toPixelPPI(t,e){const{resolutionX:i,resolutionY:n}=this;return e?t*n/Do.displayResolution:t*i/Do.displayResolution}quadToDisplayPPI(t){const e=Vn(t);for(let t=0;t<4;t++)e[t][0]=this.toDisplayPPI(e[t][0],!1),e[t][1]=this.toDisplayPPI(e[t][1],!0);return e}quadToPixelPPI(t){const e=Vn(t);for(let t=0;t<4;t++)e[t][0]=this.toPixelPPI(e[t][0],!1),e[t][1]=this.toPixelPPI(e[t][1],!0);return e}rectToDisplayPPI(t){const e={...t};return e.left=this.toDisplayPPI(t.left,!1),e.top=this.toDisplayPPI(t.top,!0),e.width=this.toDisplayPPI(t.width,!1),e.height=this.toDisplayPPI(t.height,!0),e}rectToPixelPPI(t){const e={...t};return e.left=this.toPixelPPI(t.left,!1),e.top=this.toPixelPPI(t.top,!0),e.width=this.toPixelPPI(t.width,!1),e.height=this.toPixelPPI(t.height,!0),e}dispose(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0;}getAnnotationUids(){return [...this.annotations]}}class hy extends Qs{constructor(){super(),i(this,"uid",void 0),i(this,"emitter",void 0),i(this,"repo",void 0),i(this,"onDocumentCreated",eo(this)),i(this,"onDocumentDeleted",eo(this)),i(this,"onDocumentRenamed",eo(this)),i(this,"onPagesAddedOut",eo(this)),i(this,"onAddPagesToDoc",eo(this)),i(this,"onBeforeDeletePagesFromDoc",eo(this)),i(this,"onDeletePagesFromDoc",eo(this)),i(this,"onBeforeDeleteAllPagesFromDoc",eo(this)),i(this,"onDeleteAllPagesFromDoc",eo(this)),i(this,"onMovePages",eo(this)),i(this,"onSwitchPage",eo(this)),i(this,"onReorderPages",eo(this)),i(this,"onBeforeDeleteDocs",eo(this)),i(this,"onAfterDeleteDocs",eo(this)),i(this,"onOpenDocument",eo(this)),i(this,"onCloseDocument",eo(this)),this.emitter=new ns,this.uid=ts(),this.repo=new Map;}dispose(){this.repo.forEach((t=>t.dispose())),this.repo.clear(),super.dispose();}reset(){this.repo.clear();}createDocument(){const t=new Gf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(t.uid,t);const e=$g.create(t.uid,t.name);return this.onDocumentCreated.emit(e),t}getDocument(t){return this.repo.get(t)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(t,e){const i=this.repo.get(t);if(!i)return !1;const n=gf.create(t,i.name,e);return i.name=e,this.onDocumentRenamed.emit(n),!0}deleteDocuments(t){return t.forEach((t=>{const e=this.getDocument(t);e.dispose(),this.repo.delete(t);const i=$g.create(t,e.name);this.onDocumentDeleted.emit(i);})),!0}addPagesToDocument(t,e,i){const n=this.repo.get(t);if(!n)return !1;const{length:s}=e,o=[];let r=n.pages.length;Jn(i)?(n.pages.splice(i,0,...e),r=i):n.pages.push(...e);for(let t=0;t<s;t++)o.push(r+t);const a=cf.create(t,e,o,i);return this.onAddPagesToDoc.emit(a),!0}removePagesFromDocument(t,e){const i=this.getDocument(t);if(!i)return !1;const n=e.map((t=>i.pages.indexOf(t)));e.forEach((t=>{Ns(i.pages,t);}));const s=Zg.create(t,e,n);return this.onBeforeDeletePagesFromDoc.emit(s),this.onDeletePagesFromDoc.emit(s),!0}removeAllPagesFromDocument(t){const e=this.getDocument(t);if(!e)return !1;const i=[...e.pages.keys()],n=[...e.pages];e.pages.length=0;const s=Zg.create(t,n,i);return this.onBeforeDeleteAllPagesFromDoc.emit(s),this.onDeleteAllPagesFromDoc.emit(s),!0}movePages(t,e,i){const n=this.repo.get(t);if(!n)return !1;_s(n.pages,e,i);const s=pf.create(t,e,i);return this.onMovePages.emit(s),!0}swapPages(t,e,i){const n=this.repo.get(t);if(!n)return !1;Ws(n.pages,e,i);const s=yf.create(t,e,i);return this.onSwitchPage.emit(s),!0}reorderPages(t,e){const i=this.repo.get(t);if(!i)return !1;Fs(i.pages,e);const n=ff.create(t,e);return this.onReorderPages.emit(n),!0}}class dy{on(t,e){}emit(t){}}(new dy).on("debug",(function(){}));class cy{constructor(){i(this,"undoStack",void 0),i(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[];}getOperation(){return {undo:this.undoStack.length,redo:this.redoStack.length}}execute(t){return !!t.execute()&&(this.undoStack.push(t),this.redoStack.length>0&&(this.redoStack.forEach((t=>{t.dispose();})),this.redoStack.length=0),!0)}undo(){const t=this.undoStack.pop();return t&&(t.undo(),this.redoStack.push(t)),!!t}redo(){const t=this.redoStack.pop();return t&&(t.execute(),this.undoStack.push(t)),!!t}removeUidsFromCommand(t){this.removeFromStack(this.undoStack,t),this.removeFromStack(this.redoStack,t);}removeFromStack(t,e){t.slice().forEach((e=>{if(!e.isValid){const i=t.indexOf(e);t.splice(i,1),e.dispose();}}));}reset(){this.undoStack.forEach((t=>{t.dispose();})),this.redoStack.forEach((t=>{t.dispose();})),this.undoStack=[],this.redoStack=[];}}class uy extends Qs{constructor(){super(),i(this,"invokers",void 0),i(this,"onOperationsChanged",eo(this)),i(this,"onBeforeRefreshCommands",eo(this)),i(this,"onRefreshCommands",eo(this)),this.invokers=new Map;}createInvoker(t){if(!this.invokers.has(t)){const e=new cy;this.invokers.set(t,e);}}deleteInvokers(t){t.forEach((t=>{if(this.invokers.has(t)){const e=this.invokers.get(t);null==e||e.reset(),this.invokers.delete(t);}}));}execute(t,e){const i=this.invokers.get(e);!(null==i||!i.execute(t))&&this.emitOperationsChanged(e);}undo(t){const e=this.invokers.get(t),i=!(null==e||!e.undo());return i&&this.emitOperationsChanged(t),i}redo(t){const e=this.invokers.get(t),i=!(null==e||!e.redo());return i&&this.emitOperationsChanged(t),i}saveOperations(t){const e=this.invokers.get(t);return !!e&&(e.reset(),this.emitOperationsChanged(t),!0)}getOperationState(t){return this.invokers.get(t).getOperation()}removePageFromCommand(t,e){this.onBeforeRefreshCommands.emit({docUid:t,pageUids:e});this.invokers.get(t).removeUidsFromCommand(e),this.emitOperationsChanged(t);}emitOperationsChanged(t){const e=this.invokers.get(t);let i=0,n=0;if(e){const t=e.getOperation();i=t.undo,n=t.redo;}const s=Uf.create(t,i,n);this.onOperationsChanged.emit(s);}dispose(){this.invokers.clear(),super.dispose();}reset(){this.invokers.forEach((t=>{t.reset();})),this.invokers.clear();}}class py extends Qs{constructor(){super(),i(this,"files",void 0),i(this,"onDeleteFileData",void 0),this.files=new Map,this.onDeleteFileData=eo(this);}dispose(){this.files.clear(),super.dispose();}reset(){this.files.clear();}addFile(t,e,i){const n=new qf({uid:t,mime:e,pageCount:i});this.files.set(t,n);}getByUid(t){return this.files.get(t)}addUser(t,e,i){const n=this.getByUid(t);return null==n?void 0:n.addUser(e,i)}addUsersByParsedPages(t,e){e.forEach((e=>{this.addUser(t,e.fileIndex,e.pageUid);}));}deleteUser(t,e,i){const n=this.getByUid(t);return n&&(n.deleteUser(e,i),n.count||(this.onDeleteFileData.emit(t),this.files.delete(t))),!1}}class gy extends Qs{constructor(t){super(),i(this,"pages",void 0),i(this,"core",void 0),i(this,"onUpdatePage",eo(this)),i(this,"onCreatePage",eo(this)),i(this,"onCopyPage",eo(this)),i(this,"onDeletePages",eo(this)),i(this,"onBeforeDeletePages",eo(this)),i(this,"onAfterDeletePages",eo(this)),i(this,"onBeforeCopyPages",eo(this)),i(this,"onCopyPages",eo(this)),this.core=t,this.pages=new Map;}handlePagePreloadChange(t){let{viewerUid:e,viewerMode:i,docUid:n,changes:s}=t;s.forEach((t=>{let{pageUid:s,from:o,to:r}=t;const a=this.getPage(s),l={viewerUid:e,docUid:n,pageUid:s},{autoReleaseBlob:h,autoReleaseImg:d}=Do;o&&!r?(a.raw.deleteUser(l),a.raw.hasUser()||(this.core.imageLoadService.cancelLoadRawImage(s),this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex),h&&a.raw.resetBlob(),d&&a.raw.resetImg()),i!==eg.DEFAULT&&i!==eg.THUMBNAIL||(a.original.deleteUser(l),a.original.hasUser()||(this.core.imageLoadService.cancelLoadOriginalImage(s),h&&a.original.resetBlob(),d&&a.original.resetImg()),a.display.deleteUser(l),a.display.hasUser()||(this.core.imageLoadService.cancelLoadDisplayImage(s),h&&a.display.resetBlob(),d&&a.display.resetImg())),i===eg.THUMBNAIL&&(a.thumbnail.deleteUser(l),a.thumbnail.hasUser()||(this.core.imageLoadService.cancelLoadThumbnailImage(s),h&&a.thumbnail.resetBlob(),d&&a.thumbnail.resetImg())),a.raw.hasUser()||this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex)):(a.raw.addUser(l),i!==eg.DEFAULT&&i!==eg.THUMBNAIL||(a.original.addUser(l),a.display.addUser(l)),i===eg.THUMBNAIL&&a.thumbnail.addUser(l));}));}dispose(){this.pages.clear(),super.dispose();}reset(){this.pages.clear();}getPage(t){return this.pages.get(t)}startCreatePagesByParsedPages(t,e,i){t.forEach(((t,n)=>{var s;this.createPage({...t,fileUid:e,annotations:(null===(s=t.annotations)||void 0===s?void 0:s.map((t=>t.uid)))||[]},i);}));}endCreatePagesByParsedPages(t,e){t.forEach((t=>{let{pageUid:i,fileIndex:n}=t;const s=uf.create(i,e,n);this.onCreatePage.emit(s);}));}createPage(t,e){const i=new ly(t,e);return this.pages.set(i.uid,i),i}copyPage(t,e,i){const n=i.copy(t,e);return this.pages.set(n.uid,n),Vf.create(t,n.fileUid,n.fileIndex,i.annotations.slice()),n}deletePages(t){const e=Lf.create(t);this.onBeforeDeletePages.emit(e),t.forEach((t=>{const e=this.pages.get(t);e&&e.dispose(),this.pages.delete(t);})),this.onDeletePages.emit(e),this.onAfterDeletePages.emit(e);}updatePage(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=this.pages.get(t);if(n){const{doc:s,customData:o}=n;n.dispose();const r=new ly({...i,pageUid:t},s);r.customData=o,this.pages.set(t,r);const a=mf.create(s.uid,t,e);this.onUpdatePage.emit(a);}}getPageCount(){return this.pages.size}}var fy=new WeakSet,yy=new WeakSet;class my{constructor(t){y(this,yy),y(this,fy),i(this,"core",void 0),i(this,"annotationMapper",void 0),this.core=t,this.annotationMapper=new uc;}reset(){}async saveToPng(t,e,i){const n=this.core.pageService.getPage(t);if(!n)return Promise.resolve(null);const s=await this.core.sourceStore.get(n.fileUid);if(!(p(this,fy,vy).call(this,n)||(null==e?void 0:e.saveAnnotation)&&n.annotations.length>0)&&s.fileData&&"image/png"===s.fileData.type)return i&&(i.details.current=i.details.total,i.status="InProgress",wu.info(i),i.status="Completed",wu.info(i)),s.fileData;const o=await this.core.getPageData(t,{display:!0,raw:!1,thumbnail:!1,renderAnnotation:!(null==e||!e.saveAnnotation),getPng:!0}),r=so.isApple&&!(null!=e&&e.saveAnnotation&&n.annotations.length>0)&&p(this,yy,xy).call(this,n);if(!r){if("image/png"===await Xs(o.display.data))return i&&(i.details.current=i.details.total,i.status="InProgress",wu.info(i),i.status="Completed",wu.info(i)),o.display.data}const a=this.core.saverService.getSaver("image/png");try{const t=await a.save(o.display.data,{outputType:3,is1Bit:r});return i&&(i.details.current=i.details.total,i.status="InProgress",wu.info(i),i.status="Completed",wu.info(i)),t}finally{a.destroy();}}async saveToJpeg(t,e,i){const n=this.core.pageService.getPage(t);if(!n)return Promise.resolve(null);const s=await this.core.sourceStore.get(n.fileUid);if((null==e||!e.saveAnnotation)&&s.fileData&&"image/jpeg"===s.fileData.type&&!p(this,fy,vy).call(this,n))return i&&(i.details.current=i.details.total,i.status="InProgress",wu.info(i),i.status="Completed",wu.info(i)),s.fileData;const o=this.core.saverService.getSaver("image/jpeg");try{const n=await this.core.getPageData(t,{display:!0,raw:!1,thumbnail:!1,renderAnnotation:!(null==e||!e.saveAnnotation)}),s=await o.save(n.display.data,{outputType:1,jpegQuality:null==e?void 0:e.quality});return i&&(i.details.current=i.details.total,i.status="InProgress",wu.info(i),i.status="Completed",wu.info(i)),s}finally{o.destroy();}}async saveToTiff(t,e,i){const n=this.core.saverService.getSaver("image/tiff"),s=!(null==e||!e.saveAnnotation);try{await n.init(e);for(let o=0;o<t.length;o++){const r=t[o],a=this.core.pageService.getPage(r);if(!a)break;const l=await this.core.getPageData(r,{display:!0,renderAnnotation:s}),h=so.isApple&&!(null!=e&&e.saveAnnotation&&a.annotations.length>0)&&p(this,yy,xy).call(this,a);await n.appendPage(l.display.data,{is1Bit:h}),i&&(i.details.current=o+1,i.status="InProgress",wu.info(i));}const o=await n.getTiff();return i&&(i.details.current=i.details.total,i.status="Completed",wu.info(i)),o}finally{n.destroy();}}isPdfInfoChanged(t){return !!t.pdfOptions&&(t.rotation!==t.pdfOptions.rotation||(t.mediaBox.left!==t.pdfOptions.mediaBox.left||t.mediaBox.width!==t.pdfOptions.mediaBox.width||t.mediaBox.height!==t.pdfOptions.mediaBox.height||t.mediaBox.top!==t.pdfOptions.mediaBox.top||(t.cropBox.left!==t.pdfOptions.cropBox.left||t.cropBox.width!==t.pdfOptions.cropBox.width||t.cropBox.height!==t.pdfOptions.cropBox.height||t.cropBox.top!==t.pdfOptions.cropBox.top)))}splitArrayIntoChunks(t,e){const i=[];for(let n=0;n<t.length;n+=e){const s=t.slice(n,n+e);i.push(s);}return i}async saveToPdf(t,e,i){null!=e&&e.creationDate&&(e.creationDate=$f(e.creationDate)),null!=e&&e.modifiedDate&&(e.modifiedDate=$f(e.modifiedDate)),!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation||xp.makeSureAnnotationLicenseExist();const n=this.core.saverService.getSaver("application/pdf");try{await n.init(e);const u=new Map,g=e&&e.pageType&&e.pageType!==exports.EnumPDFPageType.PAGE_DEFAULT;let f=0;for(let h=0;h<t.length;h++){var s,o;const d=t[h],c=this.core.pageService.getPage(d);if(!c)break;const y=await this.core.sourceStore.get(c.fileUid),m=g||(null===(s=c.pdfOptions)||void 0===s?void 0:s.convertMode)===exports.EnumConvertMode.CM_IMAGEONLY||(null===(o=c.pdfOptions)||void 0===o?void 0:o.renderOptions.renderGrayscale),v=[],x=[];if(y.fileData&&"application/pdf"===y.fileData.type&&!m)for(let i=h;i<t.length;i++){var r,a;const n=t[i],s=this.core.pageService.getPage(n);if(!s)break;if(s.fileUid!==c.fileUid)break;if(!s.isFull)break;if("image"===(null==e?void 0:e.saveAnnotation)&&s.annotations.length>0)break;if((null===(r=s.pdfOptions)||void 0===r?void 0:r.convertMode)===exports.EnumConvertMode.CM_IMAGEONLY||null!==(a=s.pdfOptions)&&void 0!==a&&a.renderOptions.renderGrayscale)break;let o=!1;s.filter&&"none"!==s.filter&&(o=!0);const l=s.getActions(),d=s.getPerspectiveActions();l.every((t=>"rotate"===t.type||"crop"===t.type))&&d.every((t=>"rotate"===t.type||"crop"===t.type))||(o=!0);let p=!1;if(o){this.core.getAnnotationsByPageUid(t[h]).forEach((t=>{t.oriIndex>=0&&!t.modified&&(p=!0);}));}if(o&&!p)break;this.isPdfInfoChanged(s)&&u.set(f+v.length,{mediaBox:s.mediaBox,cropBox:s.cropBox,rotation:s.rotation}),v.push(s.fileIndex),p&&x.push({pageUid:n,pageIndex:i,fileIndex:s.fileIndex});}if(v.length>0){var l;const t=null===(l=y.loadOptions)||void 0===l?void 0:l.password,s=y.fileData.size/y.pageCount,o=Math.max(1,Math.floor(83886080/s)),r=this.splitArrayIntoChunks(v,o),a=[];x.forEach((t=>{a.push(t.fileIndex);}));let d=0;for(let e=0;e<r.length;e++)if(await n.appendRawPdfPages(y.fileData,t,r[e]),i){i.status="InProgress";for(let t=0;t<r[e].length;t++)a.includes(r[e][t])||(d+=1,i.details.current=f+d,wu.info(i));}for(let t=0;t<x.length;t++){const s=await this.core.imageDataService.getNotRotatedDisplay(x[t].pageUid,"image"===(null==e?void 0:e.saveAnnotation));await n.changePageImage(x[t].pageIndex,s.data,{cropBox:c.cropBox,mediaBox:c.mediaBox,rotation:c.rotation,width:s.width,height:s.height}),i&&(i.status="InProgress",d+=1,i.details.current=f+d,wu.info(i));}h+=v.length-1,f+=v.length;}else {const t=await this.core.imageDataService.getNotRotatedDisplay(d,"image"===(null==e?void 0:e.saveAnnotation)),s=so.isApple&&!("image"===(null==e?void 0:e.saveAnnotation)&&c.annotations.length>0)&&p(this,yy,xy).call(this,c);await n.appendImagePage(t.data,{cropBox:c.cropBox,mediaBox:c.mediaBox,rotation:c.rotation,width:t.width,height:t.height,bitDepth:s?1:void 0}),f+=1,i&&(i.details.current=f,i.status="InProgress",wu.info(i));}}u.size>0&&await n.setPageInfo(u);const y=[];for(let i=0;i<t.length;i++){var h;const s=this.core.pageService.getPage(t[i]);if(s)if(e&&"image"===e.saveAnnotation)(null===(h=s.pdfOptions)||void 0===h?void 0:h.annotCount)>0&&await n.removePageAnnotations(i);else {const o=s.pdfOptions&&s.pdfOptions.convertMode===exports.EnumConvertMode.CM_RENDERALL&&s.pdfOptions.renderOptions.renderAnnotations===exports.EnumAnnotationRenderMode.RENDER_ANNOTATIONS,r=this.core.getAnnotationsByPageUid(t[i]);if(!r.length){!o&&s.pdfOptions&&s.pdfOptions.annotCount>0&&await n.removePageAnnotations(i);continue}e&&"none"===e.saveAnnotation&&r.forEach((t=>{!["textBox","textTypewriter"].includes(t.type)||!t.modified&&Jn(null==t?void 0:t.oriIndex)||t.style.textContents.forEach((t=>{y.push({family:t.fontFamily,isBlob:"bold"===t.fontWeight,isItalic:"italic"===t.fontStyle});}));}));const a=[];for(let t=0;t<r.length;t++)!0===r[t].flattened&&(a.push(r[t]),r.splice(t,1),t-=1);if(a.length>0){const t=await this.annotationMapper.getOriginalAnnotations(a,{width:s.mediaBox.left+s.mediaBox.width,height:2*s.mediaBox.top+s.mediaBox.height});await n.flattenPageAnnotations(i,t);}if(e&&"none"!==e.saveAnnotation){const t=await this.annotationMapper.getOriginalAnnotations(r,{width:s.mediaBox.left+s.mediaBox.width,height:2*s.mediaBox.top+s.mediaBox.height});var d;if(await n.setPageAnnotations(i,t,o),"flatten"===e.saveAnnotation)(t.length>0||o&&null!==(d=s.pdfOptions)&&void 0!==d&&d.annotCount)&&await n.flattenPage(i);}else {var c;(null===(c=s.pdfOptions)||void 0===c?void 0:c.annotCount)>0&&await n.removePageAnnotations(i);}}}if(y.length){await n.ifFontsExist(y)||wu.warning(wu.WASM_FONT_LOSS);}const m=await n.getPdf(go.RT_BINARY);return i&&(i.details.current=i.details.total,i.status="Completed",wu.info(i)),m}catch(t){throw wu.EXTERNAL_ERR}finally{n.destroy();}}}function vy(t){if(!t.isFull)return !0;if(t.filter&&"none"!==t.filter)return !0;if(t.getActions().some((t=>"rotate"!==t.type)))return !0;if(t.getPerspectiveActions().some((t=>"rotate"!==t.type)))return !0;const e=this.core.getAnnotationsByPageUid(t.uid);let i=!1;return e.forEach((t=>{t.flattened&&(i=!0);})),!!i||0!==t.rotation}function xy(t){if(1!==t.resource.bitDepth)return !1;if(t.filter&&t.filter!==Wc.NONE&&t.filter!==Wc.BLACK_AND_WHITE&&t.filter!==Wc.SAVE_INK)return !1;const e=this.core.getAnnotationsByPageUid(t.uid);let i=!1;return e.forEach((t=>{t.flattened&&(i=!0);})),!i}const wy=t=>{const e=new Set(t);return Array.from(e.values())};class by extends Qs{constructor(){super(),i(this,"observer",void 0),i(this,"onResizeObserver",eo(this)),this.observer=new ResizeObserver((t=>{t.forEach((t=>{this.onResizeObserver.emit(t);}));}));}observe(t){this.observer.observe(t);}unobserve(t){this.observer.unobserve(t);}reset(){this.observer.disconnect();}dispose(){this.observer.disconnect(),this.observer=null,super.dispose();}}class Cy{constructor(){i(this,"canvas",void 0),i(this,"renderer",void 0),i(this,"root",void 0),this.renderer=new _l,this.canvas=new xl({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement,(new xd).init(this.canvas);}render(t,e,i){this.root.children.slice().forEach((t=>{this.root.removeChild(t);})),this.root.appendChild(t),this.canvas.resize(e||t.width,i||t.height),this.canvas.render();}reset(){this.root.children.slice().forEach((t=>{this.root.removeChild(t);})),this.root.sortable.sorted=[];}getCanvas(){return this.canvas.contextService.getDomElement()}}let Sy;function Py(t){let e=-1;Sy||(Sy=function(){const t=new Int32Array(256);for(let e=0;e<256;e++){let i=e;for(let t=0;t<8;t++)i=1&i?3988292384^i>>>1:i>>>1;t[e]=i;}return t}());for(let i=0;i<t.length;i++)e=Sy[255&(e^t[i])]^e>>>8;return -1^e}const Ay="image/png",Ty="image/jpeg",ky="p".charCodeAt(0),Dy="H".charCodeAt(0),Ey="Y".charCodeAt(0),Iy="s".charCodeAt(0);function Ry(t,e){const i=t.slice(0,33);return new Promise(((n,s)=>{const o=new FileReader;o.onload=()=>{const i=new Uint8Array(o.result),s=t.slice(33),r=function(t,e,i,n){if(i===Ty)return t[13]=1,t[14]=e>>8,t[15]=255&e,t[16]=e>>8,t[17]=255&e,t;if(i===Ay){const i=new Uint8Array(13);e*=39.3701,i[0]=ky,i[1]=Dy,i[2]=Ey,i[3]=Iy,i[4]=e>>>24,i[5]=e>>>16,i[6]=e>>>8,i[7]=255&e,[i[8],i[9],i[10],i[11]]=[i[4],i[5],i[6],i[7]],i[12]=1;const s=Py(i),o=new Uint8Array(4);if(o[0]=s>>>24,o[1]=s>>>16,o[2]=s>>>8,o[3]=255&s,n){const e=function(t){for(let e=t.length-1;e>=4;e--)if(9===t[e-4]&&t[e-3]===ky&&t[e-2]===Dy&&t[e-1]===Ey&&t[e]===Iy)return e-3;return -1}(t);return t.set(i,e),t.set(o,e+13),t}const r=new Uint8Array(4);r[0]=0,r[1]=0,r[2]=0,r[3]=9;const a=new Uint8Array(54);return a.set(t,0),a.set(r,33),a.set(i,37),a.set(o,50),a}throw new Error(`The format ${i} is not supported.`)}(i,e,t.type),a=new Blob([r,s],{type:t.type});n(a);},o.onerror=t=>{s(t);},o.readAsArrayBuffer(i);}))}class My{constructor(t){i(this,"core",void 0),this.core=t;}async getRaw(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.raw.isAvailable)return i.raw.getImageDetail();const{fileUid:n,fileIndex:s}=i,o=await this.core.sourceStore.get(n);let r;return r=this.core.parserService.getCustomParserClasses(o.fileData.type)?o.fileData.type:await Xs(o.fileData),r||wu.throw(wu.FILE_NOT_SUPPORT),new Promise(((t,a)=>{let l=!1;const h=setTimeout((()=>{l=!0,t(null);}),15e3);this.core.parserService.getPage(o.fileData,r,n,s).then((n=>{if(l)return;if(clearTimeout(h),!n)return void t(null);let{raw:s}=i;e||(s=new iy(i)),s.updateImageDetail(n.resource),t(s.getImageDetail());})).catch((e=>{l||(clearTimeout(h),wu.error(e),t(null));}));}))}catch(t){return wu.error(t),null}}async getOriginal(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const{original:n}=i;if(n.isAvailable)return n.getImageDetail();const s=await this.getRaw(t);if(!s)return null;const o=await this.handlePerspectiveQuad(t,s);return e&&o&&i.original.updateImageDetail(o),o}async handlePerspectiveQuad(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=e;const s=i.getProcessedQuad();if(s){const o=wu.buildInfo("perspective",{pageUid:t,perspectiveQuad:s});if(wu.info(o),n=await this.core.perspectiveService.perspective({data:e.data,type:exports.EnumImageDataType.JPEG},s,{angle:i.initRotation}),!n)return o.status="Failed",wu.info(o),null;o.status="Completed",wu.info(o);}const o=new iy(i);return o.updateImageDetail(n),o.getImageDetail()}async getDisplay(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.display.isAvailable)return i.display.getImageDetail();const n=await this.getOriginal(t);if(!n)return null;const{filter:s}=i,o=await this.handleFilter(t,n);return i.filter!==s?this.getDisplay(t):(e&&o&&i.display.updateImageDetail(o),o)}async handleFilter(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const n=e,{filter:s}=i;if(s&&"none"!==s){const i=wu.buildInfo("filter",{pageUid:t,filterType:s});wu.info(i);const o=await this.core.filterService.applyFilter({data:e.data,type:exports.EnumImageDataType.JPEG,width:e.width,height:e.height},s);if(!Gn(o))return i.status="Failed",wu.info(i),null;i.status="Completed",wu.info(i),n.data=o;}const o=new iy(i);return o.updateImageDetail(n),o.getImageDetail()}async getEditedDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.core.pageService.getPage(t);if(!s||s.isDestroyed)return null;const o=await this.getDisplay(t,!1),r=this.core.getAnnotationsByPageUid(t).some((t=>!0===t.flattened));if(s.getActions().length||0!==s.rotation||!s.isMediaBoxEqualCropBox()||e&&s.annotations.length||r){const o=await this.applyEditToDisplay(t,e,i,!0,n),r=new iy(s);return r.updateImageDetail(o),r.getImageDetail()}return o}async getNotRotatedDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.core.pageService.getPage(t);if(!n||n.isDestroyed)return null;const s=await this.getOriginal(t);if(!s)return null;const o=await this.handleFilter(t,s);if(e&&n.annotations.length){const s=await this.applyEditToDisplay(t,e,!1,!1,i),o=new iy(n);return o.updateImageDetail(s),o.getImageDetail()}return o}async getThumbnail(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.thumbnail.isAvailable)return i.thumbnail.getImageDetail();const n=await this.getDisplay(t,!0);if(!n)return null;const s=await this.displayToThumbnail(n.data);return s?(e&&i.thumbnail.updateImageDetail(s),s):null}async displayToThumbnail(t){return t}async applyEditToDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=await this.core.imageLoadService.loadDisplayImage(t),r=this.core.pageService.getPage(t),a=await this.getDisplay(t,!1);let l;if(n)l=r.getEditResultForPixel();else {const[t,e]=Ys([r.initState.mediaBox.width,r.initState.mediaBox.height],Do.displayResolution,r.resource.resolutionX);l={rWidth:t,rHeight:e,cropLeft:0,cropTop:0,cropWidth:t,cropHeight:e,rotation:0};}const h={width:Math.round(l.rWidth)||1,height:Math.round(l.rHeight)||1,data:null},d=new Ma({style:{x:-l.cropLeft,y:-l.cropTop,img:o,width:a.width,height:a.height}}),c=new Fa({style:{x:-(l.cropWidth-l.rWidth)/2,y:-(l.cropHeight-l.rHeight)/2,width:l.cropWidth,height:l.cropHeight}});if(c.appendChild(d),c.setLocalAngle(l.rotation),this.core.annotationService&&r.annotations.length){const n=this.core.getAnnotationsByPageUid(t).some((t=>!0===t.flattened));if(e||!e&&n){const s=new Fa({style:{x:-l.cropLeft,y:-l.cropTop,width:r.original.pageWidth,height:r.original.pageHeight}});await this.applyAnnotationToPage(s,t,i,!e&&n),c.appendChild(s);}}this.core.commonCanvas.render(c,Math.max(1/devicePixelRatio,l.rWidth),Math.max(1/devicePixelRatio,l.rHeight)),this.core.commonCanvas.reset();const u=this.core.commonCanvas.getCanvas();return new Promise(((t,e)=>{u.toBlob((async e=>{e=await Ry(e,r.resolutionX||Do.displayResolution),h.data=e,t(h);}),s?"image/png":"image/jpeg",1);}))}async applyAnnotationToPage(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.core.pageService.getPage(e),o=[];s.annotations.forEach((t=>{const e=this.core.annotationService.getAnnotationByUid(t);o.push(e);})),o.sort(((t,e)=>t.layer-e.layer));for(let e=0;e<o.length;e++){if(i&&!o[e].flags.includes("print"))continue;if(n&&!o[e].flattened)return;if("stamp"===o[e].type&&o[e].style.imageData&&(!Jn(o[e].style.width)||!Jn(o[e].style.height))){const t=new bo,i=await t.readImageInfo({fileSource:o[e].style.imageData});let n=i.imageWidth,s=i.imageHeight;if(n>400||s>400){const t=Math.max(n/400,s/400);n/=t,s/=t;}o[e].style.width=n,o[e].style.height=s;}const r=this.core.annotationService.createAnnotationShape(o[e],s);r instanceof Oh&&r.style.imageData&&r.style.img instanceof HTMLImageElement&&await new Promise((t=>{r.style.img.onload=()=>{t();};})),r&&t.appendChild(r);}}}class By{constructor(t){i(this,"name",void 0),this.name=t||"Guest";}getUser(){return this.name}setUser(t){this.name=t;}}class Ly extends Ng{static create(t){return new Ly(t)}constructor(t){super("setExternalHandler"),i(this,"handlerType",void 0),this.handlerType=t;}}class Uy{static makeSureSourcesTypeSupported(t,e,i,n,s){const o=[];if(Fn(e))e.forEach(((t,e)=>{if(!t||0===t.length){const t=bu("Source[]",i,`[${e}].fileData`,!0);o.push(`${t}: ${wu.FILE_NOT_SUPPORT.message}`);}}));else if(!e||0===e.length){const t=bu("Source",i,"fileData");o.push(`${t}: ${wu.FILE_NOT_SUPPORT.message}`);}if(o.length>0){if(!t){throw wu.buildError({...wu.FILE_NOT_SUPPORT,details:o},n,s)}wu.throw({...wu.FILE_NOT_SUPPORT,details:o},n,s);}}}const Oy=new Map,Ny=[];let _y=class t extends Qs{constructor(t,e,n,s,o){super(),i(this,"parserService",void 0),i(this,"saverService",void 0),i(this,"perspectiveService",void 0),i(this,"filterService",void 0),i(this,"detectorService",void 0),i(this,"viewerService",void 0),i(this,"editService",void 0),i(this,"annotationService",void 0),i(this,"documentService",void 0),i(this,"trackerService",void 0),i(this,"imageLoadService",void 0),i(this,"optimizationService",void 0),i(this,"processService",void 0),i(this,"commandService",void 0),i(this,"fileSaveService",void 0),i(this,"fileService",void 0),i(this,"pageService",void 0),i(this,"resizeService",void 0),i(this,"imageDataService",void 0),i(this,"userService",void 0),i(this,"sourceStore",void 0),i(this,"commonCanvas",void 0),i(this,"onBeforeGetPageData",void 0),i(this,"onBeforeLoadSource",void 0),i(this,"onAfterLoadSource",void 0),i(this,"onSetExternalHandler",void 0),i(this,"onAfterPerspective",void 0),i(this,"onFilterChanged",void 0),i(this,"onUnload",void 0),this.parserService=t,this.saverService=e,this.perspectiveService=n,this.filterService=s,this.detectorService=o,this.onBeforeGetPageData=eo(this),this.onBeforeLoadSource=eo(this),this.onAfterLoadSource=eo(this),this.onSetExternalHandler=eo(this),this.onUnload=eo(this),this.onAfterPerspective=eo(this),this.onFilterChanged=eo(this),this.commonCanvas=new Cy,this.sourceStore=new ig,this.trackerService=new dy,this.documentService=new hy,this.fileService=new py,this.pageService=new gy(this),this.imageLoadService=new Rg(this),this.optimizationService=new Ug,this.processService=new Og,this.commandService=new uy,this.fileSaveService=new my(this),this.resizeService=new by,this.imageDataService=new My(this),this.userService=new By("Guest"),Ny.forEach((t=>{var e;null===(e=t.apply)||void 0===e||e.call(t,this);})),this.initServiceEvent();}initServiceEvent(){const{documentService:t,commandService:e,pageService:i,viewerService:n,fileService:s,parserService:o}=this;t.onDocumentCreated.on((t=>{e.createInvoker(t.docUid);}),e),t.onDocumentDeleted.on((t=>{e.deleteInvokers([t.docUid]);}),e),n.onPagePreloadChanged.on((t=>{i.handlePagePreloadChange(t);}),i),s.onDeleteFileData.on((t=>{this.sourceStore.remove(t);})),s.onDeleteFileData.on((t=>{o.freeParserByFileUid(t);}),o);}static getClass(t){return Oy.get(t)}static setClass(t,e){Oy.set(t,e);}static registerPlugin(e){Ny.includes(e)||Ny.push(e),e.install&&e.install(t);}getClass(t){return Oy.get(t)}createAsyncRepository(){return new ig}createViewer(e){const i=t.getClass("Viewer"),n={...e,core:this,groupUid:e.groupUid||ts()},s=this.viewerService.createViewer(i,n);return s.context.isInitialized=!0,s}removeViewer(t){this.viewerService.removeViewer(t.uid);}getViewer(t){return this.viewerService.getViewer(t)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(t){return this.parserService.getDefaultParserOptions(t)}setFileParserDefaultOptions(t,e){return this.parserService.setDefaultParserOptions(t,e)}setFileParser(t,e){this.parserService.registerCustomParser(t,e);}getSourceParseOptions(t,e){if("application/pdf"===e){var i;const e=t;return e.convertMode=null!==(i=e.convertMode)&&void 0!==i?i:exports.EnumConvertMode.CM_AUTO,Vn(e)}if("width"in t){return Vn(t)}}async loadSource(t,e,i,n){Fn(t)||(t=[t]);const s=this.documentService.getDocument(e);if(!s)return [];const o=Jn(i)?{insertBeforeIndex:i}:{...i},r="ignore"===o.exception,a=await this.getSourcesMimeTypes(t);r||Uy.makeSureSourcesTypeSupported(!1,a,"sources");const l=[],h=async(t,i)=>{const n=a[i];r&&Uy.makeSureSourcesTypeSupported(!1,n,`sources[${i}]`);const h=[],d=ts(),c=this.getSourceParseOptions(t,n),{fileData:u}=t,{pageCount:p,batchSize:g}=await this.parserService.getParseInfo(u,n,d,c);this.sourceStore.set(d,{fileData:n===u.type?u:u.slice(0,u.size,n),loadOptions:c,pageCount:p}),this.fileService.addFile(d,n,p);const f=this.getBatchIndices(g,p);for(const i of f){var y;const r=await this.parserService.parse(u,n,d,i,c).catch((t=>{throw t}));null===(y=t.extraPageData)||void 0===y||y.forEach((t=>{const e=r.find((e=>e.fileIndex===t.index));if(e){const i={...t};delete i.index,Jn(e.rotation)&&Jn(i.rotation)&&(i.rotation+=e.rotation),zn(i.filter)||(e.filter=i.filter),zn(i.rotation)||(e.rotation=i.rotation),zn(i.perspectiveQuad)||(e.perspectiveQuad=i.perspectiveQuad),zn(i.index)||(e.index=i.index);}}));const a=r.map((t=>{var e;const i=ts();return t.pageUid=i,null!==(e=t.filter)&&void 0!==e||(t.filter=this.filterService.getDefaultFilterType()||"none"),i}));l.push({fileData:u,mimeType:n,fileUid:d,parsedPages:r,indices:i,parseOptions:c}),this.fileService.addUsersByParsedPages(d,r),this.pageService.startCreatePagesByParsedPages(r,d,s),this.documentService.addPagesToDocument(e,a,o.insertBeforeIndex),zn(o.insertBeforeIndex)||(o.insertBeforeIndex+=r.length),h.push(...a);}return h};this.onBeforeLoadSource.emit({docUid:e});const d=[];for(const[e,i]of t.entries())try{const t=await h(i,e);d.push(...t),n&&(n.status="InProgress",n.details.current=e+1,wu.info(n));}catch(t){if(!r)throw t;wu.warning(t);}for(let t=0;t<l.length;t++){const i=l[t];await this.parserService.parseAnnotation(i.fileData,i.mimeType,i.fileUid,i.parsedPages,i.indices,i.parseOptions),this.annotationService.createAnnotationsByParsedPages(e,i.parsedPages),i.parsedPages.forEach((t=>{const e=this.pageService.getPage(t.pageUid);t.annotations&&(e.annotations=t.annotations.map((t=>t.uid)));}));}const c=d.map((t=>s.pages.indexOf(t)));return this.onAfterLoadSource.emit(Jg.create(e,c,d)),this.documentService.onPagesAddedOut.emit(Jg.create(e,[...c],[...d])),n&&(n.details.current=n.details.total,n.status="Completed",wu.info(n)),d}async getSourcesMimeTypes(t){const e=[];for(const i of t){const t=this.parserService.getCustomParserClasses(i.fileData.type)?i.fileData.type:await Xs(i.fileData);e.push(t);}return e}getAnnotationsByPageUid(t){const e=this.pageService.getPage(t);return e?e.annotations.map((t=>this.annotationService.getAnnotationByUid(t))):[]}getBatchIndices(t,e){const i=[];for(let n=0;n<e;){const s=t>0?Math.min(t,e-n):e;i.push(Array.from({length:s},((t,e)=>n+e))),n+=s;}return i}async getPageData(t,e){var i;null!==(i=e)&&void 0!==i||(e={raw:!0,display:!0,thumbnail:!0,renderAnnotation:!1,isGetPrintPageData:!1,getPng:!1});const n=this.pageService.getPage(t);if(!n)return null;this.onBeforeGetPageData.emit({pageUid:t});const s=await this.sourceStore.get(n.fileUid);let{quad:o}=n;o&&(o=n.quadToPixelPPI(o),ry(o));const r={uid:n.uid,fileData:"application/ddv-blank-image"!==s.fileData.type?s.fileData:null,fileIndex:n.fileIndex,perspectiveQuad:o,rotation:n.rotation,filter:n.filter,mediaBox:{...n.mediaBox},cropBox:{...n.cropBox}};if(e.raw){const e=await this.imageDataService.getRaw(t);r.raw={...e};}if(e.display){const i=await this.imageDataService.getEditedDisplay(t,e.renderAnnotation,e.isGetPrintPageData,e.getPng);r.display={...i};}if(e.thumbnail){const i=await this.imageDataService.getEditedDisplay(t,e.renderAnnotation,e.isGetPrintPageData,e.getPng);r.thumbnail={...i};}return r}async setCustomData(t,e){const i=this.pageService.getPage(t);return i?(i.customData=Vn(e),!0):Promise.reject()}async getCustomData(t){const e=this.pageService.getPage(t);if(!e)return Promise.reject();return Vn(e.customData)}async updatePage(t,e){var i,n;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=this.pageService.getPage(t);if(!o)return !1;const r=ts(),a=this.parserService.getCustomParserClasses(e.type)?e.type:await Xs(e);Uy.makeSureSourcesTypeSupported(!0,[a],"data");const l=this.getSourceParseOptions({fileData:e},a),{pageCount:h}=await this.parserService.getParseInfo(e,a,r,l);if(Jn(s.fileIndex)&&(s.fileIndex>=h||s.fileIndex<0))return wu.reject(wu.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");this.sourceStore.set(r,{fileData:e,loadOptions:l,pageCount:h}),this.fileService.addFile(r,a,h);const[d]=await this.parserService.parse(e,a,r,[s.fileIndex||0],l).catch((t=>{throw t}));d.pageUid=t,null!==(i=d.filter)&&void 0!==i||(d.filter=this.filterService.getDefaultFilterType()||"none");const c=this.annotationService.createAnnotationsByParsedPages(o.doc.uid,[d]);return this.commandService.removePageFromCommand(o.doc.uid,[t]),this.fileService.addUser(r,s.fileIndex,t),this.fileService.deleteUser(o.fileUid,o.fileIndex,t),null===(n=this.annotationService)||void 0===n||n.deleteAnnotations(o.annotations,!1),this.pageService.updatePage(t,e,{...d,...s,fileUid:r,annotations:c[0]}),!0}async updatePageInternal(t,e){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.pageService.getPage(t);if(!s)return !1;const o=ts(),r=this.parserService.getCustomParserClasses(e.type)?e.type:await Xs(e);Uy.makeSureSourcesTypeSupported(!0,[r],"data");const a=this.getSourceParseOptions({fileData:e,renderOptions:{renderAnnotations:"loadAnnotations"}},r),{pageCount:l}=await this.parserService.getParseInfo(e,r,o,a);if(Jn(n.fileIndex)&&(n.fileIndex>=l||n.fileIndex<0))return wu.reject(wu.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");this.sourceStore.set(o,{fileData:e,loadOptions:a,pageCount:l}),this.fileService.addFile(o,r,l);const[h]=await this.parserService.parse(e,r,o,[n.fileIndex||0],a).catch((t=>{throw t}));h.pageUid=t,null!==(i=h.filter)&&void 0!==i||(h.filter=this.filterService.getDefaultFilterType()||"none");this.annotationService.createAnnotationsByParsedPages(s.doc.uid,[h]);this.commandService.removePageFromCommand(s.doc.uid,[t]),this.fileService.addUser(o,n.fileIndex,t),this.fileService.deleteUser(s.fileUid,s.fileIndex,t);const d=this.pageService.getPage(t).annotations.slice();return this.pageService.updatePage(t,e,{...h,...n,fileUid:o,annotations:d}),!0}async getPerspectivePreviewData(t,e,i){const n=this.pageService.getPage(t),s=await this.imageDataService.getRaw(t);if(!n||!s)return null;let{quad:o}=n;o||(o=[[0,0],[s.width,0],[s.width,s.height],[0,s.height]]);const r=await this.processService.perspectivePreview(s.data,4,o,{width:s.width,height:s.height},{...e,...i});return Promise.resolve(r)}createDocument(t){return this.documentService.createDocument(t)}getDocument(t){return this.documentService.getDocument(t)}deleteDocuments(t){const{documentService:e,pageService:i}=this;if(t.map((t=>e.getDocument(t))).includes(void 0))return !1;const n=_f.create(t);e.onBeforeDeleteDocs.emit(n),t.forEach((t=>{const n=e.getDocument(t);var s;n&&(n.pages.forEach((t=>{const e=i.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t);})),null===(s=this.annotationService)||void 0===s||s.deleteAnnotationPages([...n.pages]),i.deletePages(n.pages));}));const s=e.deleteDocuments(t);return e.onAfterDeleteDocs.emit(n),s}renameDocument(t,e){this.documentService.renameDocument(t,e);}transferDocument(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:n}=this,s=n.getDocument(t),o=n.getDocument(e);if(!s||!o)return !1;if(t===e&&!i.copy)return !i.sourceIndices||this.movePages(t,i.sourceIndices,i.insertBeforeIndex);let r=[];if(null!=i&&i.sourceIndices){r=wy(i.sourceIndices).map((t=>s.pages[t]));}else r=[...s.pages];if(!r.length)return !0;i.copy?r.forEach(((t,e,n)=>{const s=this.pageService.getPage(t),r=ts();if(this.fileService.addUser(s.fileUid,s.fileIndex,r),this.pageService.copyPage(r,o,s),!1!==(null==i?void 0:i.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(r);const t=s.annotations.map((t=>({...this.annotationService.getAnnotationByUid(t).getConfig(),docUid:o.uid,pageUid:r,uid:ts()})));t.length&&this.annotationService.annotationApp.createAnnotations(t);}n[e]=r;})):(n.removePagesFromDocument(s.uid,r),r.forEach((t=>{const e=this.pageService.getPage(t);var n;(e.doc=o,!1===(null==i?void 0:i.includeAnnotations))&&(null===(n=this.annotationService)||void 0===n||n.deleteAnnotations(e.annotations),e.annotations=[]);}))),n.addPagesToDocument(o.uid,r,i.insertBeforeIndex);const a=r.map((t=>o.pages.indexOf(t)));return n.onPagesAddedOut.emit(Jg.create(o.uid,a,r)),!0}mergeDocuments(t,e){const{documentService:i}=this,n=i.createDocument(e);if(!t.length)return n;t=wy(t);const s=[];if(t.forEach((t=>{const e=i.getDocument(t);s.push(...e.pages);})),null!=e&&e.deleteOriginal?(i.deleteDocuments(t),s.forEach((t=>{const i=this.pageService.getPage(t);var s;(i.doc=n,!1===(null==e?void 0:e.includeAnnotations))&&(null===(s=this.annotationService)||void 0===s||s.deleteAnnotations(i.annotations),i.annotations=[]);}))):s.forEach(((t,i,s)=>{const o=this.pageService.getPage(t),r=ts();if(this.fileService.addUser(o.fileUid,o.fileIndex,r),this.pageService.copyPage(r,n,o),!1!==(null==e?void 0:e.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(r);const t=o.annotations.map((t=>({...this.annotationService.getAnnotationByUid(t).getConfig(),docUid:n.uid,pageUid:r,uid:ts()})));t.length&&this.annotationService.annotationApp.createAnnotations(t);}s[i]=r;})),s.length){i.addPagesToDocument(n.uid,s);const t=s.map((t=>n.pages.indexOf(t)));i.onPagesAddedOut.emit(Jg.create(n.uid,t,s));}return n}openDocument(t,e){return this.openOrCloseDocument(t,e)}closeDocument(t,e){return this.openOrCloseDocument(t,e,!0)}openOrCloseDocument(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.documentService.getDocument(t);if(!n||!this.viewerService.hasViewer(e))return !1;const s=this.viewerService.getViewer(e);return i?this.documentService.onCloseDocument.emit(Af.create(n,e,s.groupUid)):this.documentService.onOpenDocument.emit(Pf.create(n,e,s.groupUid)),this.commandService.emitOperationsChanged(t),!0}deletePages(t,e){var i;return e=wy(e),this.commandService.removePageFromCommand(t,[...e]),e.forEach((t=>{const e=this.pageService.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t);})),null===(i=this.annotationService)||void 0===i||i.deleteAnnotationPages(e),this.documentService.removePagesFromDocument(t,[...e]),this.pageService.deletePages(e),!0}deleteAllPages(t){var e;const i=this.documentService.getDocument(t),n=[...i.pages];return this.commandService.removePageFromCommand(t,n),i.pages.forEach((t=>{const e=this.pageService.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t);})),null===(e=this.annotationService)||void 0===e||e.deleteAnnotationPages(i.pages),this.documentService.removeAllPagesFromDocument(t),this.pageService.deletePages(n),!0}movePages(t,e,i){return e=wy(e),this.documentService.movePages(t,e,i)}swapPages(t,e,i){return this.documentService.swapPages(t,e,i)}reorderPages(t,e){return e=wy(e),this.documentService.reorderPages(t,e)}async printPages(t,e,i){const n=this.documentService.getDocument(t);if(!n)return Promise.reject(wu.DOC_NOT_EXIST);const s=e||Array.from(Array(n.pages.length).keys()),o=[];for(let t=0;t<s.length;t++){var r;const e=await this.getPageData(n.pages[s[t]],{raw:!1,display:!0,thumbnail:!1,renderAnnotation:null===(r=null==i?void 0:i.printAnnotation)||void 0===r||r,isGetPrintPageData:!0});o.push(e);}if(0===o.length)return Promise.reject();const a=[];return o.forEach((t=>{a.push({data:t.display.data,width:t.display.width,height:t.display.height});})),function(t){let e="",i=0,n=0;t.forEach(((t,s)=>{let o=1120,r=850;const a=r/t.width,l=o/t.height;a<l?o=Math.floor(t.height*a):a>l&&(r=Math.floor(t.width*l)),e+=`<div class="imageContainer"><img id="DDV_Image${s}" src='${es(t.data).data}' referrerpolicy='strict-origin-when-cross-origin'"/></div>`,i+=r,n+=o;}));const s=`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${i}, height=${n}`,o=window.open("about:blank","_blank",s),r=`<html><head>\n                    <style>\n                        @page {\n                            margin: 0mm;\n                        }\n                        @media print {\n                            body, html {\n                                margin: 0;\n                                padding: 0;\n                                width: 100%;\n                                height: 100%;\n                            }\n\n                            .imageContainer {\n                                break-after: page;\n                                position: relative;\n                                width: 100%;\n                                height: 100%;\n                                display: flex;\n                                align-items: center;\n                                justify-content: center\n                            }\n\n                            img {\n                                object-fit: contain;\n                                max-width: 100%;\n                                max-height: 100%;\n                            }\n                        }\n                    </style>\n                </head><body id='DDV_body'>${e}</body></html>`;if(o){o.document.write(r),o.document.close(),o.focus();const t=o.document.getElementById("DDV_body");t&&(t.onload=()=>{o&&o.print();});}}(a),!0}setDetectHandler(t,e){this.onSetExternalHandler.emit(Ly.create("detect")),this.detectorService.setDetector(e);}setImageFilterHandler(t){this.onSetExternalHandler.emit(Ly.create("filter")),this.filterService.setImageFilter(t);}clearExternalHandler(t){if(Zn(t))switch(t){case"documentBoundariesDetect":this.setDetectHandler(t,null);break;case"imageFilter":this.setImageFilterHandler(null);}}unload(){var t;this.viewerService.reset(),this.commonCanvas.reset(),this.sourceStore.reset(),this.documentService.reset(),this.fileService.reset(),this.pageService.reset(),this.commandService.reset(),this.resizeService.reset(),this.processService.reset(),this.detectorService.reset(),this.parserService.reset(),this.fileSaveService.reset(),null===(t=this.annotationService)||void 0===t||t.reset(),xp.reset(),so.unload();}preloadModule(t){so.preloadModule(t);}async perspectivePage(t,e,i){let n,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this.pageService.getPage(e);if(o.setQuad(i)){if(this.annotationService.deleteAnnotations(o.annotations),this.commandService.removePageFromCommand(t,[e]),o.quad){const{width:t,height:e}=ny(o.quad);o.original.updateImageDetail({width:t,height:e}),o.display.updateImageDetail({width:t,height:e});}this.imageLoadService.cancelLoadOriginalImage(e),o.original.reset(),s||(n=await this.imageDataService.getOriginal(e)),this.imageLoadService.cancelLoadDisplayImage(e),this.imageLoadService.cancelLoadThumbnailImage(e),o.display.reset(),o.thumbnail.reset();let{width:r,height:a}=o.original.getPageSize();o.isFull?(o.mediaBox={...o.initState.mediaBox},o.cropBox={...o.initState.cropBox}):(s&&({width:r,height:a}=ny(o.quad)),o.mediaBox={left:0,top:0,width:r,height:a},o.cropBox={...o.mediaBox}),this.onAfterPerspective.emit(Of.create(o.doc.uid,e,i,r,a));}return s?null:n||this.imageDataService.getOriginal(e)}async filterPages(t,e,i){e.forEach((t=>{const e=this.pageService.getPage(t);e.filter!==i&&(e.filter=i,e.display.reset(),e.thumbnail.reset());}));const n=Ef.create(t,e,i);return this.onFilterChanged.emit(n),!0}insertBlankPage(t,e,i,n,s,o){const r=this.documentService.getDocument(t);if(!r)return "";this.onBeforeLoadSource.emit({docUid:t});const a=ts(),l={fileData:new Blob([""],{type:"application/ddv-blank-image"}),width:null!=e?e:816,height:null!=i?i:1056,resolutionX:null!=n?n:96,resolutionY:null!=s?s:96},h=this.getSourceParseOptions(l,"application/ddv-blank-image");this.sourceStore.set(a,{fileData:l.fileData,loadOptions:h,pageCount:1}),this.fileService.addFile(a,"application/ddv-blank-image",1),this.parserService.parse(l.fileData,"application/ddv-blank-image",a,[0],h);const{displayResolution:d}=Do,c=ts();this.fileService.addUser(a,0,c);const u={resource:{data:l.fileData,width:l.width,height:l.height,resolutionX:l.resolutionX,resolutionY:l.resolutionY},mediaBox:{left:0,top:0,width:l.width/l.resolutionX*d,height:l.height/l.resolutionY*d},cropBox:{left:0,top:0,width:l.width/l.resolutionX*d,height:l.height/l.resolutionY*d},annotations:[],fileIndex:0,pageUid:c,fileUid:a};return this.pageService.createPage(u,r),this.annotationService.createAnnotationsByParsedPages(t,[u]),this.documentService.addPagesToDocument(t,[c],o),this.onAfterLoadSource.emit(Jg.create(t,[r.pages.indexOf(c)],[c])),this.documentService.onPagesAddedOut.emit(Jg.create(t,[r.pages.indexOf(c)],[c])),c}async getPageSourceInfo(t){const e=this.pageService.getPage(t),i={};i.bitDepth=e.resource.bitDepth,i.resolutionX=e.resource.resolutionX,i.resolutionY=e.resource.resolutionY;const n=await this.sourceStore.get(e.fileUid);if("application/pdf"!==n.fileData.type)return i.pageContentType=n.fileData.type,i;if(e.pdfOptions&&e.pdfOptions.pageContentType)return i.pageContentType=e.pdfOptions.pageContentType,i;const s=new So;try{const t=await s.getPdfPageContentType({fileSource:n.fileData,password:n.loadOptions.password},e.fileIndex);return e.pdfOptions&&(e.pdfOptions.pageContentType=t),i.pageContentType=t,i}finally{s.destroy();}}};function Wy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:i,style:n,id:s,className:o,children:r}=t,a=document.createElement(i);return s&&(a.id=s+e),o&&(a.className=o),n&&function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Zn(e))t.style.cssText=e;else if(i){let i="";Object.keys(e).forEach((t=>{i+=`${t}:${e[t]};`;})),t.style.cssText=i;}else Object.keys(e).forEach((i=>{t.style[i]=e[i];}));}(a,n),r&&r.forEach((t=>{const i=Wy(t,e);a.appendChild(i);})),a}function Fy(t){t&&(t.style.display="none");}function Hy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.style.display=e);}const Vy=t=>parseFloat(Number(t).toFixed(4));class zy extends Qs{constructor(){super(),i(this,"uid",void 0),i(this,"type",void 0),i(this,"action",void 0),i(this,"isValid",void 0),this.isValid=!0,this.uid=ts();}execute(){return null}undo(){return null}}new class extends Qs{constructor(){super(...arguments),i(this,"docCreated",eo(this)),i(this,"docDeleted",eo(this)),i(this,"pageAdded",eo(this)),i(this,"pageDeleted",eo(this)),i(this,"annotationCreated",eo(this)),i(this,"annotationDeleted",eo(this)),i(this,"annotationUpdated",eo(this)),i(this,"replyToAnnotation",eo(this)),i(this,"commentDeleted",eo(this)),i(this,"commentUpdated",eo(this));}};class jy extends qo{static create(t){return new jy(t,t.uid)}constructor(t,e){super(e),i(this,"type",void 0),i(this,"docUid",void 0),i(this,"pageUid",void 0),i(this,"style",void 0),i(this,"transform",void 0),i(this,"flags",void 0),i(this,"comment",void 0),i(this,"layer",void 0),i(this,"creationDate",void 0),i(this,"modified",!1),i(this,"flattened",!1),i(this,"oriIndex",void 0),this.type=t.type,this.docUid=t.docUid,this.pageUid=t.pageUid,this.style=t.style,this.flags=t.flags||["print"],this.transform=t.transform,this.oriIndex=t.oriIndex,zn(null==t?void 0:t.modified)||(this.modified=t.modified);}getConfig(){return {uid:this.uid,docUid:this.docUid,pageUid:this.pageUid,type:this.type,style:Vn(this.style),transform:Vn(this.transform),flags:Vn(this.flags),comment:Vn(this.comment),creationDate:this.comment.creationDate,modificationDate:this.comment.modificationDate,oriIndex:this.oriIndex,modified:this.modified}}clone(t,e){const i=jy.create({docUid:this.docUid,pageUid:t,type:this.type,style:Vn(this.style),transform:Vn(this.transform),flags:this.flags.slice(),comment:this.comment}),n=this.comment.clone(i.uid,e);return i.comment=n,i.layer=this.layer,i}updateStyle(t){Object.assign(this.style,t);}updateComment(t){this.comment.updateComment(t);}addReplies(t){this.comment.replies.push(...t);}deleteReplies(t){const e=this.comment.replies;t.forEach((t=>{if(e.includes(t)){const i=e.findIndex((e=>e.uid===t.uid));e.splice(i,1);}}));}updateReply(t){const e=this.comment.replies.findIndex((e=>e.uid===t.uid));this.comment.replies[e]=t;}getAllReplies(){return [...this.comment.replies]}deleteReplyReviewSate(t){const e=this.comment.getReply(t);e&&e.deleteReviewState();}setReplyReviewState(t,e){const i=this.comment.getReply(t);i&&i.setReviewState(e);}deleteReplyMarkedSate(t){const e=this.comment.getReply(t);e&&e.deleteMarkedState();}setReplyMarkedState(t,e){const i=this.comment.getReply(t);i&&i.setMarkedState(e);}}class $y{static create(t){return new $y(t)}constructor(t){i(this,"uid",void 0),i(this,"author",void 0),i(this,"contents",void 0),i(this,"creationDate",void 0),i(this,"state",void 0),this.uid=t.uid,this.author=t.author,this.contents=t.contents,this.creationDate=t.creationDate,this.state=t.state;}}class Gy{static create(t){return new Gy(t)}constructor(t){i(this,"uid",void 0),i(this,"author",void 0),i(this,"contents",void 0),i(this,"creationDate",void 0),i(this,"state",void 0),this.uid=t.uid,this.author=t.author,this.contents=t.contents,this.creationDate=t.creationDate,this.state=t.state;}}class Xy extends Yo{static create(t,e){return new Xy(t,e)}constructor(t,e){var n,s;super(e),i(this,"annotationUid",void 0),i(this,"author",void 0),i(this,"subject",void 0),i(this,"contents",void 0),i(this,"creationDate",void 0),i(this,"modificationDate",void 0),i(this,"markedStates",void 0),i(this,"reviewStates",void 0),this.annotationUid=t.annotationUid,this.author=t.author,this.subject=t.subject,this.contents=t.contents,this.creationDate=t.creationDate,this.modificationDate=t.modificationDate,this.markedStates=[],this.reviewStates=[],null!==(n=t.markedStates)&&void 0!==n&&n.length&&t.markedStates.forEach((t=>{const e=Gy.create(t);this.markedStates.push(e);})),null!==(s=t.reviewStates)&&void 0!==s&&s.length&&t.reviewStates.forEach((t=>{const e=$y.create(t);this.reviewStates.push(e);}));}updateReply(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t);}setMarkedState(t){const e=this.markedStates.length,i=this.markedStates[e-1];if((null==i?void 0:i.state)!==t.state||!i&&"marked"===t.state){const e=Gy.create(t);return this.markedStates.push(e),!0}return !1}deleteMarkedState(){this.markedStates.pop();}setReviewState(t){const e=$y.create(t);this.reviewStates.push(e);}deleteReviewState(){this.reviewStates.pop();}clone(t,e){const i=Xy.create({annotationUid:t,author:this.author,subject:this.subject,contents:this.contents,creationDate:e,modificationDate:e});return this.cloneStates(i),i}cloneStates(t){this.markedStates.forEach((e=>{const i=Gy.create({...e,uid:ts()});t.markedStates.push(i);})),this.reviewStates.forEach((e=>{const i=$y.create({...e,uid:ts()});t.reviewStates.push(i);}));}}class Yy extends Xy{static create(t,e){return new Yy(t,e)}constructor(t,e){super(t,e),i(this,"replies",void 0),this.replies=[];}updateComment(t){Object.assign(this,t);}getReply(t){return this.replies.find((e=>e.uid===t.uid))}clone(t,e){const i=Yy.create({annotationUid:t,author:this.author,subject:this.subject,contents:this.contents,creationDate:e,modificationDate:e});return this.cloneStates(i),this.replies.forEach((n=>{i.replies.push(n.clone(t,e));})),i}}class qy extends Yo{static create(t){return new qy(t)}constructor(t){super(t),i(this,"bottom",void 0),i(this,"top",void 0),i(this,"annotations",void 0),i(this,"layers",void 0),this.annotations=[],this.bottom=-1,this.top=0,this.layers=[];}clone(t){const e=qy.create(t);return e.top=this.top,e.bottom=this.bottom,e.annotations=this.annotations.slice(),e.layers=Vn(this.layers),e}createTop(){const{top:t}=this;return this.top+=1,t}addAnnotation(t,e){if(!this.annotations.includes(t)){this.annotations.push(t);const i={annotationUid:t,layer:e};return this.layers.push(i),zn(e)?(i.layer=this.top,this.top+=1):this.sortLayers(),i}return null}sortLayers(){this.layers.sort(((t,e)=>t.layer-e.layer));}deleteAnnotations(t){t.forEach((t=>{const e=this.annotations.indexOf(t);e>-1&&this.annotations.splice(e,1);const i=this.layers.findIndex((e=>e.annotationUid===t));i>-1&&this.layers.splice(i,1);}));}moveAnnotation(t){const e=this.annotations.indexOf(t);if(e<0)return null;const i=this.layers.findIndex((e=>e.annotationUid===t));if(i<0)return null;const n={annotationUid:t,index:e,layerIndex:i,layer:this.layers[i].layer};return this.deleteAnnotations([t]),n}undoMoveAnnotation(t){const{annotationUid:e}=t;this.annotations.includes(e)||this.layers.find((t=>t.annotationUid===e))||(this.annotations.splice(t.index,0,e),this.layers.splice(t.layerIndex,0,{annotationUid:e,layer:t.layer}));}bringForward(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e],n=this.layers[e+1];return n&&(this.switchLayer(i,n),this.sortLayers()),{curLayer:i,forward:n}}switchLayer(t,e){const i=t.layer;t.layer=e.layer,e.layer=i;}sendBackward(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e],n=this.layers[e-1];return n&&(this.switchLayer(i,n),this.sortLayers()),{curLayer:i,backward:n}}bringToFront(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e];return e<this.layers.length-1&&(i.layer=this.top,this.top+=1,this.sortLayers()),i}sendToBack(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e];return e>0&&(i.layer=this.bottom,this.bottom-=1,this.sortLayers()),i}restoreLayer(t,e){const i=this.layers.findIndex((e=>e.annotationUid===t));if(i<0)return null;return this.layers[i].layer=e,this.sortLayers(),!0}getLayerState(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return {back:!1,front:!1,forward:!1,backward:!1};const i={back:!0,front:!0,forward:!0,backward:!0};return 0===e&&(i.back=!1,i.backward=!1),e===this.layers.length-1&&(i.front=!1,i.forward=!1),1===this.layers.length&&(i.front=!1,i.forward=!1,i.back=!1,i.backward=!1),i}getAnnotationUidListByLayer(){return this.layers.slice().sort(((t,e)=>t.layer-e.layer)).map((t=>t.annotationUid))}}const Jy=new class{constructor(){i(this,"db",void 0),this.db=new Map;}findAnnotationByUid(t){return this.db.get(t)}deleteAnnotation(t){return !!this.db.has(t.uid)&&(this.db.delete(t.uid),!0)}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t);}clear(){this.db.clear();}},Zy=new class{constructor(){i(this,"db",void 0),this.db=new Map;}findCommentByUid(t){return this.db.get(t)}deleteComment(t){this.db.has(t.uid)&&this.db.delete(t.uid);}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t);}clear(){this.db.clear();}},Qy=new class{constructor(){i(this,"db",void 0),this.db=new Map;}findPageByUid(t){return this.db.get(t)}deletePagesByUids(t){t.forEach((t=>{this.db.delete(t);}));}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t);}clear(){this.db.clear();}};const Ky=new class extends Qs{constructor(){super(...arguments),i(this,"annotationCreated",eo(this)),i(this,"annotationDeleted",eo(this)),i(this,"annotationUpdated",eo(this)),i(this,"commentDeleted",eo(this)),i(this,"commentUpdated",eo(this)),i(this,"replyToAnnotation",eo(this)),i(this,"replyDeleted",eo(this)),i(this,"replyUpdated",eo(this)),i(this,"setReplyReviewState",eo(this)),i(this,"deleteReplyReviewState",eo(this)),i(this,"bringFroward",eo(this)),i(this,"sendBackward",eo(this)),i(this,"bringToFront",eo(this)),i(this,"sendToBack",eo(this)),i(this,"restoreLayer",eo(this)),i(this,"annotationPageSwitched",eo(this));}};class tm extends Jo{static create(t){return new tm(t)}constructor(t){super("annotationCreatedDomainEvent"),i(this,"annotations",void 0),this.annotations=t;}}const em=new class{constructor(t,e,n,s){i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),i(this,"annotationPageRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.annotationPageRepo=n,this.eventHooks=s;}execute(t){const e=t.map((t=>{const e=jy.create({...t}),i=this.annotationPageRepo.findPageByUid(e.pageUid).addAnnotation(e.uid,t.layer);if(i&&(e.layer=i.layer),this.annotationRepo.save(e),t.comment){var n;const i=Yy.create(t.comment);e.comment=i,null!==(n=t.comment.replies)&&void 0!==n&&n.length&&t.comment.replies.forEach((t=>{const e=Xy.create(t);i.replies.push(e),this.replyRepo.save(e);}));}return zn(null==t?void 0:t.flattened)||(e.flattened=t.flattened),e})),i=tm.create(e);return this.eventHooks.annotationCreated.emit(i),e}}(Jy,Zy,Qy,Ky);class im extends Jo{static create(t,e){return new im(t,e)}constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("annotationDeletedDomainEvent"),i(this,"annotations",void 0),i(this,"emitEvent",void 0),this.annotations=t,this.emitEvent=e;}}const nm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"annotationPageRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHooks=n;}execute(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(const e of t){if(!this.annotationRepo.has(e))return !1}t.forEach((t=>{this.annotationRepo.deleteAnnotation(t);this.annotationPageRepo.findPageByUid(t.pageUid).deleteAnnotations([t.uid]);}));const i=im.create(t,e);return this.eventHooks.annotationDeleted.emit(i),!0}}(Jy,Qy,Ky);const sm=new class{constructor(t){i(this,"annotationRepo",void 0),this.annotationRepo=t;}execute(t){return this.annotationRepo.findAnnotationByUid(t)}}(Jy);class om extends Jo{static create(t){return new om(t)}constructor(t){super("replyToAnnotationDomainEvent"),i(this,"reply",void 0),this.reply=t;}}const rm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=n;}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid),i=Xy.create({annotationUid:t.annotationUid,author:t.author,contents:t.contents,creationDate:t.creationDate,modificationDate:t.modifiedDate,subject:""});e.addReplies([i]),this.replyRepo.save(i);const n=om.create(i);return this.eventHooks.replyToAnnotation.emit(n),!0}}(Jy,Zy,Ky);class am extends Jo{static create(t,e,i){return new am(t,e,i)}constructor(t,e,n){super("annotationUpdatedDomainEvent"),i(this,"updateDetails",void 0),i(this,"updatedBy",void 0),i(this,"updateActions",void 0),this.updateDetails=t,this.updatedBy=e,this.updateActions=n;}}const lm=new class{constructor(t,e){i(this,"annotationRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.eventHooks=e;}execute(t){const e=[],i=t.updateDetails.map((t=>{const i=this.annotationRepo.findAnnotationByUid(t.uid);if(!i)return null;const n=i.getConfig();t.style&&i.updateStyle(t.style),t.transform&&js(t.transform,i.transform),t.flags&&(i.flags=[...t.flags]),zn(t.flattened)||(i.flattened=t.flattened),zn(t.layer)||(i.layer=t.layer),i.modified=t.modified,t.comment&&Object.assign(i.comment,t.comment),this.annotationRepo.save(i);const s=i.getConfig();return e.push({annotationUid:i.uid,from:n,to:s}),i})),n=am.create(e,t.updatedBy,t.updateActions);return this.eventHooks.annotationUpdated.emit(n),i}}(Jy,Ky);class hm extends Jo{static create(t){return new hm(t)}constructor(t){super("replyUpdatedDomainEvent"),i(this,"reply",void 0),this.reply=t;}}const dm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=n;}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return !1;const i=this.replyRepo.findCommentByUid(t.replyUid);if(!i)return !1;i.updateReply({author:t.author,contents:t.contents,modifiedDate:t.modifiedDate}),e.updateReply(i),this.annotationRepo.save(e),this.replyRepo.save(i);const n=hm.create(i);return this.eventHooks.replyUpdated.emit(n),!0}}(Jy,Zy,Ky);class cm extends Jo{static create(t){return new cm(t)}constructor(t){super("replyDeletedDomainEvent"),i(this,"reply",void 0),this.reply=t;}}const um=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=n;}execute(t){if(!this.replyRepo.has(t))return !1;const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return !1;e.deleteReplies([t]),this.replyRepo.deleteComment(t);const i=cm.create(t);return this.eventHooks.replyDeleted.emit(i),!0}}(Jy,Zy,Ky);class pm extends Jo{static create(t,e,i){return new pm(t,e,i)}constructor(t,e,n){super("bringToFrontDomainEvent"),i(this,"annotationUid",void 0),i(this,"from",void 0),i(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=n;}}const gm=new class{constructor(t,e,n){i(this,"annotRepo",void 0),i(this,"annotPageRepo",void 0),i(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=n;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.bringToFront(t);if(!s)return !1;e.layer=s.layer;const o=i.getAnnotationUidListByLayer(),r=pm.create(t,n,o);return this.eventHooks.bringToFront.emit(r),!0}}(Jy,Qy,Ky);class fm extends Jo{static create(t,e,i){return new fm(t,e,i)}constructor(t,e,n){super("sendToBackDomainEvent"),i(this,"annotationUid",void 0),i(this,"from",void 0),i(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=n;}}const ym=new class{constructor(t,e,n){i(this,"annotRepo",void 0),i(this,"annotPageRepo",void 0),i(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=n;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.sendToBack(t);if(!s)return !1;e.layer=s.layer;const o=i.getAnnotationUidListByLayer(),r=fm.create(t,n,o);return this.eventHooks.sendToBack.emit(r),!0}}(Jy,Qy,Ky);class mm extends Jo{static create(t,e,i,n){return new mm(t,e,i,n)}constructor(t,e,n,s){super("bringForwardDomainEvent"),i(this,"annotationUid",void 0),i(this,"forwardUid",void 0),i(this,"from",void 0),i(this,"to",void 0),this.annotationUid=t,this.forwardUid=e,this.from=n,this.to=s;}}const vm=new class{constructor(t,e,n){i(this,"annotRepo",void 0),i(this,"annotPageRepo",void 0),i(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=n;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.bringForward(t);if(!s)return !1;const{curLayer:o,forward:r}=s;if(e.layer=o.layer,r){this.annotRepo.findAnnotationByUid(r.annotationUid).layer=r.layer;}const a=i.getAnnotationUidListByLayer(),l=mm.create(t,null==r?void 0:r.annotationUid,n,a);return this.eventHooks.bringFroward.emit(l),!0}}(Jy,Qy,Ky);class xm extends Jo{static create(t,e,i,n){return new xm(t,e,i,n)}constructor(t,e,n,s){super("sendBackwardDomainEvent"),i(this,"annotationUid",void 0),i(this,"backwardUid",void 0),i(this,"from",void 0),i(this,"to",void 0),this.annotationUid=t,this.backwardUid=e,this.from=n,this.to=s;}}const wm=new class{constructor(t,e,n){i(this,"annotRepo",void 0),i(this,"annotPageRepo",void 0),i(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=n;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.sendBackward(t);if(!s)return !1;const{curLayer:o,backward:r}=s;if(e.layer=o.layer,r){this.annotRepo.findAnnotationByUid(r.annotationUid).layer=r.layer;}const a=i.getAnnotationUidListByLayer(),l=xm.create(t,null==r?void 0:r.annotationUid,n,a);return this.eventHooks.sendBackward.emit(l),!0}}(Jy,Qy,Ky);class bm extends Jo{static create(t){return new bm(t)}constructor(t){super("commentUpdatedDomainEvent"),i(this,"comment",void 0),this.comment=t;}}const Cm=new class{constructor(t,e){i(this,"annotationRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.eventHooks=e;}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return !1;e.updateComment(t);const i=bm.create(e.comment);return this.eventHooks.commentUpdated.emit(i),!0}}(Jy,Ky);class Sm extends Jo{static create(t){return new Sm(t)}constructor(t){super("deleteReplyReviewStateDomainEvent"),i(this,"replyUid",void 0),this.replyUid=t;}}const Pm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=n;}execute(t){const e=this.replyRepo.findCommentByUid(t);if(!e)return !1;const i=this.annotationRepo.findAnnotationByUid(e.annotationUid);if(!i)return !1;i.deleteReplyReviewSate(e),this.annotationRepo.save(i);const n=Sm.create(t);return this.eventHooks.deleteReplyReviewState.emit(n),!0}}(Jy,Zy,Ky);class Am extends Jo{static create(t){return new Am(t)}constructor(t){super("setReplyReviewStateDomainEvent"),i(this,"author",void 0),i(this,"creationDate",void 0),i(this,"contents",void 0),i(this,"state",void 0),i(this,"replyUid",void 0),this.author=t.author,this.creationDate=t.creationDate,this.contents=t.contents,this.state=t.state,this.replyUid=t.replyUid;}}const Tm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=n;}execute(t){const e=this.replyRepo.findCommentByUid(t.replyUid);if(!e)return !1;const i=this.annotationRepo.findAnnotationByUid(e.annotationUid);if(!i)return !1;i.setReplyReviewState(e,t),this.annotationRepo.save(i);const n=Am.create(t);return this.eventHooks.setReplyReviewState.emit(n),!0}}(Jy,Zy,Ky);const km=new class{constructor(t){i(this,"annotationPageRepo",void 0),this.annotationPageRepo=t;}execute(t){let e=this.annotationPageRepo.findPageByUid(t);return e||(e=qy.create(t),this.annotationPageRepo.save(e)),e}}(Qy);const Dm=new class{constructor(t,e,n){i(this,"annotationPageRepo",void 0),i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e,this.replyRepo=n;}execute(t){const e=this.annotationPageRepo.findPageByUid(t.pageUid);if(!e)return null;const i=e.clone(t.newPageUid),n=new Map;return e.annotations.forEach(((e,s)=>{const o=this.annotationRepo.findAnnotationByUid(e).clone(t.newPageUid,"");o.comment.replies.forEach((t=>{this.replyRepo.save(t);})),this.annotationRepo.save(o),i.annotations[s]=o.uid,n.set(e,o.uid);})),i.layers.forEach((t=>{t.annotationUid=n.get(t.annotationUid);})),this.annotationPageRepo.save(i),i}}(Qy,Jy,Zy);const Em=new class{constructor(t){i(this,"annotationPageRepo",void 0),this.annotationPageRepo=t;}execute(t){this.annotationPageRepo.deletePagesByUids(t);}}(Qy);const Im=new class{constructor(t,e,n){i(this,"annotationPageRepo",void 0),i(this,"annotationRepo",void 0),i(this,"replyRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e,this.replyRepo=n;}execute(t){const e=this.annotationPageRepo.findPageByUid(t.pageUid);if(!e)return null;const i=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!i)return null;const n=i.clone(t.pageUid," ");return n.comment.replies.forEach((t=>{this.replyRepo.save(t);})),e.addAnnotation(n.uid),this.annotationRepo.save(n),n}}(Qy,Jy,Zy);class Rm extends Jo{static create(t,e,i){return new Rm(t,Vn(e),Vn(i))}constructor(t,e,n){super("annotationPageSwitchedDomainEvent"),i(this,"annotationUid",void 0),i(this,"from",void 0),i(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=n;}}const Mm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"annotationPageRepo",void 0),i(this,"eventHook",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHook=n;}execute(t){const{annotationUid:e,pageUid:i,x:n,y:s,layer:o}=t,r=this.annotationRepo.findAnnotationByUid(e);if(!r)return !1;const a=this.annotationPageRepo.findPageByUid(r.pageUid);if(!a)return !1;const l=this.annotationPageRepo.findPageByUid(i);if(!l)return !1;const h={pageUid:r.pageUid,x:r.style.x,y:r.style.y,layer:r.layer};a.deleteAnnotations([e]),l.addAnnotation(e,o),r.updateStyle({x:n,y:s}),r.layer=o,r.pageUid=i;const d=Rm.create(r.uid,h,{pageUid:i,x:n,y:s,layer:o});return this.eventHook.annotationPageSwitched.emit(d),!0}}(Jy,Qy,Ky);class Bm extends Jo{static create(t,e){return new Bm(t,e)}constructor(t,e){super("restoreLayerDomainEvent"),i(this,"annotationUid",void 0),i(this,"layer",void 0),this.annotationUid=t,this.layer=e;}}const Lm=new class{constructor(t,e,n){i(this,"annotationRepo",void 0),i(this,"annotationPageRepo",void 0),i(this,"eventHooks",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHooks=n;}execute(t){let{annotationUid:e,layer:i}=t;const n=this.annotationRepo.findAnnotationByUid(e);if(!n)return !1;this.annotationPageRepo.findPageByUid(n.pageUid).restoreLayer(e,i),n.layer=i;const s=Bm.create(e,i);return this.eventHooks.restoreLayer.emit(s),!0}}(Jy,Qy,Ky);const Um=new class{constructor(t,e){i(this,"annotationPageRepo",void 0),i(this,"annotationRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e;}execute(t){let e={back:!1,front:!1,forward:!1,backward:!1};const i=this.annotationRepo.findAnnotationByUid(t);if(!i)return e;const n=this.annotationPageRepo.findPageByUid(i.pageUid);return n?(e=n.getLayerState(t),e):e}}(Qy,Jy);class Om extends Qs{constructor(){super(),i(this,"annotationRepo",Jy),i(this,"annotationReplyRepo",Zy),i(this,"annotationPageRepo",Qy),i(this,"hooks",Ky),this.register(Ky);}dispose(){this.reset(),this.hooks.dispose(),super.dispose();}reset(){this.annotationPageRepo.clear(),this.annotationReplyRepo.clear(),this.annotationRepo.clear();}createAnnotationPage(t){return km.execute(t)}copyAnnotationPage(t,e){return Dm.execute({pageUid:t,newPageUid:e})}deleteAnnotationPage(t){return Em.execute(t)}createAnnotations(t){return em.execute(t)}copyAnnotation(t,e){return Im.execute({annotationUid:t,pageUid:e})}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t.map((t=>(Zn(t)&&(t=Jy.findAnnotationByUid(t)),t)));return nm.execute(i,e)}updateAnnotation(t){return lm.execute(t)}switchAnnotationPage(t,e){return Mm.execute({annotationUid:Hn(t)?t.uid:t,...e})}getAnnotationByUid(t){return sm.execute(t)}getAnnotationLayerState(t){return Um.execute(t)}replyToAnnotation(t){return rm.execute(t)}deleteReply(t){return Zn(t)&&(t=Zy.findCommentByUid(t)),um.execute(t)}updateReply(t){return dm.execute(t)}updateComment(t){return Cm.execute(t)}deleteReplyReviewState(t){return Pm.execute(t)}setReplyReviewState(t){return Tm.execute(t)}bringToFront(t){return gm.execute(t)}sendToBack(t){return ym.execute(t)}bringForward(t){return vm.execute(t)}sendBackward(t){return wm.execute(t)}restoreLayer(t,e){return Lm.execute({annotationUid:t,layer:e})}}const Nm=["enableContinuousDrawing","controlsStyle","inkCreateDelay","showOnTopWhenSelected","defaultStyleConfig","eraserStyle","selectionStyle","enableMoveWithKeyboard","enableDeleteWithKeyboard","enableMultipleSelectWidthCtrl"];class _m extends Qs{constructor(t){super(),i(this,"context",void 0),this.context=t;}updateConfig(t){for(const[e,i]of Object.entries(t))Nm.includes(e)&&this[e](i);}defaultStyleConfig(t){if(!Hn(t))return;const{annotationController:e}=this.context,{viewer:i}=this.context;e.setAnnotationInteractiveConfig({defaultStyleConfig:t}),e.updateFreeTextDefaultConfig(),i.hooks.annotationDefaultStyleChanged.emit(i.getAnnotationConfig().defaultStyleConfig),i.emit("annotationDefaultStyleChanged",i.getAnnotationConfig().defaultStyleConfig);}enableContinuousDrawing(t){const{annotationController:e}=this.context;e.interactiveConfig.enableContinuousDrawing=t;}enableMoveWithKeyboard(t){const{annotationController:e}=this.context;e.interactiveConfig.enableMoveWithKeyboard=t;}enableDeleteWithKeyboard(t){const{annotationController:e}=this.context;e.interactiveConfig.enableDeleteWithKeyboard=t;}enableMultipleSelectWidthCtrl(t){const{annotationController:e}=this.context;e.interactiveConfig.enableMultipleSelectWidthCtrl=t;}controlsStyle(t){if(!Hn(t))return;const{annotationController:e}=this.context;e.setAnnotationInteractiveConfig({controlsStyle:t});}inkCreateDelay(t){const{annotationController:e}=this.context;e.interactiveConfig.inkCreateDelay=t;}showOnTopWhenSelected(t){const{annotationController:e}=this.context;e.interactiveConfig.showOnTopWhenSelected=t;}}const Wm={arc:"annotationArc",circle:"annotationCircle",ellipse:"annotationEllipse",image:"annotationImage",ink:"annotationInk",rectangle:"annotationRect",line:"annotationLine",polyline:"annotationPolyline",polygon:"annotationPolygon",textTypewriter:"annotationFreeText",textBox:"annotationTextBox",stamp:"annotationStamp",textAssist:"annotationTextAssist",highlight:"annotationHighlight",underline:"annotationUnderline",strikeout:"annotationStrikeout",incomplete:"annotationIncomplete"},Fm={annotationArc:"arc",annotationCircle:"circle",annotationEllipse:"ellipse",annotationImage:"image",annotationInk:"ink",annotationRect:"rectangle",annotationLine:"line",annotationPolyline:"polyline",annotationPolygon:"polygon",annotationFreeText:"textTypewriter",annotationTextBox:"textBox",annotationStamp:"stamp",annotationTextAssist:"textAssist",annotationHighlight:"highlight",annotationUnderline:"underline",annotationStrikeout:"strikeout"};class Hm extends Qs{constructor(t){super(),i(this,"viewer",void 0),i(this,"annotationConfigService",void 0),i(this,"annotationController",void 0),i(this,"context",void 0),this.viewer=t,this.context=t.context,this.annotationConfigService=new _m(this),this.initAnnotationController(),this.listenViewerEventsForAnnotation();}initAnnotationController(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&((new xd).init(this.context.rendererService.docRenderer.canvas),this.annotationController=new id(this.context.rendererService.getCanvasDom()),this.listenViewerNativeEventsForAnnotation(),this.annotationController.hooks.deleteAnnotation.on((t=>{const e=new Set(t.shapes.map((t=>t.uid)));this.context.core.annotationService.deleteAnnotations([...e]);}),this),this.annotationController.hooks.selectAnnotation.on((t=>{const e=lf.create(t.oldAnnotationsUids,t.newAnnotationUids);this.syncAnnotationLayerState(),this.viewer.hooks.selectedAnnotationsChanged.emit(e),t.emitSelected&&this.viewer.emit("selectedAnnotationsChanged",{newAnnotationUids:[...t.newAnnotationUids],oldAnnotationUids:[...t.oldAnnotationsUids]});}),this),this.annotationController.hooks.modifyAnnotation.on((t=>{const e=t.shapes.map((t=>{const e=t.shape.getAnnotationConfig();return {annotationUid:t.uid,options:{transform:Vn(e.transform),style:e.style}}}));this.context.core.annotationService.updateAnnotations(e,this.context.uid,t.actions);}),this),this.annotationController.hooks.addAnnotation.on((t=>{const e=this.context.getActiveTab();if(!e)return;const{annotationService:i}=this.context.core;t.shapes.forEach((t=>{const n=t.shape.getAnnotationConfig(),s=$f(),o=i.createAnnotation(e.uid,{uid:t.uid,docUid:e.uid,pageUid:t.shape.pageUid,type:Fm[n.type],transform:Vn(n.transform),style:Vn(n.style),flags:["print"],comment:{annotationUid:t.uid,author:"",subject:"",contents:"",creationDate:s,modificationDate:s,markedStates:[],reviewStates:[],replies:[]}});this.annotationController.updateLayer(t.uid,o.layer);}));}),this),this.annotationController.hooks.annotationModeChanged.on((t=>{if("none"===t){"annotation"===this.viewer.getViewerConfig().toolMode&&this.viewer.updateViewerConfig({toolMode:"pan"});}})),this.annotationController.hooks.beforeAnnotationEdit.on((t=>{this.viewer.hooks.beforeAnnotationEdit.emit(t);})),this.annotationController.hooks.afterAnnotationEdit.on((t=>{this.viewer.hooks.afterAnnotationEdit.emit(t);})),this.annotationController.hooks.beforeAnnotationDraw.on((t=>{this.viewer.hooks.beforeAnnotationDraw.emit(t);})),this.annotationController.hooks.afterAnnotationDraw.on((t=>{this.viewer.hooks.afterAnnotationDraw.emit(t);})),this.annotationController.hooks.renderAnnotation.on((()=>{this.context.render();})),this.annotationController.hooks.selectAnnotationTextChars.on((t=>{this.viewer.hooks.annotationTextCharsSelected.emit(t);})),this.annotationController.hooks.annotationTextContentUpdated.on((t=>{this.viewer.hooks.annotationTextContentUpdated.emit(t);})));}listenViewerNativeEventsForAnnotation(){const t=this.context.rendererService.getCanvasDom();to(t,qn()?"click":"pointerup",this).on((t=>{t.preventDefault(),this.annotationController.clickHandler(t);})),to(t,"dblclick",this).on((t=>{this.annotationController.dblClickHandler(t);}));}listenViewerEventsForAnnotation(){const{context:t,context:{hooks:e,tabService:i}}=this;(t.isDefaultViewer||t.isThumbnailViewer)&&(e.pageExistenceChanged.on((t=>{0===t.pageCount&&(this.annotationController.container=null,this.annotationController.containerId=null,this.context.annotationEditService.containerPage=null);})),e.toolModeChanged.on((e=>{const{annotationMode:i}=t.viewerConfig;if("annotation"!==e.newToolMode)this.annotationController.setAnnotationMode("none"),"crop"===e.newToolMode&&this.selectAnnotations([]);else {let t="draw";"select"===i?t="select":"erase"===i&&(t="erase"),this.annotationController.setAnnotationMode(t);}}),this),e.annotationModeChanged.on((e=>{const{toolMode:i}=t.viewerConfig;if("select"===e.newAnnotationMode||"erase"===e.newAnnotationMode){const t=e.newAnnotationMode;"annotation"===i&&this.annotationController.setAnnotationMode(t);}else {const t=Wm[e.newAnnotationMode];this.annotationController.drawType=t,"annotation"===i&&this.annotationController.setAnnotationMode("draw");}}),this),e.addPagesToDoc.on((t=>{i.getTab(t.docUid)&&this.addAnnotationByPageUids(t.pageUids);}),this),e.openDocument.on((t=>{i.getTab(t.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(t.pages));}),this),e.closeDocument.on((t=>{t.pages.forEach((t=>{const e=this.context.core.pageService.getPage(t);this.annotationController.deleteShape(e.annotations,!1,!1);}));}),this),e.deletePages.on((t=>{t.pageUids.forEach((t=>{const e=this.context.core.pageService.getPage(t);this.annotationController.deleteShape(e.annotations,!1,!1);}));}),this),e.syncDocument.on((t=>{i.getTab(t.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(t.pages));}),this),e.afterRender.on((e=>{if(null==e||!e.total)return;const i=t.annotationEditService.containerPage;if(!i)return;if(!e.getPageByUid(i.uid))return;let{x:n,y:s}=i.cropBox.getPosition(),{width:o,height:r}=i.cropBox;const a=(i.rotation%360+360)%360/90;if(1===a?n-=r:2===a?(n-=o,s-=r):3===a&&(s-=o),1===a||3===a){const t=o;o=r,r=t;}this.annotationController.eventService.setEventArea({x:n,y:s,width:o,height:r});}),this));}disableTextEditMode(){const{eventService:t}=this.annotationController;null!=t&&t.activatedShape&&(null==t?void 0:t.activatedShape)instanceof mh&&null!=t&&t.activatedShape.isEditMode&&(null==t||t.activatedShape.textEditEventHandler.disableEditMode(),this.context.render());}addAnnotationByPageUids(t){t.forEach((t=>{const e=this.context.core.pageService.getPage(t);if(e.annotations.forEach((t=>{const e=this.context.core.annotationService.annotationApp.getAnnotationByUid(t);this.addAnnotationByAnnotationData(e);})),0===e.annotations.length){const t=this.context.tabService.getTab(e.doc.uid);if(!t)return;const i=t.getPageByUid(e.uid);if(!i)return;this.annotationController.setAnnotationContainer(e.uid,i.mediaBox);}}));}addAnnotationByAnnotationData(t){if("unknown"===t.type)return !0;const e=this.context.core.pageService.getPage(t.pageUid);if(!e)return !1;const i=this.context.tabService.getTab(e.doc.uid);if(!i)return !1;const n=i.getPageByUid(t.pageUid);if(!n)return !1;let s=t.getConfig();this.annotationController.setAnnotationContainer(t.pageUid,n.mediaBox);const o=this.annotationController.addShape(Wm[t.type],{id:t.uid,style:{...s.style,zIndex:t.layer},transform:s.transform},!1);s=t.getConfig();const r={enableControl:!s.flags.includes("readOnly")&&!s.flags.includes("flattened"),isVisible:!s.flags.includes("noView"),enableEdit:!s.flags.includes("noResize"),enableRotate:!s.flags.includes("noRotate"),enableMove:!s.flags.includes("noMove")};if(o instanceof mh&&"freeTextWriter"===o.textType){r.enableEdit=!1,r.enableRotate=!1;const e=o.getAnnotationConfig();t.style.width=e.style.width;}if(o.context.isInGroup&&(r.enableRotate=!1),this.annotationController.setAnnotationFlags(t.uid,r,!1),o instanceof Oh&&"base"===o.stampType||o instanceof ph){const e=o.getAnnotationConfig();t.transform.position=e.transform.position,t.transform.scale=e.transform.scale,t.style=e.style;}return this.syncAnnotationLayerState(),!0}updateAnnotations(t,e){if(e===this.context.uid)return !0;const i=t.reduce(((t,e)=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(e);if(i){const n=this.context.core.pageService.getPage(i.pageUid);if(n){if(this.context.tabService.getTab(n.doc.uid)){const n=i.getConfig();t.push({annotationUid:e,config:n}),this.viewer.context.core.annotationService.annotationApp.restoreLayer(e,i.layer);}}}return t}),[]);return i.length===t.length&&(i.forEach((t=>{var e,i;let{annotationUid:n,config:s}=t;const o=this.annotationController.getShape(n),r={enableControl:!s.flags.includes("readOnly")&&!s.flags.includes("flattened"),isVisible:!s.flags.includes("noView"),enableEdit:!s.flags.includes("noResize"),enableRotate:!s.flags.includes("noRotate"),enableMove:!s.flags.includes("noMove")};if(o&&(o instanceof mh&&"freeTextWriter"===o.textType&&(r.enableEdit=!1,r.enableRotate=!1),o.context.isInGroup&&(o.context.tempData.enableRotate=r.enableRotate,r.enableRotate=!1)),this.annotationController.setAnnotationFlags(n,r),this.annotationController.updateShape(n,{id:n,style:s.style,transform:s.transform},!1),!o)return;const a=this.context.core.annotationService.annotationApp.getAnnotationByUid(n),l=o.getAnnotationConfig();null!=l&&null!==(e=l.transform)&&void 0!==e&&e.position&&(a.transform.position=l.transform.position),null!=l&&null!==(i=l.transform)&&void 0!==i&&i.scale&&(a.transform.scale=l.transform.scale),o instanceof Oh&&"stamp"===o.renderType&&(a.style.stampConfig=l.style.stampConfig);})),!0)}updateAnnotationPage(t,e){const i=this.context.core.annotationService.getAnnotationByUid(t);if(!i)return;const n=this.context.core.pageService.getPage(i.pageUid);if(!n)return;const s=this.context.tabService.getTab(n.doc.uid);if(!s)return;const o=s.getPageByUid(e);o&&(this.annotationController.moveShape([t],e,o.mediaBox),this.syncAnnotationLayerState());}updateLayer(t){const e=t.reduce(((t,e)=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(e);if(i){const e=this.context.core.pageService.getPage(i.pageUid);if(e){this.context.tabService.getTab(e.doc.uid)&&t.push(i);}}return t}),[]);return e.length===t.length&&(e.forEach((t=>{this.annotationController.updateLayer(t.uid,t.layer);})),this.syncAnnotationLayerState(),!0)}syncAnnotationLayerState(){let t={back:!1,front:!1,forward:!1,backward:!1};const e=this.annotationController.getSelectedShapeUids();return 1===e.length&&(t=this.context.core.annotationService.getAnnotationLayerState(e[0])),this.viewer.hooks.annotationLayerStateChanged.emit(df.create(t)),t}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.annotationController.deleteShape(t,!1,e),this.syncAnnotationLayerState();}selectAnnotations(t){return this.annotationController.selectShape(t)}getSelectedAnnotations(){const t=this.annotationController.getSelectedShapeUids();if(!t.length)return [];const e=[];return t.forEach((t=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(t);i&&e.push(i);})),e}duplicateAnnotation(t,e){throw new Error("Method not implemented.")}}class Vm extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"containerPage",void 0),this.context=t;}isHitAnnotation(t){return this.context.annotationController.isHitShape(t)}startHandler(t,e){this.context.annotationController.startHandler(t,e);}cursorHandler(t,e,i){this.context.annotationController.cursorHandler(t,e,i);}moveHandler(t,e){this.context.annotationController.moveHandler(t,e);}endHandler(t){this.context.annotationController.endHandler(t);}activateAnnotation(t,e){this.context.annotationController.eventService.activateShape(t,e);}deactivateAnnotation(){this.context.annotationController.eventService.inactivateShape(!0),this.context.annotationController.eventService.defaultGroup.clear();}hasActiveAnnotation(){return this.context.annotationController.getSelectedShapeUids().length>0}keydownHandler(t){const e=this.context.context.getActiveTab();this.context.annotationController.keyDownHandler(t,e.context.zoom);}keyupHandler(t){this.context.annotationController.keyUpHandler(t);}setAnnotationContainer(t){this.containerPage=t,this.context.annotationController.setAnnotationContainer(t.uid,t.mediaBox);}setAnnotationInteractionArea(t){this.context.annotationController.eventService.setEventArea(t);}copyAnnotations(){const t=this.context.annotationController.getSelectedShapeUids();0===t.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.copyAnnotations(t);}cutAnnotations(){const t=this.context.annotationController.getSelectedShapeUids();0===t.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.cutAnnotations(t);}pasteAnnotations(){this.context.annotationController.isInTextEditMode()||this.context.viewer.pasteAnnotations();}dispose(){super.dispose(),this.containerPage=null;}}class zm extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),this.action=t,this.core=e,this.type="createAnnotation",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{action:t}=this,{annotationApp:e}=this.core.annotationService,{annotationConfig:i}=this.action;return !!e.createAnnotations([{docUid:t.docUid,uid:i.uid,pageUid:t.pageUid,type:i.type,style:i.style,transform:i.transform,flags:i.flags,comment:i.comment,layer:i.layer,flattened:i.flattened}])}undo(){this.core.annotationService.annotationApp.deleteAnnotations([this.action.annotationConfig.uid]);}}class jm extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),this.action=t,this.core=e,this.type="deleteAnnotation",e.commandService.onBeforeRefreshCommands.on((e=>{t.docUid===e.docUid&&(t.deleteConfigs.slice().forEach((i=>{if(e.pageUids.includes(i.pageUid)){const e=t.deleteConfigs.findIndex((t=>t.pageUid===i.pageUid));t.deleteConfigs.splice(e,1);}})),this.isValid=t.deleteConfigs.length>0);}),this);}execute(){const{action:t}=this,e=t.deleteConfigs.map((t=>t.uid));return this.core.annotationService.annotationApp.deleteAnnotations(e),!0}undo(){const{annotationApp:t}=this.core.annotationService,e=this.action.deleteConfigs.map((t=>({docUid:this.action.docUid,uid:t.uid,type:t.type,pageUid:t.pageUid,style:t.style,transform:t.transform,flags:t.flags,comment:t.comment,layer:t.layer,oriIndex:t.oriIndex,modified:t.modified,flattened:t.flattened})));t.createAnnotations(e);}}class $m extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),i(this,"oldLayer",void 0),i(this,"newLayer",void 0),this.action=t,this.core=e,this.type="bringAnnotationToFront",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.bringToFront(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer);}}class Gm extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),i(this,"oldLayer",void 0),i(this,"newLayer",void 0),this.action=t,this.core=e,this.type="bringAnnotationForward",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.bringForward(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer);}}class Xm extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),this.action=t,this.core=e,this.type="sendAnnotationBackward",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){return this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.bringForward(this.action.annotationUid);}}class Ym extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),i(this,"oldLayer",void 0),i(this,"newLayer",void 0),this.action=t,this.core=e,this.type="sendAnnotationToBack",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.sendToBack(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer);}}class qm extends zy{constructor(t,e,n){super(),i(this,"action",void 0),i(this,"core",void 0),i(this,"updatedBy",void 0),this.action=t,this.core=e,this.updatedBy=n,this.type="updateAnnotation",e.commandService.onBeforeRefreshCommands.on((e=>{if(t.docUid!==e.docUid)return;const{pageUid:i}=t;e.pageUids.includes(i)&&(this.isValid=!1);}),this);}execute(){return this.update(!0),this.updatedBy=null,!0}undo(){this.update(!1);}update(t){const{annotationApp:e}=this.core.annotationService,i=this.action.updateDetails.map((e=>{const i=Vn(t?e.to:e.from);return {uid:e.annotationUid,...i}}));e.updateAnnotation({updateDetails:i,updatedBy:this.updatedBy,updateActions:[...this.action.updateActions]});}}class Jm extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),this.action=t,this.core=e,this.type="switchAnnotationPage",e.commandService.onBeforeRefreshCommands.on((e=>{t.docUid===e.docUid&&t.moveConfigs.slice().every((t=>((e.pageUids.includes(t.from.pageUid)||e.pageUids.includes(t.to.pageUid))&&(this.isValid=!1),this.isValid)));}),this);}execute(){const{annotationApp:t}=this.core.annotationService;return this.action.moveConfigs.forEach((e=>{if(zn(e.to.layer)){const i=t.annotationPageRepo.findPageByUid(e.to.pageUid).createTop();e.to.layer=i;}t.switchAnnotationPage(e.annotationUid,{...e.to});})),!0}undo(){const{annotationApp:t}=this.core.annotationService;this.action.moveConfigs.forEach((e=>{t.switchAnnotationPage(e.annotationUid,{...e.from});}));}}class Zm extends Qs{constructor(t){super(),i(this,"core",void 0),i(this,"annotationApp",void 0),i(this,"hooks",void 0),i(this,"enableEmitLayerChanged",!0),i(this,"pasteConfig",{pasteComment:!1,pasteReply:!0,updateDate:!0}),i(this,"clipboard",[]),i(this,"currentClipboard",[]),i(this,"currentPastePageUid",null),i(this,"flattenedAnnotData",{}),this.core=t,this.annotationApp=new Om,this.hooks=this.annotationApp.hooks,this.hooks.annotationCreated.on((t=>{t.annotations.forEach((t=>{t.flattened&&(this.flattenedAnnotData[t.pageUid]?this.flattenedAnnotData[t.pageUid].push(t.uid):this.flattenedAnnotData[t.pageUid]=[t.uid]);}));})),this.hooks.annotationDeleted.on((t=>{t.annotations.forEach((t=>{if(t.flattened){const e=this.flattenedAnnotData[t.pageUid],i=e.indexOf(t.uid);-1!==i&&e.splice(i,1);}}));})),this.hooks.annotationUpdated.on((t=>{t.updateActions.includes("flattenedChanged")&&t.updateDetails.forEach((t=>{const e=this.getAnnotationByUid(t.annotationUid);if(this.flattenedAnnotData[e.pageUid]&&this.flattenedAnnotData[e.pageUid].includes(e.uid)&&!e.flattened){const t=this.flattenedAnnotData[e.pageUid].indexOf(e.uid);-1!==t&&this.flattenedAnnotData[e.pageUid].splice(t,1);}e.flattened&&(this.flattenedAnnotData[e.pageUid]&&!this.flattenedAnnotData[e.pageUid].includes(e.uid)&&this.flattenedAnnotData[e.pageUid].push(e.uid),this.flattenedAnnotData[e.pageUid]||(this.flattenedAnnotData[e.pageUid]=[e.uid]));}));}));}reset(){this.annotationApp.reset();}getAnnotationByUid(t){return this.annotationApp.getAnnotationByUid(t)}deleteAnnotationPages(t){const e=t.reduce(((t,e)=>{const i=this.core.pageService.getPage(e);return i&&t.push(...i.annotations),t}),[]);this.deleteAnnotations(e,!1),this.annotationApp.annotationPageRepo.deletePagesByUids(t);}createAnnotationsByParsedPages(t,e){const i=$f();return e.reduce(((e,n)=>{var s;this.annotationApp.createAnnotationPage(n.pageUid);const o=null===(s=n.annotations)||void 0===s?void 0:s.reduce(((e,s)=>{var o,r,a,l,h;tv(s);const d={uid:s.uid,docUid:t,pageUid:n.pageUid,type:s.type,style:s.style,transform:s.transform,flags:s.flags,comment:Qm(s.comment),creationDate:null!==(o=null===(r=s.comment)||void 0===r?void 0:r.creationDate)&&void 0!==o?o:i,modificationDate:null!==(a=null===(l=s.comment)||void 0===l?void 0:l.modifiedDate)&&void 0!==a?a:i,oriIndex:null===(h=s.raw)||void 0===h?void 0:h.oriIndex};return e.push(d),e}),[]);return null!=o&&o.length?(this.annotationApp.createAnnotations(o),e.push(o.map((t=>t.uid)))):e.push([]),e}),[])}createAnnotation(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(tv(e),i){const i=new zm({actionUid:ts(),type:"createAnnotation",docUid:t,pageUid:e.pageUid,annotationConfig:{uid:e.uid,type:e.type,style:e.style,transform:e.transform,flags:e.flags,comment:e.comment,layer:e.layer,modified:e.modified,oriIndex:e.oriIndex,flattened:e.flattened}},this.core);this.core.commandService.execute(i,t);}else this.annotationApp.createAnnotations([e]);return this.annotationApp.getAnnotationByUid(e.uid)}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{pageService:i,commandService:n}=this.core,s=t.reduce(((t,e)=>{const n=this.annotationApp.getAnnotationByUid(e);if(n){const e=i.getPage(n.pageUid),s=t.get(e.doc.uid)||{uid:e.doc.uid,annotationConfigs:[]};t.set(s.uid,s);const o=n.getConfig();o.layer=n.layer,o.flattened=n.flattened,null!=o&&o.flattened&&!o.flags.includes("flattened")&&o.flags.push("flattened"),s.annotationConfigs.push(o);}return t}),new Map);if(e)for(const[t,e]of s){const i=e.annotationConfigs.map((t=>({uid:t.uid,type:t.type,pageUid:t.pageUid,style:t.style,transform:t.transform,flags:t.flags,comment:t.comment,layer:t.layer,oriIndex:t.oriIndex,modified:t.modified,flattened:t.flattened}))),s=new jm({actionUid:ts(),type:"createAnnotation",docUid:t,deleteConfigs:i},this.core);n.execute(s,e.uid);}else this.annotationApp.deleteAnnotations(t,!1);}updateAnnotations(t,e,i,n){let s,o;const r=t.reduce(((t,e)=>{const{annotationUid:i}=e,n=this.annotationApp.getAnnotationByUid(i);var r;n&&(s=n.pageUid,o=n.docUid,null!=n&&n.flattened&&!e.options.flags.includes("flattened")&&!1!==(null==e||null===(r=e.options)||void 0===r?void 0:r.flattened)&&e.options.flags.push("flattened"),t.push({annotation:n,options:e.options}));return t}),[]);if(null==r||!r.length||r.length!==t.length)return;const a=$f(),l=r.map((t=>{let{annotation:e,options:i}=t;return i.comment||(i.comment={}),i.comment.modificationDate=a,{annotationUid:e.uid,from:{...e.getConfig(),modified:e.modified,flattened:e.flattened,layer:e.layer},to:{...i,modified:!n||e.modified,flattened:Xn(null==i?void 0:i.flattened)?null==i?void 0:i.flattened:e.flattened,layer:(null==i?void 0:i.layer)||e.layer}}})),h=new qm({actionUid:ts(),type:"updateAnnotation",docUid:o,pageUid:s,updateDetails:l,updateActions:i||[]},this.core,e);this.core.commandService.execute(h,o);}switchAnnotationPage(t){const e=t.map((t=>({annotation:this.annotationApp.getAnnotationByUid(t.annotationUid),...t}))),i=this.core.pageService.getPage(e[0].annotation.pageUid);if(!i)return;const n=e.map((t=>{let{annotationUid:e,annotation:i,pageUid:n,x:s,y:o}=t;return {annotationUid:e,from:{pageUid:i.pageUid,x:i.style.x,y:i.style.y,layer:i.layer},to:{pageUid:n,x:zn(s)?i.style.x:s,y:zn(o)?i.style.y:o,layer:void 0}}})),s=new Jm({actionUid:ts(),type:"switchAnnotationPage",docUid:i.doc.uid,moveConfigs:n},this.core);this.core.commandService.execute(s,i.doc.uid);}duplicateAnnotation(t,e){const i=this.annotationApp.getAnnotationByUid(t);if(!i)return null;const n=i.getConfig();n.uid=ts(),e&&(n.pageUid=e),n.comment.creationDate=$f(),n.comment.modificationDate=n.comment.creationDate;return this.createAnnotation(n.docUid,n)}copyAnnotations(t){t.length&&(this.clipboard=[],this.currentClipboard=[],this.currentPastePageUid=null),t.forEach((t=>{const e=this.annotationApp.getAnnotationByUid(t);if(e){const t=e.getConfig();this.clipboard.push(t),this.currentClipboard.push(Vn(t));}}));}cutAnnotations(t){this.copyAnnotations(t),this.deleteAnnotations(t);}pasteAnnotations(t,e){if(!this.clipboard.length)return;const i=this.core.pageService.getPage(e);this.currentPastePageUid&&this.currentPastePageUid!==e&&(this.currentClipboard=Vn(this.clipboard)),this.currentPastePageUid=e,this.currentClipboard.forEach((n=>{var s,o,r,a;const l=$f();let{x:h,y:d}=n.style;const c=!zn(null==n||null===(s=n.style)||void 0===s?void 0:s.x)&&!zn(null==n||null===(o=n.style)||void 0===o?void 0:o.y);!c&&null!=n&&null!==(r=n.transform)&&void 0!==r&&r.position&&(h=n.transform.position.x,d=n.transform.position.y),h+=10,d+=10,(h>i.cropBox.left+i.cropBox.width-10||d>i.cropBox.top+i.cropBox.height-10||h<i.cropBox.left||d<i.cropBox.top)&&(h=i.cropBox.left,d=i.cropBox.top),c?(n.style.x=h,n.style.y=d,delete n.transform.position):!c&&null!=n&&null!==(a=n.transform)&&void 0!==a&&a.position&&(n.transform.position={x:h,y:d});const u=Vn(n),p=ts();Object.assign(u,{uid:p,docUid:t,pageUid:e,creationDate:l,modificationDate:l});const g={annotationUid:p,creationDate:l,modificationDate:l,markedStates:[],reviewStates:[],replies:[]};this.pasteConfig.pasteComment?this.pasteConfig.pasteReply||Object.assign(u.comment,g):Object.assign(u.comment,g,{contents:""}),this.createAnnotation(n.docUid,u);}));}clearAnnotationClipboard(){this.clipboard=[],this.currentClipboard=[],this.currentPastePageUid=null;}bringToFront(t){return this.handleLayer(t,"f")}bringForward(t){return this.handleLayer(t,"fw")}sendToBack(t){const e=this.getAnnotationByUid(t),i=this.flattenedAnnotData[e.pageUid];if(!i||i&&0===i.length)return this.handleLayer(t,"b");if(!this.getAnnotationLayerState(t).back)return !0;this.enableEmitLayerChanged=!1;const n=i.length,s=e.layer;this.annotationApp.sendToBack(t);for(let i=0;i<n;i++)i===n-1?(e.layer=s,this.enableEmitLayerChanged=!0,this.bringForward(t)):this.annotationApp.bringForward(t);return !0}sendBackward(t){return this.handleLayer(t,"bw")}handleLayer(t,e){const i=this.annotationApp.getAnnotationByUid(t);if(!i)return !1;const n=this.core.pageService.getPage(i.pageUid);if(!n)return !1;const s={actionUid:ts(),type:e,annotationUid:t,docUid:n.doc.uid,pageUid:n.uid},o=this.annotationApp.getAnnotationLayerState(t);let r;return "f"===e&&o.front?r=new $m(s,this.core):"fw"===e&&o.forward?r=new Gm(s,this.core):"bw"===e&&o.backward?r=new Xm(s,this.core):"b"===e&&o.back&&(r=new Ym(s,this.core)),r&&this.core.commandService.execute(r,n.doc.uid),!0}getAnnotationLayerState(t){const e=this.annotationApp.getAnnotationLayerState(t),i=this.getAnnotationByUid(t);if(!i)return e;const n=this.flattenedAnnotData[i.pageUid];if(!n||n&&0===n.length)return e;const s=[...this.core.getAnnotationsByPageUid(i.pageUid)];s.sort(((t,e)=>t.layer-e.layer));return s.indexOf(i)===n.length&&(e.back=!1,e.backward=!1),e}updateComment(){}addReply(){}deleteReply(){}updateReply(){}addReviewState(){}deleteReviewState(){}addCheckMarkState(){}deleteCheckMarkState(){}createAnnotationShape(t,e){var i,n;const{type:s,transform:o,style:r}=t.getConfig();let a=r,l=o;if("textTypewriter"===s&&(null===(i=t.transform)||void 0===i||!i.position)){const t=new mh({style:r,transform:o},"freeTextWriter",{}).getAnnotationConfig();a=t.style,l=t.transform;}e&&!["highlight","underline","strikeout","incomplete"].includes(t.type)&&function(t,e){const i=["rx","x","width","borderWidth","fontSize"],n=["ry","y","height"],s=["startPoint","endPoint"];Object.keys(t).forEach((o=>{const r=t[o];if(i.includes(o)||n.includes(o)){const i=vr(r);t[o]=e.toPixelPPI(i.value,n.includes(o));}else s.includes(o)?t[o]={x:e.toPixelPPI(r.x,!1),y:e.toPixelPPI(r.y,!0)}:"lineDash"===o?t[o]=r.map((t=>e.toPixelPPI(t,!1))):"points"===o?t[o]=r.map((t=>({x:e.toPixelPPI(t.x,!1),y:e.toPixelPPI(t.y,!0)}))):"segments"===o?t[o]=r.map((t=>t.map((t=>({x:e.toPixelPPI(t.x,!1),y:e.toPixelPPI(t.y,!0)}))))):"textContents"===o&&(t[o]=r.map((t=>({...t,fontSize:e.toPixelPPI(vr(t.fontSize).value,!1)}))));}));}(a,e),"ellipse"===s&&(a.x+=a.width/2||0,a.y+=a.height/2||0,a.rx=a.width/2||a.rx,a.ry=a.height/2||a.ry),l&&null!==(n=l)&&void 0!==n&&n.position&&(l.position={x:e.toPixelPPI(l.position.x,!1),y:e.toPixelPPI(l.position.y,!0)});const h={id:t.uid,style:a,transform:l};let d;switch(s){case"rectangle":d=new gh(h);break;case"ellipse":d=new ch(h);break;case"line":d=new Sh(h);break;case"ink":d=new ph(h);break;case"polygon":d=new bh(h);break;case"polyline":d=new Ch(h);break;case"textTypewriter":d=new mh(h,"freeTextWriter",{},!1);break;case"textBox":d=new mh(h,"textBox");break;case"stamp":d=new Oh(h);break;case"highlight":d=new Wh(h,_h.HIGHLIGHT);break;case"underline":d=new Wh(h,_h.UNDERLINE);break;case"strikeout":d=new Wh(h,_h.STRIKEOUT);break;case"incomplete":d=new Fh(h);}if(d instanceof Oh&&!d.style.imageData&&d.updateStampStyle({x:a.x,y:a.y,width:a.width,height:a.height}),["highlight","underline","strikeout","incomplete"].includes(s)){const{resolutionX:t,resolutionY:i}=e,{displayResolution:n}=Do,s=t/n,o=i/n;d.setOrigin(0,0),d.scaleLocal(s,o);}return d}getAnnotationUidsByLayer(t){const e=this.annotationApp.annotationPageRepo.findPageByUid(t);return null==e?void 0:e.getAnnotationUidListByLayer()}flattenAnnotations(t){const e=t.map((t=>this.getAnnotationByUid(t))),i=[],n=[];this.enableEmitLayerChanged=!1,e.forEach((t=>{var e;const s=t.layer;if(this.core.annotationService.annotationApp.sendToBack(t.uid),null!==(e=this.flattenedAnnotData[t.pageUid])&&void 0!==e&&e.length){var o;const e=null===(o=this.flattenedAnnotData[t.pageUid])||void 0===o?void 0:o.length;for(let i=0;i<e;i++)this.core.annotationService.annotationApp.bringForward(t.uid);}n.push(s),i.push({annotationUid:t.uid,options:{flags:[...t.flags,"flattened"],flattened:!0}}),this.flattenedAnnotData[t.pageUid]?this.flattenedAnnotData[t.pageUid].push(t.uid):this.flattenedAnnotData[t.pageUid]=[t.uid];})),this.enableEmitLayerChanged=!0,e.forEach(((t,e)=>{i[e].options.layer=t.layer,t.layer=n[e];})),this.updateAnnotations(i,void 0,["flattenedChanged"],!0);}unFlattenAnnotation(t){const e=this.getAnnotationByUid(t),i=this.flattenedAnnotData[e.pageUid];if(!i||0===i.length)return !1;const n=i.indexOf(e.uid);if(-1===n)return !1;this.enableEmitLayerChanged=!1;const s=i.length-(n+1),o=e.layer;for(let t=0;t<s;t++)this.core.annotationService.annotationApp.bringForward(e.uid);const r=e.layer,a=e.flags.filter((t=>"flattened"!==t));return e.layer=o,this.updateAnnotations([{annotationUid:e.uid,options:{flags:a,flattened:!1,layer:r}}],void 0,["flattenedChanged"],!0),i.includes(e.uid)&&i.splice(n,1),this.enableEmitLayerChanged=!0,!0}}function Qm(t){return {annotationUid:t.uid,author:t.author,subject:t.subject,contents:t.contents,creationDate:t.creationDate,modificationDate:t.modifiedDate,markedStates:Km(t.markedStates||[]),reviewStates:Km(t.reviewStates||[])}}function Km(t){return t.map((t=>({uid:t.uid,author:t.author,contents:t.contents,creationDate:t.creationDate,state:t.state})))}function tv(t){if("stamp"===t.type){const e=new Oh({style:t.style,transform:t.transform}).getAnnotationConfig();t.style=e.style,t.transform={...t.transform,position:e.transform.position,scale:e.transform.scale};}}var ev=new WeakMap,iv=new WeakMap,nv=new WeakMap,sv=new WeakMap,ov=new WeakSet,rv=new WeakSet,av=new WeakSet;class lv{constructor(t,e){y(this,av),y(this,rv),y(this,ov),f(this,ev,{writable:!0,value:void 0}),f(this,iv,{writable:!0,value:void 0}),f(this,nv,{writable:!0,value:void 0}),f(this,sv,{writable:!0,value:void 0}),p(this,ov,hv).call(this,t,e);}getCanvas(){return n(this,ev).contextService.getDomElement()}getInkOptions(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!n(this,sv))return null;const{x:e,y:i}=n(this,sv).getLocalPosition();n(this,sv).setLocalPosition(0,0);const s=n(this,sv).getAnnotationConfig(),o={borderWidth:s.style.borderWidth,borderColor:s.style.borderColor,opacity:s.style.opacity};if(t){const{displayResolution:t,dataResolution:r}=Do,a=s.style.segments.map((e=>e.map((e=>({x:Ys(e.x,t,r),y:Ys(e.y,t,r)})))));return o.borderWidth=Ys(o.borderWidth,t,r),n(this,sv).setLocalPosition(e,i),n(this,sv).getAnnotationConfig(),{points:a,...o}}return {segments:s.style.segments,...o}}getSignatureImage(){if(!n(this,sv))return Promise.resolve(null);const t=n(this,sv).getBoundingRect(),e=document.createElement("canvas");e.width=t.width,e.height=t.height;return e.getContext("2d").drawImage(this.getCanvas(),t.x*devicePixelRatio,t.y*devicePixelRatio,t.width*devicePixelRatio,t.height*devicePixelRatio,0,0,t.width,t.height),new Promise((t=>{e.toBlob(t,"image/png");}))}updateSignatureStyle(t){s(this,nv,{...n(this,nv),...t}),n(this,sv)&&(n(this,sv).updateStyle({...t}),n(this,ev).render());}clearSignature(){n(this,iv).children.slice().forEach((t=>{n(this,iv).removeChild(t);})),s(this,sv,null),n(this,ev).render();}}function hv(t,e){const i=document.createElement("canvas");i.style.touchAction="none",s(this,ev,new xl({renderer:new _l,width:t,height:e,canvas:i,dpr:window.devicePixelRatio,willReadFrequently:!0})),i.style.width=`${t}px`,i.style.height=`${e}px`,s(this,iv,n(this,ev).document.documentElement),(new xd).init(n(this,ev)),p(this,rv,dv).call(this);}function dv(){let t=!1;const e=this.getCanvas();e.addEventListener("pointerdown",(e=>{const i={x:e.offsetX,y:e.offsetY};t=!0,n(this,sv)?(n(this,sv).addSegment(),n(this,sv).addPoint(i)):(s(this,sv,new ph({style:{segments:[[i]],...n(this,nv),lineCap:"round",lineJoin:"round"}})),n(this,iv).appendChild(n(this,sv))),n(this,ev).render();})),e.addEventListener("pointermove",(e=>{if(!t)return;const i={x:e.offsetX,y:e.offsetY};n(this,sv).addPoint(i),n(this,ev).render();})),document.addEventListener("pointerup",(()=>{t&&(t=!1,n(this,sv).pathDirty=!0,n(this,sv).boundsDirty=!0,n(this,ev).render());}));}const cv={stampText:"Draft",fontSize:32,fontFamily:"Arial",fontWeight:"bold",fontStyle:"normal",underline:!1,strikeout:!1,color:"#182564",borderColor:"#182564",background:"#c7d2e4",timeStampFontSize:16,userName:"Guest",hasUserName:!0,hasDate:!0,hasTime:!0};var uv=new WeakMap,pv=new WeakMap,gv=new WeakMap,fv=new WeakMap,yv=new WeakMap,mv=new WeakMap,vv=new WeakSet,xv=new WeakSet;class wv{constructor(t,e){y(this,xv),y(this,vv),f(this,uv,{writable:!0,value:void 0}),f(this,pv,{writable:!0,value:void 0}),f(this,gv,{writable:!0,value:void 0}),f(this,fv,{writable:!0,value:void 0}),f(this,yv,{writable:!0,value:void 0}),f(this,mv,{writable:!0,value:{...cv}}),s(this,gv,t),s(this,fv,e),p(this,vv,bv).call(this,t,e);}get signatureStyle(){return {...n(this,mv)}}getStampConfig(){const{background:t,borderColor:e,stampText:i}=n(this,mv),s=[],o=function(t,e){const i=t-1,n=e-1;return [{x:i,y:n-10.6,step:2},{x:i,y:n-4.8,step:1},{x:i-6,y:n,step:1},{x:i-13.4,y:n,step:1},{x:14.4,y:n,step:0},{x:7,y:n,step:1},{x:1,y:n-4.8,step:1},{x:1,y:n-10.6,step:1},{x:1,y:11.6,step:0},{x:1,y:5.8,step:1},{x:7,y:1,step:1},{x:14.4,y:1,step:1},{x:i-13.4,y:1,step:0},{x:i-6,y:1,step:1},{x:i,y:5.8,step:1},{x:i,y:11.6,step:1},{x:i,y:n-10.6,step:0}]}(n(this,gv),n(this,fv));s.push({type:"path",stampPoints:o,borderWidth:1.3333333333333333,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4,background:t,borderColor:e});const{color:r,fontFamily:a,fontSize:l,fontStyle:h,fontWeight:d}=n(this,mv),c=null!=a&&a.includes(" ")?`'${a}'`:a,u=document.createElement("canvas").getContext("2d"),{hasUserName:p,hasDate:g,hasTime:f,timeStampFontSize:y,userName:m}=n(this,mv),v=p||g||f;if(v){let t="";t+=p?`${m} `:"",t+=g?`${function(){const t=new Date,e=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0");return `${t.getDate().toString().padStart(2,"0")}/${i}/${e}`}()} `:"",t+=f?`${function(){const t=new Date;let e=t.getHours();const i=t.getMinutes().toString().padStart(2,"0"),n=e>=12?"PM":"AM";return e%=12,e=e||12,`${e}:${i} ${n}`}()}`:"";const e=`${h} ${d} ${y}px ${c}`;u.font=e;const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:l}=u.measureText(t.trim()),v=o+l;s.push({type:"text",text:t,x:(n(this,gv)-i)/2,y:n(this,fv)/2+n(this,fv)/4+v/2,color:r,fontFamily:a,fontSize:y,fontStyle:h,fontWeight:d});}if(i){const t=`${h} ${d} ${l}px ${c}`;u.font=t;const{underline:e,strikeout:o}=this.signatureStyle,{width:p,actualBoundingBoxAscent:g,actualBoundingBoxDescent:f}=u.measureText(i),y=g+f;if(s.push({type:"text",text:i,x:(n(this,gv)-p)/2,y:v?n(this,fv)/2:n(this,fv)/2+y/2,color:r,fontFamily:a,fontSize:l,fontStyle:h,fontWeight:d}),o){const t=v?n(this,fv)/2-y/3:n(this,fv)/2+y/2-y/3,e=(n(this,gv)-p)/2;s.push({type:"path",stampPoints:[{x:e,y:t,step:2},{x:e+p,y:t,step:0}],borderWidth:2,borderColor:r});}if(e){const t=v?n(this,fv)/2+y/10:n(this,fv)/2+y/2+y/10,e=(n(this,gv)-p)/2;s.push({type:"path",stampPoints:[{x:e,y:t,step:2},{x:e+p,y:t,step:0}],borderWidth:2,borderColor:r});}}return s}getCanvas(){return n(this,pv).contextService.getDomElement()}updateSignatureStyle(t){s(this,mv,{...n(this,mv),...t});const e=this.getStampConfig();n(this,yv).stampConfig=e,n(this,yv).initStamp(),n(this,pv).render();}getSignatureImage(){if(!n(this,yv))return Promise.resolve(null);const t=document.createElement("canvas");t.width=n(this,gv),t.height=n(this,fv);return t.getContext("2d").drawImage(this.getCanvas(),-.65*devicePixelRatio,-.65*devicePixelRatio,(n(this,gv)+1.3)*devicePixelRatio,(n(this,fv)+1.3)*devicePixelRatio,0,0,n(this,gv),n(this,fv)),new Promise((e=>{t.toBlob(e,"image/png");}))}}function bv(t,e){const i=document.createElement("canvas");s(this,pv,new xl({renderer:new _l,width:t,height:e,canvas:i,dpr:window.devicePixelRatio,willReadFrequently:!0})),i.style.width=`${t}px`,i.style.height=`${e}px`,s(this,uv,n(this,pv).document.documentElement),s(this,yv,new Oh({style:{stampConfig:this.getStampConfig()}})),n(this,uv).appendChild(n(this,yv)),(new xd).init(n(this,pv)),n(this,pv).render();}const Cv={install(t){const e=t.getClass("Viewer"),n=(s=e,class extends s{constructor(t){super(t),i(this,"annotationViewerContext",void 0),this.annotationViewerContext=this.register(new Hm(this)),this.listenGlobalEventForAnnotation(),this.listenHooksForAnnotation(),this.listenNativeEventsForAnnotation(),this.context.hasAnnotationModule=!0,this.context.annotationEditService=this.register(new Vm(this.annotationViewerContext));const e=this.getViewerConfig();this.context.isDefaultViewer&&this.updateAnnotationConfig({enableDeleteWithKeyboard:e.enableDeleteWithKeyboard,enableMoveWithKeyboard:e.enableMoveAnnotationWithKeyboard,enableMultipleSelectWidthCtrl:e.enableMultipleSelectAnnotationWithKeyboard});}listenHooksForAnnotation(){const t=()=>{const t=this.getSelectedAnnotations();if(1!==t.length)return;if(!t[0])return;const e=this.getAnnotationObject(t[0].uid);e instanceof mh&&e.isEditMode&&e.updateCursor();};this.hooks.scroll.on((e=>{this.context.isDefaultViewer&&t();})),this.hooks.resize.on((e=>{this.context.isDefaultViewer&&t();})),this.hooks.zoomChanged.on((e=>{this.context.isDefaultViewer&&t();})),this.hooks.pageChanged.on((t=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const t=this.getActiveTab();if(null!=t&&t.total){const e=t.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(e);}t&&"single"===t.context.displayMode&&this.annotationViewerContext.disableTextEditMode();}}),this),this.hooks.currentPageChanged.on((t=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const t=this.getActiveTab();if(null!=t&&t.total){const e=t.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(e);}}}),this);}listenGlobalEventForAnnotation(){if(!this.context.isDefaultViewer&&!this.context.isThumbnailViewer)return;const{core:t}=this.context,e=t.annotationService.annotationApp.hooks;t.onBeforeGetPageData.on((t=>{const{activatedShape:e}=this.annotationViewerContext.annotationController.eventService;(null==e?void 0:e.pageUid)===t.pageUid&&e instanceof mh&&e.isEditMode&&e.textEditEventHandler.emitTextContentUpdated();}),this),e.annotationCreated.on((t=>{t.annotations.forEach((t=>{this.annotationViewerContext.addAnnotationByAnnotationData(t);})),this.context.render();}),this),e.annotationDeleted.on((t=>{this.annotationViewerContext.deleteAnnotations(t.annotations.map((t=>t.uid)),t.emitEvent),this.context.render();}),this);let i=null;e.annotationUpdated.on((t=>{const e=t.updateDetails.map((t=>t.annotationUid));this.annotationViewerContext.updateAnnotations(e,t.updatedBy),this.hooks.annotationsUpdated.emit(new Hf(e,t.updateActions)),i||(i=setTimeout((()=>{var t;null===(t=this.context)||void 0===t||t.render(),i=null;}),17));}),this),e.bringFroward.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid,t.forwardUid]),this.context.render();}),this),e.bringToFront.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render();}),this),e.sendBackward.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid,t.backwardUid]),this.context.render();}),this),e.sendToBack.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render();}),this),e.restoreLayer.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render();}),this),e.annotationPageSwitched.on((t=>{this.annotationViewerContext.updateAnnotationPage(t.annotationUid,t.to.pageUid),this.context.render();}),this);}listenNativeEventsForAnnotation(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&to(document,"click",this).on((t=>{const e=this.getActiveTab(),i="visible"===this.context.viewerConfig.visibility;e&&i&&(this.context.viewService.mainContainer.contains(null==t?void 0:t.target)||this.annotationViewerContext.disableTextEditMode());}));}getAnnotationConfig(){return Vn(this.annotationViewerContext.annotationController.interactiveConfig)}updateAnnotationConfig(t){this.annotationViewerContext.annotationConfigService.updateConfig(t);}selectAnnotations(t){return this.annotationViewerContext.selectAnnotations(t)}deleteAnnotations(t){this.context.core.annotationService.deleteAnnotations(t),this.context.render();}updateAnnotation(t,e,i){const n=this.getAnnotationObject(t);n instanceof mh&&n.isEditMode&&n.textEditEventHandler.emitTextContentUpdated(),this.context.core.annotationService.updateAnnotations([{annotationUid:t,options:e}],void 0,i);}getSelectedAnnotations(){return this.annotationViewerContext.getSelectedAnnotations()}bringForward(t){return this.context.core.annotationService.bringForward(t)}bringToFront(t){return this.context.core.annotationService.bringToFront(t)}sendBackward(t){return this.context.core.annotationService.sendBackward(t)}sendToBack(t){return this.context.core.annotationService.sendToBack(t)}getAnnotationObject(t){return this.annotationViewerContext.annotationController.getShape(t)}copyAnnotations(t){t||(t=this.getSelectedAnnotations().map((t=>t.uid))),t.length&&this.context.core.annotationService.copyAnnotations(t);}cutAnnotations(t){t||(t=this.getSelectedAnnotations().map((t=>t.uid))),t.length&&this.context.core.annotationService.cutAnnotations(t);}pasteAnnotations(t,e){const i=this.context.getActiveTab();if(null==i||!i.total)return;const n=i.getCurrentPage();n&&this.context.core.annotationService.pasteAnnotations(t||i.uid,e||n.uid);}clearAnnotationClipboard(){this.context.core.annotationService.clearAnnotationClipboard();}undo(){const{activatedShape:t}=this.annotationViewerContext.annotationController.eventService;if(!this.context.getActiveTab())return !1;const e=t instanceof mh&&t.isEditMode;e&&t.textEditEventHandler.emitTextContentUpdated();const i=super.undo();return e&&t.textEditEventHandler.resetStartTextContent(),i}redo(){const{activatedShape:t}=this.annotationViewerContext.annotationController.eventService;if(!this.context.getActiveTab())return !1;const e=t instanceof mh&&t.isEditMode;e&&t.textEditEventHandler.emitTextContentUpdated();const i=super.redo();return e&&t.textEditEventHandler.resetStartTextContent(),i}});var s;t.setClass("Viewer",n);},apply(t){const e=new Zm(t);t.annotationService=e;const{documentService:i,pageService:n}=t;e.hooks.annotationCreated.on((t=>{t.annotations.forEach((t=>{const e=n.getPage(t.pageUid);e&&e.annotations.push(t.uid);}));}),n),e.hooks.annotationDeleted.on((t=>{t.annotations.forEach((t=>{const e=n.getPage(t.pageUid);if(e){const i=e.annotations.indexOf(t.uid);e.annotations.splice(i,1);}}));}),n),e.hooks.annotationPageSwitched.on((t=>{const e=n.getPage(t.from.pageUid),i=n.getPage(t.to.pageUid);if(e){const i=e.annotations.indexOf(t.annotationUid);e.annotations.splice(i,1);}i&&i.annotations.push(t.annotationUid);}),n);}},Sv={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},croppingMagnifierStyle:{type:"circle",size:100,borderColor:"#323232",borderWidth:3,crosshairWidth:1,crosshairColor:"#323232",magnification:3},enableDragPage:!0,dragThreshold:3,dragStartTimeThreshold:500,enablePanX:!0,enablePanY:!0,panThreshold:3,enableZoom:!0,enableZoomWithCtrl:!0,enableZoomWithTouch:!0,zoom:1,minZoom:.02,maxZoom:8,wheelZoomFactor:1.2,tapZoomFactor:1.2,zoomOrigin:{x:"center",y:"center"},enableZoomInCropMode:!0,enableZoomInPanMode:!0,enableZoomInAnnotationMode:!0,enableSlide:!0,startSlideThreshold:20,slideThreshold:.2,startSlideThresholdForPerspective:30,slideThresholdForPerspective:.2,multiselectMode:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0,enableMagnifier:!0,scrollDirection:"vertical",displayMode:"single",fitMode:"window",margin:10,rows:4,columns:1,maxRows:20,maxColumns:20,hasThb:!1,visibility:"visible",viewerMode:eg.DEFAULT,toolMode:"pan",annotationMode:"select",enableMultiTab:!1,scrollToLatest:!1,autoScroll:!0,autoChangeIndex:!0,enableLoadSourceByDrag:!0,enableFillColor:!0,blankFillColor:"#fff",maxOptimizationSize:7e3,enableOptimizePage:!1,enableAnnotationUi:!1,enableAnnotationInteraction:!0,enableSelectAnnotation:!0,enableRotateAnnotation:!0,enableMoveAnnotation:!0,enableResizeAnnotation:!0,enableKeyboardInteraction:!0,enableZoomInWithKeyboard:!0,enableZoomOutWithKeyboard:!0,enableUndoWithKeyboard:!0,enableRedoWithKeyboard:!0,enableDeleteWithKeyboard:!0,enableSelectAllWithKeyboard:!0,enableMoveAnnotationWithKeyboard:!0,enableSaveWithKeyboard:!0,enableLoadSourceWithKeyboard:!0,enablePrintWithKeyboard:!0,enableSelectPageWithKeyboard:!0,enableCopyCutPasteWithKeyboard:!0,enableMultipleSelectAnnotationWithKeyboard:!0,moveAnnotationStepSize:2,moveAnnotationAcceleration:1};class Pv extends ka{constructor(){super({name:"Checkbox"}),i(this,"shapeType","checkbox"),i(this,"checkboxStyle",void 0),i(this,"parsedCheckboxStyle",void 0),i(this,"isChecked",!1);}get checked(){return this.isChecked}set checked(t){this.isChecked=t;}updateStyle(t){Object.assign(this.style,t);}}class Av extends ka{constructor(){super({name:"PageNumber"}),i(this,"shapeType","pageNumber"),i(this,"text",void 0),i(this,"parsedPageNumberStyle",void 0),this.text="0";}updateText(t){this.text=t;}updateStyle(t){Object.assign(this.style,t);}}class Tv extends Fa{constructor(t){super({...t,name:"TabPage"}),i(this,"uid",void 0),i(this,"tab",void 0),i(this,"isSelected",!1),i(this,"isHovered",!1),i(this,"isDragging",!1),i(this,"isLoading",!1),i(this,"isPreload",!1),i(this,"isLoaded",!1),i(this,"rWidth",void 0),i(this,"rHeight",void 0),i(this,"rotation",0),i(this,"cropLeft",void 0),i(this,"cropTop",void 0),i(this,"cropWidth",void 0),i(this,"cropHeight",void 0),i(this,"mediaBoxRect",void 0),i(this,"cropBoxRect",void 0),i(this,"isOptimized",!1),i(this,"optimizedUid","1"),i(this,"optimizationUid","2"),i(this,"editUid",void 0),i(this,"editedUid",void 0),i(this,"zoom",1),i(this,"image",void 0),i(this,"borderBox",void 0),i(this,"checkbox",void 0),i(this,"pageNumber",void 0),i(this,"curBox",void 0),i(this,"mediaBox",void 0),i(this,"cropBox",void 0),i(this,"realTimeBox",void 0),this.tab=t.tab,this.uid=t.uid,this.rWidth=t.style.width,this.rHeight=t.style.height,this.initSubShapes(t);}initSubShapes(t){this.updateStyle({visibility:"hidden"});const e=new Ma({name:"pageImage",id:this.uid,style:{x:0,y:0,zIndex:-99999}}),i=new Fa({name:"pageOptimizedBox",style:{x:0,y:0}}),n=new Fa({name:"pageCropBox"});n.clippable=!0;const s=new Fa({name:"pageMediaBox"}),o=new Fa({name:"pageBorderBox",style:{...t.style,...t.formattedPageStyle}}),r=new Fa({name:"currentStyleBox",style:{visibility:"hidden"}}),a=new Pv,l=new Av;s.appendChild(e),n.appendChild(s),o.appendChild(i),o.appendChild(n),o.appendChild(r),o.appendChild(a),this.appendChild(l),this.appendChild(o),this.image=e,this.borderBox=o,this.realTimeBox=i,this.pageNumber=l,this.checkbox=a,this.curBox=r,this.cropBox=n,this.mediaBox=s;}getRect(){const t=this.realTimeBox.getPosition();return {left:t.x,top:t.y,width:this.rWidth,height:this.rHeight}}setImgDom(t){this.image.style.img=t;}getImgDom(){return this.image.style.img}clearOptimization(){this.isOptimized=!1,this.realTimeBox.imageData=null,this.image.updateStyle({visibility:"visible"}),this.optimizationUid=ts();}destroy(){this.image.style.img=null,this.image=null,this.realTimeBox=null;}setPage(t,e,i,n){this.updateStyle({x:t,y:e,width:i,height:n});}setBorderBox(t,e,i,n,s){zn(s)?this.borderBox.updateStyle({x:t,y:e,width:i,height:n}):this.borderBox.updateStyle({x:t,y:e,width:i,height:n,borderWidth:s});}setCropBox(t,e,i,n,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.cropBox.setLocalScale(1),this.cropBox.updateStyle({x:t,y:e,width:i,height:n}),this.cropBox.setLocalScale(s),this.cropBox.setLocalAngle(o),180===this.cropBox.getAngle()&&this.cropBox.setLocalAngle(179.9);}setRealTimeBox(t,e,i,n,s){this.realTimeBox.setLocalScale(1),this.realTimeBox.updateStyle({x:t,y:e,width:i,height:n}),this.realTimeBox.setLocalScale(s,s);}setMediaBox(t,e,i,n){this.mediaBox.updateStyle({x:t,y:e,width:i,height:n});}setCurBox(t,e,i,n){this.curBox.updateStyle({x:t,y:e,width:i,height:n});}setImage(t,e,i,n){this.image.updateStyle({x:t,y:e,width:i,height:n});}}function kv(t){const{borderWidth:e,borderColor:i,borderStyle:n}=Es(t),s=parseInt(e||"0px",10);let o=[0,0];return "dashed"===n&&(o=[2*s,s]),{borderWidth:s,borderStyle:o,borderColor:i||"",lineDash:o}}const Dv=t=>{const{border:e}=t;if(!e)return 0;const i=e.match(/[0-9]+/g)[0];return parseInt(i||"0",10)};function Ev(t,e){if(zn(t)||""===t)return null;const i=xr(t);return "%"===i.unit?e*i.value/100:i.value}function Iv(t,e,i){t.style.width=`${e}px`,t.style.height=`${i}px`;}function Rv(t){const e=devicePixelRatio;return Jn(t)&&t>0?(t=Math.floor(t*e)/e)||(t=1/e):t=0,t}function Mv(t){const e=devicePixelRatio;return Jn(t)?(t=Math.round(t*e)/e)||(t=1/e):t=0,t}function Bv(t){return Mv(t)}const Lv=()=>{const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e};class Uv{constructor(t,e){i(this,"tab",void 0),i(this,"viewerContext",void 0),i(this,"viewportWidth",600),i(this,"viewportHeight",800),i(this,"currentViewportWidth",0),i(this,"currentViewportHeight",0),i(this,"currentLayoutWidth",0),i(this,"currentLayoutHeight",0),i(this,"placeholderPages",[]),i(this,"scrollLeft",0),i(this,"scrollTop",0),i(this,"maxScrollLeft",0),i(this,"maxScrollTop",0),i(this,"startRow",0),i(this,"endRow",0),i(this,"startColumn",0),i(this,"endColumn",0),i(this,"preloadCount",1),i(this,"pagePreloadChanges",[]),i(this,"direction","vertical"),i(this,"displayMode",void 0),i(this,"fitMode",void 0),i(this,"rows",void 0),i(this,"columns",void 0),i(this,"zoom",void 0),i(this,"defaultReference",void 0),i(this,"zoomReference",void 0),i(this,"resizeReference",void 0),i(this,"oldZoom",void 0),i(this,"isZoomChanged",void 0),i(this,"isOutOfBounds",void 0),i(this,"isScrollbarResized",!0),i(this,"scrollbarWidthCache",void 0),i(this,"defaultWidth",void 0),i(this,"defaultHeight",void 0),this.tab=t,this.viewerContext=e;const{viewerConfig:n}=e;this.rows=n.rows,this.columns=n.columns,this.zoom=n.zoom,this.oldZoom=n.zoom,this.displayMode=n.displayMode,this.fitMode=n.fitMode,this.direction=n.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1;}get isVertical(){return "vertical"===this.direction}get isContinuousDisplay(){return "continuous"===this.displayMode}get isSingleDisplay(){return "single"===this.displayMode}get scrollbarWidth(){if(!this.isScrollbarResized&&this.scrollbarWidthCache)return this.scrollbarWidthCache;const t=Lv();return this.scrollbarWidthCache=t,this.isScrollbarResized=!1,t}getRealRowAndColumnContinuous(){const{rows:t,columns:e,isVertical:i}=this,{total:n}=this.tab;let s=t,o=e;return i?(s=Math.ceil(n/e),n<=e&&(o=Math.max(1,n),s=1)):(o=Math.ceil(n/t),n<=t&&(s=Math.max(1,n),o=1)),{realRow:s,realColumn:o}}getRealRowAndColumnThumbnail(){const{total:t}=this.tab,{rows:e,columns:i,isVertical:n}=this,s=n?i:Math.ceil(t/e);return {realRow:n?Math.ceil(t/i):e,realColumn:s}}getZoomOriginCord(){const{zoomOrigin:t}=this.viewerContext.viewerConfig,e={start:0,center:.5,end:1};return {originX:this.currentViewportWidth*e[t.x],originY:this.currentViewportHeight*e[t.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:t}=this.viewerContext,{borderWidth:e}=t.getParsedPageStyle();return {borderWidth:e,selectedBorderWidth:t.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:t.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(t,e){return this.viewerContext.styleService.getParsedPageNumberStyle({width:t,height:e})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(t,e){return this.viewerContext.styleService.getParsedCheckboxStyle({width:t,height:e})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(t){if(Zn(t)){if(/px/.test(t)){const[e]=t.match(/(\d+)/);return parseInt(e,10)}const e=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(t)){const i=e.width/Ds(),[n]=t.match(/(\d+)/);return i*parseInt(n,10)/100}if(/em/.test(t)){const i=getComputedStyle(e).fontSize,[n]=i.match(/(\d+)/),[s]=t.match(/(\d+)/);return parseInt(n,10)*parseInt(s,10)}}return Jn(t)?t:parseInt(t,10)}setZoom(t){this.oldZoom=this.zoom,this.zoom=t,this.tab.pages.forEach((e=>{e.zoom=t;}));}getTabOffset(){const{maxScrollLeft:t,maxScrollTop:e,currentLayoutWidth:i,currentLayoutHeight:n,currentViewportWidth:s,currentViewportHeight:o,scrollLeft:r,scrollTop:a}=this;let l=0,h=0;const d=this.getParsedCanvasStyle().borderWidth||0;return l=t>0?-r:(s-(i-2*d))/2,h=e>0?-a:(o-(n-2*d))/2,{offsetX:l,offsetY:h}}parseReferenceDefault(){const{tab:t,maxScrollLeft:e,maxScrollTop:i}=this,n=t.current,s=this.placeholderPages[n];if(!s)return {scrollLeft:0,scrollTop:0};const o=this.getMargin();let r=s.x-o,a=s.y-o;return this.isContinuousDisplay&&(r=s.pageX-o,a=s.pageY-o),r=Qn(r,0,e),a=Qn(a,0,i),{scrollLeft:r,scrollTop:a}}parseReferenceZoom(t,e,i){if(zn(t)&&(t=this.zoomReference),zn(e)||zn(i)){const{originX:t,originY:n}=this.getZoomOriginCord();e=t,i=n;}let{scrollLeft:n,scrollTop:s}=this.parseReference(t,e,i);const{maxScrollLeft:o,maxScrollTop:r}=this;return n=Qn(n,0,o),s=Qn(s,0,r),{scrollLeft:n,scrollTop:s}}parseReferenceResize(){const{resizeReference:t}=this;let{scrollLeft:e,scrollTop:i}=this.parseReference(t,0,0);const{maxScrollLeft:n,maxScrollTop:s}=this;return e=Math.min(e,n),i=Math.min(i,s),{scrollLeft:e,scrollTop:i}}updateReference(){const{currentViewportWidth:t,currentViewportHeight:e}=this,i=this.generateReference(0,0),n=this.generateReference(t/2,e/2),{originX:s,originY:o}=this.getZoomOriginCord(),r=this.generateReference(s,o);this.defaultReference=n,this.resizeReference=i,this.zoomReference=r;}generateReference(t,e){let i,n,s,o,r=null,a=Number.MAX_VALUE;const{offsetX:l,offsetY:h}=this.getTabOffset(),{zoom:d}=this;this.placeholderPages.forEach((c=>{if(c&&("single"===this.displayMode&&c.uid===this.tab.currentUid||"continuous"===this.displayMode)){const u=c.x+l,p=c.y+h,g=new hs(u+c.width/2,p+c.height/2).distanceTo({x:t,y:e});g<a&&(a=g,r=c.uid,t<u?(i="start",s=u-t):t>u+c.width?(i="end",s=t-(u+c.width)):(i="center",s=(t-u)/d),e<p?(n="start",o=p-e):e>p+c.height?(n="end",o=e-(p+c.height)):(n="center",o=(e-p)/d));}}));return {pageX:s,pageY:o,positionX:i,positionY:n,pageUid:r}}parseReference(t,e,i){const{pageX:n,pageY:s,positionX:o,positionY:r,pageUid:a}=t,l=this.placeholderPages.find((t=>t.uid===a)),{zoom:h}=this;let d,c,u=0,p=0;return l&&("start"===o?d=l.x-n:"center"===o?d=l.x+n*h:"end"===o&&(d=l.x+l.width+n),"start"===r?c=l.y-s:"center"===r?c=l.y+s*h:"end"===r&&(c=l.y+l.height+s)),u=d-e,p=c-i,{scrollLeft:u,scrollTop:p}}getScrollValuesByCurrentChanged(){const{placeholderPages:t,currentViewportWidth:e,currentViewportHeight:i,startRow:n,endRow:s,startColumn:o,endColumn:r,isVertical:a}=this,{current:l}=this.tab,h=this.getMargin(),{realRow:d,realColumn:c}=this.getRealRowAndColumnThumbnail();let u=l,p=l;a?(u=n*c+o,p=s*c+r):(u=o*d+n,p=r*d+r);let g=Qn(this.scrollLeft,0,this.maxScrollLeft),f=Qn(this.scrollTop,0,this.maxScrollTop);if(l>=u&&l<=p)return {scrollLeft:g,scrollTop:f};const y=t[l];return y&&(a?(g=0,l<u?f=y.y-h:l>p&&(f=y.y+y.height+h-i)):(f=0,l<u?g=y.x-h:l>p&&(g=y.x+y.width+h-e))),g=Qn(g,0,this.maxScrollLeft),f=Qn(f,0,this.maxScrollTop),{scrollLeft:g,scrollTop:f}}getCurrentByScroll(){let t=this.tab.current;const{placeholderPages:e,currentViewportWidth:i,currentViewportHeight:n,startRow:s,endRow:o,startColumn:r,endColumn:a,isVertical:l}=this,{realRow:h,realColumn:d}=this.getRealRowAndColumnContinuous(),c=i/2,u=n/2,{offsetX:p,offsetY:g}=this.getTabOffset(),{current:f}=this.tab;let y=Number.MAX_VALUE,m=Number.MAX_VALUE,v=l?Math.floor(f/d):f%h,x=l?f%d:Math.floor(f/h);for(let t=s;t<=o;t++){const i=e[t*d];if(!i)continue;const{y:n,height:s}=i,o=n+g,r=o-u,a=u-o-s;if(r<=0&&a<=0){v=t;break}r>0&&r<m?(m=r,v=t):a>0&&a<m&&(m=a,v=t);}for(let t=r;t<=a;t++){const i=e[r];if(!i)continue;const{x:n,width:s}=i,o=n+p,a=o-c,l=c-o-s;if(a<=0&&l<=0){x=t;break}a>0&&a<y?(y=a,x=t):l>0&&l<y&&(y=l,x=t);}return t=v*d+x,t===this.tab.current?null:t}setTabScrollValue(t,e){this.scrollLeft=t,this.scrollTop=e;const{offsetX:i,offsetY:n}=this.getTabOffset();this.tab.setPosition({x:i,y:n});}}class Ov extends ka{constructor(t,e){super({name:"DocTab"}),i(this,"uid",void 0),i(this,"docType",void 0),i(this,"docName",void 0),i(this,"doc",void 0),i(this,"isActive",!1),i(this,"currentUid",void 0),i(this,"total",void 0),i(this,"selected",void 0),i(this,"context",void 0),i(this,"viewerContext",void 0),i(this,"shiftReference",void 0),i(this,"oldCurrentUid",void 0),i(this,"oldCurrent",void 0),i(this,"pageMap",new Map),this.doc=t,this.uid=t.uid,this.docName=t.name,this.docType=t.type,this.total=0,this.selected=[],this.viewerContext=e,this.context=new Uv(this,e),this.oldCurrent=-1,this.oldCurrentUid=void 0,t.pages.forEach((t=>{const e=this.createPage(t);this.pageMap.set(t,e),this.appendChild(e);})),this.total=t.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid);}get scrollToLatest(){let{scrollToLatest:t}=this.viewerContext.viewer.group.config;return zn(t)&&(t=this.viewerContext.viewerConfig.scrollToLatest),t}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return "document"===this.docType}createPage(t){const{pageStyle:e,pageNumberStyle:i,checkboxStyle:n,removeBtnStyle:s,blankFillColor:o}=this.viewerContext.viewerConfig,r=function(t){const{border:e,background:i}=t;let n={};e&&(n=kv(e));return {background:i,...n}}(e),{width:a,height:l}=this.viewerContext.getPageRenderSize(t);return new Tv({tab:this,uid:t,formattedPageStyle:r,pageNumberStyle:i,checkboxStyle:n,removeBtnStyle:s,blankFillColor:o,style:{pointerEvents:"auto",width:a,height:l}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current;}updateViewportSize(t,e){this.context.viewportWidth=t,this.context.viewportHeight=e;}rename(t){this.docName=t;}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map((t=>t.uid))}appendPages(t,e,i){const n=t.length;if(!n)return;const s=Jn(i);if(t.forEach(((t,e)=>{const n=this.createPage(t);this.appendChild(n,s?i+e:void 0),this.pageMap.set(t,n);})),this.total=this.pages.length,e)this.currentUid=this.indexToUid(s?i+n-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var o;this.currentUid=null===(o=this.pages[0])||void 0===o?void 0:o.uid,this.updateDefaultReference();}}deletePages(t){this.updateOldInfo();const e=[...t],i=t.includes(this.currentUid);if(i){const i=t.indexOf(this.currentUid);e.splice(i,1),e.push(this.currentUid);}e.forEach((t=>{const e=this.getPageByUid(t);if(i&&e.uid===this.currentUid){if(1===this.total)this.currentUid=null;else {const{current:t}=this,e=t===this.total-1?-1:1;this.currentUid=this.indexToUid(t+e);}this.updateDefaultReference();}Ns(this.selected,t),this.removeChild(e),this.pageMap.delete(e.uid),this.total-=1;})),0===this.total&&(this.context.placeholderPages=[]);}deleteAllPages(){this.updateOldInfo();[...this.pages].forEach((t=>{this.removeChild(t),this.pageMap.delete(t.uid);})),this.currentUid=null,this.selected=[],this.context.placeholderPages=[],this.total=0;}movePages(t,e){return this.updateOldInfo(),_s(this.pages,t,e)}switchPage(t,e){return this.updateOldInfo(),Ws(this.pages,t,e)}reorderPages(t){return (!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),Fs(this.pages,t)}gotoPage(t){return 0===this.total?-1:(this.updateOldInfo(),t!==this.current&&(t=Qn(t,0,this.total-1),this.currentUid=this.indexToUid(t),this.updateDefaultReference()),this.updateShiftReference(),t)}selectPages(t){this.pages.forEach((e=>{e.isSelected=t.includes(e.uid);})),this.selected=t;}selectPagesByIndices(t){const e=this.indicesToUids(t);this.selectPages(e);}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map((t=>this.uidToIndex(t)))}getPageByIndex(t){return this.pages[t]}getPageByUid(t){return this.pageMap.get(t)}getPageIndex(t){return this.pages.findIndex((e=>e.uid===t.uid))}uidToIndex(t){return this.pages.findIndex((e=>e.uid===t))}uidsToIndices(t){return t.map((t=>this.uidToIndex(t)))}indexToUid(t){var e;return null===(e=this.pages[t])||void 0===e?void 0:e.uid}indicesToUids(t){return t.map((t=>this.indexToUid(t)))}updateShiftReference(){this.shiftReference=this.currentUid;}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid};}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0;}}class Nv extends Qs{constructor(t){super(),i(this,"tabActivationStack",void 0),i(this,"tabs",void 0),i(this,"activeTabUid",void 0),i(this,"context",void 0),this.tabActivationStack=[],this.tabs=new Map,this.context=t;}dispose(){this.clearTabs(),this.tabActivationStack.length=0,super.dispose();}updateViewportSize(t,e){const i=this.getActiveTab();null!=i&&i.isDocType&&i.updateViewportSize(t,e);}createTab(t){if(this.tabs.has(t.uid))return this.tabs.get(t.uid);let e=null;return "document"===t.type&&(e=new Ov(t,this.context)),this.context.viewerConfig.enableMultiTab||this.clearTabs(),this.tabs.set(e.uid,e),e}closeTab(t){if(!this.tabs.has(t))return !1;const{tabActivationStack:e}=this;if(e.includes(t)){const i=e.indexOf(t);e.splice(i,1);}return this.getTab(t).isActive=!1,this.tabs.delete(t),this.activeTabUid===t&&(this.activeTabUid=e[e.length-1]),!0}getTab(t){return this.tabs.get(t)}getDocTab(t){const e=this.getTab(t);return null!=e&&e.isDocType?e:null}hasTab(t){return this.tabs.has(t)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(t){if(!this.tabs.has(t))return !1;const{tabActivationStack:e}=this;if(this.context.viewerConfig.enableMultiTab){if(e.includes(t)){const i=e.indexOf(t);e.splice(i,1);}}else e.length=0;return e.push(t),this.activeTabUid=t,this.tabs.forEach((e=>{e.isActive=e.uid===t;})),!0}clearTabs(){this.getAllTabs().forEach((t=>{t.destroy();})),this.tabs.clear();}resizeScrollbar(){this.tabs.forEach((t=>{t.context.isScrollbarResized=!0;}));}}class _v{constructor(t){i(this,"parsedPageStyleCache",void 0),i(this,"parsedCurrentPageStyleCache",void 0),i(this,"parsedSelectedPageStyleCache",void 0),i(this,"parsedHoveredPageStyleCache",void 0),i(this,"parsedPlaceholderStyleCache",void 0),i(this,"parsedCheckboxStyleCache",void 0),i(this,"parsedPageNumberStyleCache",void 0),i(this,"parsedQuadSelectionStyleCache",void 0),i(this,"parsedCanvasStyleCache",void 0),i(this,"context",void 0),i(this,"isPageStyleChanged",void 0),i(this,"isCurrentPageStyleChanged",void 0),i(this,"isSelectedPageStyleChanged",void 0),i(this,"isHoveredPageStyleChanged",void 0),i(this,"isPlaceholderStyleChanged",void 0),i(this,"isCheckboxStyleChanged",void 0),i(this,"isPageNumberStyleChanged",void 0),i(this,"isQuadSelectionStyleChanged",void 0),i(this,"isCanvasStyleChanged",void 0),this.context=t;}getParsedCanvasStyle(){return !this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=Wv(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(t){return !this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=Wv(this.context.viewerConfig.checkboxStyle,t),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(t){return !this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=Wv(this.context.viewerConfig.pageNumberStyle,t),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return !this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=Wv(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return !this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=Wv(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return !this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=Wv(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return !this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=Wv(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return !this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=Wv(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return !this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=Wv(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}isBorderWidthEqualHovered(){const{viewerConfig:t}=this.context;return Dv(t.pageStyle)===Dv(t.hoveredPageStyle)}isSelectedBorderWidthEqualHovered(){const{viewerConfig:t}=this.context;return Dv(t.selectedPageStyle)===Dv(t.hoveredPageStyle)}isSelectedBorderWidthEqualNormal(){const{viewerConfig:t}=this.context;return Dv(t.pageStyle)===Dv(t.selectedPageStyle)}}function Wv(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const i={};if(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:i,ctrlBorder:n}=t;if(!zn(i)){const t=kv(i);Object.assign(e,t);}if(!zn(n)){const t=kv(n);Object.assign(e,{ctrlBorderWidth:t.borderWidth,ctrlBorderColor:t.borderColor,ctrlBorderStyle:t.borderStyle});}}(t,i),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Fv.forEach((i=>{zn(t[i])||(e[i]=vr(t[i]).value||0);}));}(t,i),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Hv.forEach((i=>{zn(t[i])||(e[i]=t[i]);}));}(t,i),function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!zn(t.width)&&(i.width=Ev(t.width,e.width),zn(t.translateX)||(i.translateX=Ev(t.translateX,i.width)),!zn(t.borderRadius))){const e=Ev(t.borderRadius,i.width);i.borderRadiusX=Math.max(0,Math.min(e,i.width/2));}if(!zn(t.height)&&(i.height=Ev(t.height,e.height),zn(t.translateY)||(i.translateY=Ev(t.translateY,i.height)),!zn(t.borderRadius))){const e=Ev(t.borderRadius,i.height);i.borderRadiusY=Math.max(0,Math.min(e,i.height/2));}if(!zn(t.borderRadius)){const n=Ev(t.borderRadius,e.width);i.borderRadius=Math.max(0,Math.min(n,e.height/2,e.width/2));}if(!zn(t.ctrlBorderRadius)){const e=Ev(t.ctrlBorderRadius,i.ctrlWidth);i.ctrlBorderRadius=Math.max(0,Math.min(e,i.ctrlWidth/2,i.ctrlHeight/2));}Vv.forEach((n=>{const s=["left","right"].includes(n)?e.width:e.height,o=xr(t[n]);let r=o.value;"%"===o.unit&&(r=s*o.value/100),i[n]=r;}));}(t,e,i),t.left||t.right||t.bottom||t.top){const{left:n,top:s,right:o,bottom:r,width:a,height:l,translateX:h,translateY:d}=i;""!==t.left?i.x=n+h||0:""!==t.right&&Jn(a)?i.x=e.width-a-o+h||0:i.x=0,""!==t.top?i.y=s+d||0:""!==t.bottom&&Jn(l)?i.y=e.height-l-r+d||0:i.y=0;}return i}const Fv=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],Hv=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],Vv=["left","top","right","bottom"];const zv="visible",jv="hidden";class $v{constructor(t){i(this,"context",void 0),this.context=t;}handleVisibility(t){if(this.context.isDestroyed||t.isDestroyed||!t.total||!t.isActive)return;const{context:e}=this;if(e.isDefaultViewer?t.context.isContinuousDisplay?this.continuousVisibility(t):t.context.isSingleDisplay&&this.singleVisibility(t):e.isThumbnailViewer?this.thumbnailVisibility(t):e.isPerspectiveViewer&&t.context.isSingleDisplay&&this.singleVisibility(t),t.context.pagePreloadChanges.length){t.context.pagePreloadChanges.forEach((e=>{if(e.from&&!e.to){const i=t.getPageByUid(e.pageUid);i&&(i.isLoaded=!1);}}));const i=Wf.create(t.uid,e.uid,e.viewerConfig.viewerMode,t.context.pagePreloadChanges);e.core.viewerService.onPagePreloadChanged.emit(i);}}thumbnailVisibility(t){const{total:e}=t;if(!e)return;const i=t.context;if(i.isOutOfBounds)return void t.pages.forEach((t=>{t.updateStyle({visibility:"hidden"});}));const{rows:n,columns:s,placeholderPages:o,preloadCount:r,isVertical:a}=i,{width:l,height:h}=o[0],d=i.getParsedPageStyle(),c=i.getParsedCurrentPageStyle(),u=i.getParsedSelectedPageStyle(),p=i.getParsedHoveredPageStyle(),g=i.getParsedPlaceholderStyle(),f=i.getParsedPageNumberStyle(l,h),y=i.getParsedCheckboxStyle(l,h),{visibility:m,top:v,bottom:x,onPage:w,height:b}=f;let C=0;const S="visible"===m,P=i.getPageNumberStyle();if(S){const t=""!==P.top?v:x||0;w||(C=""!==P.top?b+t:0);}const{realColumn:A,realRow:T}=i.getRealRowAndColumnThumbnail(),{startRow:k,endRow:D}=this.getVisibleRow(t,T,A),{startColumn:E,endColumn:I}=this.getVisibleColumn(t,T,A);t.context.startRow=k,t.context.endRow=D,t.context.startColumn=E,t.context.endColumn=I;const R=Rv(c.borderWidth),M=[];t.pages.forEach(((e,i)=>{const o=a?Math.floor(i/s):i%n,l=a?i%s:Math.floor(i/n),h=o>=k-r&&o<=D+r&&l>=E-r&&l<=I+r,m=o>=k&&o<=D&&l>=E&&l<=I?zv:jv;e.isPreload!==h&&M.push({from:e.isPreload,to:h,pageUid:e.uid,index:i});let v={borderWidth:0,background:"#ffffff00"};e.isDragging&&(v=g);let x=d;e.isHovered&&(x=p),e.isSelected&&(x=u);const b=Rv(x.borderWidth);if(e.isPreload=h,e.updateStyle({visibility:m,...v}),e.borderBox.updateStyle({...x,visibility:m,borderWidth:b}),S){let t=f.y;w||(t=""!==P.top?-C:f.y+f.bottom),e.pageNumber.parsedPageNumberStyle={...f,y:t},e.pageNumber.updateText((i+1).toString());}e.pageNumber.updateStyle({visibility:f.visibility,zIndex:f.onPage?1:0});let A=y.visibility;y.visibleByHover&&(A=e.isHovered||e.isSelected?y.visibility:"hidden"),e.checkbox.parsedCheckboxStyle={...y},e.checkbox.updateStyle({visibility:A}),e.checkbox.checked=e.isSelected,e.curBox.updateStyle({...c,visibility:e.uid===t.currentUid?zv:jv,borderWidth:R});})),t.context.pagePreloadChanges=M;}continuousVisibility(t){const{preloadCount:e,isVertical:i}=t.context,{pages:n}=t,s=t.context.getParsedPageStyle(),o=t.context.getParsedCurrentPageStyle(),{realRow:r,realColumn:a}=t.context.getRealRowAndColumnContinuous(),{startRow:l,endRow:h}=this.getVisibleRow(t,r,a),{startColumn:d,endColumn:c}=this.getVisibleColumn(t,r,a);t.context.startRow=l,t.context.endRow=h,t.context.startColumn=d,t.context.endColumn=c;const u=Rv(s.borderWidth),p=Rv(o.borderWidth),g=[];n.forEach(((n,f)=>{const y=i?Math.floor(f/a):f%r,m=i?f%a:Math.floor(f/r),v=y>=l&&y<=h&&m>=d&&m<=c,x=y>=l-e&&y<=h+e&&m>=d-e&&m<=c+e;n.isPreload!==x&&g.push({from:n.isPreload,to:x,pageUid:n.uid,index:f}),n.checkbox.updateStyle({visibility:jv}),n.pageNumber.updateStyle({visibility:jv}),n.curBox.updateStyle({...o,visibility:n.uid===t.currentUid?zv:jv,borderWidth:p}),n.borderBox.updateStyle({...s,borderWidth:u}),n.updateStyle({visibility:v?zv:jv}),n.isPreload=x;})),t.context.pagePreloadChanges=g;}singleVisibility(t){const{preloadCount:e}=t.context,{current:i,total:n,pages:s}=t,o=t.getCurrentPage(),r=t.context.getParsedPageStyle(),a=Math.max(i-e,0),l=Math.min(i+e,n-1);o.checkbox.updateStyle({visibility:jv}),o.pageNumber.updateStyle({visibility:jv});const h=Rv(r.borderWidth),d=[];s.forEach(((t,e)=>{const i=e>=a&&e<=l,n=t.uid===o.uid;t.isPreload!==i&&d.push({from:t.isPreload,to:i,pageUid:t.uid,index:e}),t.borderBox.updateStyle({...r,borderWidth:h}),t.updateStyle({visibility:n?zv:jv}),t.isPreload=i,t.curBox.updateStyle({visibility:jv});})),t.context.pagePreloadChanges=d;}getVisibleColumn(t,e,i){const{scrollLeft:n,placeholderPages:s,currentViewportWidth:o,isVertical:r}=t.context;let a=0,l=i-1;if(r&&this.context.isThumbnailViewer)return {startColumn:a,endColumn:l};let h=Number.MAX_VALUE,d=Number.MAX_VALUE,c=null,u=null;for(let t=0;t<i;t++){const i=s[r?t:t*e];if(!i)continue;const{width:p,x:g}=i;if(null===c){const e=g-n;e<=0&&n-(g+p)<-1?(c=t,a=t):e>0&&e<h&&(h=e,a=t);}if(null===u){const e=n+o,i=e-(g+p);g-e<-1&&i<=0?(u=t,l=t):i>0&&i<d&&(d=i,l=t);}if(null!==c&&null!==u)break}return {startColumn:a,endColumn:l}}getVisibleRow(t,e,i){const{scrollTop:n,placeholderPages:s,currentViewportHeight:o,isVertical:r}=t.context;let a=0,l=e-1;if(!r&&this.context.isThumbnailViewer)return {startRow:a,endRow:l};let h=Number.MAX_VALUE,d=Number.MAX_VALUE,c=null,u=null;for(let t=0;t<e;t++){const e=s[r?t*i:t];if(!e)continue;const{y:p,height:g}=e;if(null===c){const e=p-n;e<=0&&n-(p+g)<-1?(c=t,a=t):e>0&&e<h&&(h=e,a=t);}if(null===u){const e=n+o,i=e-(p+g);p-e<-1&&i<=0?(u=t,l=t):i>0&&i<d&&(d=i,l=t);}if(null!==c&&null!==u)break}return {startRow:a,endRow:l}}}function Gv(t,e,i,n){const s={isOver:!1,pointerX:-1,pointerY:-1,page:t};if(t&&n){const{x:n,y:o}=t.getPosition(),{width:r,height:a}=t;s.isOver=e>=n&&i>=o&&e<=n+r&&i<=o+a;const l=t.getScale();s.pointerX=(e-n)/l.x,s.pointerY=(i-o)/l.y;}return s}const Xv={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},Yv={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},qv={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},Jv={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},Zv={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},Qv={tag:"div",id:"ddv-core",className:"ddv-core"};class Kv extends Qs{constructor(t,e){super(),i(this,"container",void 0),i(this,"defaultDom",void 0),i(this,"mainAndThbContainer",void 0),i(this,"thumbnailContainer",void 0),i(this,"mainContainer",void 0),i(this,"scrollerAndCanvasContainer",void 0),i(this,"scrollContainer",void 0),i(this,"scrollContent",void 0),i(this,"canvasContainer",void 0),i(this,"videoContainer",void 0),i(this,"audioContainer",void 0),i(this,"rootDom",void 0),i(this,"hooks",void 0),i(this,"isBindContainer",!1),i(this,"viewportWidth",void 0),i(this,"viewportHeight",void 0),i(this,"context",void 0),i(this,"dpr",Ds()),i(this,"hasScrollbarX",!1),i(this,"hasScrollbarY",!1),i(this,"winResizeTimer",void 0),this.context=t,this.hooks=e;const n=Wy(Qv,t.postfix);this.defaultDom=n;}dispose(){var t,e;null===(t=this.rootDom)||void 0===t||t.remove(),null===(e=this.thumbnailContainer)||void 0===e||e.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null,this.context=null,this.dpr=null,super.dispose();}createMainAndThbContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainAndThbContainer){const e=Wy(Zv,t);this.mainAndThbContainer=e,this.defaultDom.appendChild(e);}}createMainContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const e=Wy(Yv,t);this.mainContainer=e,this.mainAndThbContainer.appendChild(e);const i=e.querySelector(`#ddv-scroller-and-canvas${t}`),n=e.querySelector(`#ddv-canvas-container${t}`),s=e.querySelector(`#ddv-scroll-container${t}`),o=e.querySelector(`#ddv-scroll-content${t}`);this.scrollerAndCanvasContainer=i,this.canvasContainer=n,this.scrollContainer=s,this.scrollContent=o;const r=()=>{this.winResizeTimer&&clearTimeout(this.winResizeTimer),this.winResizeTimer=window.setTimeout((()=>{var t;null===(t=this.context)||void 0===t||t.resize();}),200);};window.addEventListener("resize",r);const a=t=>{t.target===e&&this.isBindContainer&&this.context.isInitialized&&this.context.resize();},{resizeService:l}=this.context.core;l.observe(e),l.onResizeObserver.on(a,this),this.context.hooks.destroy.on((()=>{l.unobserve(e),window.removeEventListener("resize",r);}));}}createThumbnailContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.thumbnailContainer){const e=Wy(Xv,t);this.thumbnailContainer=e,this.mainAndThbContainer.insertBefore(e,this.mainContainer);}}createVideoContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.videoContainer){const e=Wy(qv,t);this.mainContainer.appendChild(e);}}createAudioContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.audioContainer){const e=Wy(Jv,t);this.mainContainer.appendChild(e);}}getViewportSize(){if(!this.mainContainer)return {width:0,height:0};const{offsetWidth:t,offsetHeight:e}=this.getElSize(this.mainContainer),i=this.getCanvasBorderSize();return {width:t-2*i,height:e-2*i}}resetViewport(){const{scrollContent:t,canvasContainer:e}=this;Iv(e,0,0),Iv(t,0,0);const{width:i,height:n}=this.getViewportSize();this.viewportWidth=i,this.viewportHeight=n,this.updateCanvasContainerSize();}resizeViewport(){const{canvasContainer:t,scrollContainer:e}=this;Iv(t,0,0);const{offsetWidth:i,offsetHeight:n}=this.getElSize(e);this.viewportWidth=i,this.viewportHeight=n,this.updateCanvasContainerSize();}checkIsRound(t){const e=getComputedStyle(t);return {roundWidth:parseFloat(e.width)%1>=.5,roundHeight:parseFloat(e.height)%1>=.5}}getElSize(t){const{roundWidth:e,roundHeight:i}=this.checkIsRound(t);let{clientWidth:n,clientHeight:s,offsetWidth:o,offsetHeight:r}=t;return e&&(n-=1,o-=1),i&&(s-=1,r-=1),{clientWidth:n,clientHeight:s,offsetWidth:o,offsetHeight:r}}getMaxScrollValue(){const{scrollContainer:t}=this;return {scrollLeft:t.scrollWidth-t.clientWidth,scrollTop:t.scrollHeight-t.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const t=Ds();return this.dpr!==t&&(this.dpr=t,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(t){let e=t;return t&&Zn(t)&&(e=document.querySelector(`#${t}`)),e instanceof HTMLElement&&(e.appendChild(this.defaultDom),this.container=e,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return !1;for(let t=0;t<this.container.children.length;t++)if(this.container.children[t]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(t,e){const{scrollContainer:i}=this;i.scrollTo?i.scrollTo(t,e):(i.scrollLeft=t,i.scrollTop=e);}scrollBy(t,e){const{scrollContainer:i}=this;i.scrollBy?i.scrollBy(t,e):(i.scrollLeft+=t,i.scrollTop+=e);}updateScrollerContentSize(t){const{currentLayoutWidth:e,currentLayoutHeight:i}=t.context,{scrollContent:n,canvasContainer:s,scrollContainer:o}=this;Iv(s,10,10),Iv(n,e,i);let r=o.scrollWidth-o.clientWidth,a=o.scrollHeight-o.clientHeight;const l=getComputedStyle(o),h=getComputedStyle(n),d=parseFloat(l.width),c=parseFloat(l.height);d>=parseFloat(h.width)&&(r=0),c>=parseFloat(h.height)&&(a=0),t.context.maxScrollLeft=r,t.context.maxScrollTop=a;const u=r>0,p=a>0;let g=!1;u!==this.hasScrollbarX&&(this.hasScrollbarX=u,g=!0),p!==this.hasScrollbarY&&(this.hasScrollbarY=p,g=!0),g&&this.context.clearCurrentTabOptimization(),this.updateCanvasContainerSize();}updateCanvasContainerSize(){const{scrollContainer:t,canvasContainer:e}=this,{width:i,height:n}=getComputedStyle(this.scrollContainer);let s,o=parseFloat(i),r=parseFloat(n);t.offsetWidth!==t.clientWidth&&(Jn(s)||(s=Lv()),o-=s),t.offsetHeight!==t.clientHeight&&(Jn(s)||(s=Lv()),r-=s),Iv(e,o,r);}getCanvasBorderSize(){const{canvasContainer:t}=this;return (t.offsetWidth-t.clientWidth)/2}}class tx{constructor(){i(this,"canvasDom",void 0),i(this,"canvas",void 0),i(this,"renderer",void 0),i(this,"isInitialized",!1),i(this,"canvasWidth",0),i(this,"canvasHeight",0);}clear(){var t;const e=null===(t=this.canvas)||void 0===t?void 0:t.document.documentElement;if(!e)return;e.children.slice().forEach((t=>{e.removeChild(t);})),e.sortable.sorted=[];}render(t){var e;const i=null===(e=this.canvas)||void 0===e?void 0:e.document.documentElement;if(i){if(t)if(0===i.children.length)i.appendChild(t);else {i.children.indexOf(t)<0&&i.replaceChild(t,i.children[0]);}else {const t=[...i.children];for(let e=t.length;e>=0;e--)i.removeChild(t[e]);}this.canvas.render();}}initCanvas(t){let{container:e,width:i,height:n,limit1px:s}=t;const o=new _l({}),r=new xl({renderer:o,container:e,width:i,height:n});r.limit1px=s,this.canvasWidth=i,this.canvasHeight=n,this.renderer=o,this.canvas=r,this.canvasDom=r.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.canvasDom.style.touchAction="none",this.isInitialized=!0;}registerShapeRenderer(t,e){this.canvas.contextService.registerShapeRenderer(t,e);}getCanvasPosition(){const t=this.canvasDom.getBoundingClientRect(),{scrollX:e,scrollY:i}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return {x:t.left+e,y:t.top+i}}resize(t,e){const i=Ds();this.canvas.setDPR(i),this.canvasWidth=t,this.canvasHeight=e,this.canvas.resize(t,e);}}class ex{render(t,e){const{opacity:i,visibility:n}=t.parsedCheckboxStyle;0!==i&&"hidden"!==n&&(e.save(),e.globalAlpha=i,this.renderBox(t,e,"out"),e.clip(),this.renderBox(t,e,"in"),this.fill(t,e),this.renderBox(t,e,"center"),this.stroke(t,e),this.renderCheckMark(t,e),e.restore());}renderBox(t,e,i){const{x:n,y:s,width:o,height:r,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=t.parsedCheckboxStyle;let d=0;"center"===i?d=a/2:"in"===i&&(d=a);const c=[{x:n+l,y:s+h,start:Math.PI,end:3*Math.PI/2},{x:n+o-l,y:s+h,start:3*Math.PI/2,end:2*Math.PI},{x:n+o-l,y:s+r-h,start:0,end:Math.PI/2},{x:n+l,y:s+r-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-d,0),p=Math.max(h-d,0);if(e.beginPath(),e.ellipse&&u&&p)for(let t=0;t<4;t++){const{x:i,y:n,start:s,end:o}=c[t];e.ellipse(i,n,u,p,0,s,o);}else e.rect(n,s,o,r);e.closePath();}fill(t,e){const{background:i}=t.parsedCheckboxStyle;i&&""!==i&&(e.fillStyle=i,e.fill());}stroke(t,e){const{borderColor:i,borderWidth:n,borderStyle:s}=t.parsedCheckboxStyle;e.setLineDash(s),e.strokeStyle=i,e.lineWidth=n,n>0&&i&&""!==i&&e.stroke();}renderCheckMark(t,e){if(!t.checked)return;const{x:i,y:n,width:s,height:o,borderWidth:r,checkMarkLineWidth:a,checkMarkColor:l}=t.parsedCheckboxStyle,h=Math.max(Math.min(s-2*r,o-2*r),0);let d=i,c=n;0!==h&&(s<o?(d+=r,c=c+r+(o-s)/2):(d=d+r+(s-o)/2,c+=r),e.setLineDash([0,0]),e.lineWidth=a,e.strokeStyle=l,e.beginPath(),e.moveTo(d+.15*h,c+.5*h),e.lineTo(d+.4*h,c+.8*h),e.lineTo(d+.85*h,c+.2*h),e.stroke());}}class ix{render(t,e){const{opacity:i,visibility:n}=t.parsedPageNumberStyle;0!==i&&"hidden"!==n&&(e.save(),e.globalAlpha=i,this.renderBox(t,e,"out"),e.clip(),this.renderBox(t,e,"in"),this.fill(t,e),this.renderBox(t,e,"center"),this.stroke(t,e),this.renderFont(t,e),e.restore());}renderBox(t,e,i){const{x:n,y:s,width:o,height:r,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=t.parsedPageNumberStyle;let d=0;"center"===i?d=a/2:"in"===i&&(d=a);const c=[{x:n+l,y:s+h,start:Math.PI,end:3*Math.PI/2},{x:n+o-l,y:s+h,start:3*Math.PI/2,end:2*Math.PI},{x:n+o-l,y:s+r-h,start:0,end:Math.PI/2},{x:n+l,y:s+r-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-d,0),p=Math.max(h-d,0);if(e.beginPath(),e.ellipse&&u&&p)for(let t=0;t<4;t++){const{x:i,y:n,start:s,end:o}=c[t];e.ellipse(i,n,u,p,0,s,o);}else e.rect(n,s,o,r);e.closePath();}renderFont(t,e){const{x:i,y:n,width:s,height:o,fontSize:r,color:a,fontFamily:l}=t.parsedPageNumberStyle;e.fillStyle=a,e.textAlign="center",e.textBaseline="middle",l.includes(" ")?e.font=`${r}px '${l}'`:e.font=`${r}px ${l}`,e.fillText(t.text,i+s/2,n+o/2+r/8,s);}fill(t,e){const{background:i}=t.parsedPageNumberStyle;i&&""!==i&&(e.fillStyle=i,e.fill());}stroke(t,e){const{borderColor:i,borderWidth:n,borderStyle:s}=t.parsedPageNumberStyle;e.setLineDash(s),e.strokeStyle=i,e.lineWidth=n,n>0&&i&&""!==i&&e.stroke();}}class nx extends Qs{constructor(t,e){super(),i(this,"context",void 0),i(this,"docRenderer",void 0),i(this,"hooks",void 0),this.context=t,this.hooks=e,this.docRenderer=new tx;}dispose(){super.dispose(),this.context=null,this.docRenderer=null,this.hooks=null;}initRenderer(t,e,i){if(!this.docRenderer.isInitialized){Object.assign(t.style,this.context.viewerConfig.canvasStyle);const n=this.context.isDefaultViewer;this.docRenderer.initCanvas({container:t,width:e,height:i,limit1px:n}),this.docRenderer.registerShapeRenderer("checkbox",new ex),this.docRenderer.registerShapeRenderer("pageNumber",new ix);}}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const t=this.getCanvasDom();if(!t)return;t.getContext("2d").clearRect(0,0,t.width,t.height);}resize(t,e){this.docRenderer&&this.docRenderer.resize(t,e);}updateCanvasSize(){if(this.docRenderer){const t=this.getCanvasDom();if(!t)return;const{clientWidth:e,clientHeight:i}=t;this.docRenderer.resize(e,i);}}render(t){t.isDestroyed||(this.hooks.beforeRender.emit(t),this.docRenderer.render(t),this.hooks.afterRender.emit(t),t.pages.forEach(((t,e)=>{if(t.isVisible&&t.isLoaded){const i=qg.create(e,t.uid);this.context.emit("pageRendered",i);}})));}getCanvasPosition(){const t=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:e,scrollY:i}=window;return {x:t.left+e,y:t.top+i}}}function sx(t){const e=t.getPages(),i=e.length;if(!i)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);let{viewportWidth:n,viewportHeight:s}=t;const{rows:o,columns:r,scrollbarWidth:a,tab:l,isVertical:h}=t,d=t.getMargin();r*o<i&&(h?n-=a:s-=a);let c=0,u=0;h?(c=(n-(r+1)*d)/r,u=(s-(o+1)*d)/o):(u=(s-(o+1)*d)/o,c=(n-(r+1)*d)/r);let p=!1;(c<0||u<0)&&(p=!0,c=Math.max(0,c),u=Math.max(0,u));const g=h?Math.max(o,Math.ceil(i/r)):o,f=h?r:Math.max(r,Math.ceil(i/o)),y=c*f+(f+1)*d,m=u*g+(g+1)*d,v=l.pages.map((t=>({uid:t.uid,x:0,y:0,width:c,height:u}))),x=t.getParsedPageStyle(),w=t.getParsedSelectedPageStyle(),b=t.getParsedHoveredPageStyle(),C=t.getParsedPageNumberStyle(c,u),{visibility:S,top:P,bottom:A,onPage:T,height:k}=C;let D=c,E=u;const I=c;let R=u,M=0;const B="visible"===S,L=t.getPageNumberStyle();if(B){const t=""!==L.top?P:A||0;T||(E=u-k-t,R=u-k-t,M=""!==L.top?k+t:0);}E<0&&(p=!0,E=Math.max(0,E)),(D-2*x.borderWidth<0||E-2*x.borderWidth<0)&&(p=!0);const U=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=p?0:y+2*U,t.currentLayoutHeight=p?0:m+2*U,t.currentViewportWidth=p?t.viewportWidth:n,t.currentViewportHeight=p?t.viewportHeight:s,t.isOutOfBounds=p,p||(D=Bv(D),E=Bv(E),e.forEach(((e,i)=>{let n=x.borderWidth;e.isHovered&&(n=b.borderWidth),e.isSelected&&(n=w.borderWidth),n=Rv(n);const s=h?i%r:Math.floor(i/o),a=h?Math.floor(i/r):i%o,l=d+s*(d+c),p=d+a*(d+u);v[i].x=l,v[i].y=p;let g=D-2*n,f=E-2*n;g=Math.max(g,0),f=Math.max(f,0);const y=e.rWidth,m=e.rHeight;let C=y,S=m,P=1;(y>g||m>f)&&(y/m>g/f?(P=g/y,C=g,S=m*P):(P=f/m,S=f,C=y*P)),e.zoom=P;const A=Mv(l),T=Mv(p+M);let k=n+(g-C)/2,B=n+(f-S)/2;k=Mv(k),B=Mv(B);const L=Bv(y),U=Bv(m),O=y*(1-P)/2,N=m*(1-P)/2,_=e.cropWidth,W=e.cropHeight,F=k-O-(_-L)/2,H=B-N-(W-U)/2,V=k-O,z=B-N,j=L,$=U,G=k,X=B,Y=Bv(C),q=Bv(S);e.setPage(A,T,I,R),e.setBorderBox(0,0,D,E,n),e.setCropBox(F,H,_,W,P,e.rotation),e.setRealTimeBox(V,z,j,$,P);const{width:J,height:Z}=t.viewerContext.getPageRenderSize(e.uid);e.setMediaBox(-e.cropLeft,-e.cropTop,J,Z),e.setImage(0,0,J,Z),e.setCurBox(G,X,Y,q);})),t.placeholderPages=v);}function ox(t){const{tab:e}=t,i=e.getCurrentPage();if(!i)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);const{viewportWidth:n,viewportHeight:s,scrollbarWidth:o,fitMode:r}=t,a=t.getMargin(),l=t.getParsedPageStyle(),{borderWidth:h=0}=l,d=2*h,c=i.rWidth,u=i.rHeight,p=2*a,g=d+p,f=d+p,y=n-g,m=s-f;let{zoom:v}=t;const x=ax(r,{zoom:v,validLayoutWidth:c,validLayoutHeight:u,scrollbarWidth:o,fitViewportWidth:y,fitViewportHeight:m,isZoomChanged:t.isZoomChanged},rx);t.isZoomChanged=!1;const{zoomedLayoutWidth:w,zoomedLayoutHeight:b,zoomedViewportWidth:C,zoomedViewportHeight:S,newFitMode:P}=x;if(v=x.zoom,P&&r!==P){t.fitMode=P,t.viewerContext.viewerConfig.fitMode=P;const e=Gg.create(r,P);t.viewerContext.hooks.fitModeChanged.emit(e);}t.setZoom(v);const A=w+g,T=b+f,k=C+g,D=S+f,E=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=A+2*E,t.currentLayoutHeight=T+2*E,t.currentViewportWidth=k,t.currentViewportHeight=D,i.zoom=v,t.tab.setPosition({x:-0,y:-0});const I=e.pages.map((t=>{let{uid:e}=t;return {uid:e,x:a,y:a,width:w+d,height:b+d}}));t.placeholderPages=I;const R=Bv(w+d),M=Bv(b+d),B=Mv(a),L=B,U=Rv(h),O=U,N=Bv(c),_=Bv(u),W=c*(1-v)/2,F=u*(1-v)/2,H=i.cropWidth,V=i.cropHeight,z=U-W-(H-N)/2,j=O-F-(V-_)/2,$=U-W,G=O-F;i.setPage(B,L,R,M),i.setBorderBox(0,0,R,M),i.setCropBox(z,j,H,V,v,i.rotation),i.setRealTimeBox($,G,c,u,v);const{width:X,height:Y}=t.viewerContext.getPageRenderSize(i.uid);i.setMediaBox(-i.cropLeft,-i.cropTop,X,Y),i.setImage(0,0,X,Y);}function rx(t,e){let{zoom:i,validLayoutWidth:n,validLayoutHeight:s,scrollbarWidth:o,fitViewportWidth:r,fitViewportHeight:a}=e;return "none"===t||"actualSize"===t?("actualSize"===t&&(i=1),Math.floor(n*i)>r&&(a-=o),Math.floor(s*i)>a&&(r-=o)):"width"===t||"window"===t&&n/r>=s/a?(i=r/n,s*i>a&&(r-=o,i=r/n)):(i=a/s,n*i>r&&(a-=o,i=a/s)),{zoom:i,zoomedLayoutWidth:n*i,zoomedLayoutHeight:s*i,zoomedViewportWidth:r,zoomedViewportHeight:a}}function ax(t,e,i){const{zoom:n,isZoomChanged:s}=e;let o={};if(s){let s;const r=Vy(n);if(1===n)s="actualSize",o=i("actualSize",e);else {o=i("width",e);if(Vy(o.zoom)===r)s="width","window"===t&&(s="window");else {o=i("height",e);r===Vy(o.zoom)&&(s="height","window"===t&&(s="window"));}}s?o.newFitMode=s:(o=i("none",e),o.newFitMode="none");}else o=i(t,e);return o}function lx(t,e){let{zoom:i,fitWidth:n,fitHeight:s,validLayoutWidth:o,validLayoutHeight:r,scrollbarWidth:a,isVertical:l,fitViewportWidth:h,fitViewportHeight:d}=e;return "none"===t||"actualSize"===t?("actualSize"===t&&(i=1),Math.floor(o*i)>h&&(d-=a),Math.floor(r*i)>d&&(h-=a)):"width"===t||"window"===t&&n/h>=s/d?(i=h/n,l?r*i>d&&(h-=a,i=h/n):(o*i>h&&(d-=a),s*i>d&&(h-=a,i=h/n))):(i=d/s,l?(r*i>d&&(h-=a),n*i>h&&(d-=a,i=d/s)):o*i>h&&(d-=a,i=d/s)),{zoom:i,zoomedLayoutWidth:o*i,zoomedLayoutHeight:r*i,zoomedViewportWidth:h,zoomedViewportHeight:d}}const hx=t=>{const e=t.getPages();if(!e.length)return;const{tab:i}=t,n=i.current,s=e[n-1],o=e[n+1];s&&dx(t,s,-1),o&&dx(t,o,1);};function dx(t,e,i){const{viewportWidth:n,viewportHeight:s}=t,o=t.getParsedPageStyle(),{borderWidth:r=0}=o,a=t.getMargin(),{rWidth:l,rHeight:h}=e,d=n-2*a-2*r,c=s-2*a-2*r;let u=0,p=0,g=1;l/h>d/c?(u=d,g=d/l,p=h*g):(p=c,g=c/h,u=l*g);let f=(d-u)/2+a,y=(c-p)/2+a;f=Math.max(a,f),y=Math.max(a,y);const{x:m,y:v}=t.tab.getPosition();-1===i?(f=-n+f-m,y-=v):1===i&&(f=n+f-m,y-=v);const x=l*(1-g)/2,w=h*(1-g)/2,b=r,C=r,S=l,P=h,A=e.cropWidth,T=e.cropHeight,k=b-x-(A-S)/2,D=C-w-(T-P)/2,E="visible",I="hidden";e.updateStyle({visibility:E,x:f,y:y,width:u+2*r,height:p+2*r}),e.borderBox.updateStyle({x:0,y:0,width:u+2*r,height:p+2*r,...o,background:"#ffffff00",visibility:E}),e.cropBox.setLocalScale(1),e.cropBox.updateStyle({x:k,y:D,width:A,height:T}),e.cropBox.setLocalScale(g,g,1),e.cropBox.setLocalAngle(e.rotation);const{width:R,height:M}=t.viewerContext.getPageRenderSize(e.uid);e.mediaBox.updateStyle({x:-e.cropLeft,y:-e.cropTop,width:R,height:M}),e.zoom=g,e.checkbox.updateStyle({visibility:I}),e.pageNumber.updateStyle({visibility:I}),e.setImage(0,0,R,M);}function cx(t){const{displayMode:e}=t;"single"===e?ox(t):"continuous"===e?function(t){const e=t.getPages();if(!e.length)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);let{zoom:i}=t;const{viewportWidth:n,viewportHeight:s,tab:o,fitMode:r,scrollbarWidth:a,isVertical:l}=t,h=t.getParsedPageStyle(),{borderWidth:d}=h,c=2*d,u=t.getMargin(),{realRow:p,realColumn:g}=t.getRealRowAndColumnContinuous(),f=new Array(g).fill(0),y=new Array(p).fill(0);let m=0,v=0;e.forEach(((t,e)=>{const i=l?Math.floor(e/g):e%p,n=l?e%g:Math.floor(e/p),s=t.rWidth+c,o=t.rHeight+c;f[n]=Math.max(f[n],s),y[i]=Math.max(y[i],o),m=Math.max(f[n],m),v=Math.max(y[i],v);}));let x=f.reduce(((t,e)=>t+e),0),w=y.reduce(((t,e)=>t+e),0);const b=(g+1)*u,C=(p+1)*u,S=g*c+b,P=p*c+C;x+=b,w+=C;const A=x-S,T=w-P;let k=0,D=0,E=0,I=0;l?(k=n-S,D=s-2*u-c,E=f.reduce(((t,e)=>t+e-c),0),I=v-c):(k=n-2*u-c,D=s-P,E=m-c,I=y.reduce(((t,e)=>t+e-c),0));const R=ax(r,{zoom:i,fitWidth:E,fitHeight:I,validLayoutWidth:A,validLayoutHeight:T,scrollbarWidth:a,isVertical:l,fitViewportWidth:k,fitViewportHeight:D,isZoomChanged:t.isZoomChanged},lx);t.isZoomChanged=!1;const{zoomedLayoutWidth:M,zoomedLayoutHeight:B,zoomedViewportWidth:L,zoomedViewportHeight:U,newFitMode:O}=R;if(i=R.zoom,O&&r!==O){t.fitMode=O,t.viewerContext.viewerConfig.fitMode=O;const e=Gg.create(r,O);t.viewerContext.hooks.fitModeChanged.emit(e);}t.setZoom(i);const N=M+S,_=B+P;let W=0,F=0;l?(W=L+(g+1)*u+g*c,F=U+2*u+c):(W=L+2*u+c,F=U+(p+1)*u+p*c);const H=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=N+2*H,t.currentLayoutHeight=_+2*H,t.currentViewportWidth=W,t.currentViewportHeight=F,t.tab.setPosition({x:-0,y:-0});const V=o.pages.map((t=>({uid:t.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0})));e.forEach(((e,n)=>{const s=l?Math.floor(n/g):n%p,o=l?n%g:Math.floor(n/p),r=(f[o]-c)*i+c,a=(y[s]-c)*i+c,h=e.rWidth,m=e.rHeight;let v=0,x=0;if(0===o)v=u;else {const t=V[l?n-1:(o-1)*p+s];v=t.x+t.width+u;}if(0===s)x=u;else {const t=V[l?(s-1)*g+o:n-1];x=t.y+t.height+u;}const w=V[n];w.width=r,w.height=a,w.x=v,w.y=x,e.zoom=i;const b=h*i,C=m*i,S=x+(a-C)/2-d,P=Mv(v+(r-b)/2-d),A=Mv(S);w.pageX=P,w.pageY=A;let T=b+c,k=C+c;T=Bv(T),k=Bv(k);const D=Mv(d),E=D,I=Bv(h),R=Bv(m),M=h*(1-i)/2,B=m*(1-i)/2,L=D,U=D,O=Bv(b),N=Bv(C),_=e.cropWidth,W=e.cropHeight,F=D-M-(_-I)/2,H=E-B-(W-R)/2,z=D-M,j=E-B;e.setPage(P,A,T,k),e.setBorderBox(0,0,T,k),e.setCropBox(F,H,_,W,i,e.rotation),e.setRealTimeBox(z,j,h,m,i);const{width:$,height:G}=t.viewerContext.getPageRenderSize(e.uid);e.setMediaBox(-e.cropLeft,-e.cropTop,$,G),e.setImage(e.mediaBoxRect.left,e.mediaBoxRect.top,$,G),e.setCurBox(L,U,O,N);})),t.placeholderPages=V;}(t):"slide"===e&&hx(t);}class ux{constructor(t,e){i(this,"context",void 0),i(this,"hooks",void 0),this.context=t,this.hooks=e;}layout(t){if(t.isDestroyed||!t.isActive)return;let e;if(this.context.isDefaultViewer)e=cx;else if(this.context.isThumbnailViewer)e=sx;else if(this.context.isPerspectiveViewer){const{displayMode:i}=t.context;"single"===i?e=ox:"slide"===i&&(e=hx);}e&&(this.hooks.beforeLayout.emit(t),e(t.context),this.hooks.afterLayout.emit(t));}}const px=["viewerMode","displayMode","toolMode","annotationMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows","margin"];class gx extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"handlers",{}),this.context=t;}dispose(){this.context=null,this.handlers={},super.dispose();}updateConfig(t){for(const[e,i]of Object.entries(t))px.includes(e)&&this[e](i);}registerHandler(t,e){return !this[t]&&(this[t]=e,!0)}viewerMode(t){const{context:e}=this;e.viewerConfig.viewerMode=t,eg.CAPTURE;}toolMode(t){const{context:e}=this,i=e.viewerConfig.toolMode;t!==i&&(e.viewerConfig.toolMode=t,e.hooks.toolModeChanged.emit(sf.create(i,t)));}annotationMode(t){const{context:e}=this,i=e.viewerConfig.annotationMode;t!==i&&(e.viewerConfig.annotationMode=t),e.hooks.annotationModeChanged.emit(hf.create(i,t));}fitMode(t){const{context:e}=this,i=e.getActiveTab();if(!i){const i=e.viewerConfig.fitMode;if(i===t)return;return e.viewerConfig.fitMode=t,void e.hooks.fitModeChanged.emit(Gg.create(i,t))}const n=i.context.fitMode;n!==t&&(i.context.fitMode=t,"none"!==t&&(e.showTab(i,!0),e.hooks.fitModeChanged.emit(Gg.create(n,t))));}displayMode(t){const{context:e}=this,i=e.getActiveTab();let n;if(i){if(n=i.context.displayMode,t===n)return;i.context.displayMode=t,e.showTab(i,!0);}else {if(n=e.viewerConfig.displayMode,t===n)return;e.viewerConfig.displayMode=t;}if("slide"!==n&&"slide"!==t){const i=jg.create(n,t);e.viewer.hooks.displayModeChanged.emit(i);}}margin(t){const{context:e}=this;e.viewerConfig.margin!==t&&(e.viewerConfig.margin=t,e.showCurrentTab(!0));}rows(t){const{context:e}=this,i=e.getActiveTab();i?t!==i.context.rows&&(e.styleService.isCheckboxStyleChanged=!0,e.styleService.isPageNumberStyleChanged=!0,i.context.rows=t,this.context.showTab(i,!0)):e.viewerConfig.rows=t;}columns(t){const{context:e}=this,i=e.getActiveTab();i?t!==i.context.columns&&(e.styleService.isCheckboxStyleChanged=!0,e.styleService.isPageNumberStyleChanged=!0,i.context.columns=t,this.context.showTab(i,!0)):e.viewerConfig.columns=t;}maxColumns(t){t=Math.max(1,t);const{context:e}=this;e.viewerConfig.maxColumns=t;const i=e.getActiveTab();i&&i.context.columns>t&&this.columns(t);}maxRows(t){t=Math.max(1,t);const{context:e}=this;e.viewerConfig.maxRows=t;const i=e.getActiveTab();i&&i.context.rows>t&&this.rows(t);}zoom(t){const{context:e}=this;e.getActiveTab()&&e.zoomTo(t);}visibility(t){const{context:e}=this;if(t===e.viewerConfig.visibility)return;const{rootDom:i,defaultDom:n,thumbnailContainer:s}=e.viewService;if(!i)return;const{ui:o}=e.viewer,r=!s&&o.container.classList.contains("ddv-thumbnail-container"),a=e.viewerConfig.visibility;e.viewerConfig.visibility=t,"visible"===t?(i.style.display="flex",n.style.display="flex",r?(o.container.style.display="flex",e.core.viewerService.onResize.emit()):e.core.viewerService.onResize.emit()):(i.style.display="none",r&&(o.container.style.display="none",e.core.viewerService.onResize.emit()));const l=Sf.create(t,a);e.hooks.visibleChanged.emit(l);}zoomOrigin(t){const{context:e}=this;e.viewerConfig.zoomOrigin=t;}minZoom(t){const{context:e}=this;e.viewerConfig.minZoom=t;}maxZoom(t){const{context:e}=this;e.viewerConfig.maxZoom=t;}multiselectMode(t){const{context:e}=this;e.viewerConfig.multiselectMode=t;}canvasStyle(t){const{context:e}=this;if(Hn(t))if(Object.assign(e.viewerConfig.canvasStyle,t),e.isCaptureViewer){var i;const n=null===(i=e.viewer)||void 0===i||null===(i=i.cameraContext)||void 0===i?void 0:i.cameraContainer;n&&Object.assign(n.style,t);}else {const{canvasContainer:i}=e.viewService,n=e.rendererService.getCanvasDom();i&&(Object.assign(i.style,t),t.cursor&&n&&Object.assign(n.style,{cursor:t.cursor}),e.styleService.isCanvasStyleChanged=!0,t.border&&e.resize(),t.cursor&&e.hooks.canvasCursorStyleChanged.emit());}}pageStyle(t){const{context:e}=this;Hn(t)&&(Object.assign(e.viewerConfig.pageStyle,t),e.styleService.isPageStyleChanged=!0,e.showCurrentTab(!0));}selectedPageStyle(t){const{context:e}=this;Hn(t)&&(Object.assign(e.viewerConfig.selectedPageStyle,t),e.styleService.isSelectedPageStyleChanged=!0,e.showCurrentTab(!0));}hoveredPageStyle(t){const{context:e}=this;Hn(t)&&(Object.assign(e.viewerConfig.hoveredPageStyle,t),e.styleService.isHoveredPageStyleChanged=!0,e.showCurrentTab(!0));}placeholderStyle(t){const{context:e}=this;Hn&&(Object.assign(e.viewerConfig.placeholderStyle,t),e.styleService.isPlaceholderStyleChanged=!0,e.showCurrentTab());}currentPageStyle(t){const{context:e}=this;Hn&&(Object.assign(e.viewerConfig.currentPageStyle,t),e.styleService.isCurrentPageStyleChanged=!0,e.showCurrentTab());}pageNumberStyle(t){const{context:e}=this;if(Hn(t)){const{pageNumberStyle:i}=e.viewerConfig,n=(null==t?void 0:t.onPage)!==(null==i?void 0:i.onPage);Object.assign(i,t),e.styleService.isPageNumberStyleChanged=!0,e.showCurrentTab(n);}}checkboxStyle(t){const{context:e}=this;Hn(t)&&(Object.assign(e.viewerConfig.checkboxStyle,t),e.styleService.isCheckboxStyleChanged=!0,e.showCurrentTab());}quadSelectionStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:e}=this;Hn(t)&&(Object.assign(e.viewerConfig.quadSelectionStyle,t),e.styleService.isQuadSelectionStyleChanged=!0,e.hooks.quadSelectionStyleChanged.emit(),e.showCurrentTab());}scrollDirection(t){const{context:e}=this;e.viewerConfig.scrollDirection=t;const i=e.getActiveTab();i&&(i.context.direction=t,e.resize());}}class fx extends Qs{constructor(t){super(),i(this,"context",void 0),this.context=t;}dispose(){super.dispose(),this.context=null;}handleExternalEvents(){const{context:t}=this,{hooks:e}=this.context;e.pageChanged.on((t=>{const i=this.context.getActiveTab();let n;!i||0===i.total||-1===i.current&&-1!==i.oldCurrent?n=0:-1!==i.current&&-1===i.oldCurrent&&(n=t.total),zn(n)||e.pageExistenceChanged.emit(Nf.create(n));})),e.pageChangedAfterRender.on((i=>{const n=this.context.getActiveTab();if(!n)return;const{current:s,oldCurrent:o,currentUid:r,oldCurrentUid:a}=n;if(o!==s){const e=zg.create(o,s);t.emit("currentIndexChanged",e);}if(a!==r){const n=af.create(a||"",r||"");t.emit("currentPageChanged",n),e.currentPageChanged.emit(i);}})),e.displayModeChanged.on((e=>{t.emit("displayModeChanged",{...e});})),e.fitModeChanged.on((e=>{t.emit("fitModeChanged",{...e});})),e.toolModeChanged.on((e=>{t.emit("toolModeChanged",{...e});})),e.zoomChanged.on((t=>{t.oldZoomRatio!==t.newZoomRatio&&this.context.viewer.emit("zoomChanged",{...t});}));const i=this.context.rendererService.getCanvasDom();this.context.isCaptureViewer||(to(i,"click",this).on((e=>{const i=this.formatEvent(e);t.emit("click",i);})),to(i,"dblclick",this).on((e=>{const i=this.formatEvent(e);t.emit("dblclick",i);})),to(document.body,"dblclick",this).on((t=>{})),to(i,"contextmenu",this).on((e=>{e.preventDefault();const i=this.formatEvent(e);t.emit("rightclick",i);}))),t.viewerConfig.enableLoadSourceByDrag&&!this.context.isCaptureViewer&&(to(i,"dragenter",this).on((t=>{t.preventDefault();})),to(i,"dragleave",this).on((t=>{t.preventDefault();})),to(i,"drop",this).on((t=>{var e;t.preventDefault();const i=null===(e=t.dataTransfer)||void 0===e?void 0:e.files;if(!i)return;const n=i.length,s=[];for(let t=0;t<n;t++){const e=new Blob([i[t]],{type:i[t].type});if("application/pdf"===i[t].type){const t=xp.annotationLicenseModuleIsExist();s.push({fileData:e,convertMode:exports.EnumConvertMode.CM_AUTO,renderOptions:{renderAnnotations:t?exports.EnumAnnotationRenderMode.LOAD_ANNOTATIONS:exports.EnumAnnotationRenderMode.NO_ANNOTATIONS}});}else s.push({fileData:e});}this.context.loadSource(s);})),to(i,"dragover",this).on((t=>{t.preventDefault();})));}formatEvent(t){var e,i;const[n]=this.context.toCanvas(t),s=this.context.getPointerOverPageInfo(n.pageX,n.pageY),o=Do.displayResolution,r=Do.dataResolution,{pointerX:a,pointerY:l}=s.imageInfo;return of.create(s.index,null!==(e=null===(i=s.pageInfo.page)||void 0===i?void 0:i.uid)&&void 0!==e?e:"",a<0?-1:Js(Ys(a,o,r),2),l<0?-1:Js(Ys(l,o,r),2),Math.floor(n.pageX),Math.floor(n.pageY),t)}}class yx extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"offsetX",0),i(this,"offsetY",0),i(this,"startX",0),i(this,"startY",0),i(this,"isDragging",!1),i(this,"startPage",void 0),i(this,"newIndexes",void 0),i(this,"cacheChildren",void 0),i(this,"cacheSelectedIndexes",void 0),i(this,"isMousedown",!1),i(this,"starDragIndices",[]),this.context=t;}dispose(){super.dispose(),this.context=null;}startHandler(t){const{context:e}=this,{viewerConfig:i,styleService:n}=e;if("pan"!==i.toolMode)return;if(e.isLoadSource)return;const s=e.getActiveTab();if(null==s||!s.total)return;this.isMousedown=!0;const[o]=e.toCanvas(t),{page:r}=e.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(r&&r){this.startX=o.pageX,this.startY=o.pageY;const t=r.getPosition();this.offsetX=o.pageX-t.x,this.offsetY=o.pageY-t.y,this.startPage=r,this.cacheChildren=s.pages.slice();}}moveHandler(t){const{context:e}=this,i=e.getActiveTab();if(!i||!e.isThumbnailViewer)return;const[n]=e.toCanvas(t),s=e.getPointerOverPageInfo(n.pageX,n.pageY),{page:o}=s.pageInfo;if(this.isDragging){var r,a,l;if(o&&!o.isSelected){const t=i.selected.map((t=>i.uidToIndex(t))).sort(((t,e)=>t-e)),n=t[0],s=i.getPageIndex(o),r=i.pages.slice();t.slice().reverse().forEach((t=>{r.splice(t,1);}));let a=r.indexOf(o);s>n&&(a+=1),this.cacheSelectedIndexes.forEach(((t,e)=>{const n=i.getPageByUid(t.uid);r.splice(a+e,0,n);})),this.newIndexes=r.map((t=>i.getPageIndex(t))),i.reorderPages(this.newIndexes,!1),e.layoutService.layout(i),e.visibilityService.handleVisibility(i);}const t=e.styleService.getParsedPlaceholderStyle(),s=devicePixelRatio;let h=n.pageX-this.offsetX,d=n.pageY-this.offsetY;h=Math.round(h*s)/s,d=Math.round(d*s)/s,i.selected.forEach((e=>{const n=i.getPageByUid(e);n.isDragging=!0,n.updateStyle({...t}),n.borderBox.updateStyle({visibility:"hidden"});})),null===(r=this.startPage)||void 0===r||r.updateStyle({zIndex:1}),null===(a=this.startPage)||void 0===a||a.borderBox.updateStyle({visibility:"visible"}),null===(l=this.startPage)||void 0===l||l.borderBox.setPosition({x:h,y:d}),e.loadVisiblePages(i),e.rendererService.render(i);}else if(o&&o===this.startPage&&o.isSelected){if(((n.pageX-this.startX)**2+(n.pageY-this.startY)**2)**.5>=e.viewerConfig.dragThreshold&&this.startPage&&e.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=i.selected.map((t=>({uid:t,index:i.uidToIndex(t)}))).sort(((t,e)=>t.index-e.index));const t=i.uidsToIndices(i.selected);this.starDragIndices=[...t],e.viewer.emit("pagesDragged",Xg.create(t,[...i.selected]));}}}endHandler(t){var e;if(!this.isMousedown)return;const{context:i}=this,n=i.getActiveTab();if(n){if(this.isDragging){if(this.newIndexes){const t=n.pages.map((t=>this.cacheChildren.indexOf(t)));n.childNodes=this.cacheChildren,i.viewer.reorderPages(t),this.newIndexes=null;}n.selected.forEach((t=>{const e=n.getPageByUid(t);e.borderBox.setLocalPosition({x:0,y:0}),e.isDragging=!1,e.borderBox.updateStyle({visibility:"visible"});}));const t=n.uidsToIndices(n.selected);i.viewer.emit("pagesDropped",Yg.create(this.starDragIndices,t,[...n.selected]));}null===(e=this.startPage)||void 0===e||e.updateStyle({zIndex:0}),this.isDragging&&(i.scrollByCurrentChanged=!0,i.layoutService.layout(n),i.visibilityService.handleVisibility(n),i.rendererService.render(n)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1;}}}class mx extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"isStart",!1),i(this,"startX",void 0),i(this,"startY",void 0),i(this,"lastX",void 0),i(this,"lastY",void 0),i(this,"startTime",void 0),i(this,"startScrollLeft",void 0),i(this,"startScrollTop",void 0),i(this,"isScrolling",void 0),i(this,"scrollTimer",void 0),i(this,"scrollDirectionX","left"),i(this,"scrollDirectionY","top"),i(this,"canvasElX",void 0),i(this,"canvasElY",void 0),this.context=t,this.isScrolling=!1;}startHandler(t){const{context:e}=this;if(e.isPanning||e.isZooming)return;const i=e.getActiveTab();if(null==i||!i.total)return;const n=e.toCanvas(t);if(n.length>1)return;this.canvasElX=t.screenX,this.canvasElY=t.screenY;const{pageX:s,pageY:o}=n[0];this.isStart=!0,this.startX=s,this.startY=o,this.lastX=s,this.lastY=o,this.startTime=(new Date).getTime();const{scrollLeft:r,scrollTop:a}=i.context;this.startScrollLeft=r,this.startScrollTop=a,this.isScrolling=!1,this.scrollTimer&&(ps.clearTimer(this.scrollTimer),this.scrollTimer=null);}moveHandler(t){if(!this.isStart)return;t instanceof PointerEvent&&t.cancelable&&t.preventDefault();const{context:e}=this;if(e.isZooming)return;const i=e.toCanvas(t);if(i.length>1)return;const n=e.getActiveTab(),{maxScrollLeft:s,maxScrollTop:o}=n.context;let{scrollLeft:r,scrollTop:a}=n.context;if(!s&&!o)return;const{viewerConfig:l}=e,{panThreshold:h,enablePanX:d,enablePanY:c}=l,{pageX:u,pageY:p}=i[0],g=u-this.startX,f=p-this.startY,y=u-this.lastX,m=p-this.lastY;if(e.isPanning){if(!r&&!a&&y>=0&&m>=0)return;if(r===s&&a===o&&y<=0&&m<=0)return;d&&(r=this.startScrollLeft-g),c&&(a=this.startScrollTop-f),r=Qn(r,0,s),a=Qn(a,0,o),e.viewService.scrollTo(r,a);}else e.isPanning=d&&Math.abs(g)>=h||c&&Math.abs(f)>=h;this.lastX=u,this.lastY=p;}endHandler(t){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:e}=this,i=e.toCanvas(t,!0);if(i.length>1)return;if(e.isZooming)return;if("mouse"===t.pointerType)return;if(this.canvasElX===t.screenX&&this.canvasElY===t.screenY)return;const{scrollLeft:n,scrollTop:s}=this.context.viewService.getMaxScrollValue(),{scrollLeft:o,scrollTop:r}=this.context.viewService.scrollContainer;if(!this.isScrolling&&(n>0||s>0)){const t=(new Date).getTime(),e=i[0].pageX,a=i[0].pageY,l=e-this.startX,h=a-this.startY;let d=!1,c=!1;l>0?(d=0!==o,this.scrollDirectionX="right"):(d=o!==n,this.scrollDirectionX="left"),h>0?(c=0!==r,this.scrollDirectionY="bottom"):(c=r!==s,this.scrollDirectionY="top");const u=t-this.startTime;if((Math.abs(l)>10||Math.abs(h)>10)&&u>0&&u<300&&(d||c)){let t=Math.abs(l)/u,e=Math.abs(h)/u;(t>.4||e>.4)&&(t=Math.min(t,2.8),e=Math.min(e,2.8),this.scroll(t,e,-.05));}}}scroll(t,e,i){this.isScrolling=!0;const{scrollLeft:n,scrollTop:s}=this.context.viewService.scrollContainer;let o=0,r=0;this.scrollTimer=ps.createTimer((()=>{const{scrollLeft:a,scrollTop:l}=this.context.viewService.getMaxScrollValue();if(t<=0&&e<=0||!1===this.isScrolling)return ps.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);t>=0&&("right"===this.scrollDirectionX?o-=40*t:o+=40*t,t+=i),e>=0&&("bottom"===this.scrollDirectionY?r-=40*e:r+=40*e,e+=i);const h=Qn(n+o,0,a),d=Qn(s+r,0,l);this.context.viewService.scrollTo(h,d);}),25);}}class vx extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"scrollTimer",void 0),this.context=t;}scrollHandler(t){const{context:e}=this;if(e.scrollByCurrentChanged)return void(e.scrollByCurrentChanged=!1);const i=e.getActiveTab();if(null==i||!i.total)return;const{scrollLeft:n,scrollTop:s}=t.target;i.context.setTabScrollValue(n,s),e.visibilityService.handleVisibility(i),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout((()=>{if(!e.isDestroyed&&i.isActive){if(e.isDefaultViewer){if(i.context.updateReference(),i.context.isContinuousDisplay&&e.viewerConfig.autoChangeIndex){const t=i.context.getCurrentByScroll();null!==t&&(i.gotoPage(t),e.visibilityService.handleVisibility(i),e.emitPageChangedEvent(i),e.emitPageChangedAfterRenderEvent(i),e.core.viewerService.onCurrentChangedByScroll.emit(If.create(i.uid,e.groupUid,e.uid,t)));}e.loadVisiblePages(i);}else e.isThumbnailViewer&&e.loadVisiblePages(i);this.scrollTimer=null;}}),42),e.rendererService.render(i),e.hooks.scroll.emit();}wheelHandler(t){if(!Bs(t)&&!Ls(t))return;const{context:e}=this,i=e.getActiveTab(),{maxScrollLeft:n,maxScrollTop:s,scrollLeft:o,scrollTop:r}=i.context;let{wheelDelta:a}=t;t.deltaY&&(a=-t.deltaY),1===t.deltaMode?a*=16:2===t.deltaMode&&(a=a<0?-100:100),t.shiftKey&&n?(a>0&&0!==o||a<0&&o!==n)&&(t.cancelable&&t.preventDefault(),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(-a,0)):s&&(a<0&&r!==s||a>0&&0!==r)&&(t.cancelable&&t.preventDefault(),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-a));}}class xx extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"wheelTimer",void 0),i(this,"isStart",void 0),i(this,"isZooming",void 0),i(this,"startDistance",void 0),i(this,"touchZoomTimer",void 0),i(this,"startZoom",void 0),this.context=t,this.isZooming=!1,this.isStart=!1,this.startZoom=1;}zoomTo(t,e,i){var n;t=Vy(t);const{context:s}=this;if(!s.isDefaultViewer)return;const o=s.getActiveTab();if(null==o||!o.total)return;const{viewerConfig:r}=s;if((t=Qn(t,r.minZoom,r.maxZoom))===r.zoom)return;Jn(e)&&Jn(i)||({originX:e,originY:i}=o.context.getZoomOriginCord());const a=null===(n=o.context.placeholderPages)||void 0===n?void 0:n.length;let l;a&&(l=o.context.generateReference(e,i));const h=o.context.zoom;if(o.context.setZoom(t),r.zoom=t,o.context.isZoomChanged=!0,a){s.layoutService.layout(o),s.viewService.updateScrollerContentSize(o),s.rendererService.updateCanvasSize();const{scrollLeft:t,scrollTop:n}=o.context.parseReferenceZoom(l,e,i);o.context.setTabScrollValue(t,n),s.viewService.scrollTo(t,n),s.visibilityService.handleVisibility(o),s.loadVisiblePages(o),s.clearCurrentTabOptimization(),s.rendererService.render(o);}o.context.oldZoom=h,s.emitZoomChangedEvent(o);}wheelHandler(t){const{viewerConfig:e}=this.context;if(e.enableZoom&&e.enableZoomWithCtrl&&Ms(t)){let{wheelDelta:i}=t;t.deltaY&&(i=-t.deltaY),t.cancelable&&t.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout((()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const n=e.wheelZoomFactor||1,s=i>0?n:1/n,{x:o,y:r}=this.context.rendererService.getCanvasPosition();this.zoomTo(e.zoom*s,t.pageX-o,t.pageY-r);}),40));}}touchstartHandler(t){const{context:e}=this,i=e.getActiveTab(),{displayMode:n}=i.context,s="continuous"===n||"single"===n;if(!e.viewerConfig.enableZoom||!s)return;const o=e.toCanvas(t);o.length<2||(e.isZooming=!0,this.startZoom=i.context.zoom,this.startDistance=wx(o),this.isStart=!0);}touchmoveHandler(t){if(!this.isStart)return;t.cancelable&&t.preventDefault();const{context:e}=this,i=e.toCanvas(t);if(i.length<2)return;const n=(i[0].pageX+i[1].pageX)/2,s=(i[0].pageY+i[1].pageY)/2;let o=wx(i)/this.startDistance;t.scale&&(o=t.scale);const r=e.getActiveTab();let{zoom:a}=r.context;const l=a;a=this.startZoom*o,a!==l&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout((()=>{this.zoomTo(a,n,s),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null;}),25))),e.isZooming=!0;}touchendHandler(t){this.isStart&&(this.isStart=!1,this.startZoom=1,this.context.isZooming=!1);}tapZoomHandler(t){const{toolMode:e,enableZoom:i,tapZoomFactor:n}=this.context.viewerConfig;if(!i)return;const s="zoomIn"===e,o="zoomOut"===e;if(!s&&!o)return;const r=this.context.toCanvas(t);if(r.length>1)return;const a=(r[0].pageX+r[1].pageX)/2,l=(r[0].pageY+r[1].pageY)/2,h=this.context.getActiveTab();let{zoom:d}=h.context;s?d*=n||1:o&&(d/=n||1),this.zoomTo(d,a,l);}}function wx(t){return ((t[0].pageX-t[1].pageX)**2+(t[0].pageY-t[1].pageY)**2)**.5}class bx extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"isStart",!1),i(this,"startX",void 0),i(this,"isSliding",void 0),i(this,"slideDistance",void 0),i(this,"slideDirection",void 0),i(this,"slideRAF",void 0),i(this,"tabX",void 0),i(this,"tabY",void 0),this.context=t,this.isSliding=!1;}startHandler(t){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;const{scrollLeft:i,scrollTop:n}=this.context.viewService.getMaxScrollValue();if(i||n)return;const s=this.context.toCanvas(t);if(s.length>1)return;const o=e.getPosition();this.tabX=o.x,this.tabY=o.y,this.startX=s[0].pageX,this.isStart=!0;}moveHandler(t){if(!this.isStart)return;const{context:e}=this,i=e.getActiveTab(),n=e.toCanvas(t)[0].pageX-this.startX;if(n>0?this.slideDirection="right":n<0&&(this.slideDirection="left"),this.slideDistance=Math.min(i.context.viewportWidth,Math.abs(n)),this.isSliding)"right"===this.slideDirection?i.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&i.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),e.render();else if("single"===i.context.displayMode&&"pan"===e.viewerConfig.toolMode&&e.viewerConfig.enableSlide){const{scrollLeft:t,scrollTop:i}=this.context.viewService.getMaxScrollValue();Math.abs(n)>e.viewerConfig.startSlideThreshold&&!t&&!i&&(this.isSliding=!0,this.context.isSliding=!0,e.configService.updateConfig({displayMode:"slide"}));}}endHandler(t){if(!this.isStart)return;const{context:e}=this;this.context.toCanvas(t,!0);const i=e.getActiveTab(),{displayMode:n}=i.context;"slide"===n&&this.slide(i),this.isStart=!1;}slide(t){let e,i=0,n=0,s=0,o=!1;const{viewerConfig:r}=this.context,a=t.context.viewportWidth*r.slideThresholdForPerspective;this.slideDistance>=Math.max(a,r.startSlideThreshold)?(n=t.context.viewportWidth,e=n-this.slideDistance,"left"===this.slideDirection?t.current!==t.total-1?(s=-this.slideDistance,i=-e/6):(n=0,e=this.slideDistance,o=!0,s=-this.slideDistance,i=e/6):0!==t.current?(s=this.slideDistance,i=e/6):(n=0,e=this.slideDistance,o=!0,s=this.slideDistance,i=-e/6)):(o=!0,n=0,e=this.slideDistance,"left"===this.slideDirection?(s=-this.slideDistance,i=e/6):(s=this.slideDistance,i=-e/6));const l=()=>{s+=i;const e=s>=0;if(Math.abs(s)>=n&&(s=n,e||(s*=-1)),t.setPosition({x:s+this.tabX,y:this.tabY,z:0}),Math.abs(s)===n)return o||("right"===this.slideDirection?this.context.viewer.gotoPage(t.current-1):this.context.viewer.gotoPage(t.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(l),this.context.render();};this.slideRAF=requestAnimationFrame(l);}}class Cx extends Qs{constructor(t){super(),i(this,"context",void 0),this.context=t;}handleOptimizationEvents(){this.context.hooks.afterRender.on((t=>{this.optimizeTab(t);}));}dispose(){super.dispose(),this.context=null;}optimizeTab(t){this.context.viewerConfig.enableOptimizePage&&t.pages.forEach(((t,e)=>{!qn()&&!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&setTimeout((()=>{!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&this.optimizePage(t.uid);}),500);}));}cancelOptimization(t){this.context.core.optimizationService.cancel(t);}optimizePage(t){if(!this.context)return;const{context:e}=this,{viewerConfig:i}=e;if(!i.enableOptimizePage)return;const n=e.getActiveTab();if(!n)return;const s=n.getPageByUid(t);if(!s)return;if(s.isOptimized||!s.isVisible||!s.isLoaded||s.optimizationUid===s.optimizedUid||e.isSliding||e.isDestroyed)return;const o=e.core.pageService.getPage(t);if(null==o||!o.display.img)return;const{img:r}=s.image.style;if(!r)return;const{naturalWidth:a,naturalHeight:l}=r;let h=a,d=l;const{maxOptimizationSize:c}=i;if(h>c||d>c||s.rWidth>c||s.rHeight>c)return;let u=0,p=0,g=0,f=0,y=0;({rWidth:h,rHeight:d,cropLeft:u,cropTop:p,cropWidth:g,cropHeight:f,rotation:y}=o.getEditResultForPixel());const m=Ys(o.mediaBox.left,Do.displayResolution,o.resource.resolutionX),v=Ys(o.mediaBox.top,Do.displayResolution,o.resource.resolutionX),x=new Ma({style:{x:-u+m,y:-p+v,img:r,width:a,height:l}});let w="rgba(0,0,0,0)";if(i.enableFillColor)w=i.blankFillColor;else if(i.viewerMode===eg.THUMBNAIL){let t=i.pageStyle;s.isSelected?t=i.selectedPageStyle:s.isHovered&&(t=i.hoveredPageStyle),w=t.background;}const b=new Fa({style:{x:-(g-h)/2,y:-(f-d)/2,width:g,height:f,background:w}});b.appendChild(x),b.setLocalAngle(y);const{commonCanvas:C}=e.core;C.render(b,h,d),C.reset();const S=C.getCanvas(),P=devicePixelRatio,A=Math.floor(s.realTimeBox.width*P+.5)||1,T=Math.floor(s.realTimeBox.height*P+.5)||1;s.isOptimized=!0,e.core.optimizationService.optimize(S,h,d,A,T,s.optimizationUid).then((t=>{if(!e.isDestroyed&&t.taskUid===s.optimizationUid){s.isOptimized=!0,s.optimizedUid=s.optimizationUid;const i=S.getContext("2d",{willReadFrequently:!0}).createImageData(A,T);i.data.set(t.target),s.realTimeBox.imageData=i,s.image.updateStyle({visibility:"hidden"}),s.isVisible&&e.render();}})).catch((t=>{s.isOptimized=!1;}));}}class Sx extends Qs{constructor(t,e,n,s,o,r){super(),i(this,"context",void 0),i(this,"panModeInteraction",void 0),i(this,"cropModeInteraction",void 0),i(this,"annotationModeInteraction",void 0),i(this,"zoomInModeInteraction",void 0),i(this,"zoomOutModeInteraction",void 0),this.context=t,this.panModeInteraction=e,this.cropModeInteraction=n,this.annotationModeInteraction=s,this.zoomInModeInteraction=o,this.zoomOutModeInteraction=r;}handleEvents(){if(this.context.isCaptureViewer)return;const t=this.context.rendererService.getCanvasDom();to(t,"pointerdown",this).on((t=>{if(this.context.isPointerWorking=!0,0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointerdownHandler(t),this.cropModeInteraction.pointerdownHandler(t),this.annotationModeInteraction.pointerdownHandler(t),this.zoomInModeInteraction.startHandler(t),this.zoomOutModeInteraction.startHandler(t));})),to(t,"pointermove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointermoveHandler(t,!1),this.cropModeInteraction.pointermoveHandler(t),this.annotationModeInteraction.cursorHandler(t));}),{passive:!1}),to(t,"pointerup",this).on((t=>{if(this.context.isPointerWorking=!1,0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&this.panModeInteraction.pointerupHandler(t);})),to(document,"pointerdown",this).on((t=>{this.context.isPointerWorking=!0;})),to(document,"pointermove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointermoveHandler(t,!0),this.annotationModeInteraction.pointermoveHandler(t));}),{passive:!1}),to(document,"pointerup",this).on((t=>{if(this.context.isPointerWorking=!1,0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointerupHandler(t),this.cropModeInteraction.pointerupHandler(t),this.annotationModeInteraction.pointerupHandler(t),this.zoomInModeInteraction.endHandler(t),this.zoomOutModeInteraction.endHandler(t));})),to(t,"touchstart",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.touchstartHandler(t),this.cropModeInteraction.touchstartHandler(t));}),{passive:!1}),to(t,"touchmove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(t.cancelable&&t.preventDefault(),this.panModeInteraction.touchmoveHandler(t),this.cropModeInteraction.touchmoveHandler(t));}),{passive:!1}),to(t,"touchend",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.touchendHandler(t),this.cropModeInteraction.touchendHandler(t));})),to(t,"wheel",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.wheelHandler(t),this.cropModeInteraction.wheelHandler(t),this.annotationModeInteraction.wheelHandler(t));}),{passive:!1}),to(this.context.viewService.scrollContainer,"scroll",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.scrollHandler(t),this.cropModeInteraction.scrollHandler(t),this.annotationModeInteraction.scrollHandler(t));})),to(document,"keydown",this).on((t=>{if(!this.context.isFocusCanvas||!this.context.viewerConfig.enableKeyboardInteraction)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.keydownHandler(t),this.cropModeInteraction.keydownHandler(t),this.annotationModeInteraction.keydownHandler(t),this.zoomInModeInteraction.keydownHandler(t),this.zoomOutModeInteraction.keydownHandler(t));})),to(document,"keyup",this).on((t=>{if(!this.context.isFocusCanvas||!this.context.viewerConfig.enableKeyboardInteraction)return;this.context.getActiveTab()&&(this.panModeInteraction.keyupHandler(t),this.annotationModeInteraction.keyupHandler(t));})),to(document,"click",this).on((t=>{var e;if(this.context.isDestroyed)return;if("hidden"===this.context.viewerConfig.visibility)return;if(t.target instanceof HTMLInputElement)return void(this.context.isFocusCanvas=!1);if(this.context.viewerConfig.hasThb&&this.context.viewService.thumbnailContainer.contains(t.target))return void(this.context.isFocusCanvas=!1);let i=!(null===(e=this.context.viewService.rootDom)||void 0===e||!e.contains(t.target));i||document.body.contains(t.target)||!this.context.isDefaultViewer||(i=!0),this.context.isFocusCanvas=i;}));}}class Px extends Qs{constructor(t){super(),i(this,"context",void 0),i(this,"isPointerdown",!1),i(this,"startPage",void 0),i(this,"mouseOverPage",void 0),this.context=t;}startHandler(t){const{context:e}=this,{viewerConfig:i,styleService:n}=e,s=this.context.getActiveTab();if(null==s||!s.total)return;this.isPointerdown=!0;const[o]=e.toCanvas(t),{page:r}=e.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(!r)return;if(this.startPage=r,!Ls(t)&&!Bs(t))return;const a=s.getPageIndex(r),l=s.getCurrentPage(),h=t.shiftKey&&i.enableSelectWithShift;if(h&&s.selected.length){if(h&&l!==r&&s.shiftReference){const t=s.uidToIndex(s.shiftReference),i=Math.min(a,t),o=Math.max(a,t),l=[];for(let t=i;t<=o;t++)l.push(t);if(e.viewerConfig.enableOptimizePage){n.isSelectedBorderWidthEqualHovered()||e.clearOptimization([r.uid]),n.isSelectedBorderWidthEqualNormal()||l.forEach((t=>{const o=s.getPageByIndex(i+t);!o||s.selected.includes(o.uid)||o.uid===r.uid||n.isSelectedBorderWidthEqualNormal()||e.clearOptimization([o.uid]);}));const t=s.indicesToUids(l);n.isSelectedBorderWidthEqualNormal()||s.selected.forEach((i=>{if(!t.includes(i)){const t=s.getPageByUid(i);t&&e.clearOptimization([t.uid]);}}));}a<t&&l.reverse();const{shiftReference:h}=s;e.viewer.gotoPage(a),s.shiftReference=h,e.viewer.selectPagesByIndices(l);}}else i.multiselectMode||(r.uid!==s.currentUid?e.viewer.gotoPage(a):s.shiftReference=r.uid,r.isSelected||(e.viewerConfig.enableOptimizePage&&(n.isSelectedBorderWidthEqualNormal()||s.selected.forEach((t=>{const i=s.getPageByUid(t);i&&e.clearOptimization([i.uid]);})),n.isSelectedBorderWidthEqualHovered()||e.clearOptimization([r.uid])),e.viewer.selectPagesByIndices([a])));}moveHandler(t){const{context:e}=this,{styleService:i}=e,n=e.getActiveTab();if(null==n||!n.total)return;const[s]=e.toCanvas(t),o=e.getPointerOverPageInfo(s.pageX,s.pageY),{page:r}=o.pageInfo,{mouseOverPage:a}=this;e.viewerConfig.enableOptimizePage&&!i.isBorderWidthEqualHovered()&&(a&&!a.isSelected&&(r&&a===r||e.clearOptimization([a.uid])),r&&!r.isSelected&&(a&&a===r||e.clearOptimization([r.uid]))),this.mouseOverPage=r;let l=!1;"mouse"===t.pointerType&&n.pages.forEach((t=>{r&&r.uid===t.uid?(t.isHovered||(l=!0),t.isHovered=!0):(t.isHovered&&(l=!0),t.isHovered=!1);})),l&&(e.layoutService.layout(n),e.visibilityService.handleVisibility(n),e.rendererService.render(n));}endHandler(t){if(!this.isPointerdown)return;const{context:e}=this,{styleService:i}=e,[n]=e.toCanvas(t,!0),s=e.getActiveTab();if(null==s||!s.total)return;const o=e.getPointerOverPageInfo(n.pageX,n.pageY).pageInfo.page;if(o&&o===this.startPage)if(Ms(t)&&e.viewerConfig.enableSelectWithCtrl||e.viewerConfig.multiselectMode){const t=s.selected.slice(),n=t.indexOf(o.uid);o.isSelected?t.splice(n,1):t.push(o.uid);const r=s.uidsToIndices(t);if(o.uid!==s.currentUid){const t=s.uidToIndex(o.uid);e.viewer.gotoPage(t);}!i.isSelectedBorderWidthEqualHovered()&&e.viewerConfig.enableOptimizePage&&e.clearOptimization([o.uid]),e.viewer.selectPagesByIndices(r);}else if(!Us(t)){const t=s.getPageIndex(o);o.uid!==s.currentUid&&e.viewer.gotoPage(t),e.viewerConfig.enableOptimizePage&&(i.isSelectedBorderWidthEqualNormal()||s.selected.forEach((t=>{const i=s.getPageByUid(t);i&&e.clearOptimization([i.uid]);})),i.isSelectedBorderWidthEqualHovered()||e.clearOptimization([o.uid])),e.viewer.selectPagesByIndices([t]);}this.isPointerdown=!1,this.startPage=null;}keydownHandler(t){}}class Ax extends Qs{constructor(t){super(),i(this,"context",void 0),this.context=t;}selectAllHandler(t){this.context.viewerConfig.enableSelectAllWithKeyboard&&Ms(t)&&this.context.isThumbnailViewer&&(t.preventDefault(),this.context.viewer.selectAllPages());}undoHandler(t){this.context.viewerConfig.enableUndoWithKeyboard&&Ms(t)&&(t.preventDefault(),this.context.viewer.undo());}redoHandler(t){this.context.viewerConfig.enableRedoWithKeyboard&&Ms(t)&&(t.preventDefault(),this.context.viewer.redo());}zoomInHandler(t){this.context.viewerConfig.enableZoomInWithKeyboard&&Ms(t)&&(t.preventDefault(),this.context.viewer.zoomIn());}zoomOutHandler(t){this.context.viewerConfig.enableZoomOutWithKeyboard&&Ms(t)&&(t.preventDefault(),this.context.viewer.zoomOut());}arrowLeftHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollLeft:n,currentViewportWidth:s,scrollLeft:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Ls(t)?0!==i.current&&e.viewer.gotoPage(i.current-1):Bs(t)&&(n?0===o?0!==i.current&&e.viewer.gotoPage(i.current-1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(-r,0)):0!==i.current&&e.viewer.gotoPage(i.current-1));else if(e.isThumbnailViewer){if(Us(t))return;0!==i.current&&e.viewer.gotoPage(i.current-1);}}arrowRightHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollLeft:n,currentViewportWidth:s,scrollLeft:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Ls(t)?i.current!==i.total-1&&e.viewer.gotoPage(i.current+1):Bs(t)&&(n?o===n?i.current!==i.total-1&&e.viewer.gotoPage(i.current+1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(r,0)):i.current!==i.total-1&&e.viewer.gotoPage(i.current+1));else if(e.isThumbnailViewer){if(Us(t))return;i.current!==i.total-1&&e.viewer.gotoPage(i.current+1);}}arrowUpHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Ls(t)&&(n?0===o?0!==i.current&&e.viewer.gotoPage(i.current-1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-r)):0!==i.current&&e.viewer.gotoPage(i.current-1));else if(e.isThumbnailViewer){if(Us(t))return;const{rows:n,columns:s}=i.context,{current:o}=i,r=Math.floor(o/s),a=o%s;0===r?0!==i.current&&e.viewer.gotoPage(i.current-1):e.viewer.gotoPage(s*(r-1)+a);}}arrowDownHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Ls(t)&&(n?o===n?i.current!==i.total-1&&e.viewer.gotoPage(i.current+1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,r)):i.current!==i.total-1&&e.viewer.gotoPage(i.current+1));else if(e.isThumbnailViewer){if(Us(t))return;const{rows:n,columns:s}=i.context,{current:o}=i,r=Math.floor(o/s),a=o%s;if(r===(i.total-1)/s)0!==i.current&&e.viewer.gotoPage(i.current+1);else {const t=Math.min(i.total-1,s*(r+1)+a);e.viewer.gotoPage(t);}}}escapeHandler(t){Us(t)||t.preventDefault();}enterHandler(t){Us(t)||t.preventDefault();}pageUpHandler(t){if(Us(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o,scrollLeft:r}=i.context;t.preventDefault(),e.isDefaultViewer&&(n&&0!==o&&(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-s)),"single"===i.context.displayMode?n&&0!==o?(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-s)):0!==i.current&&(e.viewer.gotoPage(i.current-1),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(r-i.context.scrollLeft,n)):"continuous"===i.context.displayMode&&n&&0!==o&&(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-s)));}pageDownHandler(t){if(Us(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o,scrollLeft:r}=i.context;t.preventDefault(),e.isDefaultViewer&&("single"===i.context.displayMode?n&&o!==n?(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,s)):i.current!==i.total-1&&(e.viewer.gotoPage(i.current+1),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(r-i.context.scrollLeft,0)):"continuous"===i.context.displayMode&&n&&o!==n&&(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,s)));}homeHandler(t){if(Us(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,scrollTop:s}=i.context;t.preventDefault(),e.isDefaultViewer?n&&0!==s&&(e.scrollByCurrentChanged=!1,e.viewService.scrollTo(0,0)):e.isThumbnailViewer&&0!==i.current&&e.viewer.gotoPage(0);}endHandler(t){if(Us(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,scrollTop:s}=i.context;t.preventDefault(),e.isDefaultViewer?n&&s!==n&&(e.scrollByCurrentChanged=!1,e.viewService.scrollTo(0,n)):e.isThumbnailViewer&&i.current!==i.total-1&&e.viewer.gotoPage(i.total-1);}}class Tx{constructor(t){i(this,"context",void 0),i(this,"isEditAnnotation",!1),i(this,"isMove",!1),i(this,"isSlide",!1),i(this,"isActivateAnnotation",!1),i(this,"isTouchstart",!1),i(this,"isPointerdown",!1),i(this,"isFirstMove",!0),i(this,"isPointerOnAnnotation",!1),i(this,"isAnnotationActive",!1),i(this,"activeShape",void 0),i(this,"pointerNum",0),i(this,"startPoint",void 0),i(this,"dragTimer",void 0),i(this,"isDragPages",!1),i(this,"isMoveForThumbnail",!1),i(this,"isMoved",!1),i(this,"canScroll",!0),i(this,"startX",void 0),i(this,"startY",void 0),this.context=t;}get isPanMode(){return "pan"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(this.isPointerdown||!this.isPanMode)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;if("slide"===e.context.displayMode)return;const{isDefaultViewer:i,isThumbnailViewer:n,viewService:s,hasAnnotationModule:o,annotationEditService:r,selectPagesService:a,moveService:l,dragService:h,slideService:d,viewerConfig:{dragStartTimeThreshold:c,enableSlide:u,enableDragPage:p}}=this.context,{displayMode:g}=e.context;if(this.isPointerdown=!0,this.isFirstMove=!0,i){const{scrollLeft:e,scrollTop:i}=s.getMaxScrollValue();if(o){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;if(this.startPoint={x:e.pageX,y:e.pageY},i){let{x:t,y:e}=i.cropBox.getPosition(),{width:n,height:s}=i.cropBox;const o=(i.rotation%360+360)%360/90;if(1===o?t-=s:2===o?(t-=n,e-=s):3===o&&(e-=n),1===o||3===o){const t=n;n=s,s=t;}r.setAnnotationContainer(i),r.setAnnotationInteractionArea({x:t,y:e,width:n,height:s});}const{isHit:n,shape:s,isHitSelected:o}=this.context.annotationEditService.isHitAnnotation(t);n&&i?(this.activeShape=s,this.isPointerOnAnnotation=!0,"touch"===t.pointerType||"pen"===t.pointerType?o?(this.isAnnotationActive=!0,this.isEditAnnotation=!0,r.startHandler(t,!1)):(this.isActivateAnnotation=!0,r.deactivateAnnotation()):"mouse"===t.pointerType&&(this.isAnnotationActive=!0,this.isEditAnnotation=!0,r.startHandler(t,!0)),r.hasActiveAnnotation()&&(this.canScroll=!1)):r.deactivateAnnotation();}this.isPointerOnAnnotation||(e||i?(this.isMove=!0,this.isSlide=!1,l.startHandler(t)):"single"===g&&u&&(this.isMove=!1,this.isSlide=!0,d.startHandler(t)));}else if(n){a.startHandler(t);const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;i&&!Ms(t)?(this.startX=t.pageX,this.startY=t.pageY,"touch"===t.pointerType||"pen"===t.pointerType?p?this.dragTimer=setTimeout((()=>{this.isMoveForThumbnail||(this.isDragPages=!0,h.startHandler(t));}),c):(this.isMoveForThumbnail=!0,l.startHandler(t)):"mouse"===t.pointerType&&(p?(this.isDragPages=!0,h.startHandler(t)):(this.isMoveForThumbnail=!0,l.startHandler(t)))):(this.isMoveForThumbnail=!0,l.startHandler(t));}}pointermoveHandler(t,e){if(this.pointerNum>1)return;const i=this.context.getActiveTab();if(null==i||!i.total)return;const{isDefaultViewer:n,isThumbnailViewer:s,viewService:o,moveService:r,slideService:a,annotationEditService:l,dragService:h,selectPagesService:d}=this.context,{displayMode:c}=i.context;if(n&&!e&&this.isPointerdown){const[e]=this.context.toCanvas(t),i=cs(this.startPoint,{x:e.pageX,y:e.pageY});if(this.isPointerOnAnnotation&&!this.isAnnotationActive&&this.isFirstMove){i>1&&(this.isActivateAnnotation=!1);const{scrollLeft:e,scrollTop:n}=o.getMaxScrollValue();e||n?(this.isMove=!0,this.isSlide=!1,r.startHandler(t)):"single"===c&&(this.isMove=!1,this.isSlide=!0,a.startHandler(t));}if(this.isEditAnnotation){const{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;l.moveHandler(t,!i);}else this.isMove&&i>2?(this.isActivateAnnotation=!1,r.moveHandler(t)):this.isSlide&&i>10&&(this.isActivateAnnotation=!1,a.moveHandler(t));this.isFirstMove=!1;}else if(s&&e)if(d.moveHandler(t),"touch"===t.pointerType){const e=cs({x:this.startX,y:this.startY},{x:t.pageX,y:t.pageY});this.isPointerdown&&this.dragTimer&&(this.isDragPages||r.startHandler(t),e>5&&(clearTimeout(this.dragTimer),this.dragTimer=null)),this.isDragPages?(this.isMoved=!0,h.moveHandler(t)):!this.isDragPages&&this.isPointerdown&&(e>5&&(this.isMoveForThumbnail=!0,r.moveHandler(t)),this.isMoved=!0);}else this.isPointerdown&&this.dragTimer&&(this.isDragPages||r.startHandler(t),clearTimeout(this.dragTimer),this.dragTimer=null),this.isDragPages?(this.isMoved=!0,h.moveHandler(t)):!this.isDragPages&&this.isPointerdown&&(this.isMoveForThumbnail=!0,r.moveHandler(t),this.isMoved=!0);}pointerupHandler(t){if(!this.isPointerdown)return;const{isDefaultViewer:e,isThumbnailViewer:i,annotationEditService:n,moveService:s,slideService:o,dragService:r,selectPagesService:a}=this.context;if(e)this.isEditAnnotation?n.endHandler(t):this.isActivateAnnotation?(n.activateAnnotation(this.activeShape,Ms(t)),this.context.render()):this.isMove?s.endHandler(t):this.isSlide&&o.endHandler(t);else if(i){this.dragTimer&&(clearTimeout(this.dragTimer),this.dragTimer=null);const e=cs({x:this.startX,y:this.startY},{x:t.pageX,y:t.pageY});(!this.isMoved||e<10)&&a.endHandler(t),this.isDragPages?r.endHandler(t):s.endHandler(t);}this.isPointerdown=!1,this.isFirstMove=!0,this.isEditAnnotation=!1,this.isMove=!1,this.isSlide=!1,this.isActivateAnnotation=!1,this.isPointerOnAnnotation=!1,this.isAnnotationActive=!1,this.activeShape=null,this.isMoveForThumbnail=!1,this.isDragPages=!1,this.isMoved=!1,this.canScroll=!0,this.startPoint=null;}touchstartHandler(t){if(this.pointerNum=t.targetTouches.length,this.context.isDefaultViewer){const{enableZoom:e,enableZoomInPanMode:i,enableZoomWithTouch:n}=this.context.viewerConfig;if(!this.isPanMode||2!==t.targetTouches.length||this.isTouchstart||!e||!n||!i)return;this.isTouchstart=!0,this.context.zoomService.touchstartHandler(t);}}touchmoveHandler(t){this.pointerNum=t.targetTouches.length,2===t.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(t);}touchendHandler(t){this.pointerNum=t.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(t));}wheelHandler(t){if(this.pointerNum=0,!this.isPanMode)return;if(!this.canScroll)return void t.preventDefault();const{isDefaultViewer:e,isThumbnailViewer:i,viewerConfig:{enableZoom:n,enableZoomInPanMode:s,enableZoomWithCtrl:o},zoomService:r,scrollService:a}=this.context;if(e)if(Ms(t)){if(!n||!s||!o)return;r.wheelHandler(t);}else a.wheelHandler(t);else i&&a.wheelHandler(t);}scrollHandler(t){this.isPanMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(t);}keydownHandler(t){if(!this.isPanMode)return;const{context:e,context:{keyboardService:i,annotationEditService:n,viewerConfig:{enableKeyboardInteraction:s,enableZoom:o,enableZoomInPanMode:r,enableCopyCutPasteWithKeyboard:a},isPointerWorking:l}}=this;if(s&&!l)if(e.isDefaultViewer){if(this.context.annotationEditService.hasActiveAnnotation()){if(Ms(t))switch(t.key){case"c":case"C":a&&n.copyAnnotations();break;case"x":case"X":a&&n.cutAnnotations();break;case"v":case"V":a&&n.pasteAnnotations();break;case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t);}else if(Bs(t)||Ls(t)){const e=this.context.annotationEditService.containerPage;if(e){let{x:t,y:i}=e.cropBox.getPosition(),{width:s,height:o}=e.cropBox;const r=(e.rotation%360+360)%360/90;if(1===r?t-=o:2===r?(t-=s,i-=o):3===r&&(i-=s),1===r||3===r){const t=s;s=o,o=t;}n.setAnnotationContainer(e),n.setAnnotationInteractionArea({x:t,y:i,width:s,height:o});}n.keydownHandler(t);}return}switch(t.key){case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"v":case"V":a&&n.pasteAnnotations();break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t);break;case"Escape":i.escapeHandler(t);break;case"Enter":i.enterHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t);}}else if(e.isThumbnailViewer)switch(t.key){case"a":case"A":i.selectAllHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t);}}keyupHandler(t){if(!this.isPanMode)return;const{context:e,context:{annotationEditService:i,viewerConfig:{enableKeyboardInteraction:n}}}=this;n&&e.isDefaultViewer&&i.keyupHandler(t);}}class kx{constructor(t){i(this,"context",void 0),i(this,"isEditCropBox",!1),i(this,"isPerspectiveQuad",!1),i(this,"isTouchstart",!1),i(this,"isPointerdown",!1),i(this,"pointerNum",0),this.context=t;}get isCropMode(){return "crop"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(this.isPointerdown||!this.isCropMode)return;this.isPointerdown=!0;const{context:e}=this;e.hasBoxRendererModule?e.isDefaultViewer?(this.isEditCropBox=e.cropBoxEditService.isEditCropBox(t),this.isEditCropBox?e.cropBoxEditService.startHandler(t):e.moveService.startHandler(t)):e.isPerspectiveViewer&&(this.isPerspectiveQuad=!0,e.perspectiveQuadEditService.startHandler(t)):e.isDefaultViewer&&e.moveService.startHandler(t);}pointermoveHandler(t){if(this.pointerNum>1)return;const{context:e}=this;e.isDefaultViewer?(e.cropBoxEditService.moveHandler(t),!this.isEditCropBox&&this.isPointerdown&&e.moveService.moveHandler(t)):e.isPerspectiveViewer&&e.perspectiveQuadEditService.moveHandler(t);}pointerupHandler(t){if(!this.isPointerdown)return;const{context:e}=this;e.isDefaultViewer?this.isEditCropBox?e.cropBoxEditService.endHandler(t):e.moveService.endHandler(t):e.isPerspectiveViewer&&this.isPerspectiveQuad&&e.perspectiveQuadEditService.endHandler(t),this.isPointerdown=!1,this.isEditCropBox=!1,this.isPerspectiveQuad=!1;}touchstartHandler(t){this.pointerNum=t.targetTouches.length;const{context:e,context:{viewerConfig:i}}=this;if(e.isDefaultViewer){if(!this.isCropMode||2!==t.targetTouches.length||this.isTouchstart||!i.enableZoom||!i.enableZoomWithTouch||!i.enableZoomInCropMode)return;this.isTouchstart=!0,e.zoomService.touchstartHandler(t);}}touchmoveHandler(t){this.pointerNum=t.targetTouches.length,2===t.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(t);}touchendHandler(t){this.pointerNum=t.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(t));}wheelHandler(t){if(this.pointerNum=0,!this.isCropMode)return;const{context:e,context:{viewerConfig:i}}=this;if(e.isDefaultViewer)if(Ms(t)){if(!i.enableZoom||!i.enableZoomInCropMode||!i.enableZoomWithCtrl)return;e.zoomService.wheelHandler(t);}else e.isPointerWorking||e.scrollService.wheelHandler(t);}scrollHandler(t){if(!this.isCropMode)return;const{context:e}=this;(e.isDefaultViewer||e.isThumbnailViewer)&&e.scrollService.scrollHandler(t);}keydownHandler(t){if(!this.isCropMode)return;const{keyboardService:e,isDefaultViewer:i,viewerConfig:{enableKeyboardInteraction:n,enableZoom:s,enableZoomInCropMode:o},isPointerWorking:r}=this.context;if(i&&n&&!r)switch(t.key){case"y":case"Y":e.redoHandler(t);break;case"z":case"Z":e.undoHandler(t);break;case"-":s&&o&&e.zoomOutHandler(t);break;case"=":s&&o&&e.zoomInHandler(t);break;case"Escape":e.escapeHandler(t);break;case"Enter":e.enterHandler(t);break;case"PageUp":e.pageUpHandler(t);break;case"PageDown":e.pageDownHandler(t);break;case"Home":e.homeHandler(t);break;case"End":e.endHandler(t);break;case"ArrowLeft":e.arrowLeftHandler(t);break;case"ArrowRight":e.arrowRightHandler(t);break;case"ArrowUp":e.arrowUpHandler(t);break;case"ArrowDown":e.arrowDownHandler(t);}}}class Dx{constructor(t){i(this,"context",void 0),i(this,"isPointerdown",!1),i(this,"pointerId",null),i(this,"canScroll",!0),this.context=t;}get isAnnotationMode(){return "annotation"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(!this.isPointerdown&&this.isAnnotationMode&&!this.pointerId&&(this.pointerId=t.pointerId,this.context.hasBoxRendererModule&&this.context.isDefaultViewer)){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;if(i){let{x:t,y:e}=i.cropBox.getPosition(),{width:n,height:s}=i.cropBox;const o=360,r=(i.rotation%o+o)%o/90;if(1===r?t-=s:2===r?(t-=n,e-=s):3===r&&(e-=n),1===r||3===r){const t=n;n=s,s=t;}this.context.annotationEditService.setAnnotationContainer(i),this.context.annotationEditService.setAnnotationInteractionArea({x:t,y:e,width:n,height:s});}this.isPointerdown=!0,this.context.annotationEditService.startHandler(t,!0),this.context.annotationEditService.hasActiveAnnotation()&&(this.canScroll=!1);}}pointermoveHandler(t){if((this.pointerId===t.pointerId||"touch"!==t.pointerType)&&this.context.isDefaultViewer){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;this.context.annotationEditService.moveHandler(t,!i);}}cursorHandler(t){if("mouse"===(null==t?void 0:t.pointerType)&&this.context.isDefaultViewer){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;"crop"!==this.context.viewerConfig.toolMode&&this.context.annotationEditService.cursorHandler(t,!i,this.context.viewerConfig.canvasStyle.cursor);}}pointerupHandler(t){this.isPointerdown&&(this.context.isDefaultViewer&&this.context.annotationEditService.endHandler(t),this.isPointerdown=!1,this.canScroll=!0,this.pointerId=null);}wheelHandler(t){if(this.isAnnotationMode)if(this.canScroll){if(this.context.isDefaultViewer)if(Ms(t)){const{enableZoom:e,enableZoomInAnnotationMode:i,enableZoomWithCtrl:n}=this.context.viewerConfig;if(!(this.isAnnotationMode&&e&&i&&n))return;this.context.zoomService.wheelHandler(t);}else this.context.scrollService.wheelHandler(t);}else t.preventDefault();}scrollHandler(t){this.isAnnotationMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(t);}keydownHandler(t){if(!this.isAnnotationMode)return;const{context:e,context:{keyboardService:i,annotationEditService:n,viewerConfig:{enableKeyboardInteraction:s,enableZoom:o,enableZoomInAnnotationMode:r,enableCopyCutPasteWithKeyboard:a},hasAnnotationModule:l,isPointerWorking:h}}=this;if(s&&!h&&e.isDefaultViewer)if(this.context.annotationEditService.hasActiveAnnotation()){if(Ms(t))switch(t.key){case"c":case"C":a&&n.copyAnnotations();break;case"x":case"X":a&&n.cutAnnotations();break;case"v":case"V":a&&n.pasteAnnotations();break;case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t);}else if(Bs(t)||Ls(t)){const e=this.context.annotationEditService.containerPage;if(e){let{x:t,y:i}=e.cropBox.getPosition(),{width:s,height:o}=e.cropBox;const r=(e.rotation%360+360)%360/90;if(1===r?t-=o:2===r?(t-=s,i-=o):3===r&&(i-=s),1===r||3===r){const t=s;s=o,o=t;}n.setAnnotationContainer(e),n.setAnnotationInteractionArea({x:t,y:i,width:s,height:o});}n.keydownHandler(t);}}else switch(t.key){case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"v":case"V":a&&n.pasteAnnotations();break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t);break;case"Escape":i.escapeHandler(t);break;case"Enter":i.enterHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t);}}keyupHandler(t){if(!this.isAnnotationMode)return;const{context:e,context:{annotationEditService:i,viewerConfig:{enableKeyboardInteraction:n}}}=this;n&&e.isDefaultViewer&&i.keyupHandler(t);}}class Ex{constructor(t){i(this,"context",void 0),i(this,"isPointerdown",!1),this.context=t;}get isZoomInMode(){return "zoomIn"===this.context.viewerConfig.toolMode}startHandler(t){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(t),this.isPointerdown=!0);}endHandler(t){this.isPointerdown&&(this.isPointerdown=!1);}keydownHandler(t){if(!this.isZoomInMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:e}}=this;if(!e.enableKeyboardInteraction||!e.enableZoom||!e.enableZoomInWithKeyboard||this.context.isPointerWorking)return;const{keyboardService:i}=this.context;switch(t.key){case"-":i.zoomInHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t);}}}class Ix{constructor(t){i(this,"context",void 0),i(this,"isPointerdown",!1),this.context=t;}get isZoomOutMode(){return "zoomOut"===this.context.viewerConfig.toolMode}startHandler(t){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(t),this.isPointerdown=!0);}endHandler(t){this.isPointerdown&&(this.isPointerdown=!1);}keydownHandler(t){if(!this.isZoomOutMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:e}}=this;if(!e.enableKeyboardInteraction||!e.enableZoom||!e.enableZoomOutWithKeyboard||this.context.isPointerWorking)return;const{keyboardService:i}=this.context;switch(t.key){case"=":i.zoomOutHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t);}}}class Rx extends Qs{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),i(this,"core",void 0),i(this,"viewer",void 0),i(this,"uid",void 0),i(this,"groupUid",void 0),i(this,"hooks",void 0),i(this,"viewService",void 0),i(this,"rendererService",void 0),i(this,"tabService",void 0),i(this,"layoutService",void 0),i(this,"styleService",void 0),i(this,"configService",void 0),i(this,"visibilityService",void 0),i(this,"annotationEditService",void 0),i(this,"cropBoxEditService",void 0),i(this,"perspectiveQuadEditService",void 0),i(this,"eventsService",void 0),i(this,"dragService",void 0),i(this,"moveService",void 0),i(this,"scrollService",void 0),i(this,"zoomService",void 0),i(this,"slideService",void 0),i(this,"optimizationService",void 0),i(this,"interactionService",void 0),i(this,"selectPagesService",void 0),i(this,"keyboardService",void 0),i(this,"viewerConfig",Vn(Sv)),i(this,"postfix",void 0),i(this,"isDestroyed",!1),i(this,"viewportWidth",0),i(this,"viewportHeight",0),i(this,"scrollByCurrentChanged",!1),i(this,"isInitialized",!1),i(this,"addPagesTimer",null),i(this,"isPanning",void 0),i(this,"isZooming",void 0),i(this,"isSliding",void 0),i(this,"isLoadSource",!1),i(this,"isFocusCanvas",!1),i(this,"isFocusViewer",!1),i(this,"hasBoxRendererModule",!1),i(this,"hasAnnotationModule",!1),this.core=t,this.viewer=e,this.postfix=e.postfix,this.hooks=e.hooks,this.uid=e.uid,this.groupUid=e.groupUid,js(n,this.viewerConfig),this.styleService=new _v(this),this.viewService=this.register(new Kv(this,this.hooks)),this.rendererService=this.register(new nx(this,this.hooks)),this.layoutService=new ux(this,this.hooks),this.configService=this.register(new gx(this)),this.tabService=this.register(new Nv(this)),this.visibilityService=new $v(this),this.optimizationService=this.register(new Cx(this)),this.handleViewerModeChanged(),this.eventsService=this.register(new fx(this)),this.dragService=this.register(new yx(this)),this.moveService=this.register(new mx(this)),this.scrollService=this.register(new vx(this)),this.zoomService=this.register(new xx(this)),this.slideService=this.register(new bx(this)),this.interactionService=this.register(new Sx(this,new Tx(this),new kx(this),new Dx(this),new Ex(this),new Ix(this))),this.selectPagesService=this.register(new Px(this)),this.keyboardService=this.register(new Ax(this)),this.eventsService.handleExternalEvents(),this.optimizationService.handleOptimizationEvents(),this.interactionService.handleEvents();}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var t;return "visible"===(null===(t=this.viewerConfig)||void 0===t?void 0:t.visibility)}syncViewer(t){const e=t.getActiveTab();if(!e)return;const i=this.tabService.createTab(e.doc);if(i.isDocType){const{width:t,height:e}=this.viewService.getViewportSize();i.updateViewportSize(t,e);}i.currentUid=e.currentUid,i.selectPages([...e.selected]),this.tabService.activateTab(i.uid),this.hooks.syncDocument.emit(i.doc),this.emitPageChangedEvent(i),this.showTab(i),this.emitPageChangedAfterRenderEvent(i);}toCanvas(t){const e=[];let i=null;i=t instanceof MouseEvent||t instanceof PointerEvent?[t]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t.changedTouches:t.touches;const{x:n,y:s}=this.rendererService.getCanvasPosition();for(let t=0;t<i.length;t++){const o=i[t];e.push({pageX:o.pageX-n,pageY:o.pageY-s});}return e}getPointerOverPageInfo(t,e){const i=function(t,e,i){const n={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(t)for(let s=0;s<t.pages.length;s++){const o=t.pages[s],r=Gv(o,e,i,o.isVisible);if(r.isOver){n.index=s,Object.assign(n.pageInfo,r);const t=Gv(o.image,e,i,!0);return t.isOver&&Object.assign(n.imageInfo,t),n}}return n}(this.getActiveTab(),t,e);return i}resize(){if(this.tabService.resizeScrollbar(),this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const t=this.getActiveTab();t&&(this.clearCurrentTabOptimization(),this.showTab(t,!0));}updateViewportSize(){const{width:t,height:e}=this.viewService.getViewportSize();this.viewportWidth=t,this.viewportHeight=e,this.tabService.updateViewportSize(t,e);}handleViewerModeChanged(){const{postfix:t,viewService:e,isDefaultViewer:i,isPerspectiveViewer:n,isThumbnailViewer:s}=this;if(i||n||s){e.createMainAndThbContainer(t),e.createMainContainer(t),s||e.createThumbnailContainer(t),i&&(e.createVideoContainer(t),e.createAudioContainer(t)),Hy(e.mainAndThbContainer,"flex");const{width:n,height:o}=e.getViewportSize();this.rendererService.initRenderer(e.canvasContainer,n,o),this.rendererService.updateCanvasSize();}}loadSource(t){const e=this.getActiveTab();let i=null==e?void 0:e.uid;if(!e){const t=this.core.createDocument({name:jf(),type:"document"});this.viewer.openDocument(t),i=t.uid;}const n=wu.buildInfo("loadSource",{docUid:i,current:0,total:Fn(t)?t.length:1});return wu.info(n),this.core.loadSource(t,i,{exception:"ignore"},n)}openDocument(t){const{tabService:e}=this;let i=e.getTab(t.uid);if(!i){const n=e.getActiveTab();if(n&&this.hooks.closeDocument.emit(n.doc),i=e.createTab(t),i.isDocType){const{width:t,height:e}=this.viewService.getViewportSize();i.updateViewportSize(t,e);}}i.isActive||(this.tabService.activateTab(i.uid),this.emitPageChangedEvent(i),this.showTab(i),this.hooks.openDocument.emit(t),this.emitPageChangedAfterRenderEvent(i));}closeTabs(t){const e=t.filter((t=>this.tabService.hasTab(t)));if(!e.length)return;const i=e.reduce(((t,e,i)=>{const n=this.tabService.getTab(e);return n&&t.push(n),t}),[]);i.forEach((t=>{t.isActive&&this.clearCurrentTabOptimization(),this.tabService.closeTab(t.uid),this.hooks.closeDocument.emit(t.doc);}));const n=this.tabService.getActiveTab();n?this.showTab(n):(this.rendererService.docRenderer.clear(),this.resetCanvas(),this.hooks.pageChanged.emit(Cf.create(-1,0)));}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas());}render(){if("hidden"===this.viewerConfig.visibility)return;if(this.isDestroyed)return;const t=this.getActiveTab();t&&this.rendererService.render(t);}showCurrentTab(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this.getActiveTab();null!=e&&e.total&&this.showTab(e,t);}showTab(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDestroyed||t.isDestroyed||(this.tabService.activateTab(t.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(t,e):this.isThumbnailViewer?this.showTabThumbnail(t,e):this.isPerspectiveViewer&&this.showTabPerspective(t)));}showTabDefault(t){const e=t;if(!e.isDocType)return;e.style.visibility="visible";const i=e.context.zoom;this.layoutService.layout(e),this.viewerConfig.zoom=e.context.zoom;const n=e.context.zoom!==i;if(this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);const{scrollLeft:s,scrollTop:o}=e.context.parseReferenceDefault();e.context.setTabScrollValue(s,o),this.viewService.scrollTo(s,o),this.visibilityService.handleVisibility(e),this.loadVisiblePages(e),n&&this.clearCurrentTabOptimization(),this.rendererService.render(e),this.emitZoomChangedEvent(e);}showTabPerspective(t){const e=t;if(!e.isDocType)return;if(e.style.visibility="visible",this.layoutService.layout(e),this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);const{scrollLeft:i,scrollTop:n}=e.context.parseReferenceDefault();e.context.setTabScrollValue(i,n),this.viewService.scrollTo(i,n),this.visibilityService.handleVisibility(e),this.loadVisiblePages(e),this.rendererService.render(e);}showTabThumbnail(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t.isDocType)return;if(t.style.visibility="visible",this.layoutService.layout(t),this.viewService.updateScrollerContentSize(t),this.rendererService.updateCanvasSize(),!t.total)return void this.rendererService.render(t);if(t.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:e,scrollTop:i}=t.context.getScrollValuesByCurrentChanged();t.context.setTabScrollValue(e,i);}const{scrollLeft:i,scrollTop:n}=t.context;this.viewService.scrollTo(i,n),this.visibilityService.handleVisibility(t),this.loadVisiblePages(t),e&&this.clearCurrentTabOptimization(),this.rendererService.render(t);}loadPageImage(t){return this.isDefaultViewer||this.isThumbnailViewer?this.core.imageLoadService.loadDisplayImage(t):this.isPerspectiveViewer?this.core.imageLoadService.loadRawImage(t):null}loadVisiblePages(t){if(t.isDestroyed||null==t||!t.total)return;const e=[],i=[],n=t.getCurrentPage();let s=!1;t.pages.forEach((t=>{!t.isPreload||t.isLoaded||t.isLoading||(t.uid===(null==n?void 0:n.uid)?s=!0:t.isVisible?i.push(t):t.isPreload&&e.push(t));}));const o=[];s&&o.push(n),o.push(...e.reverse(),...i.reverse()),o.forEach((e=>{!e.isPreload||e.isLoaded||e.isLoading||(e.isLoading=!0,this.loadPageImage(e.uid).then((i=>{e.isLoading=!1,i&&this.renderPage(t,e,i);})).catch((t=>{e.isLoading=!1;})));}));}renderPage(t,e,i){if(!this.isDestroyed&&this.isVisible&&t.isActive&&t.pages.includes(e)&&!t.isDestroyed&&e.isPreload&&(e.isLoaded=!0,e.setImgDom(i),e.isVisible)){if(this.isDefaultViewer&&t.context.isSingleDisplay){const e=t.getCurrentPage();if(e&&!e.isLoaded)return}this.rendererService.render(t);}}emitPageChangedEvent(t){this.hooks.pageChanged.emit(Cf.create(t.current,t.total));}emitPageChangedAfterRenderEvent(t){this.hooks.pageChangedAfterRender.emit(Cf.create(t.current,t.total));}emitZoomChangedEvent(t){const{oldZoom:e,zoom:i}=t.context;this.hooks.zoomChanged.emit(rf.create(Vy(e),Vy(i)));}beforeLoadSource(t){this.isLoadSource=!0;const{tabService:e}=this,i=e.getDocTab(t);i&&i.updateOldInfo();}afterLoadSource(t){this.isLoadSource=!1;const{tabService:e}=this,i=e.getDocTab(t);i&&(this.emitPageChangedEvent(i),this.emitPageChangedAfterRenderEvent(i),i.updateOldInfo());}addPages(t,e,i,n){const{tabService:s}=this,o=s.getDocTab(t);o&&(o.appendPages(e,i,n),this.emitPageChangedEvent(o),o.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout((()=>{o.isActive&&(this.scrollByCurrentChanged=!0,this.showTab(o)),clearTimeout(this.addPagesTimer),this.addPagesTimer=null;}),200)));}deletePages(t,e){const{tabService:i}=this,n=i.getDocTab(t);n&&(this.clearOptimization(e),n.deletePages(e),this.hooks.deletePages.emit(Lf.create(e)),this.emitEventsForTab(n));}deleteAllPages(t){const{tabService:e}=this,i=e.getDocTab(t);if(!i)return;const n=i.pages.map((t=>t.uid));this.clearOptimization(n),i.deleteAllPages(),this.hooks.deletePages.emit(Lf.create(n)),this.emitEventsForTab(i);}setCurrentPage(t,e){const{tabService:i}=this,n=i.getDocTab(t);n&&n.current!==e&&(n.gotoPage(e),this.emitEventsForTab(n));}selectPages(t,e){const{tabService:i}=this,n=i.getDocTab(t);if(!n)return;const s=n.getSelected(),o=n.getSelectedIndices();let r=!1;if(o.length!==e.length)r=!0;else for(let t=0;t<e.length;t++)if(o[t]!==e[t]){r=!0;break}if(!r)return;const a=n.indicesToUids(e);if(n.selectPages(a),n.isActive){this.showTab(n);const t=ef.create(o,[...e],[...s],a);this.hooks.selectedPageChanged.emit(t),this.viewer.emit("selectedPagesChanged",t);}}movePages(t,e,i){const n=this.tabService.getDocTab(t);n&&(n.movePages(e,i),this.emitEventsForTab(n,this.isDefaultViewer));}switchPage(t,e,i){const n=this.tabService.getDocTab(t);n&&(n.switchPage(e,i),this.emitEventsForTab(n,this.isDefaultViewer));}reorderPages(t,e){const i=this.tabService.getDocTab(t);i&&(i.reorderPages(e),this.emitEventsForTab(i,this.isDefaultViewer));}emitEventsForTab(t,e){t.isActive&&(this.emitPageChangedEvent(t),this.scrollByCurrentChanged=!0,this.showTab(t,e),this.emitPageChangedAfterRenderEvent(t));}updatePage(t,e,i){const n=this.tabService.getTab(t);if(n&&n.isActive){const t=n.getPageByUid(e);t.isLoaded=!1,t.isLoading=!1,this.clearOptimization([e]),this.showTab(n);}}renameDoc(t,e){const{tabService:i}=this,n=i.getTab(t);n&&(n.rename(e),this.hooks.tabChanged.emit());}filter(t,e,i){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const n=this.getActiveTab();n&&n.uid===t&&(e.forEach((t=>{const e=n.getPageByUid(t);e&&(e.isLoaded=!1);})),this.hooks.filterChanged.emit(Ef.create(t,e,i)),this.loadVisiblePages(n),this.clearOptimization(e),this.rendererService.render(n));}activateTab(t){const e=this.tabService.getTab(t);return !!e&&(this.showTab(e),!0)}getActiveTab(){return this.tabService.getActiveTab()}dispose(){this.tabService.getAllTabs().forEach((t=>{const e=[];if(t.pages.forEach(((t,i)=>{t.isPreload&&e.push({from:!0,to:!1,pageUid:t.uid,index:i});})),e.length){const i=Wf.create(t.uid,this.uid,this.viewerConfig.viewerMode,e);this.core.viewerService.onPagePreloadChanged.emit(i);}})),this.isDestroyed=!0,this.hooks.destroy.emit(),super.dispose();}get isDefaultViewer(){return this.viewerConfig.viewerMode===eg.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===eg.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===eg.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===eg.CAPTURE}zoomTo(t,e,i){this.zoomService.zoomTo(t,e,i);}getPageRenderSize(t){const e=this.core.pageService.getPage(t);return this.isPerspectiveViewer?e.raw.getPageSize():e.mediaBox}emit(t,e){this.viewer.emit(t,e);}clearCurrentTabOptimization(){if(!this.viewerConfig.enableOptimizePage)return;const t=this.getActiveTab();if(t){const e=t.pages.map((t=>t.uid));this.clearOptimization(e);}}clearOptimization(t){const e=[],i=this.getActiveTab();i&&t.forEach((t=>{const n=i.getPageByUid(t);n&&(e.push(n.optimizationUid),n.clearOptimization());})),e.forEach((t=>{this.optimizationService.cancelOptimization(t);}));}}class Mx extends Qs{constructor(t){super(),i(this,"uid",void 0),i(this,"groupUid",void 0),i(this,"group",void 0),i(this,"postfix",void 0),i(this,"context",void 0),i(this,"emitter",void 0),i(this,"hooks",void 0),i(this,"core",void 0),i(this,"isDisposed",!1),this.emitter=new ns,t.core&&(this.core=t.core),this.uid=ts(),this.groupUid=t.groupUid,this.postfix=`-${this.uid}`,this.hooks=this.register(new ng),this.context=new Rx(this.core,this,t.viewerConfig),t.container&&!t.uiConfig&&this.context.viewService.bindContainer(t.container),this.listenGlobalEvents();}listenGlobalEvents(){const{documentService:t,viewerService:e}=this.core,{context:i}=this;this.core.onBeforeLoadSource.on((t=>{let{docUid:e}=t;i.beforeLoadSource(e);}),this),this.core.onAfterLoadSource.on((t=>{i.afterLoadSource(t.docUid);}),this),this.core.pageService.onUpdatePage.on((t=>{i.updatePage(t.docUid,t.pageUid,t.data),i.hooks.updatePage.emit(t);}),this),t.onAddPagesToDoc.on((t=>{const{group:e}=this;let{scrollToLatest:n}=e.config;zn(n)&&({scrollToLatest:n}=i.viewerConfig),i.addPages(t.docUid,t.pageUids,n,t.index),i.hooks.addPagesToDoc.emit(t);}),this),t.onDeletePagesFromDoc.on((t=>{i.deletePages(t.docUid,t.pageUids);}),this),t.onDeleteAllPagesFromDoc.on((t=>{i.deleteAllPages(t.docUid);}),this),t.onMovePages.on((t=>{i.movePages(t.docUid,t.indices,t.insertBeforeIndex);}),this),t.onSwitchPage.on((t=>{i.switchPage(t.docUid,t.one,t.another);}),this),t.onReorderPages.on((t=>{i.reorderPages(t.docUid,t.indices);}),this),t.onBeforeDeleteDocs.on((t=>{i.closeTabs(t.docUids);}),this),t.onDocumentRenamed.on((t=>{i.renameDoc(t.docUid,t.newName);}),this),t.onDocumentDeleted.on((t=>{i.closeTabs([t.docUid]);}),this),t.onOpenDocument.on((t=>{i.groupUid===t.groupUid&&i.openDocument(t.doc);}),this),t.onCloseDocument.on((t=>{i.groupUid===t.groupUid&&i.closeTabs([t.doc.uid]);}),this),e.onGotoPage.on((t=>{i.groupUid===t.groupUid&&i.setCurrentPage(t.docUid,t.index);}),this),e.onSelectPages.on((t=>{i.groupUid===t.groupUid&&i.selectPages(t.docUid,t.indices);}),this),e.onResize.on((()=>{i.resize();}),this),e.onCurrentChangedByScroll.on((t=>{i.groupUid===t.groupUid&&i.uid!==t.viewerUid&&i.setCurrentPage(t.docUid,t.current);}),this),this.core.onFilterChanged.on((t=>{const e=i.getActiveTab();(null==e?void 0:e.uid)===t.docUid&&i.filter(t.docUid,t.pageUids,t.filterType);}),this),this.core.commandService.onOperationsChanged.on((t=>{const e=i.getActiveTab();e?e.uid===t.docUid&&i.hooks.operationsChanged.emit(t):this.hooks.operationsChanged.emit({docUid:t.docUid,undo:0,redo:0});}),this);}dispose(){this.isDisposed||(this.unbindContainer(),this.context.dispose(),this.context=null,this.isDisposed=!0,this.core.removeViewer(this),super.dispose());}undo(){const t=this.context.getActiveTab();return !!t&&this.core.commandService.undo(t.uid)}redo(){const t=this.context.getActiveTab();return !!t&&this.core.commandService.redo(t.uid)}getOperationState(){const t=this.context.getActiveTab();return t?this.core.commandService.getOperationState(t.uid):{undo:0,redo:0}}saveOperations(){const t=this.context.getActiveTab();return !!t&&this.core.commandService.saveOperations(t.uid)}setRowAndColumn(t,e){return this.context.configService.updateConfig({rows:t,columns:e}),!0}getRowAndColumn(){const t=this.context.getActiveTab();if(t)return {rows:t.context.rows,columns:t.context.columns};const{viewerConfig:e}=this.context;return {rows:e.rows||1,columns:e.columns||1}}on(t,e){this.emitter.on(t,e);}emit(t,e){this.emitter.emit(t,e);}off(t,e){this.emitter.off(t,e);}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(t){this.context.configService.updateConfig(t);}bindContainer(t){return this.context.viewService.bindContainer(t)}unbindContainer(){this.context.viewService.unbindContainer();}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab();}hide(){this.updateViewerConfig({visibility:"hidden"});}render(){}resize(){this.context.resize();}indexToUid(t){const e=this.context.getActiveTab();return null==e?void 0:e.indexToUid(t)}uidToIndex(t){const e=this.context.getActiveTab();return e?e.uidToIndex(t):-1}getCurrentPageIndex(){const t=this.context.getActiveTab();return t?t.current:-1}getPageCounts(){const t=this.context.getActiveTab();return t?t.total:0}getCurrentPageUid(){var t;const e=this.context.getActiveTab();return null==e||null===(t=e.getCurrentPage())||void 0===t?void 0:t.uid}selectAllPages(){const t=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(t).keys()))}selectPagesByIndices(t){const e=this.context.getActiveTab();if(!e)return [];const i=e.indicesToUids(t);return this.core.viewerService.onSelectPages.emit(Df.create(e.uid,this.groupUid,this.uid,t)),[...i]}getSelectedPageIndices(){const t=this.context.getActiveTab();if(!t)return [];return t.getSelectedIndices()}gotoPage(t){const e=this.context.getActiveTab();return e?(t=Qn(t,0,e.total-1),e.current===t||this.core.viewerService.onGotoPage.emit(Tf.create(e.uid,this.groupUid,this.uid,t)),t):-1}movePages(t,e){const i=this.context.getActiveTab();return !!i&&this.core.movePages(i.uid,t,e)}swapPages(t,e){const i=this.context.getActiveTab();return !!i&&this.core.swapPages(i.uid,t,e)}reorderPages(t){const e=this.context.getActiveTab();return !!e&&this.core.reorderPages(e.uid,t)}deletePages(t){const e=this.context.getActiveTab();if(!e)return !1;if(!t.every((t=>t>=0&&t<e.total)))return !1;const i=e.indicesToUids(t);return this.core.deletePages(e.uid,i)}deleteAllPages(){const t=this.context.getActiveTab();return !!t&&this.core.deleteAllPages(t.uid)}openDocument(t){this.core.openDocument(t.uid,this.uid);}closeDocument(t){if(!t){const e=this.context.getActiveTab();if(!e)return;t=e.uid;}this.core.closeDocument(t,this.uid);}printDocument(){}activateTab(t){var e;return (null===(e=this.context)||void 0===e?void 0:e.activateTab(t))||!1}getActiveTab(){var t;return (null===(t=this.context)||void 0===t?void 0:t.getActiveTab())||null}getAllTabs(){var t;return (null===(t=this.context)||void 0===t?void 0:t.tabService.getAllTabs())||[]}getRealPageSize(t){const e=this.context.getActiveTab();if(!e)return {width:0,height:0};zn(t)&&(t=e.current);const i=e.getPageByIndex(t);return {width:i.rWidth,height:i.rHeight}}getRealPtPageSize(t){const e=this.context.getActiveTab();if(!e)return {width:0,height:0};zn(t)&&(t=e.current);const i=e.getPageByIndex(t);let n=Ys(i.rWidth,Do.displayResolution,72),s=Ys(i.rHeight,Do.displayResolution,72);const o=Math.round(n),r=Math.round(s);return Math.abs(n-o)<1e-6&&(n=o),Math.abs(s-r)<1e-6&&(s=r),{width:n,height:s}}getRealPixelSize(t){const e=this.context.getActiveTab();if(!e)return {width:0,height:0};zn(t)&&(t=e.current);const i=e.getPageByIndex(t),n=this.core.pageService.getPage(i.uid),{rWidth:s,rHeight:o}=n.getEditResultForPerspective();return {width:Ys(s,Do.displayResolution,n.resource.resolutionX),height:Ys(o,Do.displayResolution,n.resource.resolutionY)}}zoomIn(){const t=this.getActiveTab();if(!t||!t.isDocType)return;const{maxZoom:e}=this.getViewerConfig(),{zoom:i}=t.context;let n=Bx(i,"in");(null===n||n>e)&&(n=e),this.updateViewerConfig({zoom:n});}zoomOut(){const t=this.getActiveTab();if(!t||!t.isDocType)return;const{minZoom:e}=this.getViewerConfig(),{zoom:i}=t.context;let n=Bx(i,"out");(null===n||n<e)&&(n=e),this.updateViewerConfig({zoom:n});}filter(t,e){const i=this.context.getActiveTab();if(!i)return !1;const n=i.indicesToUids(t);return this.core.filterPages(i.uid,n,e),!1}async perspectivePage(t,e){const i=this.context.getActiveTab();if(!i)return null;let n=i.currentUid;zn(e)||(n=i.indexToUid(e));t=Ys(t,this.context.core.pageService.getPage(n).resource.resolutionX,Do.displayResolution);return (await this.core.perspectivePage(i.uid,n,t)).data}perspectiveAllPage(){const t=this.context.getActiveTab();if(!t)return;const e=[],i=[],n=[];t.pages.forEach(((t,s)=>{t.isVisible?e.push(s):t.isPreload?i.push(s):n.push(s);}));const s=[...e,...i,...n],{displayResolution:o}=Do;for(let e=0;e<s.length;e++){const i=this.indexToUid(s[e]),n=this.context.core.pageService.getPage(i);if(n.isFull){let{width:e,height:s}=n.raw.getImageDetail();const r=Math.abs((n.rotation%360+360)%360);if(90===r||270===r){const t=e;e=s,s=t;}const a=[[0,0],[e,0],[e,s],[0,s]];this.context.core.perspectivePage(t.uid,i,Ys(a,n.resolutionX,o),!0);}else if(n.activeQuad&&n.activeQuad!==n.quad){const{width:e,height:s}=n.raw.getPageSize(),o=Zf(n.activeQuad.flat(),n.rotation,e,s),r=ty(o);this.context.core.perspectivePage(t.uid,i,r,!0);}}}getPerspectivePreviewImage(t,e,i,n){const s=this.context.getActiveTab();if(!s)return null;const o=s.getPageByIndex(t);if(!o)return null;const r=o.uid,{quadSelectionStyle:a}=this.getViewerConfig(),{borderColor:l}=Es(a.border),h=function(t){const e=t=>{const e=t.toString(16);return 1===e.length?`0${e}`:e};if(t.startsWith("rgb")){const i=t.match(/(\d+)/g);if(3===i.length){const t=parseInt(i[0],10),n=parseInt(i[1],10),s=parseInt(i[2],10);return `#${e(t)}${e(n)}${e(s)}`}}if(t.startsWith("#")&&(7===t.length||4===t.length))return t;return "#FE8E14"}(l);return this.context.core.getPerspectivePreviewData(r,{width:e||200,height:i||200},{strokeColor:h.substring(1),lineWidth:n})}}function Bx(t,e){const i=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===e){for(let e=0;e<i.length;e++)if(i[e]>t)return i[e]}else for(let e=i.length-1;e>=0;e--)if(i[e]<t)return i[e];return null}class Lx extends Qs{constructor(t){super(),i(this,"isDestroyed",!1),i(this,"viewers",new Map),i(this,"groups",new Map),i(this,"onGotoPage",void 0),i(this,"onSelectPages",void 0),i(this,"onCurrentChangedByScroll",void 0),i(this,"onResize",void 0),i(this,"onPagePreloadChanged",void 0),i(this,"onViewerCreated",void 0),i(this,"core",void 0),this.core=t,this.initEventEmitter();}initEventEmitter(){this.onGotoPage=eo(this),this.onSelectPages=eo(this),this.onCurrentChangedByScroll=eo(this),this.onResize=eo(this),this.onPagePreloadChanged=eo(this),this.onViewerCreated=eo(this);}reset(){for(const t of this.viewers.values())t.dispose();this.viewers.clear(),this.groups.clear();}destroy(){if(!this.isDestroyed){for(const t of this.viewers.values())t.dispose();this.viewers=null,this.groups=null,this.isDestroyed=!0;}}createViewer(t,e){var i;const{groupUid:n}=e,s=this.groups.get(n)||new Kp(n);var o;zn(null===(i=e.viewerConfig)||void 0===i?void 0:i.scrollToLatest)||s.isSetScrollToLatest||(s.updateConfig({scrollToLatest:null===(o=e.viewerConfig)||void 0===o?void 0:o.scrollToLatest}),s.isSetScrollToLatest=!0);e.groupConfig&&s.updateConfig(e.groupConfig);const r=new t(e);r.group=s,s.viewerUids.add(r.uid),this.groups.set(n,s),this.viewers.set(r.uid,r);const a=this.getViewersByGroupUid(n);if(a.length>0){r.context.syncViewer(a[0]);const t=a[0].getActiveTab();t&&this.core.commandService.emitOperationsChanged(t.uid);}return this.onViewerCreated.emit(Ff.create(r)),r}removeViewer(t){let e;if(e=Zn(t)?this.getViewer(t):t,!e)return !1;const{uid:i,groupUid:n}=e,s=this.groups.get(n);return s&&(s.viewerUids.delete(i),s.viewerUids.size||this.groups.delete(n)),this.viewers.delete(e.uid),e.dispose(),!0}hasViewer(t){return this.viewers.has(t)}getViewer(t){return this.viewers.get(t)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(t){const e=this.viewers.get(t);return this.getViewersByGroupUid(e.groupUid)}getViewersByGroupUid(t){return this.groups.has(t)?this.groups.get(t).getViewerUids().map((t=>this.viewers.get(t))):[]}hasGroup(t){return this.groups.has(t)}}const Ux={apply(t){t.viewerService=new Lx(t);},install(t){t.setClass("Viewer",Mx);}},Ox=/^<\/([^>]*)>/,Nx=/^<([^\s>]+)[^>]*>/,_x=/^<slot>.*<\/slot>/,Wx=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function Fx(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:i,data:n,components:s,injection:o}=t,r=Hx(i,n,s,o,e),a=r.length;return a&&(r[0].cpInstance=t,r[a-1].cpInstance=t),r}function Hx(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=t.trim();const r=[];function a(t){o=o.substring(t);}function l(t){let[s,o]=t;if(o){const t=function(t){const e={},i=zs(t,Wx);return i?(i.forEach((t=>{let[,i,n]=t;e[i]=n;})),e):e}(s),a=e[":for"];a&&(delete e[":for"],t[":for"]=a);const l={type:"start",name:o,data:e,attrs:t};if(r.push(l),(i[o]||n.components&&n.components[o])&&(l.cpOption={Component:i[o]||n.components[o],injection:n}),"input"===o||/\/>/.test(s)){const t={type:"end",name:o,data:e,attrs:{}};r.push(t);}}}function h(t){let[,e]=t;if(e){const t={type:"end",name:e,attrs:{}};r.push(t);}}function d(t){if(t=t.trim()){const i={type:"text",name:t,attrs:{},data:e};r.push(i);}}for(;o;){const t=o.indexOf("<");let e;if(0===t){const t=o.match(Ox);if(t){a(t[0].length),h(t);continue}const i=o.match(_x);if(i){a(i[0].length),r.push(...s);continue}const n=o.match(Nx);if(n&&n[0]!==n.input){a(n[0].length),l(n);continue}e=o;}else e=t>0?o.substring(0,t):o;e&&(a(e.length),d(e));}return r}function Vx(t){const{cpInstance:e,children:i}=t;e&&!e.isInserted&&(e.isInserted=!0,e.hooks.inserted.emit()),i.forEach((t=>{Vx(t);}));}function zx(t){const{cpInstance:e,children:i}=t;e&&e.hooks.destroyed.emit(t),i.forEach((t=>{zx(t);}));}function jx(t){if(t){const{el:e,children:i}=t;if(function(t){const{cpInstance:e}=t;e&&(e.dispose(),e.hooks.beforeDestroyed.emit(t));}(t),e){const i=e.parentElement;i&&i.removeChild(e),e.vNode=null,t.el=null;}return zx(t),t.text=null,t.parent=null,i.length&&i.forEach((t=>{jx(t);})),!0}return !1}function $x(t,e){const i=t.el,n=i.parentNode;null!==n&&(e.el=e.renderDom(),ks(e.el,i,n),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;e<=i;)jx(t[e]),e+=1;}([t]));let s=-1;const o=t.parent;return null==o||o.children.forEach(((e,i)=>{e===t&&(s=i);})),s>-1&&(o.children[s]=e,e.parent=o,t.el=null),e}class Gx{constructor(t){i(this,"el",void 0),i(this,"tagName",void 0),i(this,"sel",""),i(this,"data",void 0),i(this,"children",void 0),i(this,"text",void 0),i(this,"key",void 0),i(this,"cpInstance",void 0),i(this,"cpOptions",void 0),i(this,"parent",void 0),this.createVNode(t);}renderDom(){if(this.el)return this.el;let t;if("FRAGMENT"===this.tagName)t=document.createDocumentFragment();else if("TEXT"===this.tagName){const e=function(t){return 0===t.length?"":t.replace(function(){if(Ps)return Ps;let t="";return As(Ss,(e=>{t+=`${e}|`;})),t+="&#(\\d{1,5});",Ps=new RegExp(t,"g"),Ps}(),((t,e)=>Cs[t]||String.fromCharCode(+e)))}(this.text);t=document.createTextNode(e);}else {t=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[e,i]of Object.entries(this.data))t.setAttribute(e,i);}return this.children.forEach((e=>{const i=e.renderDom();t.appendChild(i);})),t.vNode=this,this.el=t,function(t){const{cpInstance:e,el:i}=t;e&&(e.vNode=t,e.hooks.created.emit(i));}(this),t}patch(t){return $x(this,t)}destroy(){return jx(this)}createVNode(t){const{tagName:e,data:i={},children:n=[],el:s=null,key:o,text:r="",cpOptions:a,cpInstance:l}=t;let h=e;i.id&&(h+=`#${i.id}`),i.class&&(h+=`.${i.class}`),this.sel=h,this.data=i,this.tagName=e,this.children=n,this.el=s,this.key=o,this.text=r,this.cpInstance=l,this.cpOptions=a;}}function Xx(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],n=[];let s=[];return t.forEach((t=>{if("start"===t.type)i.push(t),n.push(s),s=[];else if("text"===t.type)s.push({type:"text",value:t.name,data:t.data});else if(t instanceof Gx)s.push(t);else {let e=i.pop();for(;e.name!==t.name;)e=i.pop();if(e){const{name:t,cpInstance:i,attrs:o,cpOption:r,data:a}=e,l={type:"token",tagName:t,cpInstance:i,cpOption:r,attrs:o,data:a,children:s};s.forEach((t=>{t.parent=l;})),s=n.pop(),s.push(l);}}})),e?s[0]:s}const Yx=/'.+'|\\".+\\"|[\w$.]+/g,qx=/{{([^\s@}]+)}}/;function Jx(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Fn(t)){const e=[];return t.forEach((t=>{e.push(...Qx(Jx(t)));})),e}if(t instanceof Gx)return t;if("token"===t.type){var i;const{tagName:n,attrs:s,cpInstance:o,children:r,data:a,cpOption:l}=t;if(s[":for"])return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:i,data:n}=t,s=JSON.parse(JSON.stringify(i)),o={":for":i[":for"]};delete i[":for"],Zx(o,{...n,...e});const r=[];return o[":for"].forEach((e=>{const i=Jx(t,e);r.push(...Qx(i));})),t.attrs=s,r}(t,e);const h={...a,...e},d={...s};let c;if(Zx(s,h),Object.prototype.hasOwnProperty.call(s,"if")&&!s.if)c=null;else if(delete s.if,l)c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:i,attrs:n,cpOption:s}=t,o=Kx(i,e),{Component:r,injection:a}=s,l=new r({data:n,injection:a}),h=Xx(Fx(l,o));if(!h)return null;return Qx(Jx(h))[0]}(t,e);else {const{key:t}=s;void 0!==t&&delete s.key;const i=Kx(r,e);c=new Gx({tagName:n.toUpperCase(),data:s,cpInstance:o,key:t,children:i});}return t.attrs=d,null===(i=c)||void 0===i||i.children.forEach((t=>{t.parent=c;})),c}return function(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:n}=t;const s=null===(e=t.parent)||void 0===e||null===(e=e.attrs)||void 0===e?void 0:e.html;if(n=function(t,e){const i=zs(t,qx);i.length&&i.forEach((i=>{const n=i[1].split(".").reduce(((t,e)=>t[e]),e),s=i[0];t=t.replace(s,n);}));return t}(n.trim(),{...t.data,...i}),s){return Jx(Xx(Hx(n),!1))}return new Gx({tagName:"TEXT",text:n})}(t,e)}function Zx(t,e){for(const s of Object.keys(t)){const[,o,r]=s.match(/^(:|@)(.+)/)||[];if(!r)continue;let a=t[s];if(delete t[s],"for"===r){var i,n;let[s,o]=a.split(" in "),[r,l]=s.split(",");r=r.trim(),l=null===(i=l)||void 0===i?void 0:i.trim(),o=null===(n=o)||void 0===n?void 0:n.trim();const h=[],d=o.split(".").reduce(((t,e)=>t[e]),e);if(Fn(d))d.forEach(((t,e)=>{const i={};i[r]=t,l&&(i[l]=e),h.push(i);}));else if(Hn(d))for(const[t,e]of Object.entries(d)){const i={};i[r]=e,l&&(i[l]=t),h.push(i);}t[":for"]=h;}else {const i="this"===a?e:a.split(".").reduce(((t,e)=>null==t?void 0:t[e]),e);if(void 0!==i)"class"===r&&t[r]?t[r]=`${t[r]} ${i}`:t[r]=i;else {a=a.replace(Yx,(t=>t.includes('"')||t.includes("'")||/^(true|false|\d+|undefined|null)$/.test(t)?t:t.split(".")));try{const i=tw(a,e);Hs(i)&&(t[r]=void 0),"class"===r&&t[r]?t[r]=`${t[r]} ${i}`:t[r]=i;}catch(e){t[r]=void 0;}}"@"===o&&(t.events||(t.events={}),t.events[r]=t[r],delete t[`@${r}`]);}}}function Qx(t){return t?(Fn(t)||(t=[t]),t):[]}function Kx(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];return t.forEach((t=>{const n=Jx(t,e)||[];i.push(...Qx(n));})),i}function tw(t,e){let i=null;try{const n=t.split(",");for(let t=0;t<n.length;t++){const i=n[t],s=/(\w+)(\[(\d+)\])?/,o=i.match(s);if(!o){e=null;break}{const t=o[1],i=o[3];if(!Object.prototype.hasOwnProperty.call(e,t)){e=null;break}e=e[t],void 0!==i&&Array.isArray(e)&&(e=e[i]);}}i=e;}catch(t){i=null;}return i}class ew extends Qs{constructor(t){let{data:e={},template:n="",components:s={},injection:o={}}=t;super(),i(this,"el",void 0),i(this,"vNode",null),i(this,"template",""),i(this,"data",{}),i(this,"injection",{}),i(this,"components",{}),i(this,"emitter",void 0),i(this,"uiEmitter",void 0),i(this,"isInserted",!1),i(this,"hooks",{created:os.create(),inserted:os.create(),updated:os.create(),beforeDestroyed:os.create(),destroyed:os.create()}),i(this,"selfEvents",[]),i(this,"globalEvents",[]),i(this,"nativeEvents",[]),this.template=n,this.emitter=ns.create(),this.setData(e),this.setComponents(s),this.setInjects(o),this.uiEmitter=this.injection.emitter,this.hooks.created.on((t=>{this.el=t;})),this.hooks.destroyed.on((()=>{this.dispose();})),this.initEvents();}setInjects(t){Object.assign(this.injection,t);}initEvents(){var t=this;const e=(e,i)=>{this.on(e,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];Zn(i)?t.$emit(i,n):Yn(i)&&i(...n);}));};for(const[t,n]of Object.entries((null===(i=this.data)||void 0===i?void 0:i.events)||{})){var i;e(t,n);}for(const[t,i]of Object.entries((null===(n=this.data)||void 0===n||null===(n=n.options)||void 0===n?void 0:n.events)||{})){var n;e(t,i);}}setData(t){Object.assign(this.data,t);}setComponents(t){Object.assign(this.components,t);}on(t,e){this.emitter.on(t,e),this.selfEvents.push([t,e]);}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this.emitter.emit(t,...i);}unbindSelfEvents(){this.selfEvents.forEach((t=>{let[e,i]=t;this.emitter.off(e,i);})),this.selfEvents=[];}$on(t,e){var i;this.uiEmitter&&(null===(i=this.uiEmitter)||void 0===i||i.on(t,e),this.globalEvents.push([t,e]));}$emit(t){for(var e,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];null===(e=this.uiEmitter)||void 0===e||e.emit(t,...n);}unbindGlobalEvents(){this.globalEvents.forEach((t=>{let[e,i]=t;this.uiEmitter.off(e,i);})),this.globalEvents=[];}nativeOn(t,e,i){if(Fn(t))t.forEach((t=>{this.nativeOn(t,e,i);}));else {const n=((t,e,i,n)=>t?(t.addEventListener(e,i,n),()=>{t.removeEventListener(e,i);}):null)(t,e,i);n&&this.nativeEvents.push(n);}}unbindNativeEvents(){this.nativeEvents.forEach((t=>{t();})),this.nativeEvents=[];}query(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelector(t)}queryAll(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelectorAll(t)}parseHTML(){return Jx(Xx(Fx(this,[])))}reRenderVNode(){const t=function(t){const e=Fx(t);return Jx(Xx(e))}(this);this.vNode.patch(t);}bindEventsEmitter(){var t=this;const{options:e}=this.data;if(null!=e&&e.events)for(const[i,n]of Object.entries(e.events))this.nativeOn(this.el,i,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];t.emit(i,...n);}));}dispose(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents(),super.dispose();}}const iw=(t,e,i,n)=>{const{id:s,tooltip:o,dataId:r,style:a,className:l}=t||{},h=(t=>{let e="";if(t)for(const[i,n]of Object.entries(t))e+=`${_n(i)}:${n};`;return e})(a);return (zn(s)?"":` id="${s}"`)+` class="${e}${null!=i?i:""} ${l||""}"`+(zn(n)?"":` :class="${n}"`)+(h?` style="${h}"`:"")+(zn(o)?"":` title="${o}"`)+(zn(r)?"":` data-id="${r}"`)};function nw(t){if(0===Object.keys(t).length||!t)return '<MainView :options="this"></MainView>';const e=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==t?void 0:t.type);return Zn(t.type)&&!e?`<${t.type} :options="this"></${t.type}>`:'<Root :options="this"></Root>'}function sw(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const e=Vn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=e&&e.children&&(e.children=e.children.map((t=>Zn(t)?{type:t}:Hn(t)?sw(t):t))),t.length&&(e.children||Fn(e.children)||(e.children=[]),e.children.push(...t)),e}class ow{constructor(t){i(this,"options",void 0),i(this,"postfix",void 0),i(this,"uiEvents",[]),i(this,"parsedUiConfig",void 0),i(this,"injection",void 0),i(this,"rootComponent",void 0),i(this,"emitter",null),i(this,"rootDom",null),i(this,"rootVNode",void 0),i(this,"container",void 0),i(this,"uiConfig",{}),i(this,"popupUiConfig",[]);const{container:e,injection:n,postfix:s,uiConfig:o,emitter:r,popupUiConfig:a}=t;this.options=t,this.injection=n,this.uiConfig=o,this.popupUiConfig=a,this.parsedUiConfig=sw(o,a),this.emitter=r||ns.create(),this.postfix=s||`-${ts()}`,Zn(e)?this.container=document.getElementById(e):e instanceof HTMLElement&&(this.container=e),this.init();}static registerComponent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[e,i]of Object.entries(t))ow.isAlreadyRegistered(e)||(this.components[`DDV${e}`]=i,this.components[e]=i);}static isAlreadyRegistered(t){return !!this.components[t]}static getComponents(){return this.components}init(){const t=new ew({data:this.parsedUiConfig,template:nw(this.parsedUiConfig),components:ow.getComponents(),injection:{...this.injection,components:ow.getComponents(),postfix:this.postfix,emitter:this.emitter}}),e=t.parseHTML();if(!e)return;const i=e.renderDom();this.rootComponent=t,this.rootVNode=e,this.rootDom=i,this.container&&(this.container.appendChild(i),Vx(this.rootVNode));}updateUiConfig(t){const e=sw(t,this.popupUiConfig),i=new ew({data:e,template:nw(this.parsedUiConfig),components:ow.getComponents(),injection:{...this.injection,components:ow.getComponents(),postfix:this.postfix,emitter:this.emitter}}).parseHTML(),n=this.rootVNode.patch(i);return this.rootDom=n.el,this.rootVNode=n,this.uiConfig=t,Vx(this.rootVNode),!0}bindContainer(t){let e;if(is(t)&&(e=t),Zn(t)){const i=document.getElementById(t);is(i)&&(e=i);}return !!e&&(this.container=e,e.appendChild(this.rootDom),Vx(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let t=0;t<this.container.children.length;t++)if(this.container.children[t]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null;}}queryByDataId(t){var e;return null===(e=this.rootDom)||void 0===e?void 0:e.querySelector(`[data-id=${t}]`)}queryAllByDataId(t){var e;return null===(e=this.rootDom)||void 0===e?void 0:e.querySelectorAll(`[data-id=${t}]`)}getElementsByType(t,e){var i;const n=[];return (null===(i=t.cpInstance)||void 0===i||null===(i=i.constructor)||void 0===i?void 0:i.cpName)===e&&t.el&&n.push(t.el),t.children.length>0&&t.children.forEach((t=>{n.push(...this.getElementsByType(t,e));})),n}on(t,e){const i=this.emitter.on(t,e);this.uiEvents.push(i);}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this.emitter.emit(t,...i);}off(t,e){this.emitter.off(t,e);}offAllEvents(){this.uiEvents.forEach((t=>{let{name:e,fn:i,context:n,once:s}=t;this.emitter.off(e,i,n,s);}));}dispose(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},zx(this.rootVNode);}}i(ow,"components",{});class rw extends ew{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(t),i(this,"defaultClass","ddv-button"),this.initTemplate(e),this.bindBaseHooks();}bindBaseHooks(){this.hooks.inserted.on((t=>{this.bindEventsEmitter();}));}initTemplate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:e}=this.data,i=""===t?this.defaultClass:`${this.defaultClass} ${t}`,n=`<div ${iw(e,i)} >`+(zn(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+"<slot></slot></div>";this.template=n;}}class aw extends ew{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(t),i(this,"defaultClass","ddv-layout"),i(this,"enableScroll",!1),i(this,"showScrollArrow",!0),i(this,"scrollLeftOrTopBtn",void 0),i(this,"scrollRightOrBottomBtn",void 0);const{options:n}=this.data;this.enableScroll=(null==n?void 0:n.enableScroll)||!1,this.showScrollArrow=(null==n?void 0:n.showScrollArrow)||!0,this.initTemplate((null==n?void 0:n.flexDirection)||e),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{lw(this),this.bindCustomScroll();})),this.hooks.updated.on((()=>{lw(this);}));}bindCustomScroll(){if(!this.enableScroll)return;this.showScrollArrow&&this.initCustomScrollButton();const t=new ResizeObserver((()=>{this.showScrollArrow&&this.updateCustomScrollButton();}));t.observe(this.el),this.hooks.destroyed.on((()=>{t.disconnect();}));}initCustomScrollButton(){const t=document.createElement("div"),e=document.createElement("div"),i=150;this.nativeOn(t,"click",(()=>{const{scrollLeft:e,scrollTop:n}=this.el;t.classList.contains("ddv-scroll-top")?this.el.scroll(0,n-i):this.el.scroll(e-i,0);})),this.nativeOn(e,"click",(()=>{const{scrollLeft:t,scrollTop:n}=this.el;e.classList.contains("ddv-scroll-bottom")?this.el.scroll(0,n+i):this.el.scroll(t+i,0);})),this.nativeOn(this.el,"scroll",(t=>{this.showScrollArrow&&this.updateCustomScrollButton();})),this.el.appendChild(t),this.el.appendChild(e),this.scrollLeftOrTopBtn=t,this.scrollRightOrBottomBtn=e,this.updateCustomScrollButton();}updateCustomScrollButton(){const{vertical:t,horizontal:e}=hw(this.el),{scrollLeft:i,scrollTop:n}=this.el,{scrollRightOrBottomBtn:s,scrollLeftOrTopBtn:o}=this;if(!o||!s)return;if(!t&&!e)return o.style.display="none",void(s.style.display="none");o.className="ddv-scroll-button "+(e?"ddv-scroll-left":"ddv-scroll-top"),s.className="ddv-scroll-button "+(e?"ddv-scroll-right":"ddv-scroll-bottom");const r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{vertical:i,horizontal:n}=hw(t);if(!i&&!n)return [!1,!1];const{scrollLeft:s,scrollTop:o,scrollHeight:r,scrollWidth:a,clientWidth:l,clientHeight:h}=t;if(n)return [s<=e,s+l-e>=a];return [o<=e,o+h-e>=r]}(this.el,0);e?(o.style.left=`${i}px`,s.style.right=-i+"px"):(o.style.top=`${n}px`,s.style.bottom=-n+"px"),o.style.display=r[0]?"none":"",s.style.display=r[1]?"none":"";}initTemplate(t){const{options:e}=this.data,i=(null==e?void 0:e.children)||[],n="row"===t?"":"-col";let s=`${this.defaultClass}${n}`;this.enableScroll&&(s+=" ddv-custom-scroll-hidden");let o=`<div ${iw(e,s)}>`;i&&i.length&&i.forEach(((t,e)=>{if(Hn(t)){const{type:i}=t;i.trim(),i.length>0&&(o+=`<${i} :options="options.children[${e}]"></${i}>`);}})),o+="</div>",this.template=o;}}function lw(t){const{options:e}=t.data,i=t.el.children;((null==e?void 0:e.children)||[]).forEach(((e,n)=>{if(is(e)){const s=e;0===n?(t.el.append(s),t.el.insertBefore(s,i[0])):((t,e)=>{const i=e.parentNode;i.lastChild===e?i.appendChild(t):ks(t,e.nextSibling,i);})(s,i[n-1]);}}));}function hw(t){let e=t.scrollHeight>t.clientHeight,i=t.scrollWidth>t.clientWidth;if(e&&i){t.scrollHeight-t.clientHeight>t.scrollWidth-t.clientWidth?i=!1:e=!1;}return {vertical:e,horizontal:i}}class dw extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks();}initTemplate(){const{options:t}=this.data,{children:e}=t,i="column"===t.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass;let n=`<div ${iw(t,i,"")} >`;e&&e.length&&e.forEach(((t,e)=>{if(Hn(t)){const{type:i}=t;i.trim(),i.length>0&&(n+=`<${i} :options="options.children[${e}]"></${i}>`);}})),n+="</div>",this.template=n;}bindHooks(){this.hooks.inserted.on((()=>{lw(this);}));}}class cw extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{this.updateClassName();})),this.hooks.updated.on((()=>{this.isInserted&&this.updateClassName();}));}updateClassName(){const t=this.el.parentNode,e=window.getComputedStyle(t),{flexDirection:i}=e;"column"===i&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"));}initTemplate(){const{options:t}=this.data,e=iw(t,this.defaultClass);this.template=`<div ${e}></div>`;}}const uw={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll",RectAnnotation:"ddvRect",EllipseAnnotation:"ddvEllipse",InkAnnotation:"ddvInk",PolygonAnnotation:"ddvPolygon",PolylineAnnotation:"ddvPolyline",LineAnnotation:"ddvLine",StampImageAnnotation:"ddvStampImage",StampIconAnnotation:"ddvStampIcon",TextTypewriterAnnotation:"ddvTypewriter",TextBoxAnnotation:"ddvTextBox",EraseAnnotation:"ddvAnnotationEraser",SelectAnnotation:"ddvAnnotationSelect",SendBackward:"ddvSendBackward",SendToBack:"ddvSendToBack",BringToFront:"ddvBringToFront",BringForward:"ddvBringForward",AnnotationSet:"ddvAnnotationSet"},pw=["Arial","Courier","Helvetica","Times New Roman"],gw=function(){let t=0,e=0;return function(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&clearTimeout(t),s){const s=!t;t=setTimeout((()=>{e!==t&&(t=0,e=0,i());}),n),s&&(e=t,i());}else t=setTimeout((()=>{i(),t=0;}),n);}}();function fw(t,e,i){const n=n=>{const s=(parseFloat(n.value)-e)/(i-e)*100;t.style.backgroundSize=`${s}% 100%`;};n(t),t.oninput=e=>{n(t);},t.onchange=e=>{n(t);};}function yw(t,e){const{bottom:i,height:n}=t.parentNode.getBoundingClientRect(),{height:s}=t.getBoundingClientRect(),{bottom:o}=e.getBoundingClientRect();let r=n;return o-i<s&&(r=-s),r}function mw(t){t.$on("ui_hidePopup",(e=>{e!==t&&Yn(null==t?void 0:t.togglePopup)&&(null==t||t.togglePopup(!1));}));}function vw(t){t.$on("ui_cropClick",(e=>{const{viewer:i}=t.injection,n=i.getPageCounts()||0;(e||n)&&ww(t.el,e);}));}function xw(t){t.$on("ui_toolModeRefactor",(()=>{const{viewer:e}=t.injection,i=e.getPageCounts()||0,{toolMode:n}=e.context.viewerConfig;i&&ww(t.el,"annotation"===n||"crop"===n);}));}function ww(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return;const{classList:i}=t,n=i.contains("ddv-button-disabled");e?n||t.classList.add("ddv-button-disabled"):n&&!e&&t.classList.remove("ddv-button-disabled");}function bw(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"base";if(!t)return;const{classList:n}=t;let s="ddv-button-activated";"deep"===i?s="ddv-button-activated-deep":"light"===i&&(s="ddv-button-activated-light");const o=n.contains(s);e?o||t.classList.add(s):t.classList.remove(s);}function Cw(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:o,right:r,bottom:a}=function(t,e){const i=(e||t.parentElement).getBoundingClientRect(),n=t.getBoundingClientRect(),s=n.top-i.top,o=i.right-n.right;return {top:s,bottom:i.bottom-n.bottom,left:n.left-i.left,right:o}}(e,t),{x:l,y:h,width:d}=t.getBoundingClientRect(),{height:c,width:u}=i.getBoundingClientRect(),{x:p,y:g,width:f,height:y}=e.getBoundingClientRect(),m=vr(getComputedStyle(t).borderWidth);let v=Math.floor(p)-Math.floor(l)-m.value;v<5&&(v=0);const x=d-u,w=v-(Math.floor(u)-Math.floor(f))/2,b=w<5?"0px":`${w}px`;let C=Math.floor(g)-Math.floor(h)-m.value;i.style.left=s&&r>u/2&&o>u/2?b:d<u+5?"0px":r>u?`${v}px`:o>u?v-(Math.floor(u)-Math.floor(f))+"px":r>u/2&&o>u/2?b:x<5?"0px":`${x}px`,a>c?(n&&(C+=2),i.style.top=C+Math.floor(y)-1+"px"):(n&&(C-=4),i.style.top=C-Math.floor(c)+"px");}function Sw(t,e,i){const n=DC.getTooltip(),s=DC.getDisplayTextConfig(),o=uw;null!=i&&i.id||!(t in o)||(i.id=o[t]+e.postfix),null!=i&&i.tooltip||!(t in n)||(i.tooltip=n[t]),null!=i&&i.displayText&&(i.label=null==i?void 0:i.displayText),null!=i&&i.label||!(t in s)||(i.label=s[t]);}function Pw(t){return (null==t?void 0:t.constructor.cpName)||""}function Aw(t){const{value:e}=t,{fontSize:i,fontFamily:n,paddingLeft:s,paddingRight:o}=getComputedStyle(t),r=document.createElement("div");r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",r.style.visibility="hidden",r.style.fontSize=i,r.style.fontFamily=n||"Arial, Helvetica, sans-serif",document.body.appendChild(r),r.textContent=e;const a=r.clientWidth+parseInt(s,10)+parseInt(o,10);return r.remove(),a}function Tw(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.uiState!==e&&t.el&&(ww(t.el,"disabled"===e),function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return;const{classList:i}=t,n=i.contains("ddv-button-focused");e?n||t.classList.add("ddv-button-focused"):t.classList.remove("ddv-button-focused");}(t.el,"focused"===e),i&&bw(t.el,"focused"===e,n?"deep":"base"),t.uiState=e);}function kw(t,e){let i=document.getElementById(`ddvMask${t.postfix}`);if(!i&&!e)return;if(i&&!e)return void i.remove();i||(i=document.createElement("div"),i.id=`ddvMask${t.postfix}`,i.className="ddv-mask");t.context.viewService.rootDom.appendChild(i);}class Dw extends rw{constructor(t,e){super(t,e.class),i(this,"callback",void 0),i(this,"uiState","normal"),i(this,"isFocused",!1),i(this,"isMenuButton",!1),this.callback=e.callback,this.bindHooks(),this.isMenuButton=t.data.menu||!1,"false"!==t.data.default&&this.bindDefaultUi();}bindEvent(){this.nativeOn(this.el,"click",(()=>{this.callback();}));}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup");}));}setUiState(t){Tw(this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.isMenuButton);}bindDefaultUi(){const{viewer:t}=this.injection,e=t=>{let e=this.isFocused?"focused":"normal";(zn(null==t?void 0:t.pageCount)?this.injection.viewer.getPageCounts():t.pageCount)||(e="disabled"),this.setUiState(e,!qn());};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindHooks(){this.hooks.created.on((()=>{this.bindEvent(),this.bindHidePopup();})),this.hooks.updated.on((()=>{this.uiState="normal";}));}initTemplate(t){const e=this.data;e.options||(e.options={});const{options:i,id:n}=this.data;n&&(i.id=n),Sw(Pw(this),this.injection.viewer,i),"false"===e.default&&(i.label=void 0),super.initTemplate(t);}}class Ew extends ew{constructor(t){super(t),i(this,"uiState","normal"),i(this,"defaultClass",void 0),i(this,"pullDownBox",void 0),i(this,"isFirstClick",!0),this.bindViewerResized(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindBaseHooks();}bindBaseHooks(){this.hooks.inserted.on((t=>{this.bindEventsEmitter();}));}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{pullDownBox:t}=this;if(!t)return;const e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:Cw(i,this.el,this.pullDownBox);}),this);}bindPullDownBoxEvents(){this.nativeOn(this.el,"click",(()=>{if(this.togglePopup(),this.isFirstClick){Cw(this.injection.viewer.rootDom,this.el,this.pullDownBox),this.isFirstClick=!1;}}));}bindPopupSwitchEvent(){mw(this);}bindDefaultUi(){const t=t=>{const e=(zn(null==t?void 0:t.pageCount)?this.injection.viewer.getPageCounts():t.pageCount)?"normal":"disabled";this.isFirstClick=!0,this.setUiState(e);};this.injection.viewer.hooks.pageExistenceChanged.on(t,this),this.hooks.inserted.on(t),this.hooks.updated.on(t);}initPullDownBox(){this.hooks.created.on((()=>{this.pullDownBox=this.query(`.${this.defaultClass}-box`),this.pullDownBox.style.display="none",this.pullDownBox.remove(),this.bindPullDownBoxEvents();})),this.hooks.updated.on((()=>{this.uiState="normal",this.pullDownBox.style.display="none",this.isFirstClick=!0;}));}bindViewerHooks(){this.injection.viewer.hooks.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1);}),this);}setUiState(t){Tw(this,t);}togglePopup(t){const{pullDownBox:e}=this,{viewer:i}=this.injection;let n="none"===e.style.display;n=zn(t)?!n:!t,n?e.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e)),bw(this.el,!n),e.style.display=n?"none":"";}}class Iw extends Ew{constructor(t){super(t),i(this,"lastSelectedIndex",0),i(this,"defaultClass","ddv-pdl"),i(this,"pullDownBoxClass","ddv-pull-down"),i(this,"children",[]),i(this,"hasCheckIcon",!1);const{defaultClassName:e,children:n,showCheckIcon:s}=t.data.options;e&&(this.defaultClass=e),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,this.children=n,this.hasCheckIcon=s,this.initPullDownBox(),this.initTemplate();}getChildrenTemplate(){let t="";return this.children.forEach(((e,i)=>{const{id:n,label:s}=e;e.id=void 0,e.label=void 0,t+=`<${e.type} :options="options.children[${i}]" default="false"id="${n?n+this.injection.viewer.postfix:""}" ><span>${s}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${e.type}>`;})),t}selectChildren(t){if(!this.hasCheckIcon)return;const{pullDownBox:e}=this;if(-1!==t&&!e.childNodes[t])return;if(-1!==this.lastSelectedIndex){const t=e.children[this.lastSelectedIndex],i=t.getElementsByTagName("i")[0];t.classList.remove("ddv-pull-down-selected"),i.style.visibility="hidden";}if(-1===t)return void(this.lastSelectedIndex=-1);const i=e.children[t],n=i.getElementsByTagName("i")[0];i.classList.add("ddv-pull-down-selected"),n.style.visibility="visible",this.lastSelectedIndex=t;}initTemplate(){const t=this.data;t.options||(t.options={});const{options:e}=this.data,{pullDownBox:i,showDropDownArrow:n}=e;Sw(Pw(this),this.injection.viewer,e);const s=`<div ${iw(e,`ddv-button ${this.defaultClass}`)}>`+(zn(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${iw(i,this.pullDownBoxClass)}>`+`${this.getChildrenTemplate()}</div>`+`<i style="display: ${n?"":"none"}" class="ddv-down-arrow"></i></div>`;this.template=s;}}class Rw extends Ew{constructor(t){super(t),i(this,"defaultClass","ddv-pdm"),i(this,"pullDownBoxClass","ddv-pull-down"),i(this,"children",[]);const{defaultClassName:e,children:n,enableScroll:s}=t.data.options;e&&(this.defaultClass=e),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,s&&(this.pullDownBoxClass+=qn()?" ddv-custom-scroll-hidden":" ddv-custom-scroll"),this.children=n,this.initPullDownBox(),this.initTemplate();}getChildrenTemplate(){let t="";return this.children.forEach(((e,i)=>{t+=`<${e.type} :options="options.children[${i}]" menu="true"></${e.type}>`;})),t}initTemplate(){const t=this.data;t.options||(t.options={});const{options:e}=this.data,{pullDownBox:i,showDropDownArrow:n}=e;Sw(Pw(this),this.injection.viewer,e);const s=`<div ${iw(e,`ddv-button ${this.defaultClass}`)}>`+(zn(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${iw(i,this.pullDownBoxClass)}>`+`${this.getChildrenTemplate()}</div>`+`<i style="display: ${n?"":"none"}" class="ddv-down-arrow"></i></div>`;this.template=s;}}class Mw extends Dw{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection;qn()&&this.el.classList.contains("ddv-button-focused")?t.updateViewerConfig({toolMode:"pan"}):(t.updateViewerConfig({toolMode:"annotation",annotationMode:e.annotationMode}),"stamp"===e.annotationMode&&t.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:null,stampConfig:null}}}));}}),i(this,"annotationMode",void 0),this.annotationMode=e.annotationMode;}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!xp.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig();t.getPageCounts()?"annotation"!==e?this.setUiState("normal"):i===this.annotationMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}class Bw extends Mw{constructor(t){super(t,{class:"ddv-ellipse",annotationMode:"ellipse"});}}i(Bw,"cpName","EllipseAnnotation");class Lw extends Mw{constructor(t){super(t,{class:"ddv-annot-eraser",annotationMode:"erase"});}}i(Lw,"cpName","EraseAnnotation");class Uw extends Mw{constructor(t){super(t,{class:"ddv-ink",annotationMode:"ink"});}}i(Uw,"cpName","InkAnnotation");class Ow extends Mw{constructor(t){super(t,{class:"ddv-line",annotationMode:"line"});}}i(Ow,"cpName","LineAnnotation");class Nw extends Mw{constructor(t){super(t,{class:"ddv-polygon",annotationMode:"polygon"});}}i(Nw,"cpName","PolygonAnnotation");class _w extends Mw{constructor(t){super(t,{class:"ddv-polyline",annotationMode:"polyline"});}}i(_w,"cpName","PolylineAnnotation");class Ww extends Mw{constructor(t){super(t,{class:"ddv-rect",annotationMode:"rectangle"});}}i(Ww,"cpName","RectAnnotation");class Fw extends Mw{constructor(t){super(t,{class:"ddv-annot-select",annotationMode:"select"});}}i(Fw,"cpName","SelectAnnotation");class Hw extends Mw{constructor(t){super(t,{class:"ddv-stamp-icon",annotationMode:"stamp"});}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!xp.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig(),n=t.getPageCounts(),{defaultStyleConfig:s}=t.getAnnotationConfig(),{stamp:o}=s,r=null==o?void 0:o.imageData;n?"annotation"!==e||"stamp"!==i||r?this.setUiState("normal"):this.setUiState("focused"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),t.hooks.annotationDefaultStyleChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}i(Hw,"cpName","StampIconAnnotation");class Vw extends Dw{constructor(t){super(t,{class:"ddv-stamp-image",callback:()=>{this.annotationImageLoader.value=null,delete this.annotationImageLoader.files,qn()&&this.el.classList.contains("ddv-button-focused")?this.injection.viewer.updateViewerConfig({toolMode:"pan"}):(this.injection.viewer.updateViewerConfig({toolMode:"pan"}),this.injection.viewer.selectAnnotations([]),this.annotationImageLoader.click());}}),i(this,"annotationImageLoader",void 0);}createAnnotationImageLoaderInput(){const t=document.createElement("input");return t.accept="image/png,image/jpeg,image/bmp",t.type="file",this.nativeOn(t,"change",(()=>{const{files:e}=t,i=new Blob([e[0]],{type:e[0].type});["image/png","image/jpeg","image/bmp"].includes(e[0].type)&&(this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:i}}}),t.value=null,t.files=null,this.injection.viewer.updateViewerConfig({toolMode:"annotation",annotationMode:"stamp"}));})),t}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet");}));}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const t=this.createAnnotationImageLoaderInput();t.style.display="none",this.el.appendChild(t),this.annotationImageLoader=t,this.nativeOn(t,"click",(t=>{t.stopPropagation();}));}));}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!xp.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig(),n=t.getPageCounts(),{defaultStyleConfig:s}=t.getAnnotationConfig(),{stamp:o}=s,r=null==o?void 0:o.imageData;n?"annotation"!==e?this.setUiState("normal"):"stamp"===i&&r?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),t.hooks.annotationDefaultStyleChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}i(Vw,"cpName","StampImageAnnotation");class zw extends Mw{constructor(t){super(t,{class:"ddv-text-box",annotationMode:"textBox"});}}i(zw,"cpName","TextBoxAnnotation");class jw extends Mw{constructor(t){super(t,{class:"ddv-typewriter",annotationMode:"textTypewriter"});}}i(jw,"cpName","TextTypewriterAnnotation");class $w extends Rw{constructor(t){const{AnnotationSet:e}=DC.getDisplayTextConfig(),i=t.data;i.options={children:[{type:"SelectAnnotation"},{type:"EraseAnnotation"},{type:"SeparatorLine"},{type:"TextTypewriterAnnotation"},{type:"TextBoxAnnotation"},{type:"SeparatorLine"},{type:"StampIconAnnotation"},{type:"StampImageAnnotation"},{type:"SeparatorLine"},{type:"InkAnnotation"},{type:"RectAnnotation"},{type:"EllipseAnnotation"},{type:"PolygonAnnotation"},{type:"PolylineAnnotation"},{type:"LineAnnotation"},{type:"SeparatorLine"},{type:"BringForward"},{type:"BringToFront"},{type:"SendBackward"},{type:"SendToBack"}],defaultClassName:"ddv-annotation-mode",label:e,enableScroll:!0,showDropDownArrow:!0,...i.options},super(t),this.$on("ui_cropClick",(t=>{const{viewer:e}=this.injection,i=e.getPageCounts()||0;(t||i)&&xp.annotationLicenseModuleIsExist()&&ww(this.el,t);}));}bindDefaultUi(){xp.annotationLicenseModuleIsExist()?(super.bindDefaultUi(),this.hooks.inserted.on((t=>{const{toolMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getPageCounts();"annotation"===e&&i>0&&this.setUiState("focused");}))):this.hooks.inserted.on((t=>{this.setUiState("disabled");}));}togglePopup(t){if((!0!==t||""!==this.pullDownBox.style.display)&&(!1!==t||"none"!==this.pullDownBox.style.display)&&(super.togglePopup(t),""===this.pullDownBox.style.display&&Gw(this.pullDownBox).horizontal)){this.pullDownBox.style.justifyContent="start";let t=0;for(let e=0;e<this.pullDownBox.children.length;e++){const i=this.pullDownBox.children[e];i.classList.contains("ddv-button-focused")&&(t=i.offsetLeft+i.clientWidth/2-this.pullDownBox.clientWidth/2);}this.pullDownBox.scroll(t,0);}}bindPopupSwitchEvent(){this.$on("ui_hidePopup",(t=>{if(t===this||"viewer"===t||t===$w.cpName)return;const{toolMode:e}=this.injection.viewer.getViewerConfig();"annotation"!==e&&this.togglePopup(!1);}));}bindViewerHooks(){if(!xp.annotationLicenseModuleIsExist())return;const t=this.injection.viewer;t.hooks.resize.on((()=>{Gw(this.pullDownBox).horizontal?this.pullDownBox.style.justifyContent="start":this.pullDownBox.style.justifyContent="";}),this),t.hooks.pageExistenceChanged.on((()=>{const{toolMode:e}=t.getViewerConfig();let i="disabled";t.getPageCounts()>0?(i="normal","annotation"===e&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0),i="focused")):this.togglePopup(!1),this.setUiState(i);}),this),t.hooks.toolModeChanged.on((e=>{if("crop"===e.newToolMode)return this.togglePopup(!1),void this.setUiState("disabled");const i="annotation"===e.newToolMode;t.getPageCounts()>0&&(this.setUiState(i?"focused":"normal"),bw(this.el,"none"!==this.pullDownBox.style.display),this.$emit("ui_annotationModeClick",i),this.$emit("ui_toolModeRefactor",i),i&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0)));}),this);}setUiState(t){super.setUiState(t);}}function Gw(t){return {vertical:t.scrollHeight>t.clientHeight,horizontal:t.scrollWidth>t.clientWidth}}i($w,"cpName","AnnotationSet");class Xw extends Dw{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection,e=t.getSelectedAnnotations();if(1!==e.length)return;const i=e[0].uid;switch(this.layerType){case"bringForward":t.bringForward(i);break;case"bringToFront":t.bringToFront(i);break;case"sendBackward":t.sendBackward(i);break;case"sendToBack":t.sendToBack(i);}}}),i(this,"layerType",void 0),this.layerType=e.layerType;}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet");}));}bindDefaultUi(){const t=this.injection.viewer,e=xp.annotationLicenseModuleIsExist(),i=()=>{if(!e)return void this.setUiState("disabled");const{viewer:i}=this.injection,n=i.getSelectedAnnotations();t.getPageCounts()&&1===n.length?this.setUiState("normal"):this.setUiState("disabled");};t.hooks.annotationLayerStateChanged.on((i=>{let{state:n}=i;if(!e)return void this.setUiState("disabled");const s=t.getSelectedAnnotations();if(!s.length||s.length>1)return void this.setUiState("disabled");const o=t.getAnnotationObject(s[0].uid);if(o&&!o.context.isActive)return void this.setUiState("disabled");let r=!1;switch(this.layerType){case"bringForward":r=n.forward;break;case"bringToFront":r=n.front;break;case"sendBackward":r=n.backward;break;case"sendToBack":r=n.back;}this.setUiState(r?"normal":"disabled");}),this),t.hooks.pageExistenceChanged.on(i,this),this.hooks.inserted.on(i),this.hooks.updated.on(i);}}class Yw extends Xw{constructor(t){super(t,{class:"ddv-bring-forward",layerType:"bringForward"});}}i(Yw,"cpName","BringForward");class qw extends Xw{constructor(t){super(t,{class:"ddv-bring-to-front",layerType:"bringToFront"});}}i(qw,"cpName","BringToFront");class Jw extends Xw{constructor(t){super(t,{class:"ddv-send-backward",layerType:"sendBackward"});}}i(Jw,"cpName","SendBackward");class Zw extends Xw{constructor(t){super(t,{class:"ddv-send-to-back",layerType:"sendToBack"});}}i(Zw,"cpName","SendToBack");class Qw extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-annotation-toolbar"),i(this,"lastSelected",void 0),i(this,"toolbarOffset",20),this.bindHooks(),this.initTemplate(),this.bindViewerHooks();}bindHooks(){const t=t=>{this.el.style.display="none";};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{viewer:t}=this.injection,e=()=>{if(!this.lastSelected)return;const e=t.getActiveTab();if("single"===e.context.displayMode&&this.lastSelected.pageUid!==e.getCurrentPage().uid)return;const{show:i,x:n,y:s}=Kw(t.context.viewService.mainContainer,this.lastSelected,this.el,this.toolbarOffset);this.togglePopup(i,n,s);};if(t.hooks.visibleChanged.on((()=>{this.togglePopup(!1);}),this),t.hooks.pageExistenceChanged.on((t=>{0===t.pageCount&&(this.togglePopup(!1),this.lastSelected=null);}),this),t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return this.togglePopup(!1),void(this.lastSelected=null);const i=e.newAnnotationUids[0],n=t.getAnnotationObject(i);if(!n)return;const{show:s,x:o,y:r}=Kw(t.context.viewService.mainContainer,n,this.el,this.toolbarOffset);this.lastSelected=n,this.togglePopup(s,o,r);}),this),t.hooks.beforeAnnotationEdit.on((()=>{this.togglePopup(!1);}),this),t.hooks.afterAnnotationEdit.on((e=>{if(e instanceof vh)return;const{show:i,x:n,y:s}=Kw(t.context.viewService.mainContainer,e,this.el,this.toolbarOffset);this.lastSelected=e,this.togglePopup(i,n,s);}),this),t.hooks.pageChanged.on((()=>{const e=t.getActiveTab();if(!e||"single"!==e.context.displayMode)return;const i=t.getSelectedAnnotations();if(1!==i.length)return;const n=i[0].pageUid===e.getCurrentPage().uid;this.togglePopup(n);}),this),t.hooks.resize.on(e,this),t.hooks.scroll.on(e,this),t.hooks.fitModeChanged.on(e,this),t.hooks.displayModeChanged.on(e,this),t.hooks.zoomChanged.on(e,this),t.hooks.annotationsUpdated.on(e,this),t.hooks.annotationTextContentUpdated.on(e,this),null!=t&&t.annotationViewerContext){const{annotationViewerContext:i}=t,{hooks:n}=i.annotationController;n.enableAnnotationTextEditMode.on(e,this),n.disableAnnotationTextEditMode.on(e,this);}}togglePopup(t,e,i){const{viewer:n}=this.injection;if(!t)return void(this.el.style.display="none");n.context.viewService.mainContainer.appendChild(this.el),this.el.style.display="",this.el.style.left=`${e||0}px`,this.el.style.top=`${i||0}px`;}initTemplate(){const{options:t}=this.data;Sw(Pw(this),this.injection.viewer,t);let e=`<div ${iw(t,this.defaultClass,"")}>`;null!=t&&t.isPaletteEnabled&&(e+='<AnnotationPaletteButton :options="options.paletteButton"></AnnotationPaletteButton>'),e+='<AnnotationDeleteButton :options="options.deleteButton"></AnnotationDeleteButton></div>',this.template=e;}}function Kw(t,e,i,n){const{width:s,height:o}=t.getBoundingClientRect(),r=e.context.getRealTimeBoundingBox(),a=getComputedStyle(i),l=vr(a.width).value,h=vr(a.height).value;if(r.right<0||r.left>s||r.top>o||r.bottom<0)return {show:!1,x:0,y:0};const d=r.left+r.width/2-l/2;let c=r.bottom+n;return c+h>o&&(c=r.top-h-n),c<0&&(c=0),{show:!0,x:d,y:c}}i(Qw,"cpName","AnnotationToolBar");class tb extends Dw{constructor(t){super(t,{class:"ddv-palette",callback:()=>{this.$emit("ui_changePalette_visible","AnnotationPalette");}}),vw(this);}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet"),this.focusTexture();}));}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof mh&&e.isEditMode&&e.focusTexture();}}}i(tb,"cpName","AnnotationPaletteButton");class eb extends Dw{constructor(t){super(t,{class:"ddv-delete-annot",callback:()=>{const{viewer:t}=this.injection,e=t.getSelectedAnnotations(),i=[];e.forEach((t=>{i.push(t.uid);})),t.deleteAnnotations(i);}}),vw(this);}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet");}));}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{viewer:e}=this.injection,i=e.getSelectedAnnotations();t.getPageCounts()&&i.length?this.setUiState("normal"):this.setUiState("disabled");};t.hooks.selectedAnnotationsChanged.on(e,this),t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}i(eb,"cpName","AnnotationDeleteButton");class ib extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-color-panel"),i(this,"colorList",void 0),i(this,"enableChangeColor",void 0),i(this,"paletteType",void 0),i(this,"colorInput",void 0),i(this,"selectedColorButton",void 0),i(this,"lastUpdatedAnnotation",void 0),i(this,"lastInputColor",void 0),i(this,"lastTextContents",void 0),i(this,"lastPaletteType",void 0),i(this,"dblClickButtons",[]),this.colorList=t.data.colorList,this.enableChangeColor=t.data.enableChangeColor,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stamp"===t?"none":"",this.paletteType=t,this.showNoFill("fill"===t),this.updateButtonSelected();}));}bindHooks(){this.hooks.inserted.on((()=>{const t=document.createElement("input");t.type="color",this.colorInput=t,this.el.appendChild(this.colorInput),this.bindEvents(),this.bindColorInputEvents();}));}bindEvents(){const t=this.el.querySelector(".ddv-palette-color-grid");this.nativeOn(t,"click",(t=>{const e=t.target;if(!(e instanceof HTMLButtonElement))return;this.dblClickButtons.push(e),this.dblClickButtons.length>2&&this.dblClickButtons.shift();if(e.classList.contains("ddv-color-selected"))return;const i=e.value,{viewer:n}=this.injection;if(""===i)this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=e;else {const t=n.getSelectedAnnotations();1===t.length&&this.updateColorByData(t[0],i),this.updateDefaultColor(i);}})),this.nativeOn(t,"dblclick",(t=>{if(!this.enableChangeColor)return;const e=t.target;if(!(e instanceof HTMLButtonElement))return;if(2===this.dblClickButtons.length&&this.dblClickButtons[0]!==this.dblClickButtons[1])return;const i=e.value;"transparent"!==i&&""!==i&&(this.colorInput.value=i,qn()&&this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=e);}));}bindColorInputEvents(){this.nativeOn(this.colorInput,"input",(t=>{gw((()=>{const{viewer:t}=this.injection,e=this.colorInput.value;this.selectedColorButton.classList.contains("ddv-add-color")&&this.addColor();this.selectedColorButton.children[0].style.background=e,this.selectedColorButton.value=e;1===t.getSelectedAnnotations().length&&this.updateColorByShape(e),this.updateDefaultColor(e),this.selectedColor(e);}),60);})),this.nativeOn(this.colorInput,"change",(t=>{this.lastUpdatedAnnotation&&(this.updateColorByData(this.lastUpdatedAnnotation,this.lastInputColor,this.lastPaletteType),this.lastUpdatedAnnotation=null,this.lastInputColor=null,this.lastPaletteType=null);}));}bindViewerHooks(){const t=this.injection.viewer;t.hooks.selectedAnnotationsChanged.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationsUpdated.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationModeChanged.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationDefaultStyleChanged.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationTextCharsSelected.on((t=>{const e=t.freeTextContentStyle,{color:i}=e;"text"===this.paletteType?this.selectedColor(i):this.updateButtonSelected();}),this);}updateColorByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if("fill"===this.paletteType)i.style.background=t;else if("stroke"===this.paletteType)i.style.borderColor=t;else if("text"===this.paletteType&&i instanceof mh){if(i.hasSelectedChars){const e=Ql(i,{color:t});i.style.textContents=e,i.textEditEventHandler.updateTextSelection();}else {if(i.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[e[0].type]:{textContent:{color:t}}}});{const e=Zl(i,{color:t});e.length&&(i.style.textContents=e);}}this.lastTextContents=i.style.textContents;}this.lastUpdatedAnnotation=e[0],this.lastInputColor=t,this.lastPaletteType=this.paletteType,this.injection.viewer.context.render();}updateColorByData(t,e,i){const{viewer:n}=this.injection,{uid:s}=t,o={},r=this.injection.viewer.getAnnotationObject(s),a=i||this.paletteType;if("text"===a&&r instanceof mh){if(r.hasSelectedChars){const t=Ql(r,{color:e});o.textContents=t;}else {if(r.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[t.type]:{textContent:{color:e}}}});{const t=Zl(r,{color:e});t.length&&(o.textContents=t);}}return this.lastTextContents&&(o.textContents=this.lastTextContents,this.lastTextContents=null),n.updateAnnotation(s,{style:o},["appearanceChanged"]),void(r.hasSelectedChars&&r.textEditEventHandler.updateTextSelection())}"fill"===a?o.background="transparent"===e?"":e:"stroke"===a&&(o.borderColor=e),n.updateAnnotation(s,{style:o},["appearanceChanged"]);}updateDefaultColor(t,e){const{annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();let s=i;n.length&&n[0]&&(s=n[0].type);const o={};switch(e||this.paletteType){case"fill":o.background=t;break;case"stroke":o.borderColor=t;break;case"text":o.textContent={},o.textContent.color=t;}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[s]:o}});}selectedColor(t){const e=this.el.querySelector(".ddv-palette-color-grid").getElementsByTagName("button");for(let i=0;i<e.length;i++){const n=e[i];if(!n.value)continue;const s=Dr(n.value),o=Dr(t);s.formatted===o.formatted?n.classList.add("ddv-color-selected"):n.classList.contains("ddv-color-selected")&&n.classList.remove("ddv-color-selected");}}updateButtonSelected(){const{viewer:t}=this.injection,e=t.getSelectedAnnotations();if(1===e.length){let n=null;if("fill"===this.paletteType)n=e[0].style.background||"transparent";else if("stroke"===this.paletteType)n=e[0].style.borderColor||"transparent";else if("text"===this.paletteType){const s=t.getAnnotationObject(e[0].uid);var i;if(s instanceof mh)n=(null===(i=e[0].style)||void 0===i||null===(i=i.textContents[0])||void 0===i?void 0:i.color)||"transparent";s instanceof mh&&(s.isEditMode||!s.style.textContents.length)&&(n=s.freeTextContentStyle.color);}return void(n&&this.selectedColor(n))}const{toolMode:n,annotationMode:s}=t.getViewerConfig();if("annotation"===n&&"select"!==s&&"erase"!==s){const{defaultStyleConfig:e}=t.getAnnotationConfig(),{background:i,borderColor:n,textContent:l}=nh;let h=null;var o;if("fill"===this.paletteType)h=(null===(o=e[s])||void 0===o?void 0:o.background)||i||"transparent";else if("stroke"===this.paletteType){var r;h=(null===(r=e[s])||void 0===r?void 0:r.borderColor)||n||"transparent";}else if("text"===this.paletteType){var a;h=(null===(a=e[s])||void 0===a||null===(a=a.textContent)||void 0===a?void 0:a.color)||(null==l?void 0:l.color)||"transparent";}h&&this.selectedColor(h);}}getColorTemplate(){const t=document.createElement("div");let e="<div>",i=0;for(let n=0;n<this.colorList.length;n++){const s=this.colorList[n];if(t.style.background=s,""!==t.style.background){if(i>26)break;i+=1,e+=`<button value="${s}"><div style="background:${s}"></div></button>`,0!==i&&i%7==0&&(e+="</div><div>"),t.style.background="";}}const n=i>26?0:27-i;for(let t=0;t<n;t++)e+=0===t?'<button value="" class="ddv-add-color"><div></div></button>':'<button value="" class="ddv-color-placeholder"><div></div></button>',(i+t+1)%7==0&&(e+="</div><div>");return e+='<button value="transparent" class="ddv-color-transparent"><div></div></button>',e+="</div>",t.remove(),e}showNoFill(t){this.el.querySelectorAll(".ddv-color-transparent").forEach((e=>{e.style.visibility=t?"":"hidden",e.style.pointerEvents=t?"":"none";}));}addColor(){const t=this.el.querySelector(".ddv-palette-color-grid"),e=t.querySelector(".ddv-add-color"),i=t.querySelector(".ddv-color-placeholder");e&&e.classList.remove("ddv-add-color"),i&&(i.classList.remove("ddv-color-placeholder"),i.classList.add("ddv-add-color"));}initTemplate(){const t=`<div class="${this.defaultClass}"><div class="ddv-palette-color-grid">${this.getColorTemplate()}</div></div>`;this.template=t;}}const nb=Do.displayResolution/Do.dataResolution;class sb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-font-panel"),i(this,"fontFamilyEl",void 0),i(this,"fontSizeEl",void 0),i(this,"fontList",[...pw]),i(this,"inputIsBlur",!0),i(this,"currentFontSizeValue",void 0),i(this,"isArrowKeyPressed",!1),i(this,"maxFontSize",72),this.maxFontSize=t.data.maxFontSize,this.maxFontSize<72&&(this.maxFontSize=72),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",(t=>{"fontFamily"!==t&&this.toggleSelect("fontFamily",!1),"fontSize"!==t&&this.toggleSelect("fontSize",!1);})),this.$on("ui_changePalette_type",(t=>{this.el.style.display="text"===t?"":"none";})),this.$on("ui_addFont",(t=>{this.addFont(t);}));}updateTextStyle(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations();if(1!==s.length||"textTypewriter"!==s[0].type&&"textBox"!==s[0].type)"annotation"!==i||"textBox"!==n&&"textTypewriter"!==n||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{textContent:t}}});else {const{uid:e,type:i}=s[0],n=this.injection.viewer.getAnnotationObject(e);if(n.isEditMode)n.hasSelectedChars&&(this.injection.viewer.updateAnnotation(e,{style:{textContents:Ql(n,t)}},["appearanceChanged"]),n.textEditEventHandler.updateTextSelection());else {const i=Zl(n,t);i.length&&this.injection.viewer.updateAnnotation(e,{style:{textContents:i}},["appearanceChanged"]);}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[i]:{textContent:t}}});}e&&this.focusTexture();}bindHooks(){this.hooks.created.on((()=>{this.fontFamilyEl=this.el.querySelector(".ddv-palette-font-family"),this.fontSizeEl=this.el.querySelector(".ddv-palette-font-size");})),this.hooks.inserted.on((()=>{this.bindToggleEvent(),this.bindSelectEvent(),this.bindFontSizeInputEvent(),this.bindTextAlignEvents(),this.bineFontStyleEvents();}));}bindToggleEvent(){const t=this.fontSizeEl.querySelector(".ddv-down-arrow");to(this.fontFamilyEl,"click",this).on((t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontFamily"),this.toggleSelect("fontFamily");}),this),to(t,"click",this).on((t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontSize"),this.toggleSelect("fontSize");}),this);}bindSelectEvent(){const t=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),e=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),i=this.fontSizeEl.getElementsByTagName("input")[0],n=this.fontFamilyEl.getElementsByTagName("span")[0];this.nativeOn(t,"click",(t=>{t.stopPropagation(),this.toggleSelect("fontFamily",!1);const e=t.target.value;e&&n.innerText!==e&&this.updateTextStyle({fontFamily:e});})),this.nativeOn(e,"click",(t=>{t.stopPropagation(),this.toggleSelect("fontSize",!1);const e=t.target.value,n=`${e}pt`===i.value;e&&!n&&this.updateTextStyle({fontSize:vr(e).value*nb});}));}bindFontSizeInputEvent(){const t=this.fontSizeEl.getElementsByTagName("input")[0];this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0);})),this.nativeOn(t,"keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){let e=Math.round(vr(t.value).value);e>this.maxFontSize&&(e=this.maxFontSize,t.value=`${this.maxFontSize}`),e<1&&(e=1,t.value="1"),this.updateTextStyle({fontSize:e*nb},!1),this.isArrowKeyPressed=!1;}})),this.nativeOn(t,"focus",(()=>{const e=t.value,i=vr(e).value;t.value=i,t.type="number",this.inputIsBlur=!1,this.currentFontSizeValue=i,this.$emit("ui_shrinkSelectionBox");})),this.nativeOn(t,"blur",(e=>{this.inputIsBlur=!0,"text"!==t.type&&(this.currentFontSizeValue=t.value,t.type="text",t.value+="pt",e.relatedTarget instanceof HTMLInputElement||this.focusTexture());}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="pt",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);let i=Math.round(vr(t.value).value);i>this.maxFontSize&&(i=this.maxFontSize),i<1&&(i=1),this.updateTextStyle({fontSize:i*nb});};this.nativeOn(t,"change",e);}bindTextAlignEvents(){const t=this.el.querySelector(".ddv-align-left"),e=this.el.querySelector(".ddv-align-center"),i=this.el.querySelector(".ddv-align-right"),n=this.el.querySelector(".ddv-justify-center"),s=t=>{const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();if(1!==n.length||"textTypewriter"!==n[0].type&&"textBox"!==n[0].type)"annotation"!==e||"textBox"!==i&&"textTypewriter"!==i||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[i]:{textAlign:t}}});else {if(t===n[0].style.textAlign)return;this.injection.viewer.updateAnnotation(n[0].uid,{style:{textAlign:t}},["appearanceChanged"]);}};this.nativeOn(t,"click",(()=>{s("left");})),this.nativeOn(e,"click",(()=>{s("center");})),this.nativeOn(i,"click",(()=>{s("right");})),this.nativeOn(n,"click",(()=>{s("justify");}));}bineFontStyleEvents(){const t=this.el.querySelector(".ddv-bold"),e=this.el.querySelector(".ddv-italic"),i=this.el.querySelector(".ddv-underline"),n=this.el.querySelector(".ddv-line-through");this.nativeOn(t,"click",(e=>{this.updateTextStyle({fontWeight:t.classList.contains("ddv-button-activated-light")?"normal":"bold"});})),this.nativeOn(e,"click",(t=>{this.updateTextStyle({fontStyle:e.classList.contains("ddv-button-activated-light")?"normal":"italic"});})),this.nativeOn(i,"click",(t=>{this.updateTextStyle({underline:!i.classList.contains("ddv-button-activated-light")});})),this.nativeOn(n,"click",(t=>{this.updateTextStyle({lineThrough:!n.classList.contains("ddv-button-activated-light")});}));}bindViewerHooks(){const{viewer:t}=this.injection;t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];if("textTypewriter"!==i.type&&"textBox"!==i.type)return;this.showTextAlignList("textBox"===i.type),this.selectTextAlign(i.style.textAlign||"left");const{defaultStyleConfig:n}=this.injection.viewer.getAnnotationConfig(),{textContent:s}=n[i.type],o=i.style.textContents.length?i.style.textContents[0]:s,{fontFamily:r,fontSize:a,fontWeight:l,fontStyle:h,underline:d,lineThrough:c}=o;this.selectFontStyle(r,Math.round(vr(a).value/nb),"bold"===l,"italic"===h,d,c);}),this),t.hooks.annotationDefaultStyleChanged.on((t=>{const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();let s,o,r=!1;if("annotation"!==e||"textBox"!==i&&"textTypewriter"!==i||(r=!0,s=i),1===n.length){const t=this.injection.viewer.getAnnotationObject(n[0].uid);t instanceof mh&&(s=n[0].type,o=n[0].style.textAlign,t.isEditMode&&!t.hasSelectedChars?r=!0:t.isEditMode||t.style.textContents.length?(this.selectTextAlign(o),r=!1):r=!0);}if(!r)return;const{textAlign:a}=t[s],{fontFamily:l,fontSize:h,fontWeight:d,fontStyle:c,underline:u,lineThrough:p}=t[s].textContent||{},{textContent:g}=nh;this.selectTextAlign(o||a||nh.textAlign),this.selectFontStyle(l||g.fontFamily,Math.round(vr(h||g.fontSize).value/nb),"bold"===(d||g.fontWeight),"italic"===(c||g.fontStyle),u||g.underline,p||g.lineThrough);}),this),t.hooks.annotationTextCharsSelected.on((t=>{const e=t.freeTextContentStyle,{fontFamily:i,fontSize:n,fontStyle:s,fontWeight:o,underline:r,lineThrough:a}=e;this.selectFontStyle(i,Math.round(vr(n).value/nb),"bold"===o,"italic"===s,r,a);}),this),t.hooks.annotationsUpdated.on((t=>{const{actions:e,uids:i}=t,n=this.injection.viewer.getSelectedAnnotations();if(!e.includes("appearanceChanged")||1!==n.length||!i.includes(n[0].uid))return;if("textTypewriter"!==n[0].type&&"textBox"!==n[0].type)return;this.selectTextAlign(n[0].style.textAlign||"left");if(!this.injection.viewer.getAnnotationObject(n[0].uid).isEditMode&&n[0].style.textContents.length){const{fontFamily:t,fontSize:e,fontWeight:i,fontStyle:s,underline:o,lineThrough:r}=n[0].style.textContents[0];this.selectFontStyle(t,Math.round(vr(e).value/nb),"bold"===i,"italic"===s,o,r);}}),this);const e=t=>{if(["textBox","textTypewriter"].includes(t)){this.showTextAlignList("textBox"===t);const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),{textContent:i,textAlign:n}=e[t],{fontFamily:s,fontSize:o,fontWeight:r,fontStyle:a,underline:l,lineThrough:h}=i;this.selectTextAlign(n),this.selectFontStyle(s,Math.round(vr(o).value/nb),"bold"===r,"italic"===a,l,h);}};t.hooks.annotationModeChanged.on((i=>{t.getSelectedAnnotations().length||e(i.newAnnotationMode);}),this),t.hooks.toolModeChanged.on((i=>{if("annotation"!==i.newToolMode)return;const{annotationMode:n}=t.getViewerConfig();e(n);}),this);}toggleSelect(t,e){const i="fontFamily"===t?"ddv-palette-font-family-select":"ddv-palette-font-size-select",n="fontFamily"===t?this.fontFamilyEl:this.fontSizeEl,s=n.querySelector(`.${i}`),o=n.querySelector(".ddv-down-arrow"),r="none"!==s.style.display,a=zn(e)?!r:e,l=this.injection.viewer.context.viewService.mainContainer;r!==a&&(a?(s.style.display="block",s.style.top=`${yw(s,l)}px`,o.style.transform="rotate(180deg)","fontSize"===t&&this.scrollFontSizeSelect()):(s.style.display="none",o.style.transform=""));}getFontFamilySelectTemplate(){let t="";for(let e=0;e<pw.length;e++){const i=pw[e];t+=`<button style="font-family:${i}" value="${i}">${i}</button>`;}return `<div class="ddv-palette-font-family"><span>Helvetica</span><i class="ddv-down-arrow"></i><div class="ddv-palette-font-family-select" style="display: none;">${t}</div></div>`}getFontSizeTemplate(){let t="";for(let e=1;e<=12;e++)t+=`<button value="${e}">${e}pt</button>`;for(let e=14;e<=36;e+=2)t+=`<button value="${e}">${e}pt</button>`;for(let e=40;e<=72;e+=4)t+=`<button value="${e}">${e}pt</button>`;if(this.maxFontSize>72){let e=72;for(;e+8<this.maxFontSize;)e+=8,t+=`<button value="${e}">${e}pt</button>`;t+=`<button value="${this.maxFontSize}">${this.maxFontSize}pt</button>`;}return `<div class="ddv-palette-font-size"><input type="string"/><i class="ddv-down-arrow"></i><div class="ddv-palette-font-size-select" style="display: none;">${t}</div></div>`}selectTextAlign(t){const e=this.el.querySelector(".ddv-align-left"),i=this.el.querySelector(".ddv-align-center"),n=this.el.querySelector(".ddv-align-right"),s=this.el.querySelector(".ddv-justify-center");bw(e,"left"===t,"light"),bw(i,"center"===t,"light"),bw(n,"right"===t,"light"),bw(s,"justify"===t,"light");}selectFontStyle(t,e,i,n,s,o){const r=this.fontFamilyEl.getElementsByTagName("span")[0],a=this.fontSizeEl.getElementsByTagName("input")[0],l=this.el.querySelector(".ddv-bold"),h=this.el.querySelector(".ddv-italic"),d=this.el.querySelector(".ddv-underline"),c=this.el.querySelector(".ddv-line-through");r.innerText=t,this.isArrowKeyPressed||("number"===a.type&&(a.type="text"),this.currentFontSizeValue=e,a.value=`${e}pt`),bw(l,i,"light"),bw(h,n,"light"),bw(d,s,"light"),bw(c,o,"light");}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof mh&&e.isEditMode&&e.focusTexture();}}addFont(t){if(this.fontList.includes(t))return;this.fontList.push(t);const e=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),i=document.createElement("button");i.style.fontFamily=t,i.value=t,i.innerText=t,e.appendChild(i);}showTextAlignList(t){const e=this.el.querySelector(".ddv-text-align-list");e&&(e.style.display=t?"":"none");}scrollFontSizeSelect(){if(!this.fontSizeEl)return;const t=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),{currentFontSizeValue:e}=this;let i=0;for(let n=0;n<t.children.length;n++){const s=t.children[n];if(!(e>=s.value))break;i=s.offsetTop;}t.scrollTo(0,i);}initTemplate(){const t=`<div class="${this.defaultClass}"><div style="display:flex; justify-content: space-between; position:relative; z-index:2">${this.getFontFamilySelectTemplate()}${this.getFontSizeTemplate()}</div><div><div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div><div class="ddv-text-align-list"><div class="ddv-button ddv-align-left"></div><div class="ddv-button ddv-align-center"></div><div class="ddv-button ddv-align-right"></div><div class="ddv-button ddv-justify-center"></div></div></div>`;this.template=t;}}const ob=["None","ClosedArrow","OpenArrow","ROpenArrow","RClosedArrow","Butt","Circle","Diamond","Square","Slash"],rb=[[0,0],[3,3],[5,5],[7,7],[7,6,3,6],[5,4,21,4],[11,5,5,5]],ab={None:"ddv-solid",OpenArrow:"ddv-line-open",ROpenArrow:"ddv-line-r-open",ClosedArrow:"ddv-line-closed",RClosedArrow:"ddv-line-r-closed",Butt:"ddv-line-butt",Square:"ddv-line-square",Diamond:"ddv-line-diamond",Circle:"ddv-line-circle",Slash:"ddv-line-slash"},lb={33:"ddv-dashed-33",55:"ddv-dashed-55",77:"ddv-dashed-77",7636:"ddv-dashed-7636",54214:"ddv-dashed-54214",11555:"ddv-dashed-11555"};class hb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-line-panel"),i(this,"commonClass","ddv-palette-line-panel-common"),i(this,"LineStyleClass","ddv-palette-border-style"),i(this,"lineStyleClassSmall","ddv-palette-border-style-small"),i(this,"startLineEndingClass","ddv-palette-line-start"),i(this,"endLineEndingClass","ddv-palette-line-end"),i(this,"selectionClass","ddv-palette-line-panel-selection"),i(this,"startLineEndingSelect",void 0),i(this,"borderStyleSelect",void 0),i(this,"endLineEndingSelect",void 0),i(this,"isStrokePalette",void 0),this.bindHooks(),this.initTemplate(),this.$on("ui_shrinkSelectionBox",(t=>{"lineEndingStart"!==t&&this.toggleSelect(0,!1),"borderStyle"!==t&&this.toggleSelect(1,!1),"lineEndingEnd"!==t&&this.toggleSelect(2,!1);})),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stroke"===t?"":"none",this.isStrokePalette="stroke"===t;const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();("annotation"===e&&"ink"===i||1===n.length&&"ink"===n[0].type)&&(this.el.style.display="none");}));}bindHooks(){this.hooks.inserted.on((()=>{const t=this.el.querySelectorAll(`.${this.commonClass}`);this.startLineEndingSelect=t[0],this.borderStyleSelect=t[1],this.endLineEndingSelect=t[2],this.bindViewerHooks(),this.bindToggleEvent(),this.bindSelectEvent();}));}bindSelectEvent(){const t=this.startLineEndingSelect.querySelector(`.${this.selectionClass}`),e=this.borderStyleSelect.querySelector(`.${this.selectionClass}`),i=this.endLineEndingSelect.querySelector(`.${this.selectionClass}`),n=(t,e)=>{const i=e.target,n="BUTTON"===i.tagName?i:i.parentNode;return Array.from(t.childNodes).indexOf(n)||0};this.nativeOn(t,"click",(e=>{const i=n(t,e),s=ob[i]||"None";this.updateLineEndingByData(!0,s),this.updateDefaultLineEnding(!0,s);})),this.nativeOn(e,"click",(t=>{const i=n(e,t),s=rb[i]||[0,0];this.updateLineDashByData(s),this.updateDefaultLineDash(s);})),this.nativeOn(i,"click",(t=>{const e=n(i,t),s=ob[e]||"None";this.updateLineEndingByData(!1,s),this.updateDefaultLineEnding(!1,s);}));}bindToggleEvent(){this.nativeOn(this.startLineEndingSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingStart"),this.toggleSelect(0);})),this.nativeOn(this.borderStyleSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","borderStyle"),this.toggleSelect(1);})),this.nativeOn(this.endLineEndingSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingEnd"),this.toggleSelect(2);}));}bindViewerHooks(){const t=this.injection.viewer,e=(t,e,i,n)=>{if(this.startLineEndingSelect.style.display=t?"":"none",this.endLineEndingSelect.style.display=t?"":"none",this.borderStyleSelect.classList.remove(t?this.LineStyleClass:this.lineStyleClassSmall),this.borderStyleSelect.classList.add(t?this.lineStyleClassSmall:this.LineStyleClass),t){const[t,e]=i;this.updateLineEndingSelect(!0,ab[t]||"ddv-solid"),this.updateLineEndingSelect(!1,ab[e]||"ddv-solid");}this.el.style.display=n||!this.isStrokePalette?"none":"",this.updateBorderStyleSelect(e||[0,0]);};t.hooks.selectedAnnotationsChanged.on((i=>{var n,s;if(1!==i.newAnnotationUids.length)return;const o=t.getSelectedAnnotations()[0];if(!o)return;const r="line"===o.type||"polyline"===o.type;e(r,null===(n=o.style)||void 0===n?void 0:n.lineDash,null===(s=o.style)||void 0===s?void 0:s.lineEnding,"ink"===o.type||"stamp"===o.type);}),this),t.hooks.annotationModeChanged.on((t=>{const i=t.newAnnotationMode,n="polyline"===i||"line"===i,s="ink"===i;if("select"!==i&&"erase"!==i&&"stamp"!==i){var o,r;const{defaultStyleConfig:t}=this.injection.viewer.getAnnotationConfig(),a=(null===(o=t[i])||void 0===o?void 0:o.lineEnding)||(null==nh?void 0:nh.lineEnding),l=(null===(r=t[i])||void 0===r?void 0:r.lineDash)||(null==nh?void 0:nh.lineDash);e(n,l,a,s);}}),this),t.hooks.annotationDefaultStyleChanged.on((i=>{var n;const{toolMode:s,annotationMode:o}=this.injection.viewer.getViewerConfig();if("annotation"!==s)return;if("select"===o||"erase"===o||"stamp"===o)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:r}=this.injection.viewer.getAnnotationConfig(),a="line"===o||"polyline"===o,l="ink"===o,h=(null===(n=r[o])||void 0===n?void 0:n.lineEnding)||nh.lineEnding,d=r[o].lineDash||nh.lineDash;e(a,d,h,l);}),this),t.hooks.annotationsUpdated.on((i=>{const{actions:n,uids:s}=i,o=t.getSelectedAnnotations();if(!n.includes("appearanceChanged")||1!==o.length||!s.includes(o[0].uid))return;if("ink"===o[0].type||"stamp"===o[0].type)return;const r="line"===o[0].type||"polyline"===o[0].type,a=o[0].style.lineEnding||["None","None"],l=o[0].style.lineDash||[0,0];e(r,l,a,!1);}),this);}toggleSelect(t,e){let i=this.borderStyleSelect;0===t?i=this.startLineEndingSelect:2===t&&(i=this.endLineEndingSelect);const n=i.querySelector(`.${this.selectionClass}`),s=i.querySelector(".ddv-down-arrow"),o="none"!==n.style.display,r=zn(e)?!o:e,a=this.injection.viewer.context.viewService.mainContainer;o!==r&&(r?(n.style.display="block",n.style.top=`${yw(n,a)}px`,s.style.transform="rotate(180deg)"):(n.style.display="none",s.style.transform=""));}updateLineEndingSelect(t,e){(t?this.startLineEndingSelect:this.endLineEndingSelect).querySelector("div").className=`ddv-button ${e}`;}updateBorderStyleSelect(t){const e=this.borderStyleSelect,i=t.join("")||"0",n=e.querySelector("div");let s="ddv-solid";((function(t){if(0===t.length)return !0;if(1===t.length)return 0===t[0];t.length%2!=0&&(t=t.concat(t));for(let e=1;e<t.length;e+=2)if(0!==t[e])return !1;return !0}))(t)||(s=lb[i]||"ddv-dashed-33"),n.className=`ddv-button ${s}`;}updateLineDashByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;(e[0].style.lineDash||[0,0]).toString()!==t.toString()&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{lineDash:t}},["appearanceChanged"]);}updateLineEndingByData(t,e){const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const n=i[0].style.lineEnding||["None","None"];t&&e===n[0]||!t&&e===n[1]||this.injection.viewer.updateAnnotation(i[0].uid,{style:{lineEnding:t?[e,n[1]]:[n[0],e]}},["appearanceChanged"]);}updateDefaultLineEnding(t,e){var i;const{annotationMode:n}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations(),{defaultStyleConfig:o}=this.injection.viewer.getAnnotationConfig();let r=(null===(i=o[n])||void 0===i?void 0:i.lineEnding)||nh.lineEnding,a=n;s.length&&s[0]&&(r=s[0].style.lineEnding,a=s[0].type);const l=[...r];t?l[0]=e:l[1]=e,this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[a]:{lineEnding:l}}});}updateDefaultLineDash(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let n=e;i.length&&i[0]&&(n=i[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{lineDash:t}}});}getBaseLineDashTemplate(){const t=["ddv-solid","ddv-dashed-33","ddv-dashed-55","ddv-dashed-77","ddv-dashed-7636","ddv-dashed-54214","ddv-dashed-11555"];let e="";for(let i=0;i<t.length;i++){e+=`<button><i class="ddv-button ${t[i]}"></i></button>`;}return `<div class="${this.commonClass} ${this.lineStyleClassSmall}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${e}</div></div>`}getLineEndingTemplate(t){const e=["ddv-solid","ddv-line-closed","ddv-line-open","ddv-line-r-open","ddv-line-r-closed","ddv-line-butt","ddv-line-circle","ddv-line-diamond","ddv-line-square","ddv-line-slash"];let i="";for(let t=0;t<e.length;t++){i+=`<button><i class="ddv-button ${e[t]}"></i></button>`;}const n=t?this.startLineEndingClass:this.endLineEndingClass;return `<div class="${this.commonClass} ${n}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${i}</div></div>`}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div style="margin-top:10px">${this.getLineEndingTemplate(!0)}${this.getBaseLineDashTemplate()}${this.getLineEndingTemplate(!1)}</div></div>`;this.template=e;}}class db extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-opacity-panel"),i(this,"isPointerDown",!1),i(this,"lastPointerValue",void 0),i(this,"range",void 0),i(this,"input",void 0),i(this,"inputIsBlur",!0),i(this,"isArrowKeyPressed",!1),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{this.range=this.el.querySelector(".ddv-palette-opacity-range"),this.input=this.el.querySelector(".ddv-palette-opacity-input"),fw(this.range,0,100),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent();}));}bineInputEvent(){const{input:t}=this;this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0);})),this.nativeOn(t,"keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){const e=xr(t.value).value;e>100&&(t.value=100),e<0&&(t.value=0);let i=parseInt(t.value,10);Jn(i)||(i=100,this.updateInput(100)),this.updateDefaultOpacity(i),this.updateOpacityByData(i),this.isArrowKeyPressed=!1;}})),this.nativeOn(t,"focus",(e=>{const i=t.value,n=xr(i).value;t.value=n,t.type="number",this.inputIsBlur=!1;})),this.nativeOn(t,"blur",(e=>{this.inputIsBlur=!0,e.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==t.type&&(t.type="text",t.value+="%");}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="%",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);const i=xr(t.value).value;i>100&&(t.value=100),i<0&&(t.value=0);let n=parseInt(t.value,10);Jn(n)||(n=100,this.updateInput(100)),this.updateDefaultOpacity(n),this.updateOpacityByData(n);};this.nativeOn(t,"change",e);}bindRangeEvent(){const{range:t}=this,e=()=>{const e=parseInt(t.value,10);this.updateOpacityByShape(e),this.input.value=`${e}%`;const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();"annotation"===i&&"select"!==n&&"erase"!==n&&this.updateInput(e);};this.nativeOn(t,"click",(()=>{const e=parseInt(t.value,10);this.injection.viewer.context.isFocusCanvas=!1,e!==this.lastPointerValue&&(this.updateOpacityByData(e),this.updateDefaultOpacity(e));})),this.nativeOn(t,"pointerdown",(t=>{t.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox");const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const n=this.injection.viewer.getAnnotationObject(i[0].uid);n instanceof mh&&n.isEditMode&&(n.textEditEventHandler.disableEditMode(),this.injection.viewer.render()),e();})),this.nativeOn(t,"pointermove",(()=>{this.isPointerDown&&e();})),this.nativeOn(t,"pointerup",(()=>{if(this.isPointerDown){const e=parseInt(t.value,10);this.lastPointerValue=e,this.updateOpacityByData(e),this.updateDefaultOpacity(e);}this.isPointerDown=!1;})),this.nativeOn(t,"keydown",(t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&e();})),this.nativeOn(t,"keyup",(e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const e=parseInt(t.value,10);this.updateOpacityByData(e),this.updateDefaultOpacity(e);}}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{annotationMode:t}=this.injection.viewer.getViewerConfig();if("select"===t||"erase"===t)return;const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),i=Jn(e[t].opacity)?e[t].opacity:nh.opacity;this.updateInput(Math.round(100*i));};t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];i&&this.updateInput(Math.round(100*i.style.opacity));}),this),t.hooks.annotationsUpdated.on((e=>{const{actions:i,uids:n}=e,s=t.getSelectedAnnotations();i.includes("appearanceChanged")&&1===s.length&&n.includes(s[0].uid)&&this.updateInput(Math.round(100*s[0].style.opacity));}),this),t.hooks.annotationModeChanged.on((t=>{e();}),this),t.hooks.toolModeChanged.on((t=>{"annotation"===t.newToolMode&&e();}),this),t.hooks.annotationDefaultStyleChanged.on((e=>{const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();if("annotation"!==i)return;if("select"===n||"erase"===n)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:s}=this.injection.viewer.getAnnotationConfig(),o=Jn(s[n].opacity)?s[n].opacity:nh.opacity;this.updateInput(100*o);}),this);}updateInput(t){let e=t;t>100&&(e=100),t<0&&(e=0),e=Math.round(e),this.range.value=`${e}`,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?e:`${e}%`;}updateOpacityByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if(!i)return;const n=100*i.style.opacity;(t=Math.round(t))!==n&&(i.style.opacity=t/100,this.injection.viewer.context.render());}updateOpacityByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=100*e[0].style.opacity;(t=Math.round(t))!==i&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{opacity:t/100}},["appearanceChanged"]);}updateDefaultOpacity(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let n=e;i.length&&i[0]&&(n=i[0].type),t=Math.round(t),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{opacity:t/100}}});}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof mh&&e.isEditMode&&e.focusTexture();}}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div class="ddv-palette-opacity-range-container"><input class="ddv-palette-opacity-range" type="range" min="0" max="100" value="100"/><input class="ddv-palette-opacity-input" type="string" value="100%"/></div></div>`;this.template=e;}}const cb=[th.DRAFT,th.FINAL,th.VOID,th.REJECTED,th.ACCEPTED,th.APPROVED,th.NOT_APPROVED,th.COMPLETED,th.CONFIDENTIAL,th.INITIAL_HERE,th.SIGN_HERE,th.WITNESS];class ub extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-stamp-panel"),i(this,"select",void 0),i(this,"selectBox",void 0),i(this,"iconName",th.DRAFT),i(this,"enableCustomStamp",!1),i(this,"customStampSelect",void 0),i(this,"customStampSelectBox",void 0),i(this,"customStampList",[]),this.enableCustomStamp=t.data.enableCustomStamp,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",(t=>{"stampIcon"!==t&&this.toggleSelect(!1,!1),this.enableCustomStamp&&"customStamp"!==t&&this.toggleSelect(!0,!1);}));}bindHooks(){this.hooks.inserted.on((()=>{this.select=this.el.querySelector(".ddv-palette-stamp-icon"),this.selectBox=this.el.querySelector(".ddv-palette-stamp-icon-select"),this.enableCustomStamp&&(this.customStampSelect=this.el.querySelector(".ddv-palette-custom-stamp"),this.customStampSelectBox=this.el.querySelector(".ddv-palette-custom-stamp-select")),this.bindToggleEvent(),this.bindSelectEvent(),this.bindCreateCustomStampEvent();}));}bindToggleEvent(){this.nativeOn(this.select,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","stampIcon"),this.toggleSelect(!1);})),this.enableCustomStamp&&this.nativeOn(this.customStampSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","customStamp"),this.toggleSelect(!0);}));}bindSelectEvent(){this.nativeOn(this.selectBox,"click",(t=>{const e=t.target.value;this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampIcon:e,stampConfig:null}}});})),this.nativeOn(this.selectBox,"pointermove",(t=>{t.stopPropagation();}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{var e;const{toolMode:i,annotationMode:n}=t.getViewerConfig(),s=t.getAnnotationConfig();"annotation"!==i||"stamp"!==n||null!==(e=s.defaultStyleConfig)&&void 0!==e&&null!==(e=e.stamp)&&void 0!==e&&e.imageData?this.el.style.display="none":this.el.style.display="";};this.hooks.inserted.on((()=>{e();const{defaultStyleConfig:i}=t.getAnnotationConfig(),{stamp:n}=i,s=(null==n?void 0:n.stampIcon)||(null==nh?void 0:nh.stampIcon);this.updateStampSpan(s);})),t.hooks.annotationDefaultStyleChanged.on((t=>{e();const{stamp:i}=t,n=(null==i?void 0:i.stampIcon)||(null==nh?void 0:nh.stampIcon);(null==i?void 0:i.stampConfig)?this.updateStampSpan("SBCustom Stamp"):n!==this.iconName&&this.updateStampSpan(n);}),this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this);}toggleSelect(t,e){const i=t?this.customStampSelect:this.select,n=t?this.customStampSelectBox:this.selectBox,s=i.querySelector(".ddv-down-arrow"),o="none"!==n.style.display,r=zn(e)?!o:e,a=this.injection.viewer.context.viewService.mainContainer;o!==r&&(r?(n.style.display="block",n.style.top=`${yw(n,a)}px`,s.style.transform="rotate(180deg)"):(n.style.display="none",s.style.transform=""));}updateStampSpan(t){this.el.getElementsByTagName("span")[1].innerText=t.slice(2),this.iconName=t;}getStampIconSelectTemplate(){let t="";for(let e=0;e<cb.length;e++){const i=cb[e];t+=`<button value="${i}">${i.slice(2)}</button>`;}return `<div class="ddv-palette-stamp-icon"><span>${th.DRAFT.slice(2)}</span><i class="ddv-down-arrow"></i><div class="ddv-palette-stamp-icon-select" style="display: none;">${t}</div></div>${this.getCustomStampTemplate()}`}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span>${this.getStampIconSelectTemplate()}</div>`;this.template=e;}bindCreateCustomStampEvent(){if(!this.enableCustomStamp)return;const t=this.customStampSelectBox.querySelector(".ddv-palette-custom-stamp-button");this.nativeOn(t,"click",(()=>{kw(this.injection.viewer,!0),this.$emit("ui_changePalette_visible","AnnotationCustomStampPanel",!0);})),this.$on("ui_customStampCreated",(t=>{const{stampConfig:e,stampImage:i}=t,n=URL.createObjectURL(i),s={stampConfig:Vn(e),imgUrl:n};this.customStampList.push(s),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampConfig:s.stampConfig}}}),this.addCustomStamp(s);})),this.nativeOn(this.customStampSelectBox,"click",(t=>{const e=t.target;if(e instanceof HTMLImageElement){const t=Ts(e.parentElement),{stampConfig:i}=this.customStampList[t-1];this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampConfig:i}}});}if("i"===e.tagName.toLocaleLowerCase()){t.stopPropagation();const i=Ts(e.parentElement),{imgUrl:n}=this.customStampList[i-1];URL.revokeObjectURL(n),e.parentElement.remove(),this.customStampList.splice(i-1,1);}}));}getCustomStampTemplate(){if(!this.enableCustomStamp)return "";return '<div class="ddv-palette-custom-stamp"><span>Custom Stamp</span><i class="ddv-down-arrow"></i><div class="ddv-palette-custom-stamp-select" style="display: none;"><div><button class="ddv-palette-custom-stamp-button">Create New Stamp</button></div></div></div>'}addCustomStamp(t){const e=document.createElement("div");e.className="ddv-palette-custom-stamp-item";const i=document.createElement("img");i.src=t.imgUrl,i.draggable=!1,e.appendChild(i);const n=document.createElement("i");n.className="ddv-button ddv-delete-annot",e.appendChild(n),this.customStampSelectBox.appendChild(e);}}const pb=Do.displayResolution/Do.dataResolution;class gb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-stroke-panel"),i(this,"isPointerDown",!1),i(this,"lastPointerValue",void 0),i(this,"range",void 0),i(this,"input",void 0),i(this,"inputIsBlur",!0),i(this,"isArrowKeyPressed",!1),i(this,"maxBorderWidth",20),this.maxBorderWidth=t.data.maxBorderWidth,this.maxBorderWidth<20&&(this.maxBorderWidth=20),this.initTemplate(),this.bindHooks(),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stroke"===t?"":"none";}));}bindHooks(){this.hooks.inserted.on((()=>{this.range=this.el.querySelector(".ddv-palette-stroke-range"),this.input=this.el.querySelector(".ddv-palette-stroke-input"),fw(this.range,0,this.maxBorderWidth),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent();}));}bineInputEvent(){const{input:t}=this;this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0);})),this.nativeOn(t,"keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){const e=vr(t.value).value;e>this.maxBorderWidth&&(t.value=this.maxBorderWidth),e<0&&(t.value=0);let i=parseInt(t.value,10);Jn(i)||(i=1,this.updateInput(1*pb)),this.updateDefaultBorderWidth(i),this.updateBorderWidthByData(i),this.isArrowKeyPressed=!1;}})),this.nativeOn(t,"focus",(e=>{const i=t.value,n=parseFloat(i);t.value=n,t.type="number",this.inputIsBlur=!1;})),this.nativeOn(t,"blur",(e=>{this.inputIsBlur=!0,e.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==t.type&&(t.type="text",t.value+="pt");}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="pt",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);const i=vr(t.value).value;i>this.maxBorderWidth&&(t.value=this.maxBorderWidth),i<0&&(t.value=0);let n=parseInt(t.value,10);Jn(n)||(n=1,this.updateInput(1*pb)),this.updateDefaultBorderWidth(n),this.updateBorderWidthByData(n);};this.nativeOn(t,"change",e);}bindRangeEvent(){const{range:t}=this,e=()=>{const e=vr(t.value).value;this.updateBorderWidthByShape(e),this.input.value=`${e}pt`;const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();"annotation"===i&&"select"!==n&&"erase"!==n&&this.updateInput(e*pb);};this.nativeOn(t,"click",(()=>{const e=vr(t.value).value;this.injection.viewer.context.isFocusCanvas=!1,e!==this.lastPointerValue&&(this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e));})),this.nativeOn(t,"pointerdown",(t=>{t.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox");const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const n=this.injection.viewer.getAnnotationObject(i[0].uid);n instanceof mh&&n.isEditMode&&(n.textEditEventHandler.disableEditMode(),this.injection.viewer.render()),e();})),this.nativeOn(t,"pointermove",(()=>{this.isPointerDown&&e();})),this.nativeOn(t,"pointerup",(()=>{if(this.isPointerDown){const e=vr(t.value).value;this.lastPointerValue=e,this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e);}this.isPointerDown=!1;})),this.nativeOn(t,"keydown",(t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&e();})),this.nativeOn(t,"keyup",(e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const e=vr(t.value).value;this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e);}}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{annotationMode:t}=this.injection.viewer.getViewerConfig();if("select"===t||"erase"===t)return;const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),i=Jn(e[t].borderWidth)?e[t].borderWidth:nh.borderWidth;this.updateInput(i);};t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];i&&this.updateInput(vr(i.style.borderWidth).value,!0);}),this),t.hooks.annotationsUpdated.on((e=>{const{actions:i,uids:n}=e,s=t.getSelectedAnnotations();i.includes("appearanceChanged")&&1===s.length&&n.includes(s[0].uid)&&this.updateInput(vr(s[0].style.borderWidth).value);}),this),t.hooks.annotationModeChanged.on((t=>{e();}),this),t.hooks.toolModeChanged.on((t=>{"annotation"===t.newToolMode&&e();}),this),t.hooks.annotationDefaultStyleChanged.on((e=>{const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();if("annotation"!==i)return;if("select"===n||"erase"===n||"stamp"===n)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:s}=this.injection.viewer.getAnnotationConfig(),o=Jn(s[n].borderWidth)?s[n].borderWidth:nh.borderWidth;this.updateInput(o);}),this);}updateInput(t,e){let i=t/pb;this.isPointerDown||e?i=Math.round(i):(i=i.toFixed(1),i.endsWith(".0")&&(i=parseInt(i,10))),this.range.value=i,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?parseFloat(i):`${i}pt`;}updateBorderWidthByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if(!i)return;const n=t*pb,{borderWidth:s}=i.style;s!==n&&(i.style.borderWidth=n,this.injection.viewer.context.render());}updateBorderWidthByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=t*pb,{borderWidth:n}=e[0].style;n!==i&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{borderWidth:i}},["appearanceChanged"]);}updateDefaultBorderWidth(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let n=e;i.length&&i[0]&&(n=i[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{borderWidth:t*pb}}});}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof mh&&e.isEditMode&&e.focusTexture();}}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div><input class="ddv-palette-stroke-range" type="range" min="0" max="${this.maxBorderWidth}" value="0"/><input class="ddv-palette-stroke-input" type="string" value="0pt"/></div></div>`;this.template=e;}}class fb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-palette-box"),i(this,"header",void 0),i(this,"fillSpan",void 0),i(this,"textSpan",void 0),i(this,"strokeSpan",void 0),i(this,"thumbnail",void 0),ow.registerComponent({ColorPanel:ib,FontPanel:sb,LinePanel:hb,StampPanel:ub,OpacityPanel:db,StrokePanel:gb}),this.bindHooks(),this.initTemplate(),this.bindViewerHooks(),this.$on("ui_changePalette_visible",((t,e)=>{t===fb.cpName&&this.togglePopup(e);})),this.injection.viewer.on("thumbnailBind",(t=>{if(this.thumbnail)return;const e=this.injection.viewer.context.core.getViewer(t);e&&(this.thumbnail=e,this.bindThumbnailHooks());}));}bindHooks(){const t=t=>{this.header=this.el.querySelector(`.${this.defaultClass}-header`);const e=this.header.getElementsByTagName("span");this.textSpan=e[0],this.strokeSpan=e[1],this.fillSpan=e[2],this.bindEvents();this.injection.viewer.context.viewService.mainContainer.appendChild(this.el);const{enableDrag:i}=this.data.options;this.el.dataset.enableDrag=`${i}`,function(t){let e,i,n=!1;function s(s){if(!n)return;const o=s.clientX-e,r=s.clientY-i;t.style.left=`${t.offsetLeft+o}px`,t.style.top=`${t.offsetTop+r}px`,e=s.clientX,i=s.clientY;}function o(){n=!1,document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",o);}t.addEventListener("pointerdown",(function(r){const a=r.target;a.classList.contains("ddv-button")||"false"===t.dataset.enableDrag||a instanceof HTMLInputElement||a instanceof HTMLButtonElement||(n=!0,e=r.clientX,i=r.clientY,document.addEventListener("pointermove",s),document.addEventListener("pointerup",o));}));}(this.el);};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindEvents(){this.nativeOn(this.el,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox",t);})),this.nativeOn(this.el,"pointerup",(t=>{t.target instanceof HTMLInputElement&&!(t.target instanceof HTMLInputElement&&"range"===t.target.type)||this.focusTexture();})),this.nativeOn(this.textSpan,"click",(()=>{this.setPaletteType("text");})),this.nativeOn(this.fillSpan,"click",(()=>{this.setPaletteType("fill");})),this.nativeOn(this.strokeSpan,"click",(()=>{this.setPaletteType("stroke");}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{toolMode:e,annotationMode:i}=t.getViewerConfig(),n=t.getSelectedAnnotations();return !t.getPageCounts()||("annotation"!==e&&!n.length||"annotation"===e&&("select"===i||"erase"===i))},i=t=>{"stamp"===t?this.setPaletteType("stamp"):"text"===t?(this.textSpan.style.display="",this.setPaletteType("text")):(this.textSpan.style.display="none",this.setPaletteType("stroke"));};this.hooks.inserted.on((()=>{e()&&this.togglePopup(!1);})),t.hooks.resize.on((()=>{if("none"===this.el.style.display)return;const{isOutOf:t}=yb(this.el,!1);if(t){var e;const t=this.el.getBoundingClientRect(),i=null===(e=this.el.parentElement)||void 0===e?void 0:e.getBoundingClientRect();this.el.style.right=i.width-t.width+"px";}}),this),t.hooks.beforeAnnotationEdit.on((()=>{this.togglePopup(!1);}),this),t.hooks.beforeAnnotationDraw.on((()=>{this.togglePopup(!1);}),this),t.hooks.pageChanged.on((e=>{e.total||this.togglePopup(!1);const i=t.getActiveTab();if(!i||"single"!==i.context.displayMode)return;1===t.getSelectedAnnotations().length&&this.togglePopup(!1);}),this),t.hooks.toolModeChanged.on((n=>{if(e())return void this.togglePopup(!1);const{annotationMode:s}=t.getViewerConfig();if("annotation"===n.newToolMode&&"select"!==s&&"erase"!==s&&!qn()){const t=["textBox","textTypewriter"].includes(s);i("stamp"===s?"stamp":t?"text":"common"),this.togglePopup(!0);}}),this),t.hooks.selectedAnnotationsChanged.on((n=>{e()&&this.togglePopup(!1);const s=t.getSelectedAnnotations();if(1!==s.length)return;const o=s[0],r=["textBox","textTypewriter"].includes(o.type),a="stamp"===o.type?"stamp":r?"text":"common";i(a),("text"===a&&"textTypewriter"===o.type||"ink"===o.type)&&(this.header.style.display="none");}),this),t.hooks.annotationModeChanged.on((e=>{if(t.getSelectedAnnotations().length)return;const n=e.newAnnotationMode;if(["erase","select"].includes(n))return void this.togglePopup(!1);const s=["textBox","textTypewriter"].includes(n),o="stamp"===n?"stamp":s?"text":"common";i(o),("text"===o&&"textTypewriter"===n||"ink"===n)&&(this.header.style.display="none");const{toolMode:r}=this.injection.viewer.getViewerConfig(),a=this.injection.viewer.getPageCounts();if(qn()&&"stamp"!==o)this.togglePopup(!1);else {const{options:t}=this.data;this.togglePopup(a>0&&"annotation"===r&&t.autoDisplay);}}),this);}bindThumbnailHooks(){this.thumbnail.hooks.visibleChanged.on((()=>{if("none"===this.el.style.display)return;const{isOutOf:t,outOfLeft:e,outOfRight:i}=yb(this.el,!1);if(t){var n;const t=this.el.getBoundingClientRect(),s=null===(n=this.el.parentElement)||void 0===n?void 0:n.getBoundingClientRect();e&&(this.el.style.left="0px"),i&&(this.el.style.left=s.width-t.width+"px");}}),this);}setPaletteType(t){const{header:e,textSpan:i,strokeSpan:n,fillSpan:s}=this;if(this.$emit("ui_changePalette_type",t),"stamp"===t)return void(e.style.display="none");const{backgroundColor:o}=getComputedStyle(this.el);e.style.display="";const r=(e,i,n)=>{e.style.background=t===i?n:"",e.style.borderBottom=t===i?"none":"";};r(i,"text",o),r(n,"stroke",o),r(s,"fill",o);}togglePopup(t,e,i){const n="none"!==this.el.style.display,s=zn(t)?!n:t;if(n===s)return;const{options:o}=this.data;s?(this.el.style.display="",null!=o&&o.positionRocked&&(this.el.style.left="",this.el.style.top="")):(this.el.style.display="none",this.$emit("ui_shrinkSelectionBox")),zn(e)||(this.el.style.right=`${e||0}px`),zn(i)||(this.el.style.top=`${i||0}px`),this.injection.viewer.emit("annotationPaletteToggle",s),yb(this.el).isOutOf&&(this.el.style.left="",this.el.style.top="");}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof mh&&e.isEditMode&&e.focusTexture();}}initTemplate(){const{options:t}=this.data;Sw(Pw(this),this.injection.viewer,t),null!=t&&t.labels||(t.labels={}),t.labels={text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"Standard Business",...t.labels},t.style={...t.style,display:"none"};const e=`<div ${iw(t,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${t.labels.text}</span><span>${t.labels.stroke}</span><span>${t.labels.fill}</span></div><FontPanel :maxFontSize="options.maxFontSize"></FontPanel><ColorPanel :enableChangeColor="options.enableChangeColor" :colorList="options.colorList"></ColorPanel><StampPanel :enableCustomStamp="options.enableCustomStamp" label="${t.labels.standardBusiness}"></StampPanel><OpacityPanel label="${t.labels.opacity}"></OpacityPanel><StrokePanel :maxBorderWidth="options.maxBorderWidth" label="${t.labels.stroke}"></StrokePanel><LinePanel label="${t.labels.style}"></LinePanel></div>`;this.template=e;}}function yb(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;if("none"===t.style.display||!t.parentElement)return {isOutOf:!1};const n=t.getBoundingClientRect(),s=t.parentElement.getBoundingClientRect();if(!e){const t=n.left<s.left,e=n.left+n.width>s.right;return {isOutOf:t||e,outOfLeft:t,outOfRight:e}}const o=n.right-i<s.left,r=n.left+i>s.right,a=n.bottom-i<s.top,l=n.top+i>s.bottom;return {isOutOf:o||r||a||l,outOfLeft:o,outOfRight:r,outOfTop:a,outOfBottom:l}}i(fb,"cpName","AnnotationPalette");class mb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-custom-stamp-panel"),i(this,"stampBoard",void 0),i(this,"fontList",[...pw]),i(this,"colorType",void 0),this.stampBoard=new wv(260,100),this.bindHooks(),this.initTemplate(),this.$on("ui_addFont",(t=>{this.addFont(t);})),this.$on("ui_changePalette_visible",((t,e)=>{t===mb.cpName&&this.togglePopup(e);}));}getFontFamilySelectTemplate(){let t="";for(let e=0;e<pw.length;e++){const i=pw[e];t+=`<button style="font-family:${i}" value="${i}">${i}</button>`;}return `<div class="ddv-stamp-font-family"><p>${this.stampBoard.signatureStyle.fontFamily}</p><i class="ddv-down-arrow"></i><div class="ddv-stamp-font-family-select" style="display: none;">${t}</div></div>`}bindHooks(){this.hooks.inserted.on((t=>{this.injection.viewer.context.viewService.rootDom.appendChild(this.el);const e=this.stampBoard.getCanvas();this.el.querySelector(`.${this.defaultClass}-canvas-container`).appendChild(e),this.bindEvents(),this.updateFontStyleButton(),this.selectColorType("background"),this.updateColorSelected();}));}bindEvents(){const t=this.el.querySelector(".ddv-bold"),e=this.el.querySelector(".ddv-italic"),i=this.el.querySelector(".ddv-underline"),n=this.el.querySelector(".ddv-line-through");this.nativeOn(t,"click",(()=>{const{fontWeight:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({fontWeight:"bold"===t?"normal":"bold"}),this.updateFontStyleButton();})),this.nativeOn(e,"click",(()=>{const{fontStyle:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({fontStyle:"italic"===t?"normal":"italic"}),this.updateFontStyleButton();})),this.nativeOn(i,"click",(()=>{const{underline:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({underline:!t}),this.updateFontStyleButton();})),this.nativeOn(n,"click",(()=>{const{strikeout:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({strikeout:!t}),this.updateFontStyleButton();}));const s=this.el.querySelectorAll(`.${this.defaultClass}-color-type span`),[o,r,a]=Array.from(s);this.nativeOn(o,"click",(()=>{this.selectColorType("background");})),this.nativeOn(r,"click",(()=>{this.selectColorType("border");})),this.nativeOn(a,"click",(()=>{this.selectColorType("text");}));const l=this.el.querySelector(`.${this.defaultClass}-color-container`);this.nativeOn(l,"click",(t=>{const e=t.target;if(!(e.dataset.color||e instanceof HTMLButtonElement))return;const i=(e instanceof HTMLButtonElement?e.parentNode:e).dataset.color;"background"===this.colorType?this.stampBoard.updateSignatureStyle({background:i}):"border"===this.colorType?this.stampBoard.updateSignatureStyle({borderColor:i}):this.stampBoard.updateSignatureStyle({color:i}),this.updateColorSelected();}));const h=this.el.querySelector(`.${this.defaultClass}-ok`);this.nativeOn(h,"click",(async t=>{const e=this.stampBoard.getStampConfig(),i=await this.stampBoard.getSignatureImage(),{options:n}=this.data,{autoDisplay:s}=n;this.$emit("ui_customStampCreated",{stampConfig:e,stampImage:i}),s&&this.togglePopup(!1);}));const d=this.el.querySelector(".ddv-button-close");this.nativeOn(d,"click",(t=>{this.togglePopup(!1);})),this.bindInputEvent(),this.bindToggleEvent(),this.bindSelectEvent();}bindInputEvent(){const t=this.el.querySelector(`.${this.defaultClass}-stamp-text input`);this.nativeOn(t,"input",(()=>{const e=t.value;this.stampBoard.updateSignatureStyle({stampText:e});}));const e=this.el.querySelectorAll(`.${this.defaultClass}-time-stamp input`),[i,n,s,o]=Array.from(e);this.nativeOn(i,"input",(()=>{const t=i.value;this.stampBoard.updateSignatureStyle({userName:t});})),this.nativeOn(n,"change",(()=>{this.stampBoard.updateSignatureStyle({hasUserName:n.checked});})),this.nativeOn(s,"change",(()=>{this.stampBoard.updateSignatureStyle({hasDate:s.checked});})),this.nativeOn(o,"change",(()=>{this.stampBoard.updateSignatureStyle({hasTime:o.checked});}));}bindSelectEvent(){const t=this.el.querySelector(".ddv-stamp-font-family"),e=t.querySelector(".ddv-stamp-font-family-select"),i=t.querySelector("p");this.nativeOn(e,"click",(t=>{t.stopPropagation(),this.toggleSelect(!1);const e=t.target.value;e&&(this.stampBoard.updateSignatureStyle({fontFamily:e}),i.innerText=e);}));}bindToggleEvent(){const t=this.el.querySelector(".ddv-stamp-font-family");this.nativeOn(t,"click",(t=>{t.stopPropagation(),this.toggleSelect();}));}toggleSelect(t){const e=this.el.querySelector(".ddv-stamp-font-family"),i=e.querySelector(".ddv-stamp-font-family-select"),n=e.querySelector(".ddv-down-arrow"),s="none"!==i.style.display,o=zn(t)?!s:t,r=this.injection.viewer.context.viewService.rootDom;s!==o&&(o?(i.style.display="block",i.style.top=`${yw(i,r)}px`,n.style.transform="rotate(180deg)"):(i.style.display="none",n.style.transform=""));}addFont(t){const e=this.el.querySelector(".ddv-stamp-font-family");if(this.fontList.includes(t))return;this.fontList.push(t);const i=e.querySelector(".ddv-stamp-font-family-select"),n=document.createElement("button");n.style.fontFamily=t,n.value=t,n.innerText=t,i.appendChild(n);}updateFontStyleButton(){const{fontStyle:t,fontWeight:e,underline:i,strikeout:n}=this.stampBoard.signatureStyle,s=this.el.querySelector(".ddv-bold"),o=this.el.querySelector(".ddv-italic"),r=this.el.querySelector(".ddv-underline"),a=this.el.querySelector(".ddv-line-through");bw(s,"bold"===e,"light"),bw(o,"italic"===t,"light"),bw(r,i,"light"),bw(a,n,"light");}getColorSelector(t){const{options:e}=this.data,{colorList:i}=e,n=document.createElement("div");let s=`<div class="${t}">`,o=0,r=!1;for(let e=0;e<i.length;e++){const a=i[e];if(n.style.background=a,""!==n.style.background){if(o>20)break;o+=1,s+=`<div data-color="${a}"><button style="background:${a}"></button></div>`,0!==o&&o%10==0&&(r=!1,s+="</div>",e!==i.length-1&&(r=!0,s+=`<div class="${t}">`)),n.style.background="";}}return r&&(s+="</div>"),n.remove(),s}selectColorType(t){if(t===this.colorType)return;const e=this.el.querySelectorAll(`.${this.defaultClass}-color-type span`),[i,n,s]=Array.from(e);this.colorType=t;[{element:i,type:"background"},{element:n,type:"border"},{element:s,type:"text"}].forEach((e=>{let{element:i,type:n}=e;n===t?(i.style.color="#3183c8",i.style.borderBottom="2px solid #3183c8"):(i.style.color="",i.style.borderBottom="");})),this.updateColorSelected();}updateColorSelected(){const{colorType:t}=this,{background:e,borderColor:i,color:n}=this.stampBoard.signatureStyle,s="background"===t?e:"border"===t?i:n,o=this.el.querySelectorAll(".ddv-custom-stamp-panel-color-container div");Array.from(o).forEach((t=>{t.style.border=t.dataset.color===s?"1px solid #aaa":"";}));}togglePopup(t){const e="none"!==this.el.style.display,i=zn(t)?!e:t;e!==i&&(this.el.style.display=i?"":"none",i||kw(this.injection.viewer,!1));}initTemplate(){const{options:t}=this.data;Sw(Pw(this),this.injection.viewer,t),t.style={...t.style,display:"none"};const{hasUserName:e,hasDate:i,hasTime:n}=this.stampBoard.signatureStyle,s=`<div ${iw(t,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${(null==t?void 0:t.title)||"Create New Stamp"}</span><div class="ddv-button ddv-button-close"></div></div><div class="${this.defaultClass}-content"><div class="${this.defaultClass}-canvas-container"></div><div class="${this.defaultClass}-stamp-text"><span>${t.labels.stampText}</span><input type="text" value="${this.stampBoard.signatureStyle.stampText}"/></div><div class="${this.defaultClass}-font-style"><span>${t.labels.fontStyle}</span><div style="margin-top: 10px; display: flex; justify-content: space-between">${this.getFontFamilySelectTemplate()}<div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div></div><div class="${this.defaultClass}-time-stamp"><span>${t.labels.timeStampText}</span><div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;"><input type="text" value="${this.stampBoard.signatureStyle.userName}"/><label><input checked="${e?"checked":""}" type="checkbox"/>${t.labels.userName}</label><label><input checked="${i?"checked":""}" type="checkbox" />${t.labels.date}</label><label><input checked="${n?"checked":""}" type="checkbox" />${t.labels.time}</label></div></div><div class="${this.defaultClass}-color-picker"><div class="${this.defaultClass}-color-type"><span>${t.labels.backgroundColor}</span><span>${t.labels.borderColor}</span><span>${t.labels.textColor}</span></div><div class="${this.defaultClass}-color-container">${this.getColorSelector(`${this.defaultClass}-color-list`)}</div></div><div class="${this.defaultClass}-footer"><div class="${this.defaultClass}-ok">${t.labels.create}</div></div></div></div>`;this.template=s;}}i(mb,"cpName","AnnotationCustomStampPanel");class vb extends Dw{constructor(t){super(t,{class:"ddv-auto-capture",callback:()=>{const{viewer:t}=this.injection,{viewerMode:e}=t.getViewerConfig(),{enableAutoCapture:i}=t.getCameraConfig();e===eg.CAPTURE&&t.updateCameraConfig({enableAutoCapture:!i});}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()?t.getCameraConfig().enableAutoCapture?this.setUiState("focused",!qn()):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.autoCaptureChanged.on((t=>{const e=t.enableAutoCapture?"focused":"normal";this.setUiState(e,!qn());}),this),t.cameraPlayed.on((()=>{const{enableAutoCapture:t}=this.injection.viewer.getCameraConfig();this.setUiState(t?"focused":"normal",!qn());}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}i(vb,"cpName","AutoCapture");class xb extends Dw{constructor(t){super(t,{class:"ddv-auto-detect",callback:()=>{const{viewer:t}=this.injection,{viewerMode:e}=t.getViewerConfig(),{enableAutoDetect:i}=t.getCameraConfig();e===eg.CAPTURE&&t.updateCameraConfig({enableAutoDetect:!i});}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()&&t.context.core.detectorService.enableDetect?t.getCameraConfig().enableAutoDetect?this.setUiState("focused",!qn()):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.autoDetectChanged.on((t=>{const e=t.enableAutoDetect?"focused":"normal";this.setUiState(e,!qn());}),this),t.cameraPlayed.on((()=>{const{core:t}=this.injection.viewer.context;if(!t.detectorService.enableDetect)return;const{enableAutoDetect:e}=this.injection.viewer.getCameraConfig();this.setUiState(e?"focused":"normal",!qn());}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}i(xb,"cpName","AutoDetect");class wb extends Dw{constructor(t){super(t,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const t=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),t.capture().finally((()=>{this.isCapturing=!1,this.setUiState("normal");}));}}),i(this,"isCapturing",!1),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.cameraPlayed.on((()=>{this.setUiState("normal");}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}i(wb,"cpName","Capture");class bb extends Dw{constructor(t){super(t,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:t}=this.injection;t.cameraContext.turnOnTheTorch?t.turnOffTorch():t.turnOnTorch();}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const{viewer:t}=this.injection;t.isVideoPlaying()&&t.cameraContext.torchSupported?t.cameraContext.turnOnTheTorch?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){this.injection.viewer.hooks.torchChanged.on((t=>{switch(t.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!qn());break;default:this.setUiState("disabled");}}),this);}}i(bb,"cpName","Flashlight");class Cb extends Dw{constructor(t){super(t,{class:"ddv-camera-convert",callback:()=>{const{viewer:t}=this.injection;t.cameraContext.convertCamera();}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()?this.setUiState(t.cameraContext.canFrontCamera?"normal":"disabled"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.cameraPlayed.on((()=>{const t=this.injection.viewer.cameraContext.canFrontCamera;this.setUiState(t?"normal":"disabled");}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}i(Cb,"cpName","CameraConvert");const Sb=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class Pb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-resolution"),i(this,"cssPrefix",`${this.defaultClass}-`),i(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),i(this,"resolutionOptions",[]),i(this,"isFirstClick",!0),i(this,"fakeResolution",!1),i(this,"lastCheckIndex",0),i(this,"box",void 0),this.bindHooks(),this.initTemplate(),mw(this);}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),ww(this.el,!0);})),this.hooks.updated.on((()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||ww(this.el,!0);}));}bindEvents(){const t=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",(()=>{const t=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Cw(t,this.el,this.box),this.isFirstClick=!1);})),this.ulEvent(t);}ulEvent(t){t&&this.nativeOn(t,"click",(t=>{const e=this.injection.viewer,i=t.target,n=i.parentNode;if("LI"===i.tagName||"LI"===n.tagName){const t="LI"===i.tagName?i.value:n.value;if(t===this.lastCheckIndex)return;const{width:s,height:o}=this.resolutionOptions[t].value;this.fakeResolution=!0,e.setResolution(s,o).catch((t=>{wu.error(t);})),this.updateChecked(s,o);}this.togglePopup(!1);}));}bindViewerHooks(){const{viewer:t}=this.injection,{hooks:e}=t;e.cameraPlayed.on((t=>{if(ww(this.el,!1),this.fakeResolution)return;const{width:e,height:i}=t.resolution;this.updateChecked(e,i),this.fakeResolution=!1;}),this),e.cameraClosed.on((()=>{ww(this.el,!0);}),this),e.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1);}),this);}updateChecked(t,e){const i=function(t,e){let i=-1;const n=e.width*e.height;for(let e=0;e<t.length;e++){const{value:s}=t[e],o=s.width*s.height;if(0===e&&n<=o)return 0;if(e===t.length&&n>=o)return t.length-1;n>o&&(i=e+1);}return i}(this.resolutionOptions,{width:t,height:e}),{box:n,checkedClassName:s}=this,o=n.getElementsByClassName(`${this.cssPrefix}checkbox`)[i],r=n.getElementsByClassName(s)[0];o!==r&&(this.lastCheckIndex=i,null==o||o.classList.add(s),null==r||r.classList.remove(s));}initTemplate(){const{options:t}=this.data,{popupBox:e}=t;Sw(Pw(this),this.injection.viewer,t);const i=`<div ${iw(t,`${this.defaultClass} ddv-button`)}>`+(zn(null==t?void 0:t.label)?"":`<span>${t.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${iw(e,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=i;}getOptionTemplate(){const{options:t}=this.data;let e=Sb;if(Fn(null==t?void 0:t.valueList))e=t.valueList;else {const{CameraResolution_720P:t,CameraResolution_1080P:i,CameraResolution_1440P:n,CameraResolution_2160P:s}=DC.getDisplayTextConfig(),o=[t,i,n,s];e.forEach(((t,e)=>{o[e]&&(t.label=o[e]);}));}let i="";return e.forEach(((t,e)=>{const{width:n,height:s}=t.value;Jn(n)&&Jn(s)&&(i+=[`<li value="${e}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==t?void 0:t.label)||""}</span>`,"</li>"].join(""));})),this.resolutionOptions=e,i}updateResolution(){const t=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=t;}togglePopup(t){const{box:e}=this,{viewer:i}=this.injection;let n="none"!==e.style.display;n=zn(t)?!n:t,n?(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e)):e.remove(),bw(this.el,n),e.style.display=n?"":"none";}}i(Pb,"cpName","CameraResolution");class Ab extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-image-preview"),i(this,"cssPrefix",`${this.defaultClass}-`),i(this,"uiState",void 0),i(this,"image",void 0),i(this,"counter",void 0),i(this,"imagePageUid",void 0),i(this,"hasTask",!1),i(this,"isUpdateTask",!1),i(this,"lastPageUid",void 0),i(this,"pageTaskUids",[]),i(this,"currentTimer",void 0),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((t=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter();})),this.hooks.inserted.on((t=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`);})),this.hooks.destroyed.on((()=>{var t;clearTimeout(this.currentTimer),null!=this&&this.image&&null!=this&&null!==(t=this.image)&&void 0!==t&&t.src&&URL.revokeObjectURL(this.image.src);}));}bindViewerHooks(){const t=this.injection.viewer,e=qn()?10:4;t.hooks.updatePage.on((async i=>{if(i.pageUid!==this.lastPageUid)return;if(this.hasTask)return this.pageTaskUids.push(i.pageUid),void(this.isUpdateTask=!0);this.hasTask=!0;const n=t.getPageCounts(),s=await t.getPerspectivePreviewImage(n-1,400,400,e);s&&(this.image.src&&URL.revokeObjectURL(this.image.src),this.image.src=es(s.data).data),this.hasTask=!1,this.pageTaskUids.length>0&&this.createTask();}),this),t.hooks.pageChanged.on((async e=>{if(0===e.total)return this.image.src="",this.setState("disabled"),this.imagePageUid=void 0,void(this.lastPageUid=void 0);if(null==this||!this.counter)return;this.counter.innerText=`${e.total}`;const i=t.getActiveTab();if(!i)return;const n=i.pages[e.total-1].uid;this.pageTaskUids.push(n),this.hasTask||n!==this.lastPageUid&&this.createTask();}),this);}async createTask(){this.hasTask||(this.hasTask=!0,await this.updateImage(),this.currentTimer=setTimeout((()=>{this.hasTask=!1,0!==this.pageTaskUids.length&&this.createTask();}),300));}async updateImage(){const t=this.injection.viewer;if(!t||!t.context)return;const e=t.getActiveTab(),i=qn()?10:4;if(!e)return;const n=e.pages.length;if(!n)return;const s=this.pageTaskUids[this.pageTaskUids.length-1],o=e.pages[n-1].uid;if(this.pageTaskUids.length=0,this.lastPageUid=e.pages[n-1].uid,this.lastPageUid===s&&this.imagePageUid===s&&!this.isUpdateTask)return;let r;this.isUpdateTask&&(this.isUpdateTask=!1);try{r=await t.getPerspectivePreviewImage(n-1,400,400,i);}catch(t){}r&&!t.isDestroy&&t.getActiveTab()&&(this.image.src&&URL.revokeObjectURL(this.image.src),this.image.src=es(r.data).data,this.imagePageUid=o,this.setState(n>0?"normal":"disabled"));}setState(t){this.uiState!==t&&this.el&&("normal"===t?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=t);}initTemplate(){const{options:t}=this.data,{imageCounter:e}=t,i=this.injection.viewer.getPageCounts();Sw(Pw(this),this.injection.viewer,t);const n=`<div ${iw(t,this.defaultClass)}> <img src=""></img><div ${iw(e,this.cssPrefix,"counter")}>${i}</div></div>`;this.template=n;}}i(Ab,"cpName","ImagePreview");class Tb extends Dw{constructor(t){super(t,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click();}}),i(this,"fileLoader",void 0),this.$on("ui_cropClick",(t=>{const{viewer:e}=this.injection;0!==(e.getPageCounts()||0)&&this.setUiState(t?"disabled":"normal");}));}createFileInput(){const t=document.createElement("input");return t.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",t.type="file",t.multiple=!0,this.nativeOn(t,"change",(()=>{const{files:e}=t,i=e.length,n=[];for(let t=0;t<i;t++){const i=new Blob([e[t]],{type:e[t].type});if("application/pdf"===e[t].type){const t=xp.annotationLicenseModuleIsExist();n.push({fileData:i,convertMode:exports.EnumConvertMode.CM_AUTO,renderOptions:{renderAnnotations:t?exports.EnumAnnotationRenderMode.LOAD_ANNOTATIONS:exports.EnumAnnotationRenderMode.NO_ANNOTATIONS}});}else n.push({fileData:i});}this.injection.viewer.context.loadSource(n),t.value=null,t.files=null;})),t}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const t=this.createFileInput();t.style.display="none",this.el.appendChild(t),this.fileLoader=t,this.nativeOn(t,"click",(t=>{t.stopPropagation();}));}));}bindDefaultUi(){this.injection.viewer.hooks.pageExistenceChanged.on((t=>{null!=t&&t.pageCount||this.setUiState("normal");}),this);}}i(Tb,"cpName","Load");class kb extends Dw{constructor(t){super(t,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages();}}),xw(this);}}i(kb,"cpName","DeleteAll");class Db extends Dw{constructor(t){super(t,{class:"ddv-delete-current",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.deletePages([e]);}}),xw(this);}}function Eb(t){try{t.dispatchEvent(new MouseEvent("click"));}catch(e){const i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(i);}}function Ib(t,e,i){if("download"in HTMLAnchorElement.prototype){const i=document.createElementNS("http://www.w3.org/1999/xhtml","a");e=e||t.name||"download",i.download=e,i.rel="noopener","string"==typeof t?(i.href=t,i.origin!==window.location.origin?function(t){const e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send();}catch(t){}return e.status>=200&&e.status<=299}(i.href)?function(t,e,i){const n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=()=>{Ib(n.response,e);},n.onerror=()=>{},n.send();}(t,e):(i.target="_blank",Eb(i)):Eb(i)):(i.href=URL.createObjectURL(t),setTimeout((()=>{URL.revokeObjectURL(i.href),i.href="",i.remove();}),3e3),setTimeout((()=>{Eb(i);}),0));}}i(Db,"cpName","DeleteCurrent");class Rb extends Dw{constructor(t){super(t,{class:"ddv-button-download",callback:()=>{const t=this.injection.viewer,e=t.getActiveTab(),i=wu.buildInfo("save",{docUid:e.doc.uid,pageUids:e.doc.pages,current:0,total:e.doc.pages.length});wu.info(i),t.context.core.fileSaveService.saveToPdf(e.doc.pages,{mimeType:"application/octet-stream",saveAnnotation:xp.annotationLicenseModuleIsExist()?"annotation":"none"},i).then((t=>{Ib(t,`${e.docName}.pdf`);})).catch((t=>{wu.error(t);}));}}),vw(this);}}i(Rb,"cpName","Download");class Mb extends Iw{constructor(t){const{Delete_DeleteCurrent:e,Delete_DeleteAll:i}=DC.getDisplayTextConfig(),{Delete_DeleteCurrent:n,Delete_DeleteAll:s}=uw;t.data.options={showCheckIcon:!0,showDropDownArrow:!0,...t.data.options,children:[{type:"DeleteCurrent",label:e,id:n},{type:"DeleteAll",label:i,id:s}],defaultClassName:"ddv-delete-btn"},super(t),xw(this);}}i(Mb,"cpName","Delete");class Bb extends Dw{constructor(t){super(t,{class:"ddv-print-page",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex(),i=t.getActiveTab(),{displayMode:n}=i.context;"single"===n?t.context.core.printPages(i.uid,[e]):t.context.core.printPages(i.uid);}}),vw(this);}}i(Bb,"cpName","Print");class Lb extends Dw{constructor(t){super(t,{class:"ddv-crop-current",callback:()=>{this.cropEvent();}});}bindDefaultUi(){Ub(this);}cropEvent(){const t=this.injection.viewer,e=t.getRectBox(),i=t.getCurrentPageIndex();e&&t.cropPages(e,[i]);}}function Ub(t){const e=t.injection.viewer,i=i=>{const n=zn(null==i?void 0:i.pageCount)?e.getPageCounts():i.pageCount,s=e.getRectBox();n&&s?t.setUiState("normal"):t.setUiState("disabled");};t.hooks.inserted.on(i),t.hooks.updated.on(i),e.hooks.pageExistenceChanged.on(i,t),e.hooks.cropRectDrawn.on((e=>{t.setUiState("normal");}),t),e.hooks.cropRectDeleted.on((e=>{t.setUiState("disabled");}),t);}i(Lb,"cpName","CropCurrent");class Ob extends Dw{constructor(t){super(t,{class:"ddv-crop-all",callback:()=>{this.cropEvent();}});}bindDefaultUi(){Ub(this);}cropEvent(){const{viewer:t}=this.injection,e=t.getRectBox(),i=t.getCropIndices();e&&t.cropPages(e,i);}}i(Ob,"cpName","CropAll");class Nb extends Dw{constructor(t){super(t,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent();}});}perspectiveEvent(){const{viewer:t}=this.injection;t.perspectiveAllPage();}}i(Nb,"cpName","PerspectiveAll");class _b extends Dw{constructor(t){super(t,{class:"ddv-full-quad",callback:()=>{this.toggleFull();}}),this.bindViewerHooks();}toggleFull(){const{viewer:t}=this.injection;t.toggleFullPerspective();}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.perspectiveQuadChanged.on((t=>{this.isFocused=t.isFull||!1,this.setUiState(t.isFull?"focused":"normal",!qn());}),this);}}i(_b,"cpName","FullQuad");class Wb extends Dw{constructor(t){super(t,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo();}}),this.$on("ui_cropClick",(()=>{const t=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(t);}));}bindDefaultUi(){Fb("redo",this);}}function Fb(t,e){const{viewer:i}=e.injection,n=()=>{const n=i.getOperationState(),s=("redo"===t?n.redo:n.undo)>0?"normal":"disabled";e.setUiState(s);};e.hooks.inserted.on(n),e.hooks.updated.on(n);i.hooks.operationsChanged.on((i=>{let n="disabled";n="redo"===t?i.redo>0?"normal":"disabled":i.undo>0?"normal":"disabled",e.setUiState(n);}),e);}i(Wb,"cpName","Redo");class Hb extends Dw{constructor(t){super(t,{class:"ddv-restore-page",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.reset(e);}}),xw(this);}}i(Hb,"cpName","Restore");class Vb extends Dw{constructor(t){super(t,{class:"ddv-rotate-left",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.rotatePages(-90,[e]);}}),xw(this);}}i(Vb,"cpName","RotateLeft");class zb extends Dw{constructor(t){super(t,{class:"ddv-rotate-right",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.rotatePages(90,[e]);}}),xw(this);}}i(zb,"cpName","RotateRight");class jb extends Dw{constructor(t){super(t,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo();}}),this.$on("ui_cropClick",(()=>{const t=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(t);}));}bindDefaultUi(){Fb("undo",this);}}i(jb,"cpName","Undo");class $b extends Ew{constructor(t){super(t),this.defaultClass="ddv-crop",this.initPullDownBox(),this.initTemplate(),this.initHooks();}initHooks(){const t=this.injection.viewer;t.hooks.toolModeChanged.on((t=>{const e="crop"===t.newToolMode;this.injection.viewer.getPageCounts()>0&&(this.setUiState(e?"focused":"normal"),this.togglePopup(e),this.isFirstClick&&e&&this.el.click()),this.$emit("ui_cropClick",e),this.$emit("ui_toolModeRefactor");}),this),t.hooks.cropRectDrawn.on((()=>{ww(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!1);}),this),t.hooks.pageChanged.on((()=>{ww(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount());}),this);}bindPullDownBoxEvents(){const{viewer:t}=this.injection,e=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`),i=this.pullDownBox.getElementsByTagName("input")[1],n=this.pullDownBox.getElementsByTagName("input")[0],s=e.children[0],o=e.children[1],r=()=>{this.togglePopup(!1),t.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}});};this.nativeOn(o,"click",(()=>{const e=t.getRectBox(),i=t.getCropIndices();e&&(t.cropPages(e,i),r());})),this.nativeOn(s,"click",r),this.nativeOn(this.el,"click",(()=>{const e=t.rootDom,i=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1];t.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0),this.$emit("ui_toolModeRefactor");ww(i,!t.getRectBox()),this.isFirstClick&&(Cw(e,this.el,this.pullDownBox),this.isFirstClick=!1);})),this.nativeOn(i,"change",(()=>{t.cropMode="all";})),this.nativeOn(n,"change",(()=>{t.cropMode="current";}));}bindPopupSwitchEvent(){}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{toolMode:e}=t.getViewerConfig();let i="disabled";t.getPageCounts()>0?("crop"===e&&this.el.click(),i=""===this.pullDownBox.style.display?"focused":"normal"):this.togglePopup(!1),this.setUiState(i);};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){}initTemplate(){const{defaultClass:t}=this,{options:e}=this.data,{popupBox:i}=e,{postfix:n,cropMode:s}=this.injection.viewer,{Crop_CropCurrent:o,Crop_CropAll:r,Crop_CropApply:a,Crop_CropCancel:l}=DC.getDisplayTextConfig(),{Crop_CropCurrent:h,Crop_CropAll:d,Crop_CropApply:c,Crop_CropCancel:u}=uw,p="current"===s?'checked="checked"':"",g="all"===s?'checked="checked"':"";Sw(Pw(this),this.injection.viewer,e);const f=`<div ${iw(e,`ddv-button ${t}`)}>`+(zn(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${iw(i,`${t}-box`)}><div>`+`<input ${p} type="radio" id="${h+n}" name="cropType" value="cropCurrent" />`+`<label for="${h+n}">${o}</label>`+`<input ${g} type="radio" id="${d+n}" name="cropType" value="cropAll" />`+`<label for="${d+n}">${r}</label></div>`+`<div class= "${t}-buttonGroup">`+`<div id="${u+n}"><span>${l}</span></div>`+`<div id="${c+n}"><span>${a}</span></div></div></div></div>`;this.template=f;}}i($b,"cpName","Crop");class Gb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-filter-item"),i(this,"cssPrefix",`${this.defaultClass}-`),i(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((t=>{this.bindEvents();})),this.hooks.inserted.on((()=>{this.bindFilterEvents();}));}bindEvents(){const{el:t}=this;this.nativeOn(t,"click",(()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:t}=this.data;this.$emit("ui_filterClick",t.type);}));}bindFilterEvents(){this.$on("ui_filterReset",(t=>{this.resetSelect(t.currentFilter);const{filterList:e}=t,{itemValue:i}=this.data,n=this.el.getElementsByTagName("img")[0];n.src&&URL.revokeObjectURL(n.src),e.forEach((t=>{if(t.type===i.type){let e="";t.imageData&&(e=es(t.imageData).data),n.src=e;}}));})),this.$on("ui_filterLoading",(t=>{const e=this.el.getElementsByTagName("img")[0],i=this.el.getElementsByTagName("div")[0];e.style.display=t?"none":"",i.style.display=t?"":"none",this.el.style.pointerEvents=t?"none":"";})),this.injection.viewer.hooks.filterChanged.on((t=>{this.resetSelect(t.filterType);}),this);}resetSelect(t){const{itemValue:e}=this.data;t===e.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass);}initTemplate(){const{options:t,itemValue:e}=this.data,i=`<div ${iw(t,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:none"></div><span>${e.label}</span></div>`;this.template=i;}}const Xb=[{type:"none",label:"Original"}];class Yb extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-filter"),i(this,"cssPrefix",`${this.defaultClass}-`),i(this,"isFirstClick",!0),i(this,"box",void 0),i(this,"applyAll",!1),i(this,"filterList",void 0),i(this,"filterUpdateStatus",!1),i(this,"enableFilter",!1),i(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),mw(this);const{filterService:e}=this.injection.viewer.context.core;e.enableFilter&&(this.enableFilter=!0,xw(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),ow.registerComponent({FilterItem:Gb});}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.filterUpdateStatus=!0,this.bindNativeEvents();})),this.hooks.updated.on((()=>{this.uiState="normal";}));}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{box:t}=this,e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:Cw(i,this.el,this.box);}),this);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.pageChanged.on((async e=>{if(0===e.total)return this.filterUpdateStatus=!0,void this.togglePopup(!1);const i=t.context.getActiveTab();if(!i||!this.box)return;const{currentUid:n,oldCurrentUid:s}=i;s!==n&&(this.filterUpdateStatus=!0,this.togglePopup(!1));}),this),t.hooks.updatePage.on((e=>{var i;const n=t.context.getActiveTab();n&&this.box&&(null===(i=n.getCurrentPage())||void 0===i?void 0:i.uid)===e.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1));}),this),t.hooks.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1);}),this);}bindNativeEvents(){const{el:t,box:e}=this,i=e.querySelector(`.${this.cssPrefix}list-header`),n=i.getElementsByTagName("span")[0],s=i.getElementsByTagName("div")[0];this.nativeOn(t,"click",(async t=>{if(this.togglePopup(),this.isFirstClick){Cw(this.injection.viewer.rootDom,this.el,this.box),this.isFirstClick=!1;}})),this.nativeOn(e,"click",(t=>{t.stopPropagation();})),this.nativeOn([n,s],"click",(()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:t}=this.injection,e=t.getPageCounts(),i=t.getCurrentPageUid(),n=t.context.core.pageService.getPage(i);t.filter(Array.from(Array(e).keys()),n.filter);}}));}bindFilterEvents(){this.$on("ui_filterClick",(t=>{const{viewer:e}=this.injection,i=e.getPageCounts();if(i<1)return;let n=Array.from(Array(i).keys());if(!this.applyAll){const i=e.getCurrentPageUid();if(e.context.core.pageService.getPage(i).filter===t)return;n=[e.getCurrentPageIndex()];}e.filter(n,t);}));}clickApplyToAll(t){const e=this.injection.viewer,i=uw.Filter_FilterAll+e.postfix,n=document.getElementById(i);if(zn(t))return this.applyAll?n.classList.remove(`${this.cssPrefix}checked`):n.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);t?n.classList.add(`${this.cssPrefix}checked`):n.classList.remove(`${this.cssPrefix}checked`),this.applyAll=t;}async updateFilterPreview(){const t=this.injection.viewer,e=t.getCurrentPageUid(),i=await t.context.core.imageDataService.getOriginal(e);if(!i)return;this.$emit("ui_filterLoading",!0);const n=[],s=t.context.core.pageService.getPage(e);let o;try{o=await t.context.core.processService.resize(i.data,3,i.width,i.height,200);}catch(t){}for(let e=0;e<this.filterList.length;e++){const s=this.filterList[e];if("none"===s.type)n.push({type:"none",imageData:i.data});else {let e;try{var r;o&&null!==(r=o)&&void 0!==r&&r.data&&(e=await t.context.core.filterService.applyFilter({data:o.data,type:exports.EnumImageDataType.JPEG,width:o.width,height:o.height},s.type));}catch(t){e=null;}n.push({type:s.type,imageData:e});}}this.$emit("ui_filterLoading",!1),this.$emit("ui_filterReset",{currentFilter:s.filter||"none",filterList:n}),this.filterUpdateStatus=!1;}initTemplate(){var t;const e=this.data,{options:i}=e,{popupBox:n,filterHeader:s,filterContent:o,valueList:r}=i,{filterService:a}=this.injection.viewer.context.core,l=uw.Filter_FilterAll+this.injection.viewer.postfix;Sw(Pw(this),this.injection.viewer,i);const h=(null===(t=DC.getDisplayTextConfig())||void 0===t?void 0:t.Filter_FilterAll)||"Apply to All";e.valueList=r||Xb,a.enableFilter&&(e.valueList=a.getSupportedFilters()),this.filterList=e.valueList;const d=`<div ${iw(i,`ddv-button ${this.defaultClass}`)}>`+(zn(null==i?void 0:i.label)?"":`<span>${i.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${iw(n,this.cssPrefix,"list")}>`+`<div id="${l}"`+`${iw(s,this.cssPrefix,"list-header")}><div></div>`+`<span>${h}</span></div>`+`<div ${iw(o,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=d;}async togglePopup(t){const{box:e}=this,{viewer:i}=this.injection;let n="none"===e.style.display;n=zn(t)?!n:!t,n?e.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e),this.filterUpdateStatus&&this.updateFilterPreview()),bw(this.el,!n),e.style.display=n?"none":"";}bindDefaultUi(){const t=this.injection.viewer,e=()=>{let e="normal";0!==t.getPageCounts()&&this.enableFilter||(e="disabled"),Tw(this,e);};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}i(Yb,"cpName","Filter");class qb extends Dw{constructor(t){super(t,{class:"ddv-button-blank",callback:()=>{}});}bindDefaultUi(){}}class Jb extends Dw{constructor(t){super(t,{class:"ddv-button-close",callback:()=>{}});}bindDefaultUi(){}}i(Jb,"cpName","Close");class Zb extends Dw{constructor(t){super(t,{class:"ddv-button-back",callback:()=>{}});}bindDefaultUi(){}}i(Zb,"cpName","Back");class Qb extends Dw{constructor(t){super(t,{class:"ddv-button-done",callback:()=>{}});}bindDefaultUi(){}}i(Qb,"cpName","Done");const Kb=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class tC extends Iw{constructor(t){const{DisplayMode_ContinuousPage:e,DisplayMode_SinglePage:i}=DC.getDisplayTextConfig(),{DisplayMode_ContinuousPage:n,DisplayMode_SinglePage:s}=uw;t.data.options={showCheckIcon:!0,showDropDownArrow:!0,...t.data.options,children:[{type:"ContinuousPage",label:e,id:n},{type:"SinglePage",label:i,id:s}],defaultClassName:"ddv-display-mode"},super(t),xw(this);}updateUiState(t){const{el:e}=this;Kb.forEach(((i,n)=>{t===i.displayName?(e.classList.add(i.className),this.selectChildren(n)):e.classList.remove(i.className);}));}bindDefaultUi(){super.bindDefaultUi();const t=this.injection.viewer,e=()=>{const{displayMode:e}=t.getViewerConfig();this.updateUiState(e);};t.hooks.displayModeChanged.on((t=>{this.updateUiState(t.newDisplayMode);}),this),t.hooks.openDocument.on((()=>{const e=t.context.getActiveTab();e&&this.updateUiState(e.context.displayMode);}),this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}i(tC,"cpName","DisplayMode");class eC extends Dw{constructor(t,e){super(t,{class:e.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:e.displayMode});}}),i(this,"displayMode",void 0),this.displayMode=e.displayMode,xw(this);}bindDefaultUi(){const t=this.injection.viewer,e=e=>{var i;const n=t.getActiveTab(),s=(null==e?void 0:e.pageCount)||t.getPageCounts(),o=(null==n||null===(i=n.context)||void 0===i?void 0:i.displayMode)||t.getViewerConfig().displayMode;s?o===this.displayMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.displayModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}class iC extends eC{constructor(t){super(t,{class:"ddv-continuous-mode",displayMode:"continuous"});}}i(iC,"cpName","ContinuousPage");class nC extends eC{constructor(t){super(t,{class:"ddv-multiple-mode",displayMode:"multiple"});}}i(nC,"cpName","MultiPage");class sC extends eC{constructor(t){super(t,{class:"ddv-single-mode",displayMode:"single"});}}i(sC,"cpName","SinglePage");const oC=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class rC extends Iw{constructor(t){const{FitMode_FitWindow:e,FitMode_FitWidth:i,FitMode_FitHeight:n,FitMode_ActualSize:s}=DC.getDisplayTextConfig(),{FitMode_FitWindow:o,FitMode_FitWidth:r,FitMode_FitHeight:a,FitMode_ActualSize:l}=uw;t.data.options={showCheckIcon:!0,showDropDownArrow:!0,...t.data.options,children:[{type:"FitWindow",label:e,id:o},{type:"FitWidth",label:i,id:r},{type:"FitHeight",label:n,id:a},{type:"ActualSize",label:s,id:l}],defaultClassName:"ddv-fit-type"},super(t),xw(this);}updateUiState(t){const{el:e}=this;"none"!==t?oC.forEach(((i,n)=>{t===i.displayName?(e.classList.add(i.className),this.selectChildren(n)):e.classList.remove(i.className);})):this.selectChildren(-1);}bindDefaultUi(){super.bindDefaultUi();const t=this.injection.viewer,e=()=>{const{fitMode:e}=t.getViewerConfig();this.updateUiState(e);};t.hooks.fitModeChanged.on((t=>{this.updateUiState(t.newFitMode);}),this),t.hooks.openDocument.on((()=>{const e=t.context.getActiveTab();e&&this.updateUiState(e.context.fitMode);}),this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}i(rC,"cpName","FitMode");class aC extends Dw{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection;t.updateViewerConfig({fitMode:e.fitMode});}}),i(this,"fitMode",void 0),this.fitMode=e.fitMode,xw(this);}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const e=t.getPageCounts(),i=t.getActiveTab();let{fitMode:n}=t.getViewerConfig();i&&(n=i.context.fitMode);const s=e>0&&n===this.fitMode;e>0?s?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.fitModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}class lC extends aC{constructor(t){super(t,{class:"ddv-fit-height",fitMode:"height"});}}i(lC,"cpName","FitHeight");class hC extends aC{constructor(t){super(t,{class:"ddv-fit-width",fitMode:"width"});}}i(hC,"cpName","FitWidth");class dC extends aC{constructor(t){super(t,{class:"ddv-fit-window",fitMode:"window"});}}i(dC,"cpName","FitWindow");class cC extends aC{constructor(t){super(t,{class:"ddv-fit-actual",fitMode:"actualSize"});}}i(cC,"cpName","ActualSize");class uC extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks();}bindHooks(){const{inserted:t}=this.hooks;t.on((()=>{var t;null===(t=this.injection.viewer)||void 0===t||t.context.viewService.bindContainer(this.el);}));}initTemplate(){const{options:t}=this.data;t.id=t.id||`ddvMainView${this.injection.viewer.postfix}`;const e=`<div ${iw(t,this.defaultClass,"")} ><slot></slot></div>`;this.template=e;}}i(uC,"cpName","MainView");class pC extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-pagination"),i(this,"cssPrefix",`${this.defaultClass}-`),i(this,"uiState","normal"),i(this,"input",void 0),i(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi();}bindHooks(){this.hooks.created.on((t=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`);}));}bindEvents(){const t=this.injection.viewer,e=this.query(`.${this.cssPrefix}goto`);this.nativeOn(e,"input",(t=>{const i=Aw(e),n=Math.min(i,this.totalSpan.clientWidth);e.style.width=`${n}px`;})),this.nativeOn(e,"blur",(()=>{const i=t.getPageCounts(),n=t.getCurrentPageIndex();let s=parseInt(e.value,10);Jn(s)?s<1?s=1:s>i&&(s=i):s=n+1,e.value=`${s}`,e.style.width=`${Aw(e)}px`,t.gotoPage(s-1);})),this.nativeOn(e,"keydown",(t=>{t.stopPropagation(),"Enter"===t.key&&e.blur();}));}setState(t){this.uiState!==t&&this.el&&("normal"===t?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=t);}bindDefaultUi(){const t=this.injection.viewer,e=e=>{const i=zn(null==e?void 0:e.total)?t.getPageCounts():null==e?void 0:e.total,n=zn(null==e?void 0:e.current)?t.getCurrentPageIndex():null==e?void 0:e.current;this.setState(i>0?"normal":"disabled"),this.input.value=`${n+1}`,this.totalSpan.innerText=`${i}`,this.input.style.width=`${Aw(this.input)}px`;};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on((()=>{this.uiState="normal",e(null);}));}initTemplate(){const{options:t}=this.data,{gotoPage:e,total:i,separator:n}=t,{cssPrefix:s,injection:o,defaultClass:r}=this,{viewer:a}=o,l=a.getCurrentPageIndex()+1,h=a.getPageCounts(),d=`<div ${iw(t,r,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${iw(e,s,"goto")} value="${l}" type="number" ><div ${iw(n,s,"separator")}></div><span ${iw(i,s,"total")} >${h}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=d;}}i(pC,"cpName","Pagination");class gC extends Dw{constructor(t,e){super(t,{class:e.class,callback:e.callback}),i(this,"type",void 0),this.type=e.type;}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const e=t.getPageCounts(),i=t.getCurrentPageIndex();let n=!1;switch(this.type){case"previous":case"first":n=e>0&&0!==i;break;case"last":case"next":n=i<e-1;}0===e&&(n=!1),this.setUiState(n?"normal":"disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e),t.hooks.pageChanged.on(e,this);}}class fC extends gC{constructor(t){super(t,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0);}});}}i(fC,"cpName","FirstPage");class yC extends gC{constructor(t){super(t,{class:"ddv-last-page",type:"last",callback:()=>{const t=this.injection.viewer,e=t.getPageCounts();t.gotoPage(e-1);}});}}i(yC,"cpName","LastPage");class mC extends gC{constructor(t){super(t,{class:"ddv-next-page",type:"next",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.gotoPage(e+1);}});}}i(mC,"cpName","NextPage");class vC extends gC{constructor(t){super(t,{class:"ddv-prev-page",type:"previous",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.gotoPage(e-1);}});}}i(vC,"cpName","PrevPage");class xC extends Dw{constructor(t){super(t,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:t}=this;if(!t)return;const{visibility:e}=t.getViewerConfig();t.updateViewerConfig({visibility:"visible"===e?"hidden":"visible"});}}),i(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",(t=>{if(this.thumbnail)return;const e=this.injection.viewer.context.core.getViewer(t);e&&(this.thumbnail=e,this.bindThumbnailHooks(e));const{visibility:i}=e.getViewerConfig();this.setUiState("visible"===i?"focused":"normal",!qn());})),this.injection.viewer.hooks.destroy.on((()=>{this.thumbnail=null;}),this);}bindThumbnailHooks(t){t.hooks.visibleChanged.on((t=>{this.setUiState("visible"===t.newVisibility?"focused":"normal",!qn());}),this);}bindDefaultUi(){const t=()=>{if(!this.thumbnail)return;const{visibility:t}=this.thumbnail.getViewerConfig();this.setUiState("visible"===t?"focused":"normal",!qn());};this.injection.viewer.hooks.pageExistenceChanged.on(t,this),this.hooks.updated.on(t);}}i(xC,"cpName","ThumbnailSwitch");class wC extends Dw{constructor(t,e){super(t,{class:e.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:e.toolMode,canvasStyle:{cursor:e.cursor}});}}),i(this,"toolMode",void 0),this.toolMode=e.toolMode,this.bindViewerHooks();}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{toolMode:e}=t.getViewerConfig();t.getPageCounts()>0?e===this.toolMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.toolModeChanged.on((e=>{const i=e.newToolMode===this.toolMode;t.getPageCounts()>0?i?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");}),this);}}class bC extends wC{constructor(t){super(t,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"});}}i(bC,"cpName","Pan");i(class extends wC{constructor(t){super(t,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"});}},"cpName","ZoomMode");class CC extends wC{constructor(t){super(t,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"});}}i(CC,"cpName","CropMode");class SC extends Dw{constructor(t){super(t,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn();}}),this.bindViewerHooks(),xw(this);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.zoomChanged.on((e=>{const{maxZoom:i}=t.getViewerConfig();t.getPageCounts()<1||e.newZoomRatio>=i?this.setUiState("disabled"):this.setUiState("normal");}),this);}}i(SC,"cpName","ZoomIn");class PC extends Dw{constructor(t){super(t,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut();}}),this.bindViewerHooks(),xw(this);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.zoomChanged.on((e=>{const{minZoom:i}=t.getViewerConfig();t.getPageCounts()<1||e.newZoomRatio<=i?this.setUiState("disabled"):this.setUiState("normal");}),this);}}i(PC,"cpName","ZoomOut");class AC extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-zoom-controller"),ow.registerComponent({ZoomIn:SC,ZoomOut:PC}),this.initTemplate();}initTemplate(){const{options:t}=this.data;Sw(Pw(this),this.injection.viewer,t);const e=`<div ${iw(t,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=e;}}i(AC,"cpName","Zoom");const TC=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class kC extends ew{constructor(t){super(t),i(this,"defaultClass","ddv-zoom-percentage"),i(this,"cssPrefix",`${this.defaultClass}-`),i(this,"isFirstClick",!0),i(this,"box",void 0),i(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),xw(this),mw(this),this.hooks.destroyed.on((()=>{this.dispose();}));}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents();})),this.hooks.inserted.on((()=>{const t=this.injection.viewer,{zoom:e}=t.getViewerConfig();this.updateZoom(e),this.updateZoomOption();})),this.hooks.updated.on((()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0;}));}bindDefaultUi(){const t=this.injection.viewer,e=()=>{Tw(this,0===t.getPageCounts()?"disabled":"normal"),this.updateZoom(t.getViewerConfig().zoom);};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const{viewer:t}=this.injection,{hooks:e}=t;e.zoomChanged.on((t=>{this.updateZoom(t.newZoomRatio);}),this),e.visibleChanged.on((e=>{if("hidden"===e.newVisibility)return void this.togglePopup(!1);const{zoom:i}=t.getViewerConfig();this.updateZoom(i);}),this);}bindEvents(){const{el:t,box:e}=this,i=t.querySelector(`.${this.cssPrefix}selector`),n=t.getElementsByTagName("input")[0],s=e.getElementsByTagName("ul")[0];this.nativeOn(i,"click",(()=>{const t=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Cw(t,this.el,this.box,!0,!0),this.isFirstClick=!1);})),this.inputEvent(n),this.ulEvent(s);}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{box:t}=this,e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:Cw(i,this.el,this.box,!0,!0);}),this);}inputEvent(t){const e=this.injection.viewer,{maxZoom:i,minZoom:n}=e.getViewerConfig();t.value=`${i}`;const s=Aw(t);function o(){const s=t.value/100,o=Qn(s,n,i);e.updateViewerConfig({zoom:o});}this.nativeOn(t,"input",(()=>{this.adaptInputWidth(s);})),this.nativeOn(t,"blur",o),this.nativeOn(t,"keydown",(t=>{t.stopPropagation();"Enter"===t.key&&o();}));}ulEvent(t){this.nativeOn(t,"click",(t=>{t.stopPropagation();const{viewer:e}=this.injection,{maxZoom:i,minZoom:n}=e.getViewerConfig(),s=t.target;if("LI"===s.tagName){const t=Qn(s.value,100*n,100*i);e.updateViewerConfig({zoom:t/100});}this.togglePopup(!1);}));}getZoomOptionTemplate(){var t;const e=(null===(t=this.data.options)||void 0===t?void 0:t.valueList)||null,i=this.injection.viewer,{maxZoom:n,minZoom:s}=i.getViewerConfig(),o=Fn(e)?e:TC,r=s<1e-4?.01:parseFloat((100*s).toFixed(2)),a=Math.floor(100*n);o.push(r,a);const l=Array.from(new Set(o)).sort(((t,e)=>t-e));let h="";return l.forEach((t=>{Jn(t)&&t<=100*n&&t>=100*s&&(h+=`<li value="${t}">${t}%</li>`);})),h}updateZoomOption(){const t=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=t;}updateZoom(t){const e=this.el.getElementsByTagName("input")[0],i=100*t;if(Number.isInteger(i))e.value=`${i}`;else {let t=i;t=t>=1e3?+t.toFixed(0).toString():t>=100?+t.toFixed(1).toString():t>=10?+t.toFixed(2).toString():+t.toFixed(3).toString(),e.value=`${t}`;}this.adaptInputWidth();}initTemplate(){const{options:t={}}=this.data,{input:e,selector:i,popupBox:n}=t,{cssPrefix:s}=this,{viewer:o}=this.injection;Sw(Pw(this),o,t);const r=`<div ${iw(t,this.defaultClass)}><div style="display: flex"><div ${iw(e,s,"input")}><input type="number"><span>%</span></div><div ${iw(i,s,"selector")}><i></i></div></div><div ${iw({id:`ddvZoomByPercentageSelectBox${o.postfix}`,...n},s,"selectbox")}><ul></ul></div></div>`;this.template=r;}adaptInputWidth(t){const e=this.el.getElementsByTagName("input")[0];let i=Aw(e);t&&i>t&&(i=t),e.style.width=`${i}px`;}togglePopup(t){const{viewer:e}=this.injection,{box:i}=this;let n="none"!==i.style.display;n=zn(t)?!n:t,n?(this.$emit("ui_hidePopup",this),e.rootDom.appendChild(i)):i.remove(),i.style.display=n?"":"none";}}i(kC,"cpName","ZoomByPercentage");class DC{static getTooltip(){return this.tooltip}static setTooltip(t){this.tooltip={...this.tooltip,...t};}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(t){this.displayTextConfig={...this.displayTextConfig,...t};}static registerAll(){ow.registerComponent({Capture:wb,Flashlight:bb,CameraConvert:Cb,CameraResolution:Pb,AutoDetect:xb,AutoCapture:vb,ImagePreview:Ab,RotateLeft:Vb,RotateRight:zb,Delete:Mb,DeleteAll:kb,DeleteCurrent:Db,Zoom:AC,ZoomIn:SC,ZoomOut:PC,ZoomByPercentage:kC,PerspectiveAll:Nb,FullQuad:_b,Restore:Hb,Undo:jb,Redo:Wb,FitMode:rC,FitWidth:hC,FitHeight:lC,FitWindow:dC,ActualSize:cC,DisplayMode:tC,SinglePage:sC,MultiPage:nC,ContinuousPage:iC,Pan:bC,Print:Bb,Filter:Yb,ThumbnailSwitch:xC,Back:Zb,Done:Qb,Pagination:pC,FirstPage:fC,LastPage:yC,NextPage:mC,PrevPage:vC,Root:dw,Layout:aw,Button:rw,MainView:uC,Load:Tb,Download:Rb,Close:Jb,Blank:qb,SeparatorLine:cw,CropCurrent:Lb,CropAll:Ob,CropMode:CC,Crop:$b,AnnotationSet:$w,EllipseAnnotation:Bw,EraseAnnotation:Lw,InkAnnotation:Uw,LineAnnotation:Ow,PolygonAnnotation:Nw,PolylineAnnotation:_w,RectAnnotation:Ww,SelectAnnotation:Fw,StampIconAnnotation:Hw,StampImageAnnotation:Vw,TextBoxAnnotation:zw,TextTypewriterAnnotation:jw,BasePullDownButton:Ew,PullDownListButton:Iw,PullDownMenuButton:Rw,BringForward:Yw,BringToFront:qw,SendBackward:Jw,SendToBack:Zw,AnnotationToolBar:Qw,AnnotationDeleteButton:eb,AnnotationPaletteButton:tb,AnnotationPalette:fb,AnnotationCustomStampPanel:mb});}}i(DC,"tooltip",{}),i(DC,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const EC={install(t){const e=function(t){var e,o,r,a;return e=new WeakMap,o=new WeakMap,r=new WeakMap,a=new WeakSet,class extends t{constructor(t){super(t),y(this,a),i(this,"ui",void 0),i(this,"rootDom",void 0),f(this,e,{writable:!0,value:!1}),f(this,o,{writable:!0,value:0}),f(this,r,{writable:!0,value:0}),DC.registerAll();const n=t.viewerConfig.enableAnnotationUi?this.getPopupUiConfig({annotationToolBarConfig:(null==t?void 0:t.annotationToolBarConfig)||{},annotationPaletteConfig:(null==t?void 0:t.annotationPaletteConfig)||{},annotationCustomStampPanelConfig:(null==t?void 0:t.annotationCustomStampPanelConfig)||{}}):[];this.ui=new ow({container:t.container,emitter:this.emitter,postfix:this.uid,uiConfig:t.uiConfig,popupUiConfig:n,injection:{viewer:this}}),t.container&&(t.uiConfig?(this.bindContainer(t.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi();}listenNativeEventsForUi(){this.on("click",(()=>{this.emit("ui_hidePopup","viewer");}));}getPopupUiConfig(t){const e={enabled:!0,isPaletteEnabled:!0,...t.annotationToolBarConfig,type:"AnnotationToolBar"},i={enabled:!0,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#FFFFFF","#CECECE"],enableChangeColor:!0,enableDrag:!0,autoDisplay:!0,enableCustomStamp:!1,...t.annotationPaletteConfig,type:"AnnotationPalette"},n={labels:{stampText:"Stamp Text",fontStyle:"Font Style",textColor:"TextColor",backgroundColor:"Background",borderColor:"BorderColor",timeStampText:"Timestamp Text",userName:"Username",date:"Date",time:"Time",create:"Create"},colorList:["#fdcccc","#f7fc7b","#c7d2e4","#d6e4cd","#910f05","#d5b142","#182564","#416a1c","#ffffff","#000000"],enabled:!1,autoDisplay:!0,...t.annotationCustomStampPanelConfig,type:"AnnotationCustomStampPanel"},s=[];return s.push(n),e.enabled&&s.push(e),i.enabled?s.push(i):e.isPaletteEnabled=!1,n.enabled&&s.push(n),s}addFontToUi(t){this.emit("ui_addFont",t);}toggleUiPopup(t,e){this.ui.emit("ui_changePalette_visible",t,e);}getUiConfig(){return Vn(this.ui.uiConfig)}updateUiConfig(t){const{resizeService:i}=this.context.core;i&&(i.unobserve(this.ui.rootDom),s(this,e,!1));const n=this.ui.updateUiConfig(t);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,p(this,a,l).call(this,this.ui.rootDom),n}getElementsByType(t){return Zn(t)?this.ui.getElementsByType(this.ui.rootVNode,t):""}bindContainer(t){let e=t;return Zn(t)&&(e=document.querySelector(`#${t}`)),e instanceof HTMLElement&&(p(this,a,l).call(this,this.ui.rootDom),this.ui.bindContainer(e),this.context.viewService.container=e,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1);}dispose(){var t;super.dispose(),null===(t=this.ui)||void 0===t||t.dispose();}};function l(t){if(n(this,e))return;const{resizeService:i}=this.context.core;i.observe(t),this.register(i.onResizeObserver.on((e=>{if(e.target===t){var i;let a=0,l=0;if((null===(i=e.borderBoxSize)||void 0===i?void 0:i.length)>0){const t=e.borderBoxSize[0];a=t.inlineSize,l=t.blockSize;}else a=t.offsetWidth,l=t.offsetHeight;const h=tf.create(n(this,o),n(this,r),a,l);s(this,o,a),s(this,r,l),this.hooks.resize.emit(h),this.emit("resized",{oldWidth:h.oldWidth,oldHeight:h.oldHeight,newWidth:h.newWidth,newHeight:h.newHeight});}}))),this.hooks.destroy.on((()=>{i.unobserve(t);})),s(this,e,!0);}}(t.getClass("Viewer"));t.setClass("Viewer",e);}};function IC(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function RC(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError;const MC="undefined"==typeof self;let BC,LC,UC,OC,NC;function _C(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function WC(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i}"undefined"!=typeof navigator&&(BC=navigator,LC=BC.userAgent,UC=BC.platform,OC=BC.mediaDevices),function(){if(!MC){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:BC.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:UC,search:"Win"},Mac:{str:UC},Linux:{str:UC}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||LC,r=s.search||e,a=s.verStr||LC,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||LC,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=LC.indexOf("Windows NT")&&(s="HarmonyOS"),NC={browser:i,version:n,OS:s};}MC&&(NC={browser:"ssr",version:0,OS:"ssr"});}(),OC&&OC.getUserMedia,"Chrome"===NC.browser&&NC.version>66||"Safari"===NC.browser&&NC.version>13||"OPR"===NC.browser&&NC.version>43||"Edge"===NC.browser&&NC.version,"function"==typeof SuppressedError&&SuppressedError;class FC{static multiply(t,e){const i=[];for(let n=0;n<3;n++){const s=e.slice(3*n,3*n+3);for(let e=0;e<3;e++){const n=[t[e],t[e+3],t[e+6]].reduce(((t,e,i)=>t+e*s[i]),0);i.push(n);}}return i}static identity(){return [1,0,0,0,1,0,0,0,1]}static translate(t,e,i){return FC.multiply(t,[1,0,0,0,1,0,e,i,1])}static rotate(t,e){var i=Math.cos(e),n=Math.sin(e);return FC.multiply(t,[i,-n,0,n,i,0,0,0,1])}static scale(t,e,i){return FC.multiply(t,[e,0,0,0,i,0,0,0,1])}}var HC,VC,zC,jC,$C,GC,XC,YC,qC;!function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra";}(HC||(HC={}));class JC{static get version(){return "1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(WC(JC,VC,!1,"f",zC),!1):(WC(JC,VC,!0,"f",zC),!0)}get disposed(){return _C(this,qC,"f")}constructor(){jC.set(this,HC.RGBA),$C.set(this,null),GC.set(this,null),XC.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,YC.set(this,null),qC.set(this,!1);}drawImage(t,e,i,n,s,o){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!n)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==_C(JC,VC,"f",zC)&&JC.checkWebGLSupport(),(null==o?void 0:o.bUseWebGL)&&!_C(JC,VC,"f",zC))throw new Error("Your browser or machine may not support WebGL.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let r;JC._onLog&&(r=Date.now(),JC._onLog("drawImage(), START: "+r));let a=0,l=0,h=i,d=n,c=0,u=0,p=i,g=n;s&&(s.sx&&(a=Math.round(s.sx)),s.sy&&(l=Math.round(s.sy)),s.sWidth&&(h=Math.round(s.sWidth)),s.sHeight&&(d=Math.round(s.sHeight)),s.dx&&(c=Math.round(s.dx)),s.dy&&(u=Math.round(s.dy)),s.dWidth&&(p=Math.round(s.dWidth)),s.dHeight&&(g=Math.round(s.dHeight)));let f,y=HC.RGBA;if((null==o?void 0:o.pixelFormat)&&(y=o.pixelFormat),(null==o?void 0:o.bufferContainer)&&(f=o.bufferContainer,f.length<4*p*g))throw new Error("Unexpected size of the 'bufferContainer'.");const m=t;if(!_C(JC,VC,"f",zC)||!(this.useWebGLByDefault&&null==(null==o?void 0:o.bUseWebGL)||(null==o?void 0:o.bUseWebGL))){JC._onLog&&JC._onLog("drawImage() in context2d."),m.ctx2d||(m.ctx2d=m.getContext("2d",{willReadFrequently:!0}));const t=m.ctx2d;if(!t)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return (m.width<c+p||m.height<u+g)&&(m.width=c+p,m.height=u+g),t.drawImage(e,a,l,h,d,c,u,p,g),JC._onLog&&JC._onLog("drawImage() in context2d end. Costs: "+(Date.now()-r)),{context:t,pixelFormat:HC.RGBA,bUseWebGL:!1}}JC._onLog&&JC._onLog("drawImage() in WebGL.");try{(m.width<c+p||m.height<u+g)&&(m.width=c+p,m.height=u+g,m.ctxWebGL&&m.ctxWebGL.viewport(0,0,c+p,u+g));const t=m.ctxWebGL||m.getContext("webgl",{antialias:!1})||m.getContext("experimental-webgl",{antialias:!1});if(!t){JC._onLog&&JC._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const t=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw t.name="WebGLError",t}if(!m.ctxWebGL||y!==_C(this,jC,"f")){m.ctxWebGL=t;const e=t=>{const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW),{positions:e,texCoords:i}},i=t=>{const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},n=(t,e)=>{const i=t.createProgram();if(e.forEach((e=>t.attachShader(i,e))),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const e=new Error(`An error occured linking the program: ${t.getProgramInfoLog(i)}.`);throw e.name="WebGLError",e}return t.useProgram(i),i},s=(t,e,i)=>{const n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=new Error(`An error occured compiling the shader: ${t.getShaderInfoLog(n)}.`);throw e.name="WebGLError",e}return n},o="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let r="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(y)&&(r=y.slice(0,3));const a=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,l=n(t,[s(t,t.VERTEX_SHADER,o),s(t,t.FRAGMENT_SHADER,a)]);WC(this,GC,{program:l,attribLocations:{vertexPosition:t.getAttribLocation(l,"a_position"),texPosition:t.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:t.getUniformLocation(l,"u_image"),uColorFactor:t.getUniformLocation(l,"uColorFactor"),uMatrix:t.getUniformLocation(l,"u_matrix"),uTextureMatrix:t.getUniformLocation(l,"u_textureMatrix")}},"f"),WC(this,XC,e(t),"f"),WC(this,$C,i(t),"f"),WC(this,jC,y,"f");}const s=(t,e,i)=>{t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);},o=(t,e,i)=>{const n=t.RGBA,s=t.RGBA,o=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n,s,o,i);},v=(t,e,o,r)=>{t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),s(t,o.positions,e.attribLocations.vertexPosition),s(t,o.texCoords,e.attribLocations.texPosition),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.uniform1i(e.uniformLocations.uSampler,0),t.uniform1f(e.uniformLocations.uColorFactor,[HC.GREY,HC.GREY32].includes(y)?1:0);let f,m,v=FC.translate(FC.identity(),-1,-1);v=FC.scale(v,2,2),v=FC.scale(v,1/t.canvas.width,1/t.canvas.height),f=FC.translate(v,c,u),f=FC.scale(f,p,g),t.uniformMatrix3fv(e.uniformLocations.uMatrix,!1,f),m=FC.translate(FC.identity(),a/i,l/n),m=FC.scale(m,h/i,d/n),t.uniformMatrix3fv(e.uniformLocations.uTextureMatrix,!1,m),t.drawArrays(t.TRIANGLES,0,6);};o(t,_C(this,$C,"f"),e),v(t,_C(this,GC,"f"),_C(this,XC,"f"),_C(this,$C,"f"));const x=f||new Uint8Array(4*p*g);if(t.readPixels(c,u,p,g,t.RGBA,t.UNSIGNED_BYTE,x),255!==x[3]){JC._onLog&&JC._onLog("Incorrect WebGL drawing .");const t=new Error("WebGL error: incorrect drawing.");throw t.name="WebGLError",t}return JC._onLog&&JC._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-r)),{context:t,pixelFormat:y===HC.GREY?HC.GREY32:y,bUseWebGL:!0}}catch(r){if(this.forceLoseContext(),null==(null==o?void 0:o.bUseWebGL))return JC._onLog&&JC._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(t,e,i,n,s,Object.assign({},o,{bUseWebGL:!1}));throw r.name="WebGLError",r}}readCvsData(t,e,i){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let n,s=0,o=0,r=t.canvas.width,a=t.canvas.height;if(e&&(e.x&&(s=e.x),e.y&&(o=e.y),e.width&&(r=e.width),e.height&&(a=e.height)),(null==i?void 0:i.length)<4*r*a)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const e=t;i?(e.readPixels(s,o,r,a,e.RGBA,e.UNSIGNED_BYTE,i),n=new Uint8Array(i.buffer,0,4*r*a)):(n=new Uint8Array(4*r*a),e.readPixels(s,o,r,a,e.RGBA,e.UNSIGNED_BYTE,n));}else if(t instanceof CanvasRenderingContext2D){let e;e=t.getImageData(s,o,r,a),n=new Uint8Array(e.data.buffer),null==i||i.set(n);}return n}transformPixelFormat(t,e,i,n){let s,o;if(JC._onLog&&(s=Date.now(),JC._onLog("transformPixelFormat(), START: "+s)),e===i)return JC._onLog&&JC._onLog("transformPixelFormat() end. Costs: "+(Date.now()-s)),n?new Uint8Array(t):t;const r=[HC.RGBA,HC.RBGA,HC.GRBA,HC.GBRA,HC.BRGA,HC.BGRA];if(r.includes(e))if(i===HC.GREY){o=new Uint8Array(t.length/4);for(let e=0;e<t.length;e+=4){const i=.21*t[e]+.71*t[e+1]+.07*t[e+2];o[e/4]=i;}}else if(i===HC.GREY32){o=n?new Uint8Array(t):t;for(let e=0;e<t.length;e+=4){const i=.21*t[e]+.71*t[e+1]+.07*t[e+2];o[e]=i,o[e+1]=i,o[e+2]=i;}}else {if(!r.includes(i))throw new Error("Unable to transform.");if(n){o=new Uint8Array(t);const n=e.indexOf("r"),s=e.indexOf("g"),r=e.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let e=0;e<t.length;e+=4)o[e+a]=t[e+n],o[e+l]=t[e+s],o[e+h]=t[e+r];}else {o=t;const n=e.indexOf("r"),s=e.indexOf("g"),r=e.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let e=0;e<t.length;e+=4){let i=[t[e],t[e+1],t[e+2]];o[e+a]=i[n],o[e+l]=i[s],o[e+h]=i[r];}}}else if(e===HC.GREY){if(i!==HC.GREY32)throw new Error("Unable to transform.");o=new Uint8Array(4*t.length);for(let e=0;e<t.length;e++)o[4*e]=t[e],o[4*e+1]=t[e],o[4*e+2]=t[e],o[4*e+3]=255;}else {if(e!==HC.GREY32)throw new Error("Unable to transform.");if(i!==HC.GREY)throw new Error("Unable to transform.");o=new Uint8Array(t.length/4);for(let e=0;e<t.length;e+=4)o[e/4]=t[e];}return JC._onLog&&JC._onLog("transformPixelFormat() end. Costs: "+(Date.now()-s)),o}getImageData(t,e,i,n,s){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!e||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==_C(JC,VC,"f",zC)&&JC.checkWebGLSupport(),(null==s?void 0:s.bUseWebGL)&&!_C(JC,VC,"f",zC))throw new Error("Your browser or machine may not support WebGL.");if(n.sx>e||n.sy>i||n.sx+n.sWidth>e||n.sy+n.sHeight>i)throw new Error("Invalid position.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let o;JC._onLog&&(o=Date.now(),JC._onLog("getImageData(), START: "+o));const r=Math.round(n.sx),a=Math.round(n.sy),l=Math.round(n.sWidth),h=Math.round(n.sHeight),d=Math.round(n.dWidth),c=Math.round(n.dHeight);let u=HC.RGBA;(null==s?void 0:s.pixelFormat)&&(u=s.pixelFormat);let p,g,f,y=null;if((null==s?void 0:s.bufferContainer)&&(y=s.bufferContainer),_C(JC,VC,"f",zC)&&(this.useWebGLByDefault&&null==(null==s?void 0:s.bUseWebGL)||(null==s?void 0:s.bUseWebGL))){JC._onLog&&JC._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),p=this._reusedWebGLCvs;try{if(y)if(u===HC.GREY){if(f=new Uint8Array(4*d*c),g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:u,bUseWebGL:!0,bufferContainer:f}),f=this.transformPixelFormat(f,g.pixelFormat,u),y){if(y.length<f.length)throw new Error("Unexpected size of the 'bufferContainer'.");y.set(f);}}else g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:u,bUseWebGL:!0,bufferContainer:y}),f=new Uint8Array(y.buffer,0,4*d*c),f=this.transformPixelFormat(f,g.pixelFormat,u);else u===HC.GREY?((!_C(this,YC,"f")||_C(this,YC,"f").length<4*d*c)&&WC(this,YC,new Uint8Array(4*d*c),"f"),f=new Uint8Array(_C(this,YC,"f").buffer,0,4*d*c)):f=new Uint8Array(4*d*c),g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:u,bUseWebGL:!0,bufferContainer:f}),f=this.transformPixelFormat(f,g.pixelFormat,u);}catch(n){if("WebGLError"===n.name&&(this.forceLoseContext(),null==(null==s?void 0:s.bUseWebGL)))return JC._onLog&&JC._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},Object.assign({},s,{bUseWebGL:!1}));throw n}}else if(JC._onLog&&JC._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),p=this._reusedCvs,g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:HC.RGBA,bUseWebGL:!1}),f=this.readCvsData(g.context,{width:d,height:c},null),f=this.transformPixelFormat(f,g.pixelFormat,u),y){if(y.length<f.length)throw new Error("Unexpected size of the 'bufferContainer'.");y.set(f);}return JC._onLog&&JC._onLog("getImageData() end. Costs: "+(Date.now()-o)),{data:f,pixelFormat:u,width:d,height:c,bUseWebGL:g.bUseWebGL}}convertDataToCvs(t,e,i,n){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof e||e<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const s=document.createElement("canvas");let o;if(s.width=e,s.height=i,n===HC.GREY){o=new Uint8ClampedArray(4*e*i);for(let e=0;e<o.length;e+=4)o[e]=t[e/4],o[e+1]=t[e/4],o[e+2]=t[e/4],o[e+3]=255;}else o=new Uint8ClampedArray(t.buffer);const r=new ImageData(o,e,i);return s.getContext("2d").putImageData(r,0,0),s}forceLoseContext(){if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),WC(this,$C,null,"f"),WC(this,GC,null,"f"),WC(this,XC,null,"f"),this._reusedWebGLCvs=null;}dispose(){this.forceLoseContext(),WC(this,qC,!0,"f");}}VC=JC,jC=new WeakMap,$C=new WeakMap,GC=new WeakMap,XC=new WeakMap,YC=new WeakMap,qC=new WeakMap,zC={value:void 0};var ZC,QC,KC,tS,eS,iS,nS,sS,oS,rS,aS,lS,hS,dS,cS,uS,pS,gS,fS,yS,mS,vS,xS,wS,bS,CS,SS,PS,AS,TS,kS,DS,ES,IS,RS,MS,BS,LS,US,OS,NS,_S,WS;class FS{constructor(){ZC.set(this,new Map),QC.set(this,!1);}get disposed(){return IC(this,QC,"f")}on(t,e){t=t.toLowerCase();const i=IC(this,ZC,"f").get(t);if(i){if(i.includes(e))return;i.push(e);}else IC(this,ZC,"f").set(t,[e]);}off(t,e){t=t.toLowerCase();const i=IC(this,ZC,"f").get(t);if(!i)return;const n=i.indexOf(e);-1!==n&&i.splice(n,1);}offAll(t){t=t.toLowerCase();const e=IC(this,ZC,"f").get(t);e&&(e.length=0);}fire(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};e||(e=[]),t=t.toLowerCase();const n=IC(this,ZC,"f").get(t);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let t of n){if(!t)continue;let s=[];if(i.copy)for(let t of e){try{t=JSON.parse(JSON.stringify(t));}catch(t){}s.push(t);}else s=e;let o=!1;if(i.async)setTimeout((()=>{this.disposed||n.includes(t)&&t.apply(i.target,s);}),0);else try{o=t.apply(i.target,s);}catch(t){}if(!0===o)break}}}dispose(){RC(this,QC,!0,"f");}}ZC=new WeakMap,QC=new WeakMap;const HS=(t,e,i,n)=>{if(!i)return t;let s=e+Math.round((t-e)/i)*i;return n&&(s=Math.min(s,n)),s};class VS{static get version(){return "2.0.12"}static isStorageAvailable(t){let e;try{e=window[t];const i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}static findBestRearCameraInIOS(t,e){if(!t||!t.length)return null;let i=!1;if((null==e?void 0:e.getMainCamera)&&(i=!0),i){const e=["후면 카메라","背面カメラ","後置鏡頭","后置相机","กล้องด้านหลัง","बैक कैमरा","الكاميرا الخلفية","מצלמה אחורית","камера на задней панели","задня камера","задна камера","артқы камера","πίσω κάμερα","zadní fotoaparát","zadná kamera","tylny aparat","takakamera","stražnja kamera","rückkamera","kamera på baksidan","kamera belakang","kamera bak","hátsó kamera","fotocamera (posteriore)","câmera traseira","câmara traseira","cámara trasera","càmera posterior","caméra arrière","cameră spate","camera mặt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=t.find((t=>e.includes(t.label.toLowerCase())));return null==i?void 0:i.deviceId}{const e=["후면","背面","後置","后置","านหลัง","बैक","خلفية","אחורית","задняя","задней","задна","πίσω","zadní","zadná","tylny","trasera","traseira","taka","stražnja","spate","sau","rück","posteriore","posterior","hátsó","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"],i=["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],n=["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],s=t.filter((t=>{const i=t.label.toLowerCase();return e.some((t=>i.includes(t)))}));if(!s.length)return null;const o=s.find((t=>{const e=t.label.toLowerCase();return i.some((t=>e.includes(t)))}));if(o)return o.deviceId;const r=s.find((t=>{const e=t.label.toLowerCase();return n.some((t=>e.includes(t)))}));return r?r.deviceId:s[0].deviceId}}static findBestRearCamera(t,e){if(!t||!t.length)return null;if(["iPhone","iPad","Mac"].includes(NC.OS))return VS.findBestRearCameraInIOS(t,{getMainCamera:null==e?void 0:e.getMainCameraInIOS});const i=["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"];for(let e of t){const t=e.label.toLowerCase();if(t&&i.some((e=>t.includes(e)))&&/\b0(\b)?/.test(t))return e.deviceId}return ["Android","HarmonyOS"].includes(NC.OS)?t[t.length-1].deviceId:null}static findBestCamera(t,e,i){return t&&t.length?"environment"===e?this.findBestRearCamera(t,i):"user"===e?null:e?void 0:null:null}static async playVideo(t,e,i){if(!t)throw new Error("Invalid 'videoEl'.");if(!e)throw new Error("Invalid 'source'.");return new Promise((async(n,s)=>{let o;const r=()=>{t.removeEventListener("loadstart",d),t.removeEventListener("abort",c),t.removeEventListener("play",u),t.removeEventListener("error",p),t.removeEventListener("loadedmetadata",y);};let a=!1;const l=()=>{a=!0,o&&clearTimeout(o),r(),n(t);},h=t=>{o&&clearTimeout(o),r(),s(t);},d=()=>{t.addEventListener("abort",c,{once:!0});},c=()=>{const t=new Error("Video playing was interrupted.");t.name="AbortError",h(t);},u=()=>{l();},p=()=>{h(new Error(`Video error ${t.error.code}: ${t.error.message}.`));};let g;const f=new Promise((t=>{g=t;})),y=()=>{g();};if(t.addEventListener("loadstart",d,{once:!0}),t.addEventListener("play",u,{once:!0}),t.addEventListener("error",p,{once:!0}),t.addEventListener("loadedmetadata",y,{once:!0}),"string"==typeof e||e instanceof String?t.src=e:t.srcObject=e,t.autoplay&&await new Promise((t=>{setTimeout(t,1e3);})),!a){i&&(o=setTimeout((()=>{r(),s(new Error("Failed to play video. Timeout."));}),i));try{t.src&&await t.load(),await t.play(),l();}catch(t){}if(!a){await f;try{await t.play(),l();}catch(t){h(t);}}}}))}static async testCameraAccess(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))return {ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let n;try{n=t?await navigator.mediaDevices.getUserMedia(t):await navigator.mediaDevices.getUserMedia({video:!0});}catch(t){return {ok:!1,errorName:t.name,errorMessage:t.message}}finally{null==n||n.getTracks().forEach((t=>{t.stop();}));}return {ok:!0}}get state(){if(!IC(this,uS,"f"))return "closed";if("pending"===IC(this,uS,"f"))return "opening";if("fulfilled"===IC(this,uS,"f"))return "opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(t){t&&VS.isStorageAvailable("localStorage")?RC(this,lS,!0,"f"):RC(this,lS,!1,"f");}get ifSaveLastUsedCamera(){return IC(this,lS,"f")}get isVideoPlaying(){return !(!IC(this,eS,"f")||IC(this,eS,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(t){var e,i,n;if(!(t instanceof HTMLElement)&&null!=t)throw new TypeError("Invalid 'element'.");null===(e=IC(this,vS,"f"))||void 0===e||e.removeEventListener("click",IC(this,mS,"f")),null===(i=IC(this,vS,"f"))||void 0===i||i.removeEventListener("touchend",IC(this,mS,"f")),null===(n=IC(this,vS,"f"))||void 0===n||n.removeEventListener("touchmove",IC(this,yS,"f")),RC(this,vS,t,"f"),t&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(NC.OS)?(t.addEventListener("touchend",IC(this,mS,"f")),t.addEventListener("touchmove",IC(this,yS,"f"))):t.addEventListener("click",IC(this,mS,"f")));}get tapFocusEventBoundEl(){return IC(this,vS,"f")}get disposed(){return IC(this,kS,"f")}constructor(t){var e,i;tS.add(this),eS.set(this,null),iS.set(this,void 0),nS.set(this,(()=>{"opened"===this.state&&IC(this,CS,"f").fire("resumed",null,{target:this,async:!1});})),sS.set(this,(()=>{IC(this,CS,"f").fire("paused",null,{target:this,async:!1});})),oS.set(this,void 0),rS.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],aS.set(this,void 0),lS.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,hS.set(this,void 0),dS.set(this,!0),cS.set(this,void 0),uS.set(this,void 0),pS.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},gS.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(t,e)=>{let i,n;const s=window.getComputedStyle(IC(this,eS,"f")).objectFit,o=this.getResolution(),r=IC(this,eS,"f").getBoundingClientRect(),a=r.left,l=r.top,{width:h,height:d}=IC(this,eS,"f").getBoundingClientRect();if(h<=0||d<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const c=h/d,u=o.width/o.height;let p=1;if("contain"===s)u>c?(p=h/o.width,i=(t-a)/p,n=(e-l-(d-h/u)/2)/p):(p=d/o.height,n=(e-l)/p,i=(t-a-(h-d*u)/2)/p);else {if("cover"!==s)throw new Error("Unsupported object-fit.");u>c?(p=d/o.height,n=(e-l)/p,i=(t-a+(d*u-h)/2)/p):(p=h/o.width,i=(t-a)/p,n=(e-l+(h/u-d)/2)/p);}return {x:i,y:n}},fS.set(this,!1),yS.set(this,(()=>{RC(this,fS,!0,"f");})),mS.set(this,(async t=>{var e;if(IC(this,fS,"f"))return void RC(this,fS,!1,"f");if(!IC(this,gS,"f"))return;if(!this.isVideoPlaying)return;if(!IC(this,iS,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(e=this.getCameraCapabilities())||void 0===e?void 0:e.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let i,n;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),t instanceof MouseEvent)i=t.clientX,n=t.clientY;else {if(!(t instanceof TouchEvent))throw new Error("Unknown event type.");if(!t.changedTouches.length)return;i=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;}const s=this.getResolution(),o=2*Math.round(Math.min(s.width,s.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let r;try{r=this.calculateCoordInVideo(i,n);}catch(t){}if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return;const a={x:r.x+"px",y:r.y+"px"},l=o+"px",h=l;let d;VS._onLog&&(d=Date.now());try{await IC(this,tS,"m",NS).call(this,a,l,h,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance);}catch(t){if(VS._onLog)throw VS._onLog(t),t}VS._onLog&&VS._onLog(`Tap focus costs: ${Date.now()-d} ms`),this._focusParameters.taskBackToContinous=setTimeout((()=>{var t;VS._onLog&&VS._onLog("Back to continuous focus."),null===(t=IC(this,iS,"f"))||void 0===t||t.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}));}),this._focusParameters.focusBackToContinousTime),IC(this,CS,"f").fire("tapfocus",null,{target:this,async:!1});})),vS.set(this,null),xS.set(this,1),wS.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!IC(this,eS,"f"))return;const t=IC(this,xS,"f");if(t<1)throw new RangeError("Invalid scale value.");if(1===t)IC(this,eS,"f").style.transform="";else {const e=window.getComputedStyle(IC(this,eS,"f")).objectFit,i=IC(this,eS,"f").videoWidth,n=IC(this,eS,"f").videoHeight,{width:s,height:o}=IC(this,eS,"f").getBoundingClientRect();if(s<=0||o<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const r=s/o,a=i/n;let l=1;"contain"===e?l=r<a?s/(i/t):o/(n/t):"cover"===e&&(l=a>r?o/(i/t):s/(n/t));const h=l*(1-1/t)*(i/2-IC(this,wS,"f").x),d=l*(1-1/t)*(n/2-IC(this,wS,"f").y);IC(this,eS,"f").style.transform=`translate(${h}px, ${d}px) scale(${t})`;}},bS.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const t=document.createElement("canvas");let e;if(t.width=this.width,t.height=this.height,this.pixelFormat===HC.GREY){e=new Uint8ClampedArray(this.width*this.height*4);for(let t=0;t<e.length;t+=4)e[t]=this.data[t/4],e[t+1]=this.data[t/4],e[t+2]=this.data[t/4],e[t+3]=255;}else e=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(e,this.width,this.height);return t.getContext("2d").putImageData(i,0,0),t})),CS.set(this,void 0),SS.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],PS.set(this,new Map),AS.set(this,!1),TS.set(this,(async()=>{var t,e;if("visible"===document.visibilityState){if(VS._onLog&&VS._onLog("document visible. video paused: "+(null===(t=IC(this,eS,"f"))||void 0===t?void 0:t.paused)),"opening"==this.state||"opened"==this.state){let t=!1;if(!this.isVideoPlaying){VS._onLog&&VS._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),t=!0;}catch(t){VS._onLog&&VS._onLog("document visible. 1st resume video failed, try open instead.");}t||await IC(this,tS,"m",MS).call(this);}if(await new Promise((t=>setTimeout(t,300))),!this.isVideoPlaying){VS._onLog&&VS._onLog("document visible. 1st open failed. 2rd resume start."),t=!1;try{await this.resume(),t=!0;}catch(t){VS._onLog&&VS._onLog("document visible. 2rd resume video failed, try open instead.");}t||await IC(this,tS,"m",MS).call(this);}}}else "hidden"===document.visibilityState&&(VS._onLog&&VS._onLog("document hidden. video paused: "+(null===(e=IC(this,eS,"f"))||void 0===e?void 0:e.paused)),"opening"==this.state||"opened"==this.state&&this.isVideoPlaying&&this.pause());})),kS.set(this,!1),(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia)||setTimeout((()=>{VS.onWarning&&VS.onWarning("The browser is too old or the page is loaded from an insecure origin.");}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),t instanceof HTMLVideoElement&&this.setVideoEl(t),RC(this,CS,new FS,"f"),this.imageDataGetter=new JC,document.addEventListener("visibilitychange",IC(this,TS,"f"));}setVideoEl(t){if(!(t&&t instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");t.addEventListener("play",IC(this,nS,"f")),t.addEventListener("pause",IC(this,sS,"f")),RC(this,eS,t,"f");}getVideoEl(){return IC(this,eS,"f")}releaseVideoEl(){var t,e;null===(t=IC(this,eS,"f"))||void 0===t||t.removeEventListener("play",IC(this,nS,"f")),null===(e=IC(this,eS,"f"))||void 0===e||e.removeEventListener("pause",IC(this,sS,"f")),RC(this,eS,null,"f");}isVideoLoaded(){return !!IC(this,eS,"f")&&4==IC(this,eS,"f").readyState}async open(){if(IC(this,cS,"f")&&!IC(this,dS,"f")){if("pending"===IC(this,uS,"f"))return IC(this,cS,"f");if("fulfilled"===IC(this,uS,"f"))return}IC(this,CS,"f").fire("before:open",null,{target:this}),await IC(this,tS,"m",MS).call(this),IC(this,CS,"f").fire("played",null,{target:this,async:!1}),IC(this,CS,"f").fire("opened",null,{target:this,async:!1});}async close(){if("closed"===this.state)return;IC(this,CS,"f").fire("before:close",null,{target:this});const t=IC(this,cS,"f");if(IC(this,tS,"m",LS).call(this),t&&"pending"===IC(this,uS,"f")){try{await t;}catch(t){}if(!1===IC(this,dS,"f")){const t=new Error("'close()' was interrupted.");throw t.name="AbortError",t}}RC(this,cS,null,"f"),RC(this,uS,null,"f"),IC(this,CS,"f").fire("closed",null,{target:this,async:!1});}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");IC(this,eS,"f").pause();}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await IC(this,eS,"f").play();}async setCamera(t){if("string"!=typeof t)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof IC(this,oS,"f").video&&(IC(this,oS,"f").video={}),delete IC(this,oS,"f").video.facingMode,IC(this,oS,"f").video.deviceId={exact:t},!("closed"===this.state||this.videoSrc||"opening"===this.state&&IC(this,dS,"f"))){IC(this,CS,"f").fire("before:camera:change",[],{target:this,async:!1}),await IC(this,tS,"m",BS).call(this);try{this.resetSoftwareScale();}catch(t){}return IC(this,rS,"f")}}async switchToFrontCamera(t){if("object"!=typeof IC(this,oS,"f").video&&(IC(this,oS,"f").video={}),(null==t?void 0:t.resolution)&&(IC(this,oS,"f").video.width={ideal:t.resolution.width},IC(this,oS,"f").video.height={ideal:t.resolution.height}),delete IC(this,oS,"f").video.deviceId,IC(this,oS,"f").video.facingMode={exact:"user"},RC(this,aS,null,"f"),!("closed"===this.state||this.videoSrc||"opening"===this.state&&IC(this,dS,"f"))){IC(this,CS,"f").fire("before:camera:change",[],{target:this,async:!1}),IC(this,tS,"m",BS).call(this);try{this.resetSoftwareScale();}catch(t){}return IC(this,rS,"f")}}getCamera(){var t;if(IC(this,rS,"f"))return IC(this,rS,"f");{let e=(null===(t=IC(this,oS,"f").video)||void 0===t?void 0:t.deviceId)||"";if(e){e=e.exact||e.ideal||e;for(let t of this._arrCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t))}return {deviceId:"",label:"",_checked:!1}}}async _getCameras(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;if(t){let t=await navigator.mediaDevices.getUserMedia({video:!0});n=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind)),t.getTracks().forEach((t=>{t.stop();}));}else n=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));const s=[],o=[];if(this._arrCameras)for(let t of this._arrCameras)t._checked&&o.push(t);for(let t=0;t<n.length;t++){let e,i=n[t];for(let t of o)if(i.deviceId==t.deviceId){e=t;break}e||(e={deviceId:i.deviceId,label:i.label?i.label:"camera "+t,_checked:!1}),e.deviceId&&s.push(e);}return this._arrCameras=s,VS._onLog&&VS._onLog(JSON.stringify(this._arrCameras)),s}async getCameras(){var t,e;if(!(null===(e=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===e?void 0:e.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(t,e,i){if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof IC(this,oS,"f").video&&(IC(this,oS,"f").video={}),i?(IC(this,oS,"f").video.width={exact:t},IC(this,oS,"f").video.height={exact:e}):(IC(this,oS,"f").video.width={ideal:t},IC(this,oS,"f").video.height={ideal:e}),"closed"===this.state||this.videoSrc||"opening"===this.state&&IC(this,dS,"f"))return null;IC(this,CS,"f").fire("before:resolution:change",[],{target:this,async:!1}),await IC(this,tS,"m",BS).call(this);try{this.resetSoftwareScale();}catch(t){}const n=this.getResolution();return {width:n.width,height:n.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&IC(this,eS,"f"))return {width:IC(this,eS,"f").videoWidth,height:IC(this,eS,"f").videoHeight};if(IC(this,iS,"f")){const t=IC(this,iS,"f").getSettings();return {width:t.width,height:t.height}}if(this.isVideoLoaded())return {width:IC(this,eS,"f").videoWidth,height:IC(this,eS,"f").videoHeight};{const t={width:0,height:0};let e=IC(this,oS,"f").video.width||0,i=IC(this,oS,"f").video.height||0;return e&&(t.width=e.exact||e.ideal||e),i&&(t.height=i.exact||i.ideal||i),t}}async getResolutions(t){var e,i,n,s,o,r,a,l,h,d,c;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let u="";const p=(t,e)=>{const i=IC(this,PS,"f").get(t);if(!i||!i.length)return !1;for(let t of i)if(t.width===e.width&&t.height===e.height)return !0;return !1};if(this._mediaStream){u=null===(c=IC(this,rS,"f"))||void 0===c?void 0:c.deviceId;let e=IC(this,PS,"f").get(u);if(e&&!t)return JSON.parse(JSON.stringify(e));e=[],IC(this,PS,"f").set(u,e),RC(this,pS,!0,"f");try{for(let t of this.detectedResolutions){await IC(this,iS,"f").applyConstraints({width:{ideal:t.width},height:{ideal:t.height}}),IC(this,tS,"m",ES).call(this);const i=IC(this,iS,"f").getSettings(),n={width:i.width,height:i.height};p(u,n)||e.push({width:n.width,height:n.height});}}catch(t){throw IC(this,tS,"m",LS).call(this),RC(this,pS,!1,"f"),t}try{await IC(this,tS,"m",MS).call(this);}catch(t){if("AbortError"===t.name)return e;throw t}finally{RC(this,pS,!1,"f");}return e}{const e=async(t,e,i)=>{const n={video:{deviceId:{exact:t},width:{ideal:e},height:{ideal:i}}};let s=null;try{s=await navigator.mediaDevices.getUserMedia(n);}catch(t){return null}if(!s)return null;const o=s.getVideoTracks();let r=null;try{const t=o[0].getSettings();r={width:t.width,height:t.height};}catch(t){const e=document.createElement("video");e.srcObject=s,r={width:e.videoWidth,height:e.videoHeight},e.srcObject=null;}return o.forEach((t=>{t.stop();})),r};let i=(null===(o=null===(s=null===(n=IC(this,oS,"f"))||void 0===n?void 0:n.video)||void 0===s?void 0:s.deviceId)||void 0===o?void 0:o.exact)||(null===(l=null===(a=null===(r=IC(this,oS,"f"))||void 0===r?void 0:r.video)||void 0===a?void 0:a.deviceId)||void 0===l?void 0:l.ideal)||(null===(d=null===(h=IC(this,oS,"f"))||void 0===h?void 0:h.video)||void 0===d?void 0:d.deviceId);if(!i)return [];let c=IC(this,PS,"f").get(i);if(c&&!t)return JSON.parse(JSON.stringify(c));c=[],IC(this,PS,"f").set(i,c);for(let t of this.detectedResolutions){const n=await e(i,t.width,t.height);n&&!p(i,n)&&c.push({width:n.width,height:n.height});}return c}}async setMediaStreamConstraints(t,e){if(!(t=>{return null!==t&&"[object Object]"===(e=t,Object.prototype.toString.call(e));var e;})(t))throw new TypeError("Invalid 'mediaStreamConstraints'.");RC(this,oS,JSON.parse(JSON.stringify(t)),"f"),RC(this,aS,null,"f"),e&&IC(this,tS,"m",BS).call(this);}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(IC(this,oS,"f")))}resetMediaStreamConstraints(){RC(this,oS,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f");}getCameraCapabilities(){if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return IC(this,iS,"f").getCapabilities?IC(this,iS,"f").getCapabilities():{}}getCameraSettings(){if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return IC(this,iS,"f").getSettings()}async turnOnTorch(){if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await IC(this,iS,"f").applyConstraints({advanced:[{torch:!0}]});}async turnOffTorch(){if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await IC(this,iS,"f").applyConstraints({advanced:[{torch:!1}]});}async setColorTemperature(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=HS(t,n.min,n.step,n.max)),await IC(this,iS,"f").applyConstraints({advanced:[{colorTemperature:t,whiteBalanceMode:"manual"}]}),t}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=HS(t,n.min,n.step,n.max)),await IC(this,iS,"f").applyConstraints({advanced:[{exposureCompensation:t}]}),t}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!n)throw Error("Not supported.");e&&(t<n.min?t=n.min:t>n.max&&(t=n.max));const s=this.getResolution();return await IC(this,iS,"f").applyConstraints({width:{ideal:Math.max(s.width,s.height)},frameRate:t}),t}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(t,e){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),n=null==i?void 0:i.focusMode,s=null==i?void 0:i.focusDistance;if(!n)throw Error("Not supported.");if("string"!=typeof t.mode)throw TypeError("Invalid 'mode'.");const o=t.mode.toLowerCase();if(!n.includes(o))throw Error("Unsupported focus mode.");if("manual"===o){if(!s)throw Error("Manual focus unsupported.");if(t.hasOwnProperty("distance")){let i=t.distance;e&&(i<s.min?i=s.min:i>s.max&&(i=s.max),i=HS(i,s.min,s.step,s.max)),this._focusParameters.focusArea=null,await IC(this,iS,"f").applyConstraints({advanced:[{focusMode:o,focusDistance:i}]});}else {if(!t.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const e=t.area.centerPoint;let i=t.area.width,n=t.area.height;if(!i||!n){const t=this.getResolution();i||(i=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),n||(n=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px");}this._focusParameters.focusArea={centerPoint:{x:e.x,y:e.y},width:i,height:n},await IC(this,tS,"m",NS).call(this,e,i,n);}}}else this._focusParameters.focusArea=null,await IC(this,iS,"f").applyConstraints({advanced:[{focusMode:o}]});}getFocus(){const t=this.getCameraSettings(),e=t.focusMode;return e?"manual"===e?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:t.focusDistance}:{mode:e}:null}async enableTapToFocus(){RC(this,gS,!0,"f");}disableTapToFocus(){RC(this,gS,!1,"f");}isTapToFocusEnabled(){return IC(this,gS,"f")}async setZoom(t){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if("number"!=typeof t.factor)throw new TypeError("Illegal type of 'factor'.");if(t.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");t.centerPoint?IC(this,tS,"m",_S).call(this,t.centerPoint):this.resetScaleCenter();try{if(IC(this,tS,"m",WS).call(this,IC(this,wS,"f"))){const e=await this.setHardwareScale(t.factor,!0);let i=this.getHardwareScale();1==i&&1!=e&&(i=e),t.factor>i?this.setSoftwareScale(t.factor/i):this.setSoftwareScale(1);}else await this.setHardwareScale(1),this.setSoftwareScale(t.factor);}catch(e){const i=e.message||e;if("Not supported."!==i&&"Camera is not open."!==i)throw e;this.setSoftwareScale(t.factor);}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let t=1;try{t=this.getHardwareScale();}catch(t){if("Camera is not open."!==(t.message||t))throw t}return {factor:t*IC(this,xS,"f")}}async resetZoom(){await this.setZoom({factor:1});}async setHardwareScale(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(!IC(this,iS,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=HS(t,n.min,n.step,n.max)),await IC(this,iS,"f").applyConstraints({advanced:[{zoom:t}]}),t}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(t,e){if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");e&&IC(this,tS,"m",_S).call(this,e),RC(this,xS,t,"f"),this.updateVideoElWhenSoftwareScaled();}getSoftwareScale(){return IC(this,xS,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();RC(this,wS,{x:t.width/2,y:t.height/2},"f");}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter();}getFrameData(t){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(IC(this,pS,"f"))return null;const e=Date.now();VS._onLog&&VS._onLog("getFrameData() START: "+e);const i=IC(this,eS,"f").videoWidth,n=IC(this,eS,"f").videoHeight;let s={sx:0,sy:0,sWidth:i,sHeight:n,dWidth:i,dHeight:n};(null==t?void 0:t.position)&&(s=JSON.parse(JSON.stringify(t.position)));let o=HC.RGBA;(null==t?void 0:t.pixelFormat)&&(o=t.pixelFormat);let r=IC(this,xS,"f");(null==t?void 0:t.scale)&&(r=t.scale);let a=IC(this,wS,"f");if(null==t?void 0:t.scaleCenter){if("string"!=typeof t.scaleCenter.x||"string"!=typeof t.scaleCenter.y)throw new Error("Invalid scale center.");let e=0,s=0;if(t.scaleCenter.x.endsWith("px"))e=parseFloat(t.scaleCenter.x);else {if(!t.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");e=parseFloat(t.scaleCenter.x)/100*i;}if(t.scaleCenter.y.endsWith("px"))s=parseFloat(t.scaleCenter.y);else {if(!t.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");s=parseFloat(t.scaleCenter.y)/100*n;}if(isNaN(e)||isNaN(s))throw new Error("Invalid scale center.");a.x=Math.round(e),a.y=Math.round(s);}let l=null;if((null==t?void 0:t.bufferContainer)&&(l=t.bufferContainer),0==i||0==n)return null;1!==r&&(s.sWidth=Math.round(s.sWidth/r),s.sHeight=Math.round(s.sHeight/r),s.sx=Math.round((1-1/r)*a.x+s.sx/r),s.sy=Math.round((1-1/r)*a.y+s.sy/r));const h=this.imageDataGetter.getImageData(IC(this,eS,"f"),i,n,s,{pixelFormat:o,bufferContainer:l});if(!h)return null;const d=Date.now();return VS._onLog&&VS._onLog("getFrameData() END: "+d),{data:h.data,width:h.width,height:h.height,pixelFormat:h.pixelFormat,timeSpent:d-e,timeStamp:d,toCanvas:IC(this,bS,"f")}}on(t,e){if(!IC(this,SS,"f").includes(t.toLowerCase()))throw new Error(`Event '${t}' does not exist.`);IC(this,CS,"f").on(t,e);}off(t,e){IC(this,CS,"f").off(t,e);}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),IC(this,CS,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",IC(this,TS,"f")),RC(this,kS,!0,"f");}}function zS(t,e){Jn(e)&&(t.config.maxFrameNumber=e);}function jS(t,e){Jn(e)&&(t.config.autoCaptureDelay=e);}function $S(t,e){if(!Xn(e))return;const{context:i}=t.viewer;i.core.detectorService.enableDetect&&(t.config.enableAutoDetect=e,t.isVideoPlaying&&(t.viewer.hooks.autoDetectChanged.emit(xf.create(e)),e?t.loop.startLoop():t.config.enableAutoCapture?t.loop.cancelAnimation():t.loop.closeLoop()));}function GS(t,e){Xn(e)&&(t.config.enableAutoCapture=e,t.isVideoPlaying&&(t.viewer.hooks.autoCaptureChanged.emit(vf.create(e)),e?t.loop.startLoop():t.config.enableAutoDetect||t.loop.closeLoop()));}function XS(t,e){Jn(e)&&(t.config.acceptedPolygonConfidence=e);}function YS(t,e){return !!t.videoEl&&(t.config.fullscreen=e,t.videoEl.style.objectFit=e?"cover":"contain",t.loop.updateVideoLayout(),!0)}eS=new WeakMap,iS=new WeakMap,nS=new WeakMap,sS=new WeakMap,oS=new WeakMap,rS=new WeakMap,aS=new WeakMap,lS=new WeakMap,hS=new WeakMap,dS=new WeakMap,cS=new WeakMap,uS=new WeakMap,pS=new WeakMap,gS=new WeakMap,fS=new WeakMap,yS=new WeakMap,mS=new WeakMap,vS=new WeakMap,xS=new WeakMap,wS=new WeakMap,bS=new WeakMap,CS=new WeakMap,SS=new WeakMap,PS=new WeakMap,AS=new WeakMap,TS=new WeakMap,kS=new WeakMap,tS=new WeakSet,DS=async function(){const t=this.getMediaStreamConstraints();if("boolean"==typeof t.video&&(t.video={}),t.video.deviceId);else if(IC(this,aS,"f"))delete t.video.facingMode,t.video.deviceId={exact:IC(this,aS,"f")};else if(this.ifSaveLastUsedCamera&&VS.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&i&&(t.video.width=e,t.video.height=i);}else if(this.ifSkipCameraInspection);else {const e=async t=>{let e=null;return "environment"===t&&["Android","HarmonyOS","iPhone","iPad"].includes(NC.OS)?(await this._getCameras(!1),IC(this,tS,"m",ES).call(this),e=VS.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):t||["Android","HarmonyOS","iPhone","iPad"].includes(NC.OS)||(await this._getCameras(!1),IC(this,tS,"m",ES).call(this),e=VS.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),e};let i=t.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const n=await e(i);n&&(delete t.video.facingMode,t.video.deviceId={exact:n});}return t},ES=function(){if(IC(this,dS,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},IS=async function(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;try{VS._onLog&&VS._onLog("======try getUserMedia========");let e=[0,500,1e3,2e3],i=null;const s=async t=>{for(let s of e){s&&(await new Promise((t=>setTimeout(t,s))),IC(this,tS,"m",ES).call(this));try{VS._onLog&&VS._onLog("ask "+JSON.stringify(t)),n=await navigator.mediaDevices.getUserMedia(t),IC(this,tS,"m",ES).call(this);break}catch(t){if("NotFoundError"===t.name||"NotAllowedError"===t.name||"AbortError"===t.name||"OverconstrainedError"===t.name)throw t;i=t,VS._onLog&&VS._onLog(t.message||t);}}};if(await s(t),n||"object"!=typeof t.video||(t.video.deviceId&&(delete t.video.deviceId,await s(t)),!n&&t.video.facingMode&&(delete t.video.facingMode,await s(t)),n||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,await s(t))),!n)throw i;return n}catch(t){throw null==n||n.getTracks().forEach((t=>{t.stop();})),"NotFoundError"===t.name&&(DOMException?t=new DOMException("No camera available, please use a device with an accessible camera.",t.name):(t=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),t}},RS=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((t=>{t.stop();})),this._mediaStream=null),RC(this,iS,null,"f");},MS=async function(){RC(this,dS,!1,"f");const t=RC(this,hS,Symbol(),"f");if(IC(this,cS,"f")&&"pending"===IC(this,uS,"f")){try{await IC(this,cS,"f");}catch(t){}IC(this,tS,"m",ES).call(this);}if(t!==IC(this,hS,"f"))return;const e=RC(this,cS,(async()=>{RC(this,uS,"pending","f");try{if(this.videoSrc){if(!IC(this,eS,"f"))throw new Error("'videoEl' should be set.");await VS.playVideo(IC(this,eS,"f"),this.videoSrc,this.cameraOpenTimeout),IC(this,tS,"m",ES).call(this);}else {let t=await IC(this,tS,"m",DS).call(this);IC(this,tS,"m",RS).call(this);let e=await IC(this,tS,"m",IS).call(this,t);await this._getCameras(!1),IC(this,tS,"m",ES).call(this);const i=()=>{const t=e.getVideoTracks();let i,n;if(t.length&&(i=t[0]),i){const t=i.getSettings();if(t)for(let e of this._arrCameras)if(t.deviceId===e.deviceId){e._checked=!0,e.label=i.label,n=e;break}}return n},n=IC(this,oS,"f");if("object"==typeof n.video){let s=n.video.facingMode;if(s instanceof Array&&s.length&&(s=s[0]),"object"==typeof s&&(s=s.exact||s.ideal),!(IC(this,aS,"f")||this.ifSaveLastUsedCamera&&VS.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||n.video.deviceId)){const n=i(),o=VS.findBestCamera(this._arrCameras,s,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});o&&o!=(null==n?void 0:n.deviceId)&&(e.getTracks().forEach((t=>{t.stop();})),t.video.deviceId={exact:o},e=await IC(this,tS,"m",IS).call(this,t),IC(this,tS,"m",ES).call(this));}}const s=i();(null==s?void 0:s.deviceId)&&(RC(this,aS,s&&s.deviceId,"f"),this.ifSaveLastUsedCamera&&VS.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",IC(this,aS,"f")),"object"==typeof t.video&&t.video.width&&t.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(t.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(t.video.height))))),IC(this,eS,"f")&&(await VS.playVideo(IC(this,eS,"f"),e,this.cameraOpenTimeout),IC(this,tS,"m",ES).call(this)),this._mediaStream=e;const o=e.getVideoTracks();(null==o?void 0:o.length)&&RC(this,iS,o[0],"f"),RC(this,rS,s,"f");}}catch(t){throw IC(this,tS,"m",LS).call(this),RC(this,uS,null,"f"),t}RC(this,uS,"fulfilled","f");})(),"f");return e},BS=async function(){var t;if("closed"===this.state||this.videoSrc)return;const e=null===(t=IC(this,rS,"f"))||void 0===t?void 0:t.deviceId,i=this.getResolution();await IC(this,tS,"m",MS).call(this);const n=this.getResolution();e&&e!==IC(this,rS,"f").deviceId&&IC(this,CS,"f").fire("camera:changed",[IC(this,rS,"f").deviceId,e],{target:this,async:!1}),i.width==n.width&&i.height==n.height||IC(this,CS,"f").fire("resolution:changed",[{width:n.width,height:n.height},{width:i.width,height:i.height}],{target:this,async:!1}),IC(this,CS,"f").fire("played",null,{target:this,async:!1});},LS=function(){IC(this,tS,"m",RS).call(this),RC(this,rS,null,"f"),IC(this,eS,"f")&&(IC(this,eS,"f").srcObject=null,this.videoSrc&&(IC(this,eS,"f").pause(),IC(this,eS,"f").currentTime=0)),RC(this,dS,!0,"f");try{this.resetSoftwareScale();}catch(t){}},US=async function t(e,i){const n=t=>{if(!IC(this,iS,"f")||!this.isVideoPlaying||t.focusTaskId!=this._focusParameters.curFocusTaskId){IC(this,iS,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const e=new Error(`Focus task ${t.focusTaskId} canceled.`);throw e.name="DeprecatedTaskError",e}1===this._focusParameters.isDoingFocus&&Date.now()-t.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1);};let s;i=HS(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await IC(this,iS,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(e),s=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((t=>{setTimeout(t,s);})),n(e);let o=e.focusL-e.focusW/2,r=e.focusT-e.focusH/2,a=e.focusW,l=e.focusH;const h=this.getResolution();if(o>=h.width||r>=h.height)throw new Error("Invalid area.");o+a>h.width&&(a=h.width-o),r+l>h.height&&(l=h.height-r),o=Math.round(o),r=Math.round(r),a=Math.round(a),l=Math.round(l);const d=4*h.width*h.height*this._focusParameters.defaultTempBufferContainerLenRatio,c=4*a*l;let u=this._focusParameters.tempBufferContainer;if(u){const t=u.length;d>t&&d>=c?u=new Uint8Array(d):c>t&&c>=d&&(u=new Uint8Array(c));}else u=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(d,c));if(!this.imageDataGetter.getImageData(IC(this,eS,"f"),h.width,h.height,{sx:o,sy:r,sWidth:a,sHeight:l,dWidth:a,dHeight:l},{pixelFormat:HC.RGBA,bufferContainer:u}))return IC(this,tS,"m",t).call(this,e,i);const p=u;let g=0;for(let t=0,e=c-8;t<e;++t){let e=p[t]-p[t+8];++t;let i=p[t]-p[t+8];++t;let n=p[t]-p[t+8];++t,g+=e*e+i*i+n*n;}return -g},OS=async function t(e,i,n,s,o,r,a){let l;if(i=HS(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=HS(s,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r?r=HS(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(r=HS(Math.sqrt((i||this._focusParameters.fds.step)*(s||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await IC(this,tS,"m",US).call(this,e,r)),a<=n&&a<=o?l=3:n<o&&n<a?l=1:o<n&&o<a&&(l=2),(s-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await IC(this,iS,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await IC(this,iS,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:s}]})),!0;if(1===l)return await IC(this,tS,"m",t).call(this,e,i,n,r,a);if(2===l)return await IC(this,tS,"m",t).call(this,e,r,a,s,o);if(3!==l)return n=await IC(this,tS,"m",US).call(this,e,i),o=await IC(this,tS,"m",US).call(this,e,s),await IC(this,tS,"m",t).call(this,e,i,n,s,o);let h=HS(Math.sqrt((i||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),d=HS(Math.sqrt((s||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/h)<=Math.abs(1/this._focusParameters.oldDistance-1/d)){let l=await IC(this,tS,"m",US).call(this,e,h);if(l<a)return await IC(this,tS,"m",t).call(this,e,i,n,r,a,h,l);if(l==a)return await IC(this,tS,"m",t).call(this,e,h,l,r,a);let c=await IC(this,tS,"m",US).call(this,e,d);if(l>a&&a<c)return await IC(this,tS,"m",t).call(this,e,h,l,d,c,r,a);if(a==c)return await IC(this,tS,"m",t).call(this,e,r,a,d,c);if(a>c)return await IC(this,tS,"m",t).call(this,e,r,a,s,o,d,c)}else {let l=await IC(this,tS,"m",US).call(this,e,d);if(a>l)return await IC(this,tS,"m",t).call(this,e,r,a,s,o,d,l);if(a==l)return await IC(this,tS,"m",t).call(this,e,r,a,d,l);let c=await IC(this,tS,"m",US).call(this,e,h);if(c>a&&a<l)return await IC(this,tS,"m",t).call(this,e,h,c,d,l,r,a);if(c==a)return await IC(this,tS,"m",t).call(this,e,h,c,r,a);if(c<a)return await IC(this,tS,"m",t).call(this,e,i,n,r,a,h,c)}return !1},NS=async function(t,e,i,n,s){var o;if(1==this._focusParameters.isDoingFocus)return !1;if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'centerPoint'.");if(!e||"string"!=typeof e)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const r=this.getResolution();let a=0,l=0;if(t.x.endsWith("px"))a=parseFloat(t.x);else {if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");a=parseFloat(t.x)/100*r.width;}if(t.y.endsWith("px"))l=parseFloat(t.y);else {if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(t.y)/100*r.height;}if(isNaN(a)||isNaN(l)||a<0||a>r.width||l<0||l>r.height)throw new Error("Invalid 'centerPoint'.");let h=0;if(e.endsWith("px"))h=parseFloat(e);else {if(!e.endsWith("%"))throw new Error("Invalid 'width'.");h=parseFloat(e)/100*r.width;}if(isNaN(h)||h<0)throw new Error("Invalid 'width'.");let d=0;if(i.endsWith("px"))d=parseFloat(i);else {if(!i.endsWith("%"))throw new Error("Invalid 'height'.");d=parseFloat(i)/100*r.height;}if(isNaN(d)||d<0)throw new Error("Invalid 'height'.");if(1!==IC(this,xS,"f")){const t=IC(this,xS,"f"),e=IC(this,wS,"f");h/=t,d/=t,a=(1-1/t)*e.x+a/t,l=(1-1/t)*e.y+l/t;}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(o=this.getCameraCapabilities())||void 0===o?void 0:o.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const c={focusL:a,focusT:l,focusW:h,focusH:d,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},u=async(t,e,i)=>{try{(null==e||e<this._focusParameters.fds.min)&&(e=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let n=HS(Math.sqrt(i*(e||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=HS(Math.sqrt((e||this._focusParameters.fds.step)*n),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=HS(Math.sqrt(n*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=await IC(this,tS,"m",US).call(this,t,o),a=await IC(this,tS,"m",US).call(this,t,s),l=await IC(this,tS,"m",US).call(this,t,n);if(a>l&&l<r){const e=await IC(this,tS,"m",OS).call(this,t,s,a,o,r,n,l);return this._focusParameters.isDoingFocus=0,e}if(a<l&&a<r){let i=await IC(this,tS,"m",US).call(this,t,e);const o=await IC(this,tS,"m",OS).call(this,t,e,i,n,l,s,a);return this._focusParameters.isDoingFocus=0,o}if(l>r&&a>r){let e=await IC(this,tS,"m",US).call(this,t,i);const s=await IC(this,tS,"m",OS).call(this,t,n,l,i,e,o,r);return this._focusParameters.isDoingFocus=0,s}if(a==l&&l<r){const e=await IC(this,tS,"m",OS).call(this,t,s,a,n,l);return this._focusParameters.isDoingFocus=0,e}if(l==r&&a>l){const e=await IC(this,tS,"m",OS).call(this,t,n,l,o,r);return this._focusParameters.isDoingFocus=0,e}return u(t,e,i)}catch(t){if("DeprecatedTaskError"!==t.name)throw t}};return u(c,n,s)},_S=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'center'.");const e=this.getResolution();let i=0,n=0;if(t.x.endsWith("px"))i=parseFloat(t.x);else {if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.x)/100*e.width;}if(t.y.endsWith("px"))n=parseFloat(t.y);else {if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.y)/100*e.height;}if(isNaN(i)||isNaN(n))throw new Error("Invalid scale center.");RC(this,wS,{x:i,y:n},"f");},WS=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},VS.browserInfo=NC,VS.onWarning=null===(KC=null===window||void 0===window?void 0:window.console)||void 0===KC?void 0:KC.warn;class qS{constructor(t){i(this,"isLooping",!1),i(this,"lastDetectTime",(new Date).getTime()),i(this,"loopTimer",void 0),i(this,"autoCaptureStartTime",0),i(this,"lastRenderedQuad",void 0),i(this,"animation",void 0),i(this,"cameraContext",void 0),i(this,"videoLayout",void 0),this.cameraContext=t;}getLoopState(){const{enableAutoCapture:t,enableAutoDetect:e}=this.cameraContext.config;return t||e}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime();}loopTimeout(){if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const t=this.getDetectRemainTime();this.loopTimer=setTimeout((async()=>{if(!this.getLoopState()||this.isLooping)return;this.isLooping=!0;const t=await this.loopTaskDetail();this.isLooping=!1,t&&this.getLoopState()&&setTimeout((()=>{this.getLoopState()&&this.loopTimeout();}),10);}),t);}async loopTaskDetail(){if(!(this.cameraContext&&this.cameraContext.isVideoPlaying&&this.cameraContext.videoEl&&this.cameraContext.canvasEl))return !1;if(!this.getLoopState())return !1;const{viewer:t}=this.cameraContext;if(this.lastDetectTime=(new Date).getTime(),!t.context.viewService.isBindContainer)return !0;if("hidden"===t.getViewerConfig().visibility)return !1;const{config:e}=this.cameraContext,{enableDetect:i}=t.context.core.detectorService,n=this.cameraContext.getFrameData();if(!n)return !1;const s={type:1,data:n.data.buffer,height:n.height,width:n.width};let o={success:!1};var r;i&&(o=await this.getDetectResult(s),0===n.data.length&&(n.data=new Uint8Array(s.data)),e.enableAutoDetect&&this.cameraContext.isVideoPlaying&&o.success&&null!==(r=o)&&void 0!==r&&r.location?(this.lastRenderedQuad?this.createDetectAnimation(this.lastRenderedQuad,o.location):this.drawQuadrilateral(o.location),this.lastRenderedQuad=o.location):(this.clearCanvas(),this.lastRenderedQuad=null));let a=!1;var l;if(e.enableAutoCapture){if((null===(l=o)||void 0===l?void 0:l.status)===exports.EnumDocumentDetectionStatus.AUTO_CAPTURE&&(a=!0),!i)if(this.autoCaptureStartTime<=0)this.autoCaptureStartTime=(new Date).getTime();else {(new Date).getTime()-this.autoCaptureStartTime>e.autoCaptureDelay&&(this.autoCaptureStartTime=0,a=!0);}}else this.autoCaptureStartTime=0;if(a){var h,d,c;if(null===(h=this.cameraContext.viewer)||void 0===h||!h.context)return !1;const t=await this.cameraContext.viewer.context.core.processService.resize(n.data.buffer,1,n.width,n.height,-1);if(this.cameraContext.isCapturedPages=!0,null===(d=this.cameraContext.viewer)||void 0===d||!d.context)return !1;await this.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(c=o)||void 0===c?void 0:c.location}],fileData:t.data}),this.startCaptureAnimation(),await JS(),this.closeCaptureAnimation();}return !0}getDetectRemainTime(){const t=(new Date).getTime(),{maxFrameNumber:e}=this.cameraContext.config,i=t-this.lastDetectTime;return Math.max(0,1e3/e-i)}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()));}closeLoop(){if(!this.loopTimer)return;const{context:t}=this.cameraContext.viewer,{detectorService:e}=t.core;e.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation);}updateVideoLayout(){const{videoEl:t,config:e}=this.cameraContext,{fullscreen:i}=e,{videoWidth:n,videoHeight:s}=t,{width:o,height:r}=t.getBoundingClientRect(),a={zoom:1,left:0,top:0};if(i){const t=Math.max(o/n,r/s);a.zoom=t;}else {const t=Math.min(o/n,r/s),e=(o-n*t)/2,i=(r-s*t)/2;a.zoom=t,a.left=e,a.top=i;}this.videoLayout=a;}async getDetectResult(t){const{cameraContext:e}=this,{context:i}=e.viewer,{detectorService:n}=i.core;if(!n.enableDetect)return Promise.resolve({success:!1});let s=t;if(!t){const t=e.getFrameData();s={type:1,data:t.data.buffer,height:t.height,width:t.width};}const{acceptedPolygonConfidence:o,enableAutoCapture:r,autoCaptureDelay:a}=e.config,l={acceptedPolygonConfidence:o,enableAutoCapture:r,autoCaptureDelay:a},h=await n.detect(s,l);return h||Promise.resolve({success:!1})}drawQuadrilateral(t){if(!this.loopTimer)return;const{canvasEl:e,viewer:i}=this.cameraContext;if(!e)return;const{zoom:n,left:s,top:o}=this.videoLayout,r=e.getContext("2d");r.save(),r.clearRect(0,0,e.width,e.height),r.translate(s,o),r.scale(n,n),r.beginPath(),r.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)r.lineTo(t[e][0],t[e][1]);r.closePath();const{quadSelectionStyle:a}=i.getViewerConfig(),{border:l,background:h}=a,{borderWidth:d,borderColor:c,borderStyle:u}=Es(l);let p=vr(d).value/n;0===p&&(p=1);const g="solid"===u?[0,0]:[5*p,2*p];r.strokeStyle=c,r.fillStyle=h,r.lineCap="round",r.lineWidth=p,r.setLineDash(g),r.fill(),r.stroke(),r.restore();}clearCanvas(){const{canvasEl:t}=this.cameraContext;if(!t)return;t.getContext("2d").clearRect(0,0,t.width,t.height);}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation);}createDetectAnimation(t,e){let i=0;const n=()=>{this.clearCanvas();const s=t.map(((t,n)=>{const s=e[n];return [t[0]+(s[0]-t[0])*i,t[1]+(s[1]-t[1])*i]}));this.drawQuadrilateral(s),i<1&&(i+=.2,this.animation=requestAnimationFrame(n));};n();}startCaptureAnimation(){var t,e;this.cameraContext&&null!==(t=this.cameraContext)&&void 0!==t&&t.videoEl&&null!==(e=this.cameraContext)&&void 0!==e&&e.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden");}closeCaptureAnimation(){var t,e;this.cameraContext&&null!==(t=this.cameraContext)&&void 0!==t&&t.videoEl&&null!==(e=this.cameraContext)&&void 0!==e&&e.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="");}}function JS(){return new Promise((t=>{setTimeout((()=>{t("");}),50);}))}const ZS={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},QS={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class KS{constructor(t){var e;if(i(this,"camera",void 0),i(this,"configHandler",{}),i(this,"isHttps",!0),i(this,"lastDeviceId",void 0),i(this,"userDeviceId",void 0),i(this,"isFirstPlayed",!0),i(this,"isTurningTorch",!1),i(this,"initializing",!1),i(this,"cameraContainer",void 0),i(this,"viewer",void 0),i(this,"loop",void 0),i(this,"videoEl",void 0),i(this,"canvasEl",void 0),i(this,"config",Vn(QS)),i(this,"bUser",!1),i(this,"canFrontCamera",!1),i(this,"isCapturedPages",!1),i(this,"lastEnvironmentCameraId",void 0),i(this,"cameraList",[]),i(this,"turnOnTheTorch",!1),i(this,"torchSupported",!1),this.viewer=t,this.camera=new VS,this.loop=new qS(this),this.initConfigHandler(),null!==(e=navigator)&&void 0!==e&&null!==(e=e.mediaDevices)&&void 0!==e&&e.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const t=this.getCameras().then((t=>{this.cameraList=t;})),e=this.getFrontCamera().then((t=>{this.canFrontCamera=t,this.viewer.hooks.cameraInit.emit(kf.create(t));})).catch((t=>{}));Promise.all([t,e]).finally((()=>{this.initializing=!1;}));}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents();}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks();}handleViewerModeChanged(){const{defaultDom:t,mainAndThbContainer:e}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const e=Wy(ZS,this.viewer.postfix);this.cameraContainer=e,Object.assign(e.style,this.viewer.context.viewerConfig.canvasStyle),t.appendChild(e);const i=e.getElementsByTagName("video")[0],n=e.getElementsByTagName("canvas")[0];i.setAttribute("playsinline","true"),i.setAttribute("muted","true"),i.setAttribute("disablePictureInPicture","true"),i.setAttribute("autoplay","autoplay"),i.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),i.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(i),this.bindCameraCanvas(n),this.updateCameraConfig(QS);}Hy(this.cameraContainer,"flex"),Fy(e);}else Fy(this.cameraContainer),Hy(e,"flex");}initConfigHandler(){const t={maxFrameNumber:zS,enableAutoCapture:GS,enableAutoDetect:$S,acceptedPolygonConfidence:XS,fullscreen:YS,autoCaptureDelay:jS};this.configHandler=t;}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on((()=>{this.isCaptureViewer&&this.getFrontCamera().then((t=>{this.canFrontCamera=t,this.viewer.hooks.cameraInit.emit(kf.create(t));})),this.handleViewerModeChanged();})),this.viewer.hooks.visibleChanged.on((t=>{this.loop.closeLoop(),"visible"===t.newVisibility&&this.loop.startLoop();}));}bindGlobalHooks(){this.viewer.context.core.documentService.onAddPagesToDoc.on((t=>{if(!this.isCapturedPages)return;const e=Wg.create(t.pageUids[0]);this.viewer.emit("captured",e),this.isCapturedPages=!1;}),this.viewer);}bindCameraEvents(){const{camera:t}=this;t.on("paused",(()=>{this.loop.closeLoop();})),t.on("resumed",(()=>{this.loop.closeLoop(),this.loop.startLoop();})),t.on("before:open",(()=>{this.videoEl&&(this.videoEl.style.opacity="0");})),t.on("before:resolution:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop();})),t.on("before:camera:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId;})),t.on("camera:changed",(()=>{const t=_g.create(this.lastDeviceId,this.camera.getCamera().deviceId);this.viewer.emit("cameraChanged",t);})),t.on("played",(()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:t}=this.config,e=this.camera.getResolution();let i="unsupported";try{const t=this.camera.getCameraCapabilities();i=null!=t&&t.torch?"supported":"unsupported";}catch(t){}this.torchSupported="supported"===i,this.emitTorchChanged(i),"supported"===i&&t&&this.turnOnTorch().catch((()=>{this.config.enableTorch=!0;})),this.viewer.hooks.cameraPlayed.emit(bf.create(e)),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop();})),t.on("closed",(()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.emitTorchChanged("unsupported"));}));}emitTorchChanged(t){this.viewer.hooks.torchChanged.emit(wf.create(t));}getVPointerEvent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=0,s=0,o=0,r=0;if(e){const{left:t,top:i}=e.getBoundingClientRect();o=t,r=i;}return t instanceof PointerEvent||t instanceof MouseEvent?(n=t.offsetX,s=t.offsetY):i?(n=t.changedTouches[0].clientX-o,s=t.changedTouches[0].clientY-r):(n=t.touches[0].clientX-o,s=t.touches[0].clientY-r),of.create(-1,"",-1,-1,Math.floor(n),Math.floor(s),t)}triggerPlayed(t){const e=Qg.create(this.camera.getCamera().deviceId,t);this.viewer.emit("played",e);}bindNativeEvents(){const t=this.canvasEl;if(!t)return;const e=t=>{const e=this.getVPointerEvent(t);this.viewer.emit("click",e);},i=t=>{this.viewer.emit("dblclick",this.getVPointerEvent(t));},n=t=>{t.preventDefault();const e=this.getVPointerEvent(t);this.viewer.emit("rightclick",e);},s=()=>{setTimeout((()=>{this.resize();}),500);},o=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop());};t.addEventListener("click",e),t.addEventListener("dblclick",i),t.addEventListener("contextmenu",n),document.addEventListener("visibilitychange",o),window.addEventListener("orientationchange",s),this.viewer.hooks.destroy.on((()=>{t.removeEventListener("click",e),t.removeEventListener("dblclick",i),t.removeEventListener("contextmenu",n),document.removeEventListener("visibilitychange",o),window.removeEventListener("orientationchange",s);}));}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===eg.CAPTURE}get isVideoPlaying(){return !!this.camera&&this.camera.isVideoPlaying}async getFrontCamera(){if(!this.isHttps)return wu.reject(wu.CAMERA_NEED_HTTPS);const t=await VS.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(t.ok)}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const t=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then((()=>(this.bUser=!0,this.lastEnvironmentCameraId=t,this.torchSupported&&this.emitTorchChanged("unsupported"),Promise.resolve())))}return this.setCamera(this.lastEnvironmentCameraId).then((()=>(this.bUser=!1,this.torchSupported&&this.emitTorchChanged("supported"),Promise.resolve())))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:t,height:e}=this.videoEl.getBoundingClientRect(),i=this.videoEl.videoWidth,n=this.videoEl.videoHeight,s=Math.max(t/i,e/n),o=t/(i*s),r=e/(n*s),a=Math.floor((1-o)/2*i),l=Math.floor((1-r)/2*n),h=Math.floor(i*o),d=Math.floor(n*r);return this.camera.getFrameData({position:{sx:a,sy:l,sWidth:h,sHeight:d,dWidth:h,dHeight:d}})}updateCameraConfig(t){for(const[e,i]of Object.entries(t)){const t=this.configHandler[e];t&&!zn(i)&&t(this,i);}}bindCameraVideo(t){t instanceof HTMLVideoElement&&(this.camera.setVideoEl(t),this.videoEl=t);}bindCameraCanvas(t){t instanceof HTMLCanvasElement&&(this.canvasEl=t);}async capture(){this.loop.startCaptureAnimation(),await JS(),this.loop.closeCaptureAnimation(),wu.verbose(`[${Date.now()}][cv] start capture`);const t=this.getFrameData();if(wu.verbose(`[${Date.now()}][cv] get frame done`),!t)return null;const e={type:1,data:t.data.buffer,width:t.width,height:t.height},i=await this.loop.getDetectResult(e);wu.verbose(`[${Date.now()}][cv] get detect result done`),0===t.data.length&&(t.data=new Uint8Array(e.data));const n=await this.viewer.context.core.processService.resize(t.data.buffer,1,t.width,t.height,-1);return wu.verbose(`[${Date.now()}][cv] create image done`),this.isCapturedPages=!0,await this.viewer.context.loadSource({fileData:n.data,extraPageData:[{index:0,perspectiveQuad:i.success?i.location:void 0}]}),wu.verbose(`[${Date.now()}][cv] capture done`),n.data}async play(t){if(!this.isHttps)return Promise.reject(wu.CAMERA_NEED_HTTPS);if(!t&&this.isVideoPlaying)return Promise.resolve();const{fill:e,resolution:i}=t||{},n=this.camera.getResolution();if(Xn(e)&&this.updateCameraConfig({fullscreen:e}),this.isVideoPlaying&&tP(i)&&i[0]===n.width&&i[1]===n.height)return Promise.resolve();let s=[n.width,n.height];if(tP(i)){if(this.isVideoPlaying)return this.camera.setResolution(i[0],i[1]).then((t=>(this.resize(),this.triggerPlayed(i),Promise.resolve()))).catch();this.camera.setResolution(i[0],i[1]),s=i;}return !this.isFirstPlayed||this.isVideoPlaying||i||"opening"===this.camera.state||(this.camera.setResolution(1280,720),s=[1280,720]),this.initializing&&await new Promise((t=>{const e=setInterval((()=>{this.initializing||(clearInterval(e),t(""));}),100);})),this.isFirstPlayed&&(this.isFirstPlayed=!1),this.camera.open().then((async()=>(this.resize(),this.triggerPlayed(s),Promise.resolve()))).catch((t=>{let e=wu.CAMERA_OCCUPIED;return "Permission denied"===t.message&&(e=wu.CAMERA_DENIED),8===t.code&&(e=wu.CAMERA_NO_CAMERA),Promise.reject(e)}))}stop(){var t;this.loop.closeLoop(),this.viewer.emit("stopped",nf.create(this.getCamera().deviceId)),null===(t=this.camera)||void 0===t||t.close();}async setCamera(t){let e="";Hn(t)?e=t.deviceId||"":Zn(t)&&(e=t);let i=!1;for(let t=0;t<this.cameraList.length;t++)this.cameraList[t].deviceId===e&&(i=!0);if(!i)return Promise.reject(wu.CAMERA_NOT_EXIST);await this.camera.setCamera(e).catch((t=>{let e=wu.CAMERA_OCCUPIED;"Permission denied"===t.message&&(e=wu.CAMERA_DENIED),8===t.code&&(e=wu.CAMERA_NO_CAMERA),Promise.reject(e);}));const n=this.camera.getResolution(),s={deviceId:e,width:n.width,height:n.height};return this.isVideoPlaying&&this.triggerPlayed([n.width,n.height]),Promise.resolve(s)}getCamera(){const t=this.camera.getCamera();return {deviceId:t.deviceId,label:t.label}}async getCameras(){const t=(await this.camera.getAllCameras()).map((t=>({deviceId:t.deviceId,label:t.label})));return Promise.resolve(t)}async setResolution(t,e){const i=this.camera.getCamera();if(!i||""===i.deviceId)return Promise.reject(wu.CAMERA_NOT_EXIST);let n;if(Jn(t))n=t;else if(Fn(t)){const[i,s]=t;n=i,e=s;}let s=this.camera.getResolution();return Jn(n)&&Jn(e)&&(this.loop.closeLoop(),s=await this.camera.setResolution(n,e).catch((t=>{}))),this.camera&&this.isVideoPlaying&&this.triggerPlayed([s.width,s.height]),Promise.resolve({deviceId:i.deviceId,...s})}getResolution(){const t=this.camera.getCamera();if(!t||""===t.deviceId)return [0,0];const e=this.camera.getResolution();return [e.width,e.height]}async getResolutions(){const t=(await this.camera.getResolutions()).map((t=>[t.width,t.height]));return Promise.resolve(t)}turnOnTorch(){const t=this.camera.getCamera();return t&&""!==t.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then((()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.emitTorchChanged("on"),Promise.resolve()))).catch((t=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),wu.reject(wu.CAMERA_NOT_SUPPORT_TORCH))))):Promise.reject(wu.CAMERA_NO_VIDEO)}turnOffTorch(){const t=this.camera.getCamera();return t&&""!==t.deviceId?this.camera.turnOffTorch().then((()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),Promise.resolve()))).catch((t=>wu.reject(wu.CAMERA_NOT_SUPPORT_TORCH))):Promise.reject(wu.CAMERA_NO_VIDEO)}resize(){const{canvasEl:t}=this,{width:e,height:i}=t.getBoundingClientRect();t.width=Math.floor(e),t.height=Math.floor(i),this.loop.updateVideoLayout();}dispose(){var t,e;this.stop(),null===(t=this.loop)||void 0===t||t.closeLoop(),null===(e=this.camera)||void 0===e||e.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null;}}function tP(t){return !!(Fn(t)&&Jn(t[0])&&Jn(t[1]))}const eP={install(t){const e=t.getClass("Viewer"),n=(s=e,class extends s{constructor(t){if(super(t),i(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===eg.CAPTURE){this.cameraContext=new KS(this);const e=QS;Hn(t.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach((i=>{i in t.viewerConfig&&(e[i]=t.viewerConfig[i]);})),this.cameraContext.config={...e,defaultCameraConfig:QS},this.on("resized",(()=>{this.cameraContext.resize();}));}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return Vn(this.cameraContext.config)}updateCameraConfig(t){Hn(t)&&this.cameraContext.updateCameraConfig(t);}capture(){return this.cameraContext.capture()}play(t){return this.cameraContext.play(t)}stop(){this.isVideoPlaying()?this.cameraContext.stop():wu.warning(wu.CAMERA_NO_VIDEO);}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(t){return this.cameraContext.setCamera(t)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(t,e){return this.cameraContext.setResolution(t,e)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}dispose(){var t;this.cameraContext&&(null===(t=this.cameraContext)||void 0===t||t.dispose()),this.cameraContext=null,super.dispose();}});var s;t.setClass("Viewer",n);}};class iP{constructor(t){i(this,"uid",void 0),i(this,"areaUid",void 0),i(this,"isRect",!0),i(this,"vertexes",[]),i(this,"midpoints",[]),i(this,"points",[]),i(this,"keepAspectRatio",!1),i(this,"isConvex",!0),i(this,"renderer",void 0),i(this,"area",void 0),i(this,"slopeRatio",[]),i(this,"selectedPart",-1),i(this,"startX",null),i(this,"startY",null),i(this,"lastX",null),i(this,"lastY",null),i(this,"lastAspectRatio",1),i(this,"b1",void 0),i(this,"b2",void 0),i(this,"k1",void 0),i(this,"k2",void 0),this.uid=ts(),Object.assign(this,t),this.initBox(t.vertexes);}initBox(t){this.vertexes=t,this.midpoints=nP(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=ms(this.vertexes);}getRect(){if(!this.isRect)return null;const{minX:t,maxX:e,minY:i,maxY:n}=this.getBounds();return {left:t,top:i,width:e-t||1,height:n-i||1}}getQuad(){if(this.isRect)return null;const{points:t}=this,e=[];for(let i=0;i<4;i++)e.push([t[2*i],t[2*i+1]]);return e}getActivePartNum(t,e,i){const n=this.getSelectedCtrlPointNum(t,e,i);if(n>-1)return n;return this.isPointOnBox(t,e)?8:-1}getSelectedCtrlPointNum(t,e,i){const{points:n}=this,{width:s,height:o,zoom:r}=this.area,{ctrlWidth:a,ctrlHeight:l,ctrlRadiusMultipleMobile:h}=this.renderer.config.boxStyle;let d=l/2/r,c=a/2/r;i&&(c*=h,d*=h);const u=Qn(c,0,3*c),p=Qn(d,0,3*d);for(let i=0;i<8;i++){const r=n[2*i],a=n[2*i+1];if(t<=r+u&&t>=r-u&&e<=a+p&&e>=a-p&&t>=0-u&&t<=s+u&&e>=0-p&&e<=o+p&&(i<4&&this.renderer.config.enableEditCropBoxVertices||this.renderer.config.enableEditCropBoxMidpoints))return i}return -1}checkOrientation(t){if(t<0||t>7)return null;const{minX:e,maxX:i,minY:n,maxY:s}=this.getBounds(),{points:o}=this,r=o[2*t],a=o[2*t+1];let l="",h="";return r===i?l="e":r===e&&(l="w"),a===s?h="s":a===n&&(h="n"),t<4?h+l:h||l}onStartHandler(t,e,i,n){var s;if(null!==(s=i)&&void 0!==s||(i=this.getActivePartNum(t,e,n)),!(i<0)&&(this.startX=t,this.startY=e,this.lastX=t,this.lastY=e,this.selectedPart=i,!this.isRect&&i>3&&i<8)){const{points:t,slopeRatio:e}=this,n=i-4;this.k1=e[(n+1)%4],this.b1=t[(2*n+3)%8]-this.k1*t[(2*n+2)%8],this.k2=e[(n+3)%4],this.b2=t[(2*n+1)%8]-this.k2*t[(2*n+0)%8];}}onMoveHandler(t,e,i){const{selectedPart:n}=this;if(n<0)return;const s=t-this.lastX,o=e-this.lastY;if(0===s&&0===o)return;const{points:r}=this;let a=r.slice();var l;n<8?(null!==(l=i)&&void 0!==l||(i=n),this.isRect?a=this.moveRectPoint(a,i,t,e):(a=this.moveQuadPoint(a,i,t,e),this.slopeRatio=ms(r).slice(0,4),this.isConvex=vs(a))):8===n&&(a=this.moveBox(a,s,o));const h=nP(a);this.points=a.slice(0,8).concat(h),this.midpoints=h,this.lastX=t,this.lastY=e;}onEndHandler(){const{startX:t,startY:e,vertexes:i,midpoints:n,lastX:s,lastY:o,selectedPart:r}=this;if(r<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let a=this.points.slice();const l=vs(a);(t===s&&e===o||!l)&&(a=i.slice().concat(n)),this.isConvex=!0,this.vertexes=a.slice(0,8),this.midpoints=nP(a),this.points=a.slice(0,8).concat(this.midpoints),this.slopeRatio=ms(a).slice(0,4);}getBounds(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return {minX:Math.min(t[0],t[2],t[4],t[6]),maxX:Math.max(t[0],t[2],t[4],t[6]),minY:Math.min(t[1],t[3],t[5],t[7]),maxY:Math.max(t[1],t[3],t[5],t[7])}}moveRectPoint(t,e,i,n){let s=0,o=0;const{enableEditCropBoxMidpoints:r,enableEditCropBoxVertices:a}=this.renderer.config;if(this.keepAspectRatio){const{minX:l,maxX:h,minY:d,maxY:c}=this.getBounds(),u=this.checkOrientation(e);let p=(h-l)/(c-d);0===p||p===1/0||p===-1/0||Number.isNaN(p)?p=this.lastAspectRatio:this.lastAspectRatio=p,s=0,o=0;let g="w",f=!1;if(e<4){if(a){if(f=!0,s=i-t[2*e],o=n-t[2*e+1],0===s||0===o)return t;g="w";}}else {const a=e-4;if(r){f=!0;const r={e:[(a+1)%4,"w"],s:[a,"h"],w:[a,"w"],n:[(a+1)%4,"h"]};if(["e","s","w","n"].includes(u)&&([e,g]=r[u]),s=i-t[2*a],o=n-t[2*a+1],0===s||0===o)return t}}if(f){const i=["ne","sw","n","w"];"h"===g?(s=o*p,i.includes(u)&&(s=-s)):(o=s/p,i.includes(u)&&(o=-o));const n=t[2*e]+s,r=t[2*e+1]+o,{width:a,height:l}=this.area;n<0?(s=0-t[2*e],o=0):n>a?(s=a-t[2*e],o=0):r<0?(o=0-t[2*e+1],s=0):r>l&&(o=l-t[2*e+1],s=0),t[2*e]+=s,t[2*e+1]+=o;const h=(e+1)%4,d=(e+3)%4;e%2?(t[2*h]+=s,t[2*d+1]+=o):(t[2*h+1]+=o,t[2*d]+=s);}}else if(e<4){if(a){if(s=i-t[2*e],o=n-t[2*e+1],0===s&&0===o)return t;t[2*e]=i,t[2*e+1]=n;const r=(e+1)%4,a=(e+3)%4;e%2?(t[2*r]=i,t[2*a+1]=n):(t[2*r+1]=n,t[2*a]=i);}}else {const s=e-4;if(r){const e=this.slopeRatio[s%4];0===e?(t[(2*s+3)%8]=n,t[(2*s+1)%8]=n):e!==1/0&&e!==-1/0||(t[(2*s+2)%8]=i,t[(2*s+0)%8]=i);}}return t}moveQuadPoint(t,e,i,n){const s=t.slice();if(e<4){const s=i-t[2*e],o=n-t[2*e+1];if(0===s&&0===o)return t;t[2*e]=i,t[2*e+1]=n;}else {const o=e-4,r=this.slopeRatio[o%4],a=n-r*i,l=-a/r,h=a,d=t[(2*o+9)%8]-r*t[(2*o+8)%8],c=-d/r,{k1:u,b1:p,k2:g,b2:f}=this;0===r?(t[(2*o+3)%8]=n,u!==1/0&&u!==-1/0&&(t[(2*o+2)%8]=(n-p)/u),t[(2*o+1)%8]=n,g!==1/0&&g!==-1/0&&(t[(2*o+0)%8]=(n-f)/g)):r===1/0||r===-1/0?(t[(2*o+2)%8]=i,t[(2*o+3)%8]=u*i+p,t[(2*o+0)%8]=i,t[(2*o+1)%8]=g*i+f):(0===u?t[(2*o+2)%8]+=l-c:u===1/0||u===-1/0?t[(2*o+3)%8]+=h-d:(t[(2*o+2)%8]=(p-a)/(r-u),t[(2*o+3)%8]=(r*p-u*a)/(r-u)),0===g?t[(2*o+0)%8]+=l-c:g===1/0||g===-1/0?t[(2*o+1)%8]+=h-d:(t[(2*o+0)%8]=(f-a)/(r-g),t[(2*o+1)%8]=(r*f-g*a)/(r-g)));for(let e=0;e<4;e++){const i=t[2*e],n=t[2*e+1];if(i<0||i>this.area.width||n<0||n>this.area.height)return s}}return t}moveBox(t,e,i){const{minX:n,maxX:s,minY:o,maxY:r}=this.getBounds(t);e=Qn(e,-n,this.area.width-s),i=Qn(i,-o,this.area.height-r);for(let n=0;n<4;n++)t[2*n]+=e,t[2*n+1]+=i;return t}isPointOnBox(t,e){if(this.isRect){const{minX:i,maxX:n,minY:s,maxY:o}=this.getBounds();return t>=i&&t<=n&&e>=s&&e<=o}const i=[...this.vertexes],n=[...this.midpoints],s=[];for(let t=0;t<4;t++)s.push([i[2*t],i[2*t+1]]),s.push([n[2*t],n[2*t+1]]);return function(t,e){let i,n,s,o,r=0;const a=e.length;for([s]=e,i=1;i<=a;i++)o=e[i%a],t[0]>Math.min(s[0],o[0])&&t[0]<=Math.max(s[0],o[0])&&t[1]<=Math.max(s[1],o[1])&&s[0]!==o[0]&&(n=(t[0]-s[0])*(o[1]-s[1])/(o[0]-s[0])+s[1],(s[1]===o[1]||t[1]<=n)&&(r+=1)),s=o;if(r%2==0)return !1;return !0}([t,e],s)}}function nP(t){const e=t.slice(0,8).concat(t[0],t[1]),i=[];for(let t=0;t<4;t++){const n=(e[2*t]+e[2*(t+1)])/2,s=(e[2*t+1]+e[2*(t+1)+1])/2;i.push(n,s);}return i}class sP{constructor(t,e,n){i(this,"areaUid",void 0),i(this,"left",void 0),i(this,"top",void 0),i(this,"width",void 0),i(this,"height",void 0),i(this,"boxes",void 0),i(this,"isVisible",!0),i(this,"zoom",1),i(this,"oldRect",void 0),i(this,"oldQuad",void 0),i(this,"isModified",!1),i(this,"isDrawNewBox",!1),i(this,"activeBoxUid",void 0),i(this,"activePartNum",-1),i(this,"startX",void 0),i(this,"startY",void 0),i(this,"isMouseDown",!1),i(this,"isDrawing",!1),i(this,"renderer",void 0),this.renderer=t,this.areaUid=e,this.boxes=[],this.updateAreaRect(n);}hasActiveBox(){return !!this.activeBoxUid}getFullVertexes(){return [0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(t){return t.left>=0&&t.left<=this.width&&t.left+t.width<=this.width&&t.top>=0&&t.top<=this.height&&t.top+t.height<=this.height}isContainBox(t){const e=t.getRect();return this.isContainRect(e)}isFullBox(t){const{vertexes:e}=t;return 0===e[0]&&0===e[1]&&e[2].toFixed(2)===this.width.toFixed(2)&&0===e[3]&&e[4].toFixed(2)===this.width.toFixed(2)&&e[5].toFixed(2)===this.height.toFixed(2)&&0===e[6]&&e[7].toFixed(2)===this.height.toFixed(2)}addRectBox(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t=this.handleBoundary(t),this.addBox(t,!0,e)}updateRectBox(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t.getRect(),s=t.getQuad();if(e=this.handleBoundary(e),t.initBox(e),i){const e={box:t};t.isRect?(e.oldRect=n,e.newRect=t.getRect()):(e.oldQuad=s,e.newQuad=t.getQuad()),this.renderer.hooks.boxModified.emit(e);}}handleBoundary(t){t=[...t];for(let e=0;e<4;e++){const i=[t[2*e],t[2*e+1]];i[0]=Qn(i[0],0,this.width),i[1]=Qn(i[1],0,this.height),[t[2*e],t[2*e+1]]=i;}return t}addQuadBox(t){return this.addBox(t,!1)}addBox(t){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=new iP({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...t],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(i),e&&this.renderer.hooks.boxCreated.emit(i),i}getBoxRects(){return this.boxes.map(((t,e)=>({index:e,...t.getRect()})))}getBoxByUid(t){return this.boxes.find((e=>e.uid===t))}deleteBoxByUid(t){const e=this.boxes.findIndex((e=>e.uid===t));e>-1&&this.boxes.splice(e,1);}clearBoxes(){this.boxes.length=0;}updateAreaRect(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height;}setKeepAspectRatio(t){this.isDrawing||this.boxes.forEach((e=>{e.keepAspectRatio=t;}));}isTouchedPoint(t,e,i){return t=Qn(t,0,this.width),e=Qn(e,0,this.height),this.boxes.some((n=>{const s=n.getActivePartNum(t,e,i);return s>-1&&s<8}))}isTouchedBox(t,e,i){return t=Qn(t,0,this.width),e=Qn(e,0,this.height),this.boxes.some((n=>n.getActivePartNum(t,e,i)>-1))}onStartHandler(t,e,i){this.isMouseDown=!0,t=Qn(t,0,this.width),e=Qn(e,0,this.height),this.startX=t,this.startY=e;const n=this.boxes.find((n=>{const s=n.getActivePartNum(t,e,i);return s>-1&&(this.activePartNum=s),s>-1}));n&&(this.oldRect=n.getRect(),this.oldQuad=n.getQuad(),this.activeBoxUid=n.uid,n.keepAspectRatio=this.renderer.config.keepAspectRatio,n.onStartHandler(t,e,void 0,i));}onMoveHandler(t,e,i,n){if(!this.isMouseDown)return;let s;if(t=Qn(t,0,this.width),e=Qn(e,0,this.height),this.activeBoxUid){if(s=this.getBoxByUid(this.activeBoxUid),!s)return;const{keepAspectRatioWithShift:n,keepAspectRatio:o,enableMoveQuad:r}=this.renderer.config;if(s.isRect)s.keepAspectRatio=!(!i||!n)||o;else if(!r&&8===this.activePartNum)return;return s.onMoveHandler(t,e),void(this.isModified=!0)}const{enableCreateBoxByPointer:o,enableMultiple:r}=this.renderer.config;if((r||!this.boxes.length)&&o){const{startX:i,startY:o}=this;let r=e-o;const a=t-i;let l=-1;const h=2/this.zoom;if(a<-h&&r<-h?l=0:a>h&&r<-h?l=1:a>h&&r>h?l=2:a<-h&&r>h&&(l=3),l>-1){const{aspectRatio:h}=this.renderer.config;h>0&&(r=a/h,l%2&&(r=-a/h));const d=[],c=l%2?[i,o,i,o+r,t,o+r,t,o]:[t,o+r,i,o+r,i,o,t,o];for(let t=0;t<4;t++)d.push(c[2*(l+t)%8]),d.push(c[(2*(l+t)+1)%8]);s=this.addRectBox(d,!1),this.isDrawNewBox=!0,s.keepAspectRatio=h>0,this.isDrawing=!0,this.activeBoxUid=s.uid,s.onStartHandler(this.startX,this.startY,l,n),s.onMoveHandler(t,e,l);}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const t=this.getBoxByUid(this.activeBoxUid);if(t){if(t.keepAspectRatio=this.renderer.config.keepAspectRatio,t.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(t);else if(this.isModified){const e={box:t};t.isRect?(e.oldRect=this.oldRect,e.newRect=t.getRect()):(e.oldQuad=this.oldQuad,e.newQuad=t.getQuad()),this.renderer.hooks.boxModified.emit(e);}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1;}}isPointHover(t){let[e,i]=t;return e>=0&&e<=this.width&&i>=0&&i<=this.height}getCursorInfo(t,e,i){for(let n=this.boxes.length-1;n>=0;n--){const s=this.boxes[n],o=s.getActivePartNum(t,e,i);if(o>-1){let t="move";return o<8&&(t=s.checkOrientation(o)),{part:o,position:t,isRect:s.isRect}}}return null}}const oP={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default",enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0};class rP{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,"areas",void 0),i(this,"scrollTop",0),i(this,"scrollLeft",0),i(this,"zoom",1),i(this,"config",void 0),i(this,"canvasDom",void 0),i(this,"isMousedown",!1),i(this,"isEditing",!1),i(this,"editingCursor","crosshair"),i(this,"hoveredArea",void 0),i(this,"hooks",{boxCreated:rs(),boxModified:rs(),boxDeleted:rs()}),this.areas=new Map,this.zoom=1,this.config=Vn(oP),js(t,this.config),this.setCanvasDom(t.canvas);}setCanvasDom(t){t&&(this.canvasDom=t);}updateConfig(t){js(t,this.config);}addArea(t,e){if(this.areas.has(t)){const i=this.areas.get(t);return i.updateAreaRect(e),i}const i=new sP(this,t,e);return this.areas.set(t,i),i}deleteArea(t){if(this.areas.has(t)){this.areas.get(t).boxes.forEach((t=>{this.hooks.boxDeleted.emit(t);})),this.areas.delete(t);}}clearArea(){this.areas.forEach((t=>{t.boxes.forEach((t=>{this.hooks.boxDeleted.emit(t);}));})),this.areas.clear();}clearAreaBoxes(t){if(this.areas.has(t)){const e=this.areas.get(t);e.boxes.forEach((t=>{this.hooks.boxDeleted.emit(t);})),e.clearBoxes();}}addRectBox(t,e){return this.areas.get(e).addRectBox(t)}addQuadBox(t,e){return this.areas.get(e).addQuadBox(t)}updateOptions(t){Object.assign(this,t),Jn(t.zoom)&&this.areas.forEach((e=>{e.zoom=t.zoom;}));}getAreaByUid(t){return this.areas.get(t)}deleteAreaByUid(t){this.areas.delete(t);}getHoveredArea(t){const e=this.nativeToCanvas(t);for(const t of this.areas.values()){const i=this.canvasToArea(e,t);if(t.isPointHover(i)&&t.isVisible)return t}return null}getHoveredAreaForCursor(t){const e=Is(t),i=this.nativeToCanvas(t);for(const t of this.areas.values()){const n=this.canvasToArea(i,t),[s,o]=n,r=t.isVisible&&t.boxes.find((t=>t.getActivePartNum(s,o,e)>-1));if(t.isPointHover(n)||r)return t}return null}isControlPointTouched(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return !1;const i=this.nativeToCanvas(t),[n,s]=this.canvasToArea(i,e),o=Is(t);return e.isTouchedPoint(n,s,o)}isBoxTouched(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return !1;const i=this.nativeToCanvas(t),[n,s]=this.canvasToArea(i,e),o=Is(t);return e.isTouchedBox(n,s,o)}onStartHandler(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return;this.hoveredArea=e,this.isMousedown=!0;const i=this.nativeToCanvas(t),[n,s]=this.canvasToArea(i,e),o=Is(t);e.onStartHandler(n,s,o);}onMoveHandler(t){if(!this.canvasDom)return;const{defaultCursor:e}=this.config,i=this.getHoveredArea(t);if(i){if(!i.isVisible)return}else this.canvasDom.style.cursor=e;const n=Is(t),s=this.nativeToCanvas(t);if(this.isMousedown){const[e,i]=this.canvasToArea(s,this.hoveredArea);this.hoveredArea.onMoveHandler(e,i,Bs(t),n);}if(this.config.enableCursor&&i){const t="crosshair",o="move",{canvasDom:r}=this;if(this.hasBox()){const[a,l]=this.canvasToArea(s,i),h=i.getCursorInfo(a,l,n);let d;if(null===h)d=this.config.enableMultiple?t:e;else if(h.isRect){const e=h.position===o;this.isMousedown?this.isEditing||(this.editingCursor=e?o:t,this.isEditing=!0):d=e?o:`${h.position}-resize`;}else h.part>-1&&h.part<8?this.isMousedown?this.isEditing||(this.editingCursor=t,this.isEditing=!0):d=t:d=e;this.isEditing&&(d=this.editingCursor),r.style.cursor=d;}else r.style.cursor!==t&&(r.style.cursor=t);}}hasBox(){for(const t of this.areas.values())if(t.isVisible&&t.boxes.length)return !0;return !1}onEndHandler(t){this.isMousedown&&(this.isMousedown=!1,this.isEditing=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null);}render(){if(!this.canvasDom||!this.areas.size)return;const t=this.canvasDom.getContext("2d");t.setTransform(1,0,0,1,0,0),this.areas.forEach((e=>{e.isVisible&&e.boxes.length&&this.renderArea(t,e);}));}renderArea(t,e){const{borderStyle:i,borderColor:n,borderWidth:s,ctrlBorderColor:o,ctrlBackground:r,ctrlBorderWidth:a,ctrlBorderStyle:l,background:h,maskColor:d,invalidBorderColor:c,invalidCtrlBorderColor:u,ctrlBorderRadius:p,ctrlWidth:g,ctrlHeight:f}=this.config.boxStyle,y=devicePixelRatio,m=g*y,v=f*y,x=Math.min(p*y,m/2,v/2),w=[i[0]*y,i[1]*y],b=s*y,C=a*y,S=[l[0]*y,l[1]*y];t.save(),t.beginPath(),t.rect(e.left*y,e.top*y,e.width*e.zoom*y,e.height*e.zoom*y),t.closePath(),t.clip(),this.config.enableMask&&d&&(t.save(),t.beginPath(),t.rect(e.left*y,e.top*y,e.width*e.zoom*y,e.height*e.zoom*y),e.boxes.forEach((i=>{let n=this.areaPointsToCanvas(i.points.slice(0,8),e),s=this.areaPointsToCanvas(i.midpoints.slice(0,8),e);1!==y&&(n=n.map((t=>t*y)),s=s.map((t=>t*y))),t.moveTo(n[0],n[1]);for(let e=1;e<4;e++)t.lineTo(n[2*e],n[2*e+1]);})),t.closePath(),t.clip("evenodd"),t.fillStyle=d,t.fill(),t.restore()),e.boxes.forEach((i=>{let s=this.areaPointsToCanvas(i.points.slice(0,8),e),a=this.areaPointsToCanvas(i.midpoints.slice(0,8),e);1!==y&&(s=s.map((t=>t*y)),a=a.map((t=>t*y))),t.save(),t.setLineDash(w),t.strokeStyle=i.isConvex?n:c,t.fillStyle=""===h?"transparent":h,t.lineWidth=b,t.beginPath(),t.moveTo(s[0],s[1]);for(let e=1;e<4;e++)t.lineTo(s[2*e],s[2*e+1]);t.closePath(),t.fill(),t.stroke(),t.setLineDash(S),t.strokeStyle=i.isConvex?o:u,t.fillStyle=""===r?"transparent":r,t.lineWidth=C,this.config.enableEditCropBoxVertices&&this.drawCtrlPoints(t,s,m,v,x,this.config.enableHideEditingCropBoxVertex?i.selectedPart:-1),this.config.enableEditCropBoxMidpoints&&this.drawCtrlPoints(t,a,m,v,x,this.config.enableHideEditingCropBoxMidpoint?i.selectedPart-4:-1),t.restore();})),t.restore();}drawCtrlPoints(t,e,i,n,s,o){const r=i/2,a=n/2;for(let l=0;l<4;l++){if(l===o)continue;t.beginPath();const h=e[2*l],d=e[2*l+1];if(0===s)t.rect(h-r,d-a,i,n);else {const{PI:e}=Math;t.arc(h-r+s,d-a+s,s,e,3*e/2),t.arc(h+r-s,d-a+s,s,3*e/2,2*e),t.arc(h+r-s,d+a-s,s,0,e/2),t.arc(h-r+s,d+a-s,s,e/2,e);}t.closePath(),t.fill(),t.stroke();}}areaPointsToCanvas(t,e){const i=[];for(let n=0;n<4;n++){const[s,o]=this.areaToCanvas([t[2*n],t[2*n+1]],e);i.push(s,o);}return i}canvasToArea(t,e){let[i,n]=t;const{scrollLeft:s,scrollTop:o,zoom:r}=this;return i=(i-e.left+s)/r,n=(n-e.top+o)/r,[i,n]}areaToCanvas(t,e){let[i,n]=t;const{scrollLeft:s,scrollTop:o,zoom:r}=this;return i=i*r+e.left-s,n=n*r+e.top-o,[i,n]}nativeToCanvas(t){const e=function(t){return ["touchstart","touchend","touchmove"].includes(t.type)}(t)?t.targetTouches[0]:t,i=this.canvasDom.getBoundingClientRect(),{scrollX:n,scrollY:s}=window;return [e.pageX-n-i.left,e.pageY-s-i.top]}}class aP{constructor(t){i(this,"canvas",void 0),i(this,"style",{type:"rect",size:100,borderColor:"#323232",borderWidth:3,magnification:3,crosshairWidth:1,crosshairColor:"#323232"}),Object.assign(this.style,t||{}),this.canvas=document.createElement("canvas");}render(t){const{type:e,size:i,borderColor:n,borderWidth:s,magnification:o,crosshairColor:r,crosshairWidth:a}=this.style,l=i/2*devicePixelRatio,h=i*devicePixelRatio,d=2*Math.PI,c=t.canvas.getContext("2d");c.save(),c.setTransform(1,0,0,1,0,0),t.targetX*devicePixelRatio<h&&t.targetY*devicePixelRatio<h?c.translate(t.canvas.width-l,l):c.translate(l,l),c.beginPath(),"circle"===e?c.arc(0,0,l,0,d):c.rect(-l,-l,h,h),c.clip(),c.scale(o,o),c.clearRect(-l,-l,2*l,2*l);const u=c.getImageData(t.targetX*devicePixelRatio-l,t.targetY*devicePixelRatio-l,h,h);this.canvas.width=h,this.canvas.height=h;this.canvas.getContext("2d").putImageData(u,0,0),c.drawImage(this.canvas,-l,-l,h,h),c.closePath(),c.strokeStyle=n,c.lineWidth=s,c.stroke(),c.beginPath();const p=.5*l/o;c.moveTo(0,-p),c.lineTo(0,p),c.moveTo(-p,0),c.lineTo(p,0),c.closePath(),c.strokeStyle=r,c.lineWidth=a/o,c.stroke(),c.restore();}}class lP{constructor(t,e){i(this,"context",void 0),i(this,"core",void 0),i(this,"boxRenderer",void 0),i(this,"viewer",void 0),i(this,"isMousedown",!1),i(this,"magnifier",void 0),i(this,"canvas",void 0),i(this,"isRenderMagnifier",!1),this.viewer=t,this.context=t.context,this.core=t.context.core,this.boxRenderer=e,this.magnifier=new aP(this.context.viewerConfig.croppingMagnifierStyle),this.canvas=this.context.rendererService.getCanvasDom();}isEditCropBox(t){const e=this.boxRenderer.getHoveredArea(t);return !(!e||!e.isVisible||e.boxes.length&&!this.boxRenderer.isBoxTouched(t))}mousedown(t){const{context:e}=this,i=this.context.getActiveTab();if(null==i||!i.total)return;if("crop"!==this.context.viewerConfig.toolMode)return;const[n]=this.context.toCanvas(t),{page:s}=this.context.getPointerOverPageInfo(n.pageX,n.pageY).pageInfo;if(i&&s&&s.uid!==i.currentUid){const t=i.getPageIndex(s);i.gotoPage(t),this.context.emitPageChangedEvent(i),this.context.core.viewerService.onCurrentChangedByScroll.emit(If.create(i.uid,e.groupUid,e.uid,t)),this.context.emitPageChangedAfterRenderEvent(i);}this.isMousedown=!0,this.boxRenderer.onStartHandler(t);const o=!this.boxRenderer.hasBox()||this.boxRenderer.isControlPointTouched(t);this.isRenderMagnifier=o,o&&e.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType)&&this.magnifier.render({target:this.canvas,targetX:n.pageX,targetY:n.pageY,canvas:this.canvas,canvasX:n.pageX,canvasY:n.pageY});}mousemove(t){const e=this.context.getActiveTab();if(null!=e&&e.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&t instanceof TouchEvent&&t.cancelable&&t.preventDefault(),this.boxRenderer.onMoveHandler(t),this.isMousedown&&this.context.render(),this.isRenderMagnifier&&this.context.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType))){const[e]=this.context.toCanvas(t);this.magnifier.render({target:this.canvas,targetX:e.pageX,targetY:e.pageY,canvas:this.canvas,canvasX:e.pageX,canvasY:e.pageY});}}mouseup(t){this.isMousedown&&(this.boxRenderer.onEndHandler(t),this.isRenderMagnifier=!1,this.isMousedown=!1,this.context.render());}afterPerspective(t){let{pageUid:e,docUid:i,width:n,height:s}=t;const{context:o}=this,r=o.tabService.getTab(i);if(!r)return;const a=r.getPageByUid(e);if(a&&(a.rWidth=n,a.rHeight=s,o.clearOptimization([a.uid])),r.isActive){if("crop"===o.viewerConfig.toolMode){this.boxRenderer.areas.forEach((t=>{t.clearBoxes();}));const t=this.boxRenderer.getAreaByUid(e),i=r.getPageByUid(e).getRect();null==t||t.updateAreaRect(i);}a&&(a.isLoaded=!1),o.scrollByCurrentChanged=!0;let t=!0;this.context.isDefaultViewer?"none"===r.context.fitMode&&(t=!1):this.context.isThumbnailViewer&&(t=!1),this.context.showTab(r,t);}}afterRotatePages(t){const{context:e}=this;if("crop"!==e.viewerConfig.toolMode)return;const i=this.context.getActiveTab();null!=i&&i.total&&i.uid===t.docUid&&(this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),t.pageUids.forEach((t=>{const e=this.boxRenderer.getAreaByUid(t),n=i.getPageByUid(t).getRect();null==e||e.updateAreaRect(n);})),this.context.render());}afterRender(t){const{context:e}=this;"crop"===e.viewerConfig.toolMode&&(t.pages.forEach((e=>{const i=this.boxRenderer.getAreaByUid(e.uid);if(i){if(e.isVisible){const t=e.getRect();i.updateAreaRect(t);}"current"===this.viewer.cropMode?i.isVisible=e.uid===t.currentUid:i.isVisible=e.isVisible;}})),this.boxRenderer.updateOptions({zoom:t.context.zoom}),this.boxRenderer.render());}toolModeChanged(t){if("crop"!==t.oldToolMode&&"crop"===t.newToolMode){const t=this.context.getActiveTab();if(!t)return;t.pages.forEach((e=>{const i=e.getRect(),n=this.boxRenderer.addArea(e.uid,i);"current"===this.viewer.cropMode?n.isVisible=e.uid===t.currentUid:n.isVisible=e.isVisible;})),this.boxRenderer.updateOptions({zoom:t.context.zoom});}else "crop"!==t.newToolMode&&"crop"===t.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render());}pageChanged(t){if("crop"!==this.context.viewerConfig.toolMode)return;return this.context.getActiveTab()?0===t.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(t){t.pageUids.forEach((t=>{this.boxRenderer.deleteArea(t);}));}updatePage(t){const{context:e}=this;if("crop"!==e.viewerConfig.toolMode)return;const i=e.getActiveTab();if(i&&i.uid===t.docUid)if("current"===this.viewer.cropMode&&t.pageUid===i.currentUid)this.resetPageCropArea();else if("all"===this.viewer.cropMode){const n=this.boxRenderer.getAreaByUid(t.pageUid),s=i.getPageByUid(t.pageUid).getRect();n.updateAreaRect(s),this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),e.render();}}addPages(t){const e=this.context.getActiveTab();null!=e&&e.total&&e.uid===t.docUid&&(t.pageUids.forEach((t=>{const i=e.getPageByUid(t),n=i.getRect();this.boxRenderer.addArea(i.uid,n),this.boxRenderer.updateOptions({zoom:e.context.zoom});})),this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})));}resetPageCropArea(){const t=this.context.getActiveTab();this.clearRedundantBoxes();const e=t.getCurrentPage(),i=e.getRect();this.boxRenderer.addArea(e.uid,i),this.boxRenderer.updateOptions({zoom:t.context.zoom}),this.context.render();}clearRedundantBoxes(){const t=this.context.getActiveTab();t&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach((e=>{e.areaUid!==t.currentUid&&this.boxRenderer.clearAreaBoxes(e.areaUid);}));}}class hP{constructor(t,e){i(this,"context",void 0),i(this,"core",void 0),i(this,"boxRenderer",void 0),i(this,"viewer",void 0),i(this,"isMousedown",!1),i(this,"canSlide",!1),i(this,"isStart",!1),i(this,"startX",void 0),i(this,"isSliding",void 0),i(this,"slideDistance",void 0),i(this,"slideDirection",void 0),i(this,"slideRAF",void 0),i(this,"tabX",void 0),i(this,"tabY",void 0),i(this,"magnifier",void 0),i(this,"canvas",void 0),i(this,"isRenderMagnifier",!1),this.viewer=t,this.context=t.context,this.core=t.context.core,this.boxRenderer=e,this.magnifier=new aP(this.context.viewerConfig.croppingMagnifierStyle),this.canvas=this.context.rendererService.getCanvasDom();}mousedown(t){const e=this.context.getActiveTab();if(null==e||!e.total)return;this.isMousedown=!0;if(!this.boxRenderer.isControlPointTouched(t)&&this.context.viewerConfig.enableSlide)this.canSlide=!0,this.slideStart(t);else {this.boxRenderer.onStartHandler(t);const e=this.boxRenderer.isControlPointTouched(t);if(this.isRenderMagnifier=e,e&&this.context.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType)){const[e]=this.context.toCanvas(t);this.magnifier.render({target:this.canvas,targetX:e.pageX,targetY:e.pageY,canvas:this.canvas,canvasX:e.pageX,canvasY:e.pageY});}}}mousemove(t){const e=this.context.getActiveTab();if(null==e||!e.total)return;if(Is(t)&&t.cancelable&&t.preventDefault(),this.canSlide)this.slideMove(t);else if(this.boxRenderer.onMoveHandler(t),this.isMousedown&&this.context.render(),this.isRenderMagnifier&&this.context.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType)){const[e]=this.context.toCanvas(t);this.magnifier.render({target:this.canvas,targetX:e.pageX,targetY:e.pageY,canvas:this.canvas,canvasX:e.pageX,canvasY:e.pageY});}}mouseup(t){this.isMousedown&&(this.canSlide?this.slideEnd(t):this.boxRenderer.onEndHandler(t),this.isRenderMagnifier=!1,this.canSlide=!1,this.isMousedown=!1,this.context.render());}reRender(){const{context:t}=this,e=t.getActiveTab();null!=e&&e.total&&"visible"===t.viewerConfig.visibility&&(this.updatePageQuad(e),t.render());}updatePage(t){const{context:e}=this,i=e.getActiveTab();null!=i&&i.total&&"visible"===e.viewerConfig.visibility&&i.currentUid===t.pageUid&&(this.updatePageQuad(i),e.render());}afterRender(t){if(null==t||!t.total)return;const{boxRenderer:e}=this;t.pages.forEach((t=>{const i=e.getAreaByUid(t.uid);if(i&&t.isVisible){const e=t.getRect();i.updateAreaRect(e);}})),e.updateOptions({zoom:t.context.zoom}),e.render();}pageChanged(t){if(-1===t.current&&0===t.total)return void this.boxRenderer.clearArea();const e=this.context.getActiveTab();e&&this.updatePageQuad(e);}updatePageQuad(t){const{context:e}=this,i=t.getCurrentPage();if(!i)return !1;let n=null;const s=this.boxRenderer.getAreaByUid(i.uid);s&&s.boxes[0]&&(n=s.boxes[0].getQuad());const o=e.core.pageService.getPage(t.currentUid);this.boxRenderer.clearArea();const r=i.getRect(),a=this.boxRenderer.addArea(i.uid,r);this.boxRenderer.updateOptions({zoom:t.context.zoom});const l=o.getQuadVertices(),h=a.addQuadBox(l);let d=h.getQuad();e.hooks.perspectiveQuadChanged.emit(Bf.create(h.getQuad(),o.isFull)),n&&(n=o.quadToPixelPPI(n)),d&&(d=o.quadToPixelPPI(d)),ry(n),ry(d);let c=!1;return n&&d&&(c=qs(n,d)),c||e.viewer.emit("quadModified",Kg.create(n,d)),h}afterRotatePages(t){const e=this.context.getActiveTab();null!=e&&e.total&&t.pageUids.includes(e.currentUid)&&(this.updatePageQuad(e),this.context.render());}afterPerspective(t){let{pageUid:e,docUid:i}=t;const{context:n}=this,s=this.context.getActiveTab();if(null==s||!s.total)return;if(s.uid!==i||s.currentUid!==e)return;const o=s.getCurrentPage();o&&(o.isLoaded=!1),this.updatePageQuad(s),n.scrollByCurrentChanged=!0,n.showTab(s,!0);}slideStart(t){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;const{scrollLeft:i,scrollTop:n}=this.context.viewService.getMaxScrollValue();if(i||n)return;const s=this.context.toCanvas(t);if(s.length>1)return;const o=e.getPosition();this.tabX=o.x,this.tabY=o.y,this.startX=s[0].pageX,this.isStart=!0;}slideMove(t){if(!this.isStart)return;const{context:e}=this,{viewerConfig:i}=e,n=e.getActiveTab(),s=e.toCanvas(t)[0].pageX-this.startX;if(s>0?this.slideDirection="right":s<0&&(this.slideDirection="left"),this.slideDistance=Math.min(n.context.viewportWidth,Math.abs(s)),this.isSliding)"right"===this.slideDirection?n.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&n.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),e.render();else if("single"===n.context.displayMode&&"crop"===i.toolMode&&i.enableSlide){const{scrollLeft:t,scrollTop:n}=this.context.viewService.getMaxScrollValue();Math.abs(s)>i.startSlideThresholdForPerspective&&!t&&!n&&(this.isSliding=!0,e.configService.updateConfig({displayMode:"slide"}));}}slideEnd(t){if(!this.isStart)return;const{context:e}=this,i=e.getActiveTab(),{displayMode:n}=i.context;"slide"===n&&this.slide(i),this.isStart=!1;}slide(t){let e,i=0,n=0,s=0,o=!1;const{viewerConfig:r}=this.context,a=t.context.viewportWidth*r.slideThresholdForPerspective;this.slideDistance>=Math.max(a,r.startSlideThresholdForPerspective)?(n=t.context.viewportWidth,e=n-this.slideDistance,"left"===this.slideDirection?t.current!==t.total-1?(s=-this.slideDistance,i=-e/6):(n=0,e=this.slideDistance,o=!0,s=-this.slideDistance,i=e/6):0!==t.current?(s=this.slideDistance,i=e/6):(n=0,e=this.slideDistance,o=!0,s=this.slideDistance,i=-e/6)):(o=!0,n=0,e=this.slideDistance,"left"===this.slideDirection?(s=-this.slideDistance,i=e/6):(s=this.slideDistance,i=-e/6));const l=()=>{s+=i;const e=s>=0;if(Math.abs(s)>=n&&(s=n,e||(s*=-1)),t.setPosition({x:s+this.tabX,y:this.tabY,z:0}),Math.abs(s)===n)return o||("right"===this.slideDirection?this.context.viewer.gotoPage(t.current-1):this.context.viewer.gotoPage(t.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(l),this.context.render();};this.slideRAF=requestAnimationFrame(l);}}class dP{constructor(t){i(this,"service",void 0),this.service=t;}startHandler(t){this.service.mousedown(t);}moveHandler(t){this.service.mousemove(t);}endHandler(t){this.service.mouseup(t);}isEditCropBox(t){return this.service.isEditCropBox(t)}}class cP{constructor(t){i(this,"service",void 0),this.service=t;}startHandler(t){this.service.mousedown(t);}moveHandler(t){this.service.mousemove(t);}endHandler(t){this.service.mouseup(t);}}function uP(t,e){return {left:Js(t.left,e),top:Js(t.top,e),width:Js(t.width,e),height:Js(t.height,e)}}const pP={install(t){const e=t.getClass("Viewer"),n=(s=e,class extends s{constructor(t){super(t),i(this,"boxRenderer",void 0),i(this,"iCropMode","current"),i(this,"cropRectService",void 0),i(this,"perspectiveQuadService",void 0);const{isDefaultViewer:e,isPerspectiveViewer:n}=this.context;(e||n)&&this.initBoxRenderer(),this.cropRectService=new lP(this,this.boxRenderer),this.perspectiveQuadService=new hP(this,this.boxRenderer),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox(),this.context.hasBoxRendererModule=!0,this.context.cropBoxEditService=new dP(this.cropRectService),this.context.perspectiveQuadEditService=new cP(this.perspectiveQuadService);}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;const{canvasStyle:{cursor:t},enableEditCropBoxMidpoints:e,enableEditCropBoxVertices:i,enableHideEditingCropBoxMidpoint:n,enableHideEditingCropBoxVertex:s}=this.context.viewerConfig;this.boxRenderer=new rP({defaultCursor:t,enableEditCropBoxMidpoints:e,enableEditCropBoxVertices:i,enableHideEditingCropBoxMidpoint:n,enableHideEditingCropBoxVertex:s}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on((()=>{this.updateQuadStyle();}),this),this.context.hooks.canvasCursorStyleChanged.on((()=>{this.boxRenderer.updateConfig({defaultCursor:this.context.viewerConfig.canvasStyle.cursor});}),this),this.hooks.resize.on((()=>{this.context.render();}));const{hooks:o}=this.boxRenderer;o.boxCreated.on((t=>{const e=this.context.getActiveTab();if(null!=e&&e.total&&(this.context.isDefaultViewer&&t.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach((e=>{e.boxes.length?e.boxes.forEach((i=>{e.isContainBox(t)?e.updateRectBox(i,[...t.vertexes]):e.clearBoxes();})):e.isContainBox(t)&&e.addRectBox([...t.vertexes],!1);})),t.isRect)){let e=t.getRect();e=Ys(e,Do.displayResolution,72),e=uP(e,2);const i=Hg.create(e);this.hooks.cropRectDrawn.emit(i),this.emit("cropRectDrawn",i);}})),o.boxDeleted.on((t=>{const e=this.context.getActiveTab();if(null!=e&&e.total&&t.isRect){let e=t.getRect();e=Ys(e,Do.displayResolution,72),e=uP(e,2);const i=Fg.create(e);this.hooks.cropRectDeleted.emit(i),this.emit("cropRectDeleted",i);}})),o.boxModified.on((t=>{const e=this.context.getActiveTab();if(null==e||!e.total)return;const{box:i}=t;if(this.context.isDefaultViewer&&i.isRect){let{oldRect:e,newRect:n}=t,s=0;if("all"===this.cropMode&&this.boxRenderer.areas.forEach((t=>{t.boxes.length?t.boxes.forEach((e=>{t.isContainBox(i)?(s+=1,t.updateRectBox(e,[...i.vertexes])):t.clearBoxes();})):t.isContainBox(i)&&t.addRectBox([...i.vertexes]);})),e&&(e=Ys(e,Do.displayResolution,72),e=uP(e,2)),n&&(n=Ys(n,Do.displayResolution,72),n=uP(n,2)),!e||!n||e.left!==n.left||e.top!==n.top||e.width!==n.width||e.height!==n.height){s=Math.max(1,s);for(let t=0;t<s;t++){const t=Vg.create(e,n);this.emit("cropRectModified",t);}}}if(this.context.isPerspectiveViewer&&!i.isRect){const e=this.context.core.pageService.getPage(i.area.areaUid),n=this.boxRenderer.getAreaByUid(i.area.areaUid);if(!n)return;const s=n.isFullBox(i);e.isFull=s,e.setActiveQuad(i.getQuad());let{oldQuad:o,newQuad:r}=t;o&&(o=e.quadToPixelPPI(o)),r&&(r=e.quadToPixelPPI(r)),ry(o),ry(r),this.hooks.perspectiveQuadChanged.emit(Bf.create(r,e.isFull));let a=!1;o&&r&&(a=qs(r,o)),a||this.emit("quadModified",Kg.create(o,r));}}));}updateQuadStyle(){const t=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:t});}get cropMode(){return this.iCropMode}set cropMode(t){if(this.iCropMode===t)return;const e=this.iCropMode;this.iCropMode=t;const i=this.context.getActiveTab();if(null!=i&&i.total){if("current"===e&&"all"===t){const t=this.boxRenderer.getAreaByUid(i.currentUid).boxes[0];t&&this.boxRenderer.areas.forEach((e=>{e.isContainBox(t)?e.boxes.length?e.updateRectBox(e.boxes[0],[...t.vertexes]):e.addRectBox([...t.vertexes]):e.clearBoxes();}));}this.cropRectService.clearRedundantBoxes(),this.context.render();}}toggleFullPerspective(){const{context:t}=this;if(!t.isPerspectiveViewer)return;const e=t.getActiveTab();null!=e&&e.total&&t.core.pageService.getPage(e.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(e),t.render());}listenDefaultGlobalEventsForBox(){this.context.isPerspectiveViewer||(this.context.core.editService.onAfterRotatePages.on((t=>{this.cropRectService.afterRotatePages(t);}),this),this.context.core.onAfterPerspective.on((t=>{this.cropRectService.afterPerspective(t);}),this));}listenPerspectiveGlobalEventsForBox(){this.context.isPerspectiveViewer&&(this.context.core.editService.onAfterRotatePages.on((t=>{this.perspectiveQuadService.afterRotatePages(t);}),this),this.context.core.onAfterPerspective.on((t=>{this.perspectiveQuadService.afterPerspective(t);}),this));}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:t}=this;this.hooks.resize.on((()=>{t.reRender();})),this.hooks.visibleChanged.on((()=>{t.reRender();})),this.hooks.updatePage.on((e=>{t.updatePage(e);})),this.hooks.afterRender.on((e=>{t.afterRender(e);})),this.hooks.pageChanged.on((e=>{t.pageChanged(e);}));}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:t}=this;this.hooks.updatePage.on((e=>{t.updatePage(e);})),this.hooks.addPagesToDoc.on((e=>{t.addPages(e);})),this.hooks.afterRender.on((e=>{t.afterRender(e);})),this.hooks.toolModeChanged.on((e=>{t.toolModeChanged(e);})),this.hooks.pageChanged.on((e=>{t.pageChanged(e);})),this.hooks.deletePages.on((e=>{t.deletePages(e);})),this.hooks.beforeCropPages.on((()=>{this.clearRectBox();}));}setRectBox(t,e){const i=this.context.getActiveTab();return !(!i||!i.total||(zn(e)&&(e=[i.current]),i.indicesToUids(e).forEach((e=>{let i=t;i=Ys(t,Do.dataResolution,Do.displayResolution);const n=(t=>{const{left:e,top:i,width:n,height:s}=t;return [e,i,e+n,i,e+n,i+s,e,i+s]})(i),s=this.boxRenderer.areas.get(e);s.boxes.length?s.updateRectBox(s.boxes[0],n,!0):s.addRectBox(n);})),this.context.render(),0))}getRectBox(){const t=this.context.getActiveTab();if(t&&t.total){let e=null;if(t.pages.find((t=>{const i=this.boxRenderer.getAreaByUid(t.uid);return !(null==i||!i.boxes.length||(e=i,0))})),e){const t=e.boxes[0];if(null!=t&&t.isRect){let e=t.getRect();return e=Ys(e,Do.displayResolution,Do.dataResolution),e=uP(e,2),e.width=e.width||1,e.height=e.height||1,e}}}return null}getRenderedRectBoxCount(){const t=this.context.getActiveTab();let e=0;return t&&t.total&&this.boxRenderer.areas.forEach((t=>{e+=t.boxes.length;})),e}getCropIndices(){const t=this.context.getActiveTab();let e=[];if(t&&t.total)if("all"===this.iCropMode){const i=[];this.boxRenderer.areas.forEach((t=>{t.boxes.length&&i.push(t.areaUid);})),e=t.uidsToIndices(i);}else e=[t.current];return e}clearRectBox(){return this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),!0}setQuadBox(t){const e=this.context.getActiveTab();if(!e||!e.total)return !1;const i=this.context.core.pageService.getPage(e.currentUid);let n=t;n=t.map((t=>Ys(t,i.resource.resolutionX,Do.displayResolution)));const s=this.boxRenderer.getAreaByUid(e.currentUid),{width:o,height:r}=s,a=ey(n,o,r);return i.isFull=a,i.setActiveQuad(n),this.perspectiveQuadService.updatePageQuad(e),this.hooks.perspectiveQuadChanged.emit(Bf.create(n,i.isFull)),this.context.render(),!0}getQuadBox(){const t=this.context.getActiveTab();if(t&&t.total){const e=this.boxRenderer.getAreaByUid(t.currentUid).boxes[0];if(!e.isRect){let i=e.getQuad();const n=this.context.core.pageService.getPage(t.currentUid);return i=i.map((t=>Ys(t,Do.displayResolution,n.resource.resolutionX))),ry(i),i}}return null}resetQuadBox(t){const e=this.context.getActiveTab();if(null==e||!e.total)return !1;let i=[];return i=zn(t)?[e.currentUid]:e.indicesToUids(t),i.forEach((t=>{const i=this.context.core.pageService.getPage(t),{quad:n}=i;n?(i.isFull&&(i.isFull=!1),i.setActiveQuad(n),this.perspectiveQuadService.updatePageQuad(e)):i.isFull||(i.isFull=!0,this.perspectiveQuadService.updatePageQuad(e)),i.uid===e.currentUid&&this.hooks.perspectiveQuadChanged.emit(Bf.create(n,i.isFull));})),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),!0}isConvexQuad(t){return vs(t.flat())}});var s;t.setClass("Viewer",n);}};class gP extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),this.action=t,this.core=e,this.type="rotate",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on((t=>{const{pageUids:e}=this.action;e.slice().forEach((i=>{if(t.pageUids.includes(i)){const t=e.indexOf(i);e.splice(t,1);}})),this.isValid=e.length>0;}),this);}execute(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).addAction(e);}));const i=Rf.create(e.docUid,e.angle,e.pageUids);return t.editService.onRotatePages.emit(i),t.editService.onAfterRotatePages.emit(i),!0}undo(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).deleteAction(e.actionUid);}));const i=Rf.create(e.docUid,e.angle,e.pageUids);t.editService.onRotatePages.emit(i),t.editService.onAfterRotatePages.emit(i);}}class fP extends zy{constructor(t,e){super(),i(this,"action",void 0),i(this,"core",void 0),this.action=t,this.core=e,this.type="crop",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on((t=>{const{pageUids:e}=this.action;e.slice().forEach((i=>{if(t.pageUids.includes(i)){const t=e.indexOf(i);e.splice(t,1);}})),this.isValid=e.length>0;}),this);}execute(){const{core:t,action:e}=this;e.pageUids.forEach((e=>{t.pageService.getPage(e).addAction(this.action);}));const i=Mf.create(e.docUid,e.rect,e.pageUids);return t.editService.onCropPages.emit(i),!0}undo(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).deleteAction(e.actionUid);}));const i=Mf.create(e.docUid,e.rect,e.pageUids);t.editService.onCropPages.emit(i);}}class yP extends Qs{constructor(t){super(),i(this,"core",void 0),i(this,"onRotatePages",void 0),i(this,"onAfterRotatePages",void 0),i(this,"onCropPages",void 0),i(this,"onAfterCropPages",void 0),this.core=t,this.initEventEmitter();}initEventEmitter(){this.onRotatePages=eo(this),this.onAfterRotatePages=eo(this),this.onCropPages=eo(this),this.onAfterCropPages=eo(this);}rotatePages(t,e,i,n){const s={actionUid:ts(),type:"rotate",docUid:t,pageUids:[...e],angle:i,rotationType:n},{core:o}=this,r=new gP(s,o);return o.commandService.execute(r,t),!0}cropPages(t,e,i){const n={actionUid:ts(),type:"crop",docUid:t,pageUids:[...e],rect:{...i}},{core:s}=this,o=new fP(n,s);return s.commandService.execute(o,t),!0}}const mP={apply(t){t.editService=new yP(t);},install(t){const e=t.getClass("Viewer"),i=(n=e,class extends n{constructor(t){super(t),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit();}listenGlobalEventsForEdit(){const{context:t}=this,e=e=>{let{docUid:i,pageUids:n}=e;const s=t.tabService.getTab(i);if(null!=s&&s.isActive){t.scrollByCurrentChanged=!0,t.clearOptimization(n);let e=!0;t.isDefaultViewer?"none"===s.context.fitMode&&(e=!1):t.isThumbnailViewer&&(e=!1),t.showTab(s,e);}};t.core.editService.onRotatePages.on(e,this),t.core.editService.onCropPages.on(e,this);}listenViewerEventsForEdit(){this.hooks.beforeLayout.on((t=>{const{core:{pageService:e},isDefaultViewer:i,isThumbnailViewer:n,isPerspectiveViewer:s}=this.context;(i||n||s)&&t.pages.forEach((t=>{let s=null;const o=e.getPage(t.uid);s=i||n?o.getEditResult():o.getEditResultForPerspective(),s&&(t.rWidth=s.rWidth,t.rHeight=s.rHeight,t.cropLeft=s.cropLeft,t.cropTop=s.cropTop,t.cropWidth=s.cropWidth,t.cropHeight=s.cropHeight,t.rotation=s.rotation,t.mediaBoxRect=s.mediaBox,t.cropBoxRect=s.cropBox);}));}));}rotatePages(t,e){var i;if(t%360==0)return !0;const n=this.context.getActiveTab();if(!n)return !1;null!==(i=e)&&void 0!==i||(e=[n.current]);const s=n.indicesToUids(e);return this.context.core.editService.rotatePages(n.uid,s,t,"contain")}cropPages(t,e){var i;const n=this.context.getActiveTab();if(!n)return !1;null!==(i=e)&&void 0!==i||(e=[n.current]);const s=n.indicesToUids(e);return t=Ys(t,Do.dataResolution,Do.displayResolution),this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(n.uid,s,t)}});var n;t.setClass("Viewer",i);}};class vP{async perspective(t,e,i,n){var s;const o=new wo,r=await o.initImage({source:t.data,isRGBA:t.type===exports.EnumImageDataType.RGBA,width:t.width,height:t.height,isBGRA:t.type===exports.EnumImageDataType.BGRA});r.srcBuffer&&(t.data=r.srcBuffer),null!=i&&i.angle&&await o.rotate({angle:i.angle}),await o.perspective(e);const a=await o.getImage({jpegQuality:null==n?void 0:n.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===exports.EnumImageDataType.RGBA,bitDepth:null==n?void 0:n.bitDepth,xDpi:null==n?void 0:n.xdpi,yDpi:null==n?void 0:n.ydpi,returnBlob:!1,returnType:To[null!==(s=null==n?void 0:n.outputType)&&void 0!==s?s:t.type]});await o.freeReservedData();const l={data:new Blob([a.imageData],{type:a.blobType}),width:a.imageWidth,height:a.imageHeight,resolutionX:a.imageXResolution,resolutionY:a.imageYResolution};return o.terminate(),l}}var xP=new WeakMap,wP=new WeakMap,bP=new WeakSet,CP=new WeakSet,SP=new WeakSet;function PP(t,e,i,n){return (new vP).perspective(t,e,i,n)}function AP(t){return n(this,xP).push(t),n(this,wP)||(s(this,wP,!0),p(this,SP,TP).call(this)),t.promise}async function TP(){do{if(n(this,xP).isEmpty())break;const t=n(this,xP).pop();try{let e;if("perspective"===(null==t?void 0:t.api))e=await p(this,bP,PP).apply(this,t.params);null==t||t.resolve(e);}catch(e){t.retry<1?(t.retry+=1,n(this,xP).push(t)):null==t||t.reject(e);}}while(!n(this,xP).isEmpty());s(this,wP,!1);}_y.registerPlugin(Ux),_y.registerPlugin(eP),_y.registerPlugin(pP),_y.registerPlugin(mP),_y.registerPlugin(Cv),_y.registerPlugin(EC);const kP=new _y(new class{constructor(){this.registerParser("image/jpeg",bd),this.registerParser("image/bmp",bd),this.registerParser("image/png",bd),this.registerParser("image/tiff",Cd),this.registerParser("image/jp2",bd),this.registerParser("application/pdf",fc),this.registerParser("image/rgba",mc),this.registerParser("application/ddv-blank-image",Nc);}dispose(){this.reset();}reset(){xc.getAllParsers().forEach((t=>t.destroy())),xc.clear(),Cc.clear();}freeParserByFileUid(t){Ac.execute(t);}registerParser(t,e){Ec.execute({mime:t,parser:e});}unregisterParser(t){Ic.execute(t);}registerCustomParser(t,e){Rc.execute({mime:t,parser:e});}unregisterCustomParser(t){Mc.execute(t);}getDefaultParserOptions(t){return Bc.execute(t)}setDefaultParserOptions(t,e){return Lc.execute({mime:t,options:e})}getCustomParserClasses(t){return Uc.execute(t)}async parse(t,e,i,n,s){return kc.execute({fileData:t,mime:e,fileUid:i,indices:n,parseOptions:s})}async parseAnnotation(t,e,i,n,s,o){return Dc.execute({fileData:t,mime:e,fileUid:i,indices:s,parseOptions:o,parsedPages:n})}async getPage(t,e,i,n){return Tc.execute({fileData:t,mime:e,fileUid:i,fileIndex:n})}cancelGetPage(t,e){Pc.execute({fileUid:t,fileIndex:e});}async getParseInfo(t,e,i,n){return Oc.execute({fileData:t,mime:e,fileUid:i,options:n})}},new class{constructor(){this.registerSaver("application/pdf",$o),this.registerSaver("image/png",Go),this.registerSaver("image/jpeg",Go),this.registerSaver("image/tiff",Xo);}registerSaver(t,e){Bo.execute({mime:t,saverConstructor:e});}unregisterSaver(t){Lo.execute(t);}getSaver(t){return Mo.execute(t)}},new class{constructor(){y(this,SP),y(this,CP),y(this,bP),f(this,xP,{writable:!0,value:new Ao}),f(this,wP,{writable:!0,value:!1});}dispose(){throw new Error("Method not implemented.")}perspective(t,e,i,n){return this.createTask("perspective",[t,e,i,n])}createTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);return i.promise=new Promise(((t,e)=>{i.resolve=t,i.reject=e;})),p(this,CP,AP).call(this,i)}cancelTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);n(this,xP).remove(i);}},new class{constructor(){y(this,du),y(this,hu),y(this,lu),i(this,"filter",void 0),f(this,ru,{writable:!0,value:new Ao}),f(this,au,{writable:!0,value:!1});}get enableFilter(){return !!this.filter}async applyFilter(t,e,i,n){return this.createTask("filter",[t,e,i,n])}cancelFilter(t,e){}setImageFilter(t){t?this.filter=t:this.filter&&(this.filter.destroy(),this.filter=null);}getDefaultFilterType(){var t;return (null===(t=this.filter)||void 0===t?void 0:t.defaultFilterType)||Wc.NONE}getSupportedFilters(){var t;return (null===(t=this.filter)||void 0===t?void 0:t.querySupported())||[]}createTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);return i.promise=new Promise(((t,e)=>{i.resolve=t,i.reject=e;})),p(this,hu,uu).call(this,i)}cancelTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);n(this,ru).remove(i);}},new class{constructor(){i(this,"detector",void 0);}get enableDetect(){return this.detector&&this.detector instanceof Jc}detect(t,e){var i;return null===(i=this.detector)||void 0===i?void 0:i.detect(t,e)}setDetector(t){t?this.detector=t:this.detector&&(this.detector.destroy(),this.detector=null);}resetDetector(){this.detector&&this.detector.reset();}reset(){var t;null===(t=this.detector)||void 0===t||t.destroy(),this.detector=null;}}),DP="Layout",EP="Button",IP="Capture",RP="Flashlight",MP="CameraConvert",BP="CameraResolution",LP="AutoDetect",UP="AutoCapture",OP="ImagePreview",NP="Rotate",_P="RotateLeft",WP="RotateRight",FP="Delete",HP="DeleteCurrent",VP="DeleteAll",zP="Zoom",jP="ZoomIn",$P="ZoomOut",GP="ZoomByPercentage",XP="Crop",YP="CropMode",qP="CropCurrent",JP="CropAll",ZP="FullQuad",QP="PerspectiveAll",KP="Undo",tA="Redo",eA="FitMode",iA="FitWindow",nA="FitHeight",sA="FitWidth",oA="ActualSize",rA="DisplayMode",aA="SinglePage",lA="ContinuousPage",hA="Pan",dA="Load",cA="Download",uA="Print",pA="Filter",gA="Restore",fA="ThumbnailSwitch",yA="Pagination",mA="Done",vA="Back",xA="Blank",wA="Close",bA="MainView",CA="SeparatorLine",SA="AnnotationSet",PA="EllipseAnnotation",AA="EraseAnnotation",TA="InkAnnotation",kA="LineAnnotation",DA="PolygonAnnotation",EA="PolylineAnnotation",IA="RectAnnotation",RA="SelectAnnotation",MA="StampIconAnnotation",BA="StampImageAnnotation",LA="TextBoxAnnotation",UA="TextTypewriterAnnotation",OA="BringForward",NA="BringToFront",_A="SendBackward",WA="SendToBack";function FA(t,e,i,n){return !!zn(t)&&Cu.output(e,i,n,void 0,wu.PARAM_MISS,!0)}function HA(t,e,i,n){return !!Hn(t)||Cu.output(e,i,n,void 0,wu.PARAM_INVALID)}class VA{static getTooltip(){return DC.getTooltip()}static setTooltip(t){const e="Elements.setTooltip",i="tooltip";return !(FA(t,1,e,i)||!HA(t,1,e,i))&&(DC.setTooltip(t),!0)}static getDisplayTextConfig(){return DC.getDisplayTextConfig()}static setDisplayTextConfig(t){const e="Elements.displayTextConfig",i="displayTextConfig";return !(FA(t,1,e,i)||!HA(t,1,e,i))&&(DC.setDisplayTextConfig(t),!0)}static get Layout(){return DP}static get Button(){return EP}static get Capture(){return IP}static get Flashlight(){return RP}static get CameraConvert(){return MP}static get CameraResolution(){return BP}static get AutoDetect(){return LP}static get AutoCapture(){return UP}static get ImagePreview(){return OP}static get Rotate(){return NP}static get RotateLeft(){return _P}static get RotateRight(){return WP}static get Delete(){return FP}static get DeleteCurrent(){return HP}static get DeleteAll(){return VP}static get Zoom(){return zP}static get ZoomIn(){return jP}static get ZoomOut(){return $P}static get ZoomByPercentage(){return GP}static get Crop(){return XP}static get CropCurrent(){return qP}static get CropAll(){return JP}static get FullQuad(){return ZP}static get PerspectiveAll(){return QP}static get Undo(){return KP}static get Redo(){return tA}static get Pan(){return hA}static get CropMode(){return YP}static get Load(){return dA}static get Download(){return cA}static get Print(){return uA}static get Filter(){return pA}static get Restore(){return gA}static get ThumbnailSwitch(){return fA}static get Pagination(){return yA}static get FitMode(){return eA}static get FitWindow(){return iA}static get FitHeight(){return nA}static get FitWidth(){return sA}static get ActualSize(){return oA}static get DisplayMode(){return rA}static get SinglePage(){return aA}static get ContinuousPage(){return lA}static get MainView(){return bA}static get SeparatorLine(){return CA}static get Done(){return mA}static get Back(){return vA}static get Blank(){return xA}static get Close(){return wA}static get AnnotationSet(){return SA}static get EllipseAnnotation(){return PA}static get EraseAnnotation(){return AA}static get InkAnnotation(){return TA}static get LineAnnotation(){return kA}static get PolygonAnnotation(){return DA}static get PolylineAnnotation(){return EA}static get RectAnnotation(){return IA}static get SelectAnnotation(){return RA}static get StampIconAnnotation(){return MA}static get StampImageAnnotation(){return BA}static get TextBoxAnnotation(){return LA}static get TextTypewriterAnnotation(){return UA}static get BringForward(){return OA}static get BringToFront(){return NA}static get SendBackward(){return _A}static get SendToBack(){return WA}}const zA={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},VA.Flashlight]},VA.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[VA.AutoDetect,VA.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},VA.ImagePreview,VA.CameraConvert]}]},jA={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[VA.Blank,VA.Pagination,VA.Download]},VA.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[VA.DisplayMode,VA.RotateLeft,VA.Crop,VA.Filter,VA.Undo,VA.Delete,VA.Load]}]},$A={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[VA.Blank,VA.Pagination,VA.PerspectiveAll]},VA.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[VA.FullQuad,VA.RotateLeft,VA.RotateRight,VA.DeleteCurrent,VA.DeleteAll]}]},GA={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:VA.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},VA.AutoDetect,{type:VA.Capture,className:"ddv-capture-viewer-capture-desktop"},VA.AutoCapture]},VA.MainView,{type:VA.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},XA={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[VA.FullQuad,VA.RotateLeft,VA.RotateRight,VA.DeleteCurrent,VA.DeleteAll,{type:VA.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:VA.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},VA.MainView]},YA={type:VA.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:VA.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:VA.Layout,children:[VA.ThumbnailSwitch,VA.Zoom,VA.FitMode,VA.DisplayMode,VA.RotateLeft,VA.RotateRight,VA.Crop,VA.Filter,VA.Undo,VA.Redo,VA.DeleteCurrent,VA.DeleteAll,VA.Pan]},{type:VA.Layout,children:[{type:VA.Pagination,className:"ddv-edit-viewer-pagination-desktop"},VA.Load,VA.Download,VA.Print]}]},VA.MainView]},qA={type:VA.Layout,children:[VA.MainView]},JA=Vn(jA);JA.children[0].children=[VA.Blank,VA.Blank,VA.Pagination,VA.AnnotationSet,VA.Download];const ZA=Vn(YA);var QA,KA;ZA.children[0].children[0].enableScroll=!0,ZA.children[0].children[0].children.push(VA.SeparatorLine,VA.AnnotationSet),function(t){t.REJECTED="rejected",t.ACCEPTED="accepted",t.INITIAL_HERE="initialHere",t.SIGN_HERE="signHere",t.WITNESS="witness",t.APPROVED="approved",t.NOT_APPROVED="notApproved",t.DRAFT="draft",t.FINAL="final",t.COMPLETED="completed",t.CONFIDENTIAL="confidential",t.VOID="void";}(QA||(QA={})),function(t){t.NONE="none",t.OPEN="open",t.OPEN_REVERSE="openReverse",t.CLOSED="closed",t.CLOSED_REVERSE="closedReverse",t.BUTT="butt",t.SLASH="slash",t.SQUARE="square",t.DIAMOND="diamond",t.CIRCLE="circle";}(KA||(KA={}));const tT={background:"#e2e1de"},eT={border:"1px solid #707070",background:"#fff"},iT={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},nT={opacity:1,borderWidth:1,borderColor:"rgb(0,0,0)",background:"",lineDash:[0,0]},sT={content:"",color:"rgb(0,0,0)",fontSize:16,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1},oT={content:"",color:"rgb(0,0,0)",fontSize:1536/72,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1};qn()&&(nT.borderWidth=3,sT.fontSize=72);const rT={...nT,lineEnding:{start:KA.NONE,end:KA.NONE}},aT={paletteConfig:{maxFontSize:256,maxBorderWidth:40,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#ffffff","#CECECE"],labels:{text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"StandardBusiness"}},toolbarConfig:{},annotationSelectionStyle:{border:"1px solid #59626A",background:"",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},inkCreateDelay:1e3,showOnTopWhenSelected:!1,enableContinuousDrawing:!1,defaultStyleConfig:{rectangle:{...nT},ellipse:{...nT},polygon:{...nT},polyline:{...rT},line:{...rT},ink:{opacity:1,borderWidth:qn()?3:1,borderColor:"rgb(0,0,0)"},textBox:{...nT,textAlign:"left",textContent:{...sT}},textTypewriter:{opacity:1,textContent:{...sT}},stamp:{opacity:1,stamp:QA.DRAFT}}},lT={canvasStyle:{...tT},quadSelectionStyle:{...iT},enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80};function hT(t,e){return !!t.getActiveTab()||Cu.output(e,void 0,void 0,void 0,wu.DOC_NOT_OPEN)}function dT(t,e,i,n){return !i.getActiveTab().doc.pages.length&&Cu.output(n,t,e,void 0,wu.DOC_NO_IMAGE,!0)}function cT(t,e,i,n){return !!function(t){return !(!Jn(t)||Jn(t)&&!Number.isInteger(t))}(t)||Cu.output(n,e,i,void 0,wu.PARAM_INVALID)}function uT(t,e,i,n,s){const o=ID.isUiConfigValid(t,n);if(o.length>0)return Cu.output(s,i,n,o);const r=vD(t,e);return !r||Cu.output(s,e.charAt(0).toUpperCase()+e.slice(1),r,void 0,wu.ELEMENT_UNSUPPORTED)}function pT(t,e,i,n,s,o){return (t<e||t>i)&&Cu.output(n,s,o,void 0,wu.PARAM_OUT_OF_RANGE,!0)}function gT(t,e,i,n){return !!t.includes(e)||Cu.output(i,n,void 0,void 0,wu.PAGE_NOT_EXIST)}function fT(t,e,i,n){return !!Yn(t)||Cu.output(n,e,i,void 0,wu.PARAM_INVALID)}function yT(t,e,i,n,s){const o=Cu.formatError(Cu.isStringAndNotEmpty(t,s));return !o||Cu.output(e,i,n,void 0,o)}function mT(t,e,i,n,s,o,r){const a=ID.isNumberArrayValid(t,s,o,r);return !a.length||Cu.output(e,i,n,a,wu.PARAM_INVALID)}class vT{getIsBoundContainer(t){return t.context.viewService.isBindContainer}bindContainer(t,e,i){FA(e,0,i,"container");const n=ID.isContainerParamValid(e);n&&Cu.error(i,"container",void 0,n),t.bindContainer(e);}unbindContainer(t){t.unbindContainer();}getIsVisible(t){return "visible"===t.getViewerConfig().visibility}show(t){t.show();}hide(t){t.hide();}getCurrentDocument(t){var e;const i=null===(e=t.getActiveTab())||void 0===e?void 0:e.uid;return i?jD.getDocument(i):null}openDocument(t,e,i){const n="docUid or doc";FA(t,0,i,n),function(t){if(Zn(t))return 0!==t.trim().length;return !1}(t)||Hn(t)||Cu.error(i,n,void 0,wu.PARAM_INVALID);const s=Hn(t)?t.uid:t;!function(t,e,i,n,s){!!t.getDocument(e)||Cu.output(i,n,s,void 0,wu.DOC_NOT_EXIST);}(kP.documentService,s,0,i,n),kP.getViewer(e)||Cu.error(i,"viewerUid",void 0,wu.PARAM_INVALID),kP.openDocument(s,e);}closeDocument(t,e){return !!hT(t,1)&&(t.closeDocument(),!0)}getStyle(t,e,i,n,s){const o="styleName";if(FA(i,1,s,o)||!yT(i,1,s,o))return null;if(!n.includes(i))return Cu.warning(s,o,void 0,wu.PARAM_NOT_SUPPORT),null;if("annotationSelectionStyle"===i){return t.getAnnotationConfig().controlsStyle}const r=t.getViewerConfig();if(i in r){const t=function(t,e){const i=["border","background"],n=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],s={pageStyle:i,selectedPageStyle:i,hoveredPageStyle:i,canvasStyle:[...i,"cursor"],checkboxStyle:[...n,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...n,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(t in s){const i=s[t];return Object.fromEntries(Object.entries(e).filter((t=>{let[e,n]=t;return i.includes(e)})))}return Vn(e)}(i,r[i]);return "capture"===e&&"quadSelectionStyle"===i?{border:t.border,background:t.background}:t}return null}updateStyle(t,e,i,n,s){return !(FA(e,1,s,"styleName")||FA(i,1,s,"style")||!yT(e,1,s,"styleName")||!HA(i,1,s,"style")||!function(t,e,i,n,s,o){if(!yT(t,o,n,s))return !1;if(!i.includes(t))return Cu.output(o,n,s,void 0,wu.PARAM_NOT_SUPPORT);const r=PD(t,e);return !r.length||Cu.output(o,n,"style",r)}(e,i,n,s,"styleName",1))&&("annotationSelectionStyle"===e?(t.updateAnnotationConfig({controlsStyle:i}),!0):(t.updateViewerConfig({[e]:i}),!0))}getUiConfig(t){return t.getUiConfig()}updateUiConfig(t,e,i,n){const s="uiConfig";return !(FA(e,1,n,s)||!uT(e,i,n,s,1))&&t.updateUiConfig(e)}indexToUid(t,e,i){const n="index";if(FA(e,1,i,n)||!cT(e,i,n,1)||!hT(t,1)||dT(void 0,void 0,t,1))return "";return pT(e,0,t.getPageCounts()-1,1,i,n)?"":t.indexToUid(e)}uidToIndex(t,e,i){if(FA(e,1,i,"uid")||!yT(e,1,i,"uid",!1)||!hT(t,1)||dT(void 0,void 0,t,1))return -1;return gT(this.getCurrentDocument(t).pages,e,1,i)?t.uidToIndex(e):-1}getCurrentPageUid(t){return hT(t,1)?dT(void 0,void 0,t,1)?"":t.getCurrentPageUid():""}getCurrentPageIndex(t){return hT(t,1)?dT(void 0,void 0,t,1)?-1:t.getCurrentPageIndex():-1}getPageCount(t){return hT(t,1)?t.getPageCounts():-1}gotoPage(t,e,i){const n="index";if(FA(e,1,i,n)||!cT(e,i,n,1)||!hT(t,1)||dT(void 0,void 0,t,1))return -1;return pT(e,0,t.getPageCounts()-1,1,i,n)?-1:t.gotoPage(e)}rotate(t,e,i,n){if(FA(e,1,n,"angle")||!cT(e,n,"angle",1)||!function(t,e,i,n){return t%90==0||Cu.output(n,e,i,void 0,wu.PARAM_NOT_SUPPORT)}(e,n,"angle",1)||!hT(t,1)||dT(void 0,void 0,t,1))return !1;if(!zn(i)){if(!mT(i,1,n,"indices",0,this.getPageCount(t)-1))return !1}return t.rotatePages(e,i)}saveOperation(t){return !!hT(t,1)&&t.saveOperations()}on(t,e,i,n){!FA(i,1,e,"eventName")&&!FA(n,1,e,"listener")&&yT(i,1,e,"eventName",!1)&&fT(n,e,"listener",1)&&t.on(i,n);}off(t,e,i,n){!FA(i,1,e,"eventName")&&yT(i,1,e,"eventName",!1)&&(zn(n)||fT(n,e,"listener",1))&&t.off(i,n);}destroy(t){t&&t.dispose();}}function xT(t,e,i,n){return !!Xn(t)||Cu.output(n,e,i,void 0,wu.PARAM_INVALID)}function wT(t,e,i,n,s,o){const r=Cu.formatError(Cu.isNumberAndIsInRange(t,s,o));return !r||Cu.output(e,i,n,void 0,r)}function bT(t,e,i,n,s){if(!Hn(t))return Cu.output(i,n,s,void 0,wu.PARAM_INVALID);const o=[],r=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];return Object.keys(t).forEach((i=>{const n=t[i];if("container"===i)o.push(...ID.isContainerKeyValid(n,s));else if("uiConfig"===i){const t=ID.isUiConfigValid(n,"option.uiConfig");if(t.length>0)o.push(...t);else {const t=vD(n,e);if(t){const i=wu.buildError(wu.ELEMENT_UNSUPPORTED,e.charAt(0).toUpperCase()+e.slice(1),t);o.push(`option.uiConfig: ${i.message}`);}}}else "viewerConfig"!==i&&"thumbnailConfig"!==i||Object.keys(n).forEach((t=>{const e=n[t];if(r.includes(t)){const n=PD(t,e);o.push(...n.map((t=>`${i}.${t}`)));}}));})),!(o.length>0)||Cu.output(i,n,s,o)}const CT=["canvasStyle","quadSelectionStyle"],ST="CaptureViewer";var PT=new WeakMap,AT=new WeakMap,TT=new WeakSet;class kT{constructor(t){var e;y(this,TT),f(this,PT,{writable:!0,value:void 0}),f(this,AT,{writable:!0,value:new vT}),i(this,"uid",void 0),i(this,"groupUid",void 0),i(this,"postfix",void 0);const o=`new ${ST}`;xp.makeSureCoreLicenseExist(),xp.makeSureCameraLicenseExist(),zn(t)||bT(t,"captureViewer",0,o,"option");const r=js((null==t?void 0:t.viewerConfig)||{},Vn({...lT,viewerMode:eg.CAPTURE})),a=qn()?zA:GA;s(this,PT,kP.createViewer({uiConfig:Vn(a),...t,viewerConfig:r})),null!=t&&null!==(e=t.viewerConfig)&&void 0!==e&&e.enableAutoDetect&&!n(this,PT).context.core.detectorService.enableDetect&&wu.warning(wu.DOC_DETECT_MISS),this.uid=n(this,PT).uid,this.groupUid=n(this,PT).groupUid,this.postfix=n(this,PT).postfix,p(this,TT,DT).call(this);}get isVisible(){return n(this,AT).getIsVisible(n(this,PT))}get isBoundContainer(){return n(this,AT).getIsBoundContainer(n(this,PT))}get currentDocument(){return n(this,AT).getCurrentDocument(n(this,PT))}get acceptedPolygonConfidence(){return n(this,PT).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(t){const e="acceptedPolygonConfidence";wT(t,1,`${ST}.${e}`,e,0,100)&&n(this,PT).updateCameraConfig({acceptedPolygonConfidence:t});}get maxFrameNumber(){return n(this,PT).getCameraConfig().maxFrameNumber}set maxFrameNumber(t){const e="maxFrameNumber";wT(t,1,`${ST}.${e}`,e,1e-6,60)&&n(this,PT).updateCameraConfig({maxFrameNumber:t});}get enableAutoDetect(){return n(this,PT).getCameraConfig().enableAutoDetect}set enableAutoDetect(t){const e="enableAutoDetect",i=`${ST}.${e}`;xT(t,i,e,1)&&(t&&!n(this,PT).context.core.detectorService.enableDetect&&Cu.warning(i,void 0,void 0,wu.DOC_DETECT_MISS),n(this,PT).updateCameraConfig({enableAutoDetect:t}));}get enableAutoCapture(){return n(this,PT).getCameraConfig().enableAutoCapture}set enableAutoCapture(t){const e="enableAutoCapture";xT(t,`${ST}.${e}`,e,1)&&n(this,PT).updateCameraConfig({enableAutoCapture:t});}bindContainer(t){n(this,AT).bindContainer(n(this,PT),t,`${ST}.bindContainer`);}unbindContainer(){n(this,AT).unbindContainer(n(this,PT));}show(){n(this,AT).show(n(this,PT));}hide(){n(this,AT).hide(n(this,PT));}getUiConfig(){return n(this,AT).getUiConfig(n(this,PT))}updateUiConfig(t){return n(this,AT).updateUiConfig(n(this,PT),t,"captureViewer",`${ST}.updateUiConfig`)}openDocument(t){n(this,AT).openDocument(t,this.uid,`${ST}.openDocument`);}closeDocument(){return n(this,AT).closeDocument(n(this,PT),`${ST}.closeDocument`)}getStyle(t){return n(this,AT).getStyle(n(this,PT),"capture",t,CT,`${ST}.getStyle`)}updateStyle(t,e){return n(this,AT).updateStyle(n(this,PT),t,e,CT,`${ST}.updateStyle`)}capture(){return n(this,PT).isVideoPlaying()?n(this,PT).context.viewService.isBindContainer?n(this,PT).capture():wu.reject(wu.CONTAINER_NO_BOUND):wu.reject(wu.CAMERA_NO_VIDEO)}play(t){const e=`${ST}.play`;if(!zn(t)){const i=function(t,e,i,n){const s=ID.isVideoConfig(t,n);return !s.length||Cu.output(e,i,n,s)}(t,2,e,"config");if(!0!==i)return i}return n(this,PT).play(t).catch((t=>wu.reject(t,e)))}stop(){n(this,PT).stop();}getCurrentCamera(){return n(this,PT).getCurrentCamera()}getAllCameras(){return n(this,PT).getAllCameras()}selectCamera(t){const e=`${ST}.selectCamera`,i="cameraObjectOrDeviceID",s=FA(t,2,e,i);if(s)return s;if(Zn(t)){const n=yT(t,2,e,i,!1);if(!0!==n)return n}else {const n=function(t,e,i,n){const s=ID.isVideoDeviceInfo(t,n);return !s.length||Cu.output(e,i,n,s)}(t,2,e,i);if(!0!==n)return n}return n(this,PT).selectCamera(t).catch((t=>wu.reject(t,e,i)))}getCurrentResolution(){return n(this,PT).getCurrentResolution()}turnOnTorch(){return n(this,PT).turnOnTorch().catch((t=>wu.reject(t)))}turnOffTorch(){return n(this,PT).turnOffTorch().catch((t=>wu.reject(t)))}on(t,e){n(this,AT).on(n(this,PT),`${ST}.on`,t,e);}off(t,e){n(this,AT).off(n(this,PT),`${ST}.off`,t,e);}destroy(){n(this,AT).destroy(n(this,PT));}}function DT(){n(this,PT).hooks.destroy.on((()=>{s(this,PT,null),Object.setPrototypeOf(this,null);}));}const ET={canvasStyle:{...tT},currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},IT={...ET,visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}},RT={canvasStyle:{...tT},pageStyle:{...eT},quadSelectionStyle:{...iT},currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1,enableMagnifier:!0},MT=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var BT=new WeakSet;class LT{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";y(this,BT),i(this,"v",void 0),i(this,"vCommon",new vT),i(this,"uid",void 0),i(this,"groupUid",void 0),i(this,"postfix",void 0),i(this,"errorPrefix",void 0),this.errorPrefix=e;const n=`new ${this.errorPrefix}`;xp.makeSureCoreLicenseExist(),zn(t)||bT(t,"browseViewer",0,n,"option");const s=ED(null==t?void 0:t.keyboardInteractionConfig),o=js((null==t?void 0:t.viewerConfig)||{},Vn({...ET,viewerMode:eg.THUMBNAIL,displayMode:"multiple",toolMode:"pan",enableOptimizePage:!0}));this.v=kP.createViewer({uiConfig:Vn(qA),...t,viewerConfig:{...o,...s}}),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,p(this,BT,UT).call(this);}get isVisible(){return this.vCommon.getIsVisible(this.v)}get isBoundContainer(){return this.vCommon.getIsBoundContainer(this.v)}set multiselectMode(t){const e="multiselectMode";xT(t,`${this.errorPrefix}.${e}`,e,1)&&this.v.updateViewerConfig({multiselectMode:t});}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}show(){this.vCommon.show(this.v);}hide(){this.vCommon.hide(this.v);}getUiConfig(){return this.vCommon.getUiConfig(this.v)}updateUiConfig(t){return this.vCommon.updateUiConfig(this.v,t,"browseViewer",`${this.errorPrefix}.updateUiConfig`)}getStyle(t){return this.vCommon.getStyle(this.v,"browse",t,MT,`${this.errorPrefix}.getStyle`)}updateStyle(t,e){const i=`${this.errorPrefix}.updateStyle`;return this.vCommon.updateStyle(this.v,t,e,MT,i)}getSelectedPageIndices(){return hT(this.v,1)?this.v.getSelectedPageIndices():[]}selectAllPages(){if(!hT(this.v,1))return [];if(0===this.v.getPageCounts()){const t=`${this.errorPrefix}.selectAllPages`;return Cu.output(1,t,void 0,void 0,wu.DOC_NO_IMAGE),[]}return this.v.selectAllPages()}selectPages(t){const e=`${this.errorPrefix}.selectPages`,i="indices";if(FA(t,1,e,i)||!hT(this.v,1))return [];return mT(t,1,e,i,0,this.v.getPageCounts()-1)?this.v.selectPagesByIndices(t):[]}setRowAndColumn(t,e){const i=`${this.errorPrefix}.setRowAndColumn`,n="row",s="column",{maxColumns:o,maxRows:r}=this.v.getViewerConfig();return !(FA(t,1,i,n)||FA(e,1,i,s)||!cT(t,i,n,1)||!cT(e,i,s,1)||pT(t,1,r,1,i,n)||pT(e,1,o,1,i,s))&&this.v.setRowAndColumn(t,e)}on(t,e){this.vCommon.on(this.v,`${this.errorPrefix}.on`,t,e);}off(t,e){this.vCommon.off(this.v,`${this.errorPrefix}.off`,t,e);}}function UT(){this.v.hooks.destroy.on((()=>{this.v=null,Object.setPrototypeOf(this,null);}));}function OT(t,e,i,n,s){const o=ID.isAnnotationOptionsValid(t,n,s);return !o.length||Cu.output(e,i,n,o)}const NT={borderColor:"rgb(0,0,0)",background:"",borderWidth:1,opacity:1,lineDash:[0,0],flags:{print:!0,noView:!1,readOnly:!1},rotation:0};var _T=new WeakMap;class WT{constructor(t){i(this,"uid",null),i(this,"creationDate",""),i(this,"modificationDate",""),f(this,_T,{writable:!0,value:void 0}),s(this,_T,t),this.uid=ts(),this.creationDate=$f(),this.modificationDate=this.creationDate;}get type(){return null}get pageUid(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get flattened(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return !!t&&t.flattened}set flattened(t){const e="Annotation.flattened";if(FA(t,1,e,"options"))return;if(!xT(t,e,"options",1))return;kP.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?kP.annotationService.flattenAnnotations([this.uid]):kP.annotationService.unFlattenAnnotation(this.uid));}getOptions(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);if(t){const e=t.getConfig(),i=VT(e,this.type);s(this,_T,{...i}),this.modificationDate=e.comment.modificationDate;}return $T(this.type,n(this,_T))}updateOptions(t){const e="Annotation.updateOptions";if(FA(t,1,e,"options"))return !1;if(!HA(t,1,e,"options"))return !1;if(!OT(t,1,e,"options",this.type))return !1;const i=this.getOptions(),s=FT(this.type,t,i);if(!["rectangle","stamp","ellipse","textBox","ink"].includes(this.type)&&s.has("rotated")&&s.delete("rotated"),!s.size)return !0;this.getOptions(),js(t,n(this,_T));const o=HT({...n(this,_T)},this.type);return kP.annotationService.updateAnnotations([{annotationUid:this.uid,options:o}],void 0,[...s]),!0}}function FT(t,e,i){const n="moved",s="resized",o="startPoint",r="endPoint",a=new Map([[["x","y"],"moved"],[["width","height"],"resized"],[["rotation"],"rotated"],[["flags"],"flagsChanged"],[["borderWidth","borderColor","background","opacity","textAlign","lineCap","lineJoin","miterLimit","lineDash","lineEnding","textContents"],"appearanceChanged"],[["textContents","stamp"],"contentChanged"]]),l=Vn(e);l.flags={...i.flags,...(null==l?void 0:l.flags)||{}},["line","polyline"].includes(t)&&e.lineEnding&&(l.lineEnding={...i.lineEnding,...(null==l?void 0:l.lineEnding)||{}});const h=new Set,d=Object.keys(l);return d.forEach((e=>{if(!SD(i[e],l[e]))if("points"!==e||"ink"!==t&&"polygon"!==t&&"polyline"!==t)if(e!==o&&e!==r||"line"!==t)for(const[t,i]of a)t.includes(e)&&!h.has(i)&&h.add(i);else d.includes(o)&&d.includes(r)&&kD([i[o],i[r]],[l[o],l[r]])?h.add(n):h.add(s);else kD(i[e],l[e])?h.add(n):h.add(s);})),h}function HT(t,e){const i=Vn(t),n={style:i,flags:[],transform:{angle:0}},{lineEnding:s,points:o,textContents:r,stamp:a,borderWidth:l,x:h,y:d,width:c,height:u,startPoint:p,endPoint:g,lineDash:f}=i||{},y=Do.dataResolution,m=Do.displayResolution;if(o&&("ink"===e?n.style.segments=qT(o,y,m):n.style.points=YT(o,y,m)),s&&(n.style.lineEnding=zT(s,"date")),a&&(n.style.imageData=null,a instanceof Blob||Zn(a)&&uD(a)?n.style.imageData=a:Zn(a)?n.style.iconName=jT(a,"date"):DD(a)&&(n.style.stampConfig=a)),zn(l)||(n.style.borderWidth=Ys(l,y,m)),zn(h)||(n.style.x=Ys(h,y,m)),zn(d)||(n.style.y=Ys(d,y,m)),zn(c)||(n.style.width=Ys(c,y,m)),zn(u)||(n.style.height=Ys(u,y,m)),zn(f)||(n.style.lineDash=Ys(f,y,m)),zn(p)||(n.style.startPoint=Ys(p,y,m)),zn(g)||(n.style.endPoint=Ys(g,y,m)),r){const t=[];r.forEach((e=>{null!=e&&e.fontSize&&(e.fontSize=Ys(e.fontSize,y,m)),Zn(e.fontFamily)&&""===(null==e?void 0:e.fontFamily.trim())&&(e.fontFamily="Helvetica"),t.push({...oT,...e});})),n.style.textContents=t;}return Jn(t.rotation)&&["rectangle","stamp","ellipse","textBox","ink"].includes(e)&&(n.transform.angle=t.rotation),t.flags&&(t.flags.print&&n.flags.push("print"),t.flags.noView&&n.flags.push("noView"),t.flags.readOnly&&n.flags.push("readOnly"),t.flags.noResize&&n.flags.push("noResize"),t.flags.noRotate&&n.flags.push("noRotate"),t.flags.noMove&&n.flags.push("noMove")),n}function VT(t,e){var i,n,s,o,r,a,l,h,d,c;const{lineEnding:u,iconName:p,imageData:g,segments:f,textContents:y,borderWidth:m,x:v,y:x,width:w,height:b,startPoint:C,endPoint:S,lineDash:P,points:A,stampConfig:T}=(null==t?void 0:t.style)||{},k=Do.displayResolution,D=Do.dataResolution;if(A&&(t.style.points=YT(A,k,D)),f&&"ink"===e&&(t.style.points=qT(f,k,D),delete t.style.segments),u&&(t.style.lineEnding=zT(u,"user")),(g||p||T)&&(t.style.stamp=g||jT(p,"user")||Vn(T),delete t.style.iconName,delete t.style.imageData,delete t.style.stampConfig),zn(m)||(t.style.borderWidth=Ys(m,k,D)),zn(v)||(t.style.x=Ys(v,k,D)),zn(x)||(t.style.y=Ys(x,k,D)),zn(w)||(t.style.width=Ys(w,k,D)),zn(b)||(t.style.height=Ys(b,k,D)),zn(C)||(t.style.startPoint=Ys(C,k,D)),zn(S)||(t.style.endPoint=Ys(S,k,D)),zn(P)||(t.style.lineDash=Ys(P,k,D)),y){const e=[];y.forEach((t=>{null!=t&&t.fontSize&&(t.fontSize=Ys(t.fontSize,k,D)),Zn(t.fontFamily)&&""===(null==t?void 0:t.fontFamily.trim())&&(t.fontFamily="Helvetica"),e.push({...oT,...t});})),t.style.textContents=e;}return null===(i=t.style)||void 0===i||delete i.lineJoin,null===(n=t.style)||void 0===n||delete n.lineCap,null===(s=t.style)||void 0===s||delete s.miterLimit,{...t.style,rotation:(null===(o=t.transform)||void 0===o?void 0:o.angle)||0,flags:{print:!(null===(r=t.flags)||void 0===r||!r.includes("print")),noView:!(null===(a=t.flags)||void 0===a||!a.includes("noView")),readOnly:!(null===(l=t.flags)||void 0===l||!l.includes("readOnly")),noResize:!(null===(h=t.flags)||void 0===h||!h.includes("noResize")),noRotate:!(null===(d=t.flags)||void 0===d||!d.includes("noRotate")),noMove:!(null===(c=t.flags)||void 0===c||!c.includes("noMove"))}}}function zT(t,e){const i={None:KA.NONE,OpenArrow:KA.OPEN,ROpenArrow:KA.OPEN_REVERSE,ClosedArrow:KA.CLOSED,RClosedArrow:KA.CLOSED_REVERSE,Butt:KA.BUTT,Slash:KA.SLASH,Square:KA.SQUARE,Diamond:KA.DIAMOND,Circle:KA.CIRCLE};if("user"===e){const[e,n]=t;return {start:i[e],end:i[n]}}return [CD(i,t.start)[0]||"None",CD(i,t.end)[0]||"None"]}function jT(t,e){const i={[QA.REJECTED]:th.REJECTED,[QA.ACCEPTED]:th.ACCEPTED,[QA.INITIAL_HERE]:th.INITIAL_HERE,[QA.SIGN_HERE]:th.SIGN_HERE,[QA.WITNESS]:th.WITNESS,[QA.APPROVED]:th.APPROVED,[QA.NOT_APPROVED]:th.NOT_APPROVED,[QA.DRAFT]:th.DRAFT,[QA.FINAL]:th.FINAL,[QA.COMPLETED]:th.COMPLETED,[QA.CONFIDENTIAL]:th.CONFIDENTIAL,[QA.VOID]:th.VOID};return "user"===e?CD(i,t)[0]||t:i[t]||th.DRAFT}function $T(t,e){const i=["opacity","flags"],n=["x","y","width","height"],s=["borderColor","borderWidth","lineDash"],o=[...i,...s,...n,"background","rotation"],r=["points","background",...s,...i],a={rectangle:o,ellipse:o,polygon:r,polyline:["lineEnding",...r],stamp:["stamp",...n,...i,"rotation"],ink:["points","borderWidth","borderColor","rotation",...i],line:["startPoint","endPoint","lineEnding","background",...s,...i],textBox:["textContents","textAlign","background","rotation",...i,...s,...n],textTypewriter:["x","y","textContents",...i]}[t];if(!a)return e;const l={};for(const i in e)if(a.includes(i)){let n=e[i];"points"!==i||"ink"!==t&&"polygon"!==t&&"polyline"!==t?"startPoint"!==i&&"endPoint"!==i||"line"!==t?"borderColor"===i||"background"===i?l[i]=XT(n,2):"opacity"===i?(n>1&&(n=1),n<0&&(n=0),l[i]=GT(n,2)):"textContents"===i?l[i]=n.map((t=>(void 0!==t.color&&(t.color=XT(t.color,2)),void 0!==t.fontSize&&(t.fontSize=GT(t.fontSize,2)),t))):"lineDash"===i?l[i]=n.map((t=>GT(t,2))):Jn(e[i])?l[i]=GT(n,2):l[i]=n:l[i]={x:GT(n.x,2),y:GT(n.y,2)}:Fn(n[0])?l[i]=n.map((t=>t.map((t=>({x:GT(t.x,2),y:GT(t.y,2)}))))):l[i]=n.map((t=>({x:GT(t.x,2),y:GT(t.y,2)})));}return l}function GT(t,e){return Number.parseFloat(t.toFixed(e))}function XT(t,e){if(t&&t.startsWith("rgb")){const i=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/,n=t.match(i);if(n){const t=parseInt(n[1],10),i=parseInt(n[2],10),s=parseInt(n[3],10);let o=void 0!==n[4]?parseFloat(n[4]):void 0;if(void 0!==o){o<0&&(o=0),o>1&&(o=1);const n=function(t,e){const i=t.toString();if(/^\d+\.\d{3,}$/.test(i))return parseFloat(t.toFixed(e));return t}(o,e);return `rgba(${t},${i},${s},${n})`}return `rgb(${t},${i},${s})`}}return t}function YT(t,e,i){return t.map((t=>({x:Ys(t.x,e,i),y:Ys(t.y,e,i)})))}function qT(t,e,i){return t.map((t=>t.map((t=>({x:Ys(t.x,e,i),y:Ys(t.y,e,i)})))))}const JT={...NT,x:10,y:10,width:100,height:100};class ZT extends WT{constructor(t){super(t=js(t||{},Vn(JT)));}get type(){return "rectangle"}}const QT={...NT,x:10,y:10,width:100,height:80};class KT extends WT{constructor(t){super(t=js(t||{},Vn(QT)));}get type(){return "ellipse"}}const tk={...NT,points:[[{x:10,y:10},{x:110,y:80}],[{x:110,y:10},{x:10,y:80}]]};class ek extends WT{constructor(t){super(t=js(t||{},Vn(tk)));}get type(){return "ink"}}const ik={...NT,startPoint:{x:10,y:10},endPoint:{x:110,y:80},lineEnding:{start:KA.NONE,end:KA.NONE}};class nk extends WT{constructor(t){super(t=js(t||{},Vn(ik)));}get type(){return "line"}}const sk={...NT,points:[{x:60,y:10},{x:10,y:55},{x:30,y:110},{x:90,y:110},{x:110,y:55}]};class ok extends WT{constructor(t){super(t=js(t||{},Vn(sk)));}get type(){return "polygon"}}const rk={...NT,points:[{x:10,y:40},{x:50,y:80},{x:110,y:10}],lineEnding:{start:KA.NONE,end:KA.NONE}};class ak extends WT{constructor(t){super(t=js(t||{},Vn(rk)));}get type(){return "polyline"}}async function lk(t,e,i,n,s){const o=[`${s}.${n} is invalid`];let r=!1;if(Gn(t)){const e=await Xs(t);["image/bmp","image/jpeg","image/png"].includes(e)||(r=!0);}else r=!0;return !r||Cu.output(e,i,s,o)}const hk={x:10,y:10,stamp:QA.DRAFT,width:void 0,height:void 0,opacity:1,flags:{print:!0,noView:!1,readOnly:!1},rotation:0},dk={[QA.REJECTED]:[23.58,23.54],[QA.ACCEPTED]:[28.39,24.6],[QA.INITIAL_HERE]:[126.26,33.78],[QA.SIGN_HERE]:[126.26,33.78],[QA.WITNESS]:[126.26,33.78],[QA.APPROVED]:[211.33,59.33],[QA.NOT_APPROVED]:[284.83,59.33],[QA.DRAFT]:[144.19,59.66],[QA.FINAL]:[123.73,59.66],[QA.COMPLETED]:[227.83,59.33],[QA.CONFIDENTIAL]:[272.83,59.33],[QA.VOID]:[114.71,59.66]};var ck=new WeakMap;class uk{constructor(t){i(this,"uid",null),i(this,"creationDate",""),i(this,"modificationDate",""),f(this,ck,{writable:!0,value:void 0}),t=js(t||{},Vn(hk)),!Zn(t.stamp)||!dk[t.stamp]||Jn(t.width)&&Jn(t.height)||(t.width=t.width||dk[t.stamp][0],t.height=t.height||dk[t.stamp][1]),s(this,ck,t),this.uid=ts(),this.creationDate=$f(),this.modificationDate=this.creationDate;}get type(){return "stamp"}get pageUid(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get flattened(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return !!t&&t.flattened}set flattened(t){const e="Annotation.flattened";if(FA(t,1,e,"options"))return;if(!xT(t,e,"options",1))return;kP.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?kP.annotationService.flattenAnnotations([this.uid]):kP.annotationService.unFlattenAnnotation(this.uid));}getOptions(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);if(t){const e=t.getConfig(),i=VT(e,this.type);s(this,ck,{...i}),this.modificationDate=e.comment.modificationDate;}return $T(this.type,n(this,ck))}async updateOptions(t){const e="Annotation.updateOptions";if(FA(t,0,e,"options"))return;if(!HA(t,0,e,"options"))return;if(!OT(t,0,e,"options",this.type))return;if(Gn(t.stamp)&&!await lk(t.stamp,0,e,"stamp","options"))return;const i=this.getOptions(),s=FT(this.type,t,i);if(!s.size)return;this.getOptions(),js(t,n(this,ck));let o=n(this,ck);null!=t&&t.stamp||(o={...n(this,ck),stamp:null});const r=HT(o,this.type);kP.annotationService.updateAnnotations([{annotationUid:this.uid,options:r}],void 0,[...s]);}}const pk={...NT,x:10,y:10,width:150,height:80,textAlign:"left",textContents:[{content:"Insert text here"}]};class gk extends WT{constructor(t){super(t=js(t||{},Vn(pk)));}get type(){return "textBox"}}const fk={x:10,y:10,textContents:[{content:"Insert text here"}],opacity:1,author:"",subject:"",flags:{print:!0,noView:!1,readOnly:!1}};class yk extends WT{constructor(t){super(t=js(t||{},Vn(fk)));}get type(){return "textTypewriter"}}function mk(t,e,i,n,s,o){const r=Cu.formatError({isValid:Fn(t)});if(r)return Cu.output(e,i,n,void 0,r);const a=[];return t.forEach(((t,e)=>{const i=Cu.formatDetails(bu("Array",s,`[${e}]`,!0),Cu.isStringAndNotEmpty(t,o));a.push(...i);})),!a.length||Cu.output(e,i,n,a)}function vk(t,e,i,n,s){const o=[];return e.forEach(((e,i)=>{t.has(e)||o.push(`annotationUids[${i}]: The specified annotation(s) do not exist.`);})),!o.length||Cu.output(i,n,s,o,wu.ANNOTATION_NOT_EXIST)}function xk(t,e,i,n,s){return !!t.has(e)||Cu.output(i,n,s,void 0,wu.ANNOTATION_NOT_EXIST)}class wk{constructor(){i(this,"uid",null),i(this,"creationDate",""),i(this,"modificationDate",""),this.uid=ts(),this.creationDate=$f(),this.modificationDate=$f();}get type(){return "unknown"}get pageUid(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get flattened(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return !!t&&t.flattened}set flattened(t){const e="Annotation.flattened";if(FA(t,1,e,"options"))return;if(!xT(t,e,"options",1))return;kP.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?kP.annotationService.flattenAnnotations([this.uid]):kP.annotationService.unFlattenAnnotation(this.uid));}}var bk=new WeakMap;class Ck{constructor(t){f(this,bk,{writable:!0,value:void 0}),i(this,"uid",null),i(this,"creationDate",""),i(this,"modificationDate",""),this.uid=ts(),this.creationDate=$f(),this.modificationDate=$f(),s(this,bk,t);}get type(){return "incomplete"}get pageUid(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get raw(){return n(this,bk)}get flattened(){const t=kP.annotationService.annotationApp.getAnnotationByUid(this.uid);return !!t&&t.flattened}set flattened(t){const e="Annotation.flattened";if(FA(t,1,e,"options"))return;if(!xT(t,e,"options",1))return;kP.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?kP.annotationService.flattenAnnotations([this.uid]):kP.annotationService.unFlattenAnnotation(this.uid));}}const Sk=["annotationsAdded","annotationsDeleted","annotationsModified","annotationLayerChanged"],Pk="AnnotationManager",Ak=new Map;var Tk=new WeakMap,kk=new WeakMap,Dk=new WeakMap,Ek=new WeakSet,Ik=new WeakSet;function Rk(t,e){switch(t){case"rectangle":return new ZT(e);case"ellipse":return new KT(e);case"polygon":return new ok(e);case"polyline":return new ak(e);case"line":return new nk(e);case"stamp":return new uk(e);case"ink":return new ek(e);case"textBox":return new gk(e);case"textTypewriter":return new yk(e);case"unknown":return new wk;case"highlight":case"underline":case"strikeout":case"incomplete":return new Ck((null==e?void 0:e.annotationRaw)||{});default:return null}}function Mk(t,e){n(this,Dk).emit(t,e);}const Bk=new class{constructor(){y(this,Ik),y(this,Ek),f(this,Tk,{writable:!0,value:void 0}),f(this,kk,{writable:!0,value:void 0}),f(this,Dk,{writable:!0,value:void 0}),s(this,Tk,kP),s(this,kk,Ak),s(this,Dk,new ns);const t=n(this,Tk).annotationService.annotationApp.hooks;t.annotationCreated.on((t=>{const e=t.annotations.reduce(((t,e)=>{if(!n(this,kk).has(e.uid)){const t=e.getConfig(),i=VT(t),s=p(this,Ek,Rk).call(this,t.type,i);s&&(s.uid=t.uid,s.creationDate=t.comment.creationDate,s.modificationDate=t.comment.modificationDate,n(this,kk).set(t.uid,s));}return t.push(e.uid),t}),[]);p(this,Ik,Mk).call(this,"annotationsAdded",{annotationUids:e});})),t.annotationDeleted.on((t=>{t.annotations.forEach((t=>{if(n(this,kk).has(t.uid)){this.getAnnotationsByUids([t.uid])[0].modificationDate="",n(this,kk).delete(t.uid);}}));const e=t.annotations.map((t=>t.uid));t.emitEvent&&p(this,Ik,Mk).call(this,"annotationsDeleted",{annotationUids:e});})),t.annotationUpdated.on((t=>{const e={modifiedAnnotations:t.updateDetails.map((t=>{const e=this.getAnnotationsByUids([t.annotationUid])[0],i=e.type,n=kP.annotationService.annotationApp.getAnnotationByUid(e.uid);return e.modificationDate=n.comment.modificationDate,{uid:t.annotationUid,oldOptions:$T(i,VT(Vn(t.from),i)),newOptions:$T(i,VT(Vn(t.to),i))}})),actions:[...t.updateActions]};e.actions.includes("flattenedChanged")||p(this,Ik,Mk).call(this,"annotationsModified",e);}));const e=(t,e)=>{n(this,Tk).annotationService.enableEmitLayerChanged&&p(this,Ik,Mk).call(this,"annotationLayerChanged",{oldAnnotationUidList:[...t.from],newAnnotationUidList:[...t.to]});};t.bringFroward.on((t=>{e(t);})),t.bringToFront.on((t=>{e(t);})),t.sendBackward.on((t=>{e(t);})),t.sendToBack.on((t=>{e(t);}));}createAnnotation(t,e,i){const s="AnnotationManager.createAnnotation",o="pageUid",r="type",a="annotationOptions";let l=null;try{xp.makeSureCoreLicenseExist(),xp.makeSureAnnotationLicenseExist(),FA(t,0,s,o),FA(e,0,s,r),yT(t,0,s,o,!1),function(t,e,i,n){Zn(t)?!!["rectangle","ellipse","polygon","polyline","line","stamp","ink","textBox","textTypewriter"].includes(t)||Cu.output(e,i,n,void 0,wu.PARAM_NOT_SUPPORT):Cu.output(e,i,n,void 0,wu.PARAM_INVALID);}(e,0,s,r),l=n(this,Tk).pageService.getPage(t),l||Cu.error(s,o,void 0,wu.PAGE_NOT_EXIST),zn(i)||(HA(i,0,s,a),OT(i,0,s,a,e));}catch(t){if("stamp"===e)return Promise.reject(t);throw t}const h=Vn(i||{}),d=()=>{var i,s,o;const r=p(this,Ek,Rk).call(this,e,h);n(this,kk).set(r.uid,r);const a=n(this,Tk).pageService.getPage(t).doc.uid,d=HT(r.getOptions(),e);if("textTypewriter"===e){const t=l.mediaBox.width,e=l.mediaBox.width-d.style.x;d.style.width=e<0?t:e;}const c={uid:r.uid,docUid:a,pageUid:t,type:e,style:d.style,transform:d.transform,flags:d.flags,comment:{annotationUid:r.uid,author:(null===(i=d.comment)||void 0===i?void 0:i.author)||"",subject:(null===(s=d.comment)||void 0===s?void 0:s.subject)||"",contents:(null===(o=d.comment)||void 0===o?void 0:o.contents)||"",creationDate:r.creationDate,modificationDate:r.creationDate,markedStates:[],reviewStates:[],replies:[]}};return n(this,Tk).annotationService.createAnnotation(a,c),r};if("stamp"===e&&Gn(null==h?void 0:h.stamp)){const t=h;return new Promise((async(e,i)=>{try{await lk(t.stamp,0,s,"stamp",a);}catch(t){return void i(t)}if(!Jn(t.width)||!Jn(t.height)){const e=new bo,n=await e.readImageInfo({fileSource:t.stamp}).catch((t=>{i(t);}));let s=n.imageWidth,o=n.imageHeight;if(s>400||o>400){const t=Math.max(s/400,o/400);s/=t,o/=t;}t.width=s,t.height=o;}e(d());}))}return d()}deleteAnnotations(t){const e=`${Pk}.deleteAnnotations`,i="annotationUids";return !(FA(t,1,e,i)||!mk(t,1,e,i,void 0,!1)||!vk(n(this,kk),t,1,e,i))&&(n(this,Tk).annotationService.deleteAnnotations(t),!0)}getAnnotationsByUids(t){const e=`${Pk}.getAnnotationsByUids`,i="annotationUids";return !FA(t,1,e,i)&&mk(t,1,e,i,void 0,!1)&&vk(n(this,kk),t,1,e,i)?t.map((t=>n(this,kk).get(t))):[]}getAnnotationsByPage(t){const e=`${Pk}.getAnnotationsByPage`,i="pageUid";if(FA(t,1,e,i)||!yT(t,1,e,i,!1))return [];if(!n(this,Tk).pageService.getPage(t))return Cu.warning(e,i,void 0,wu.PAGE_NOT_EXIST),[];const s=n(this,Tk).annotationService.getAnnotationUidsByLayer(t),o=[];return s.forEach((t=>{const e=n(this,kk).get(t);e&&o.push(e);})),o}getAnnotationsByDoc(t){const e=`${Pk}.getAnnotationsByDoc`,i="docUid";if(FA(t,1,e,i)||!yT(t,1,e,i,!1))return [];const s=n(this,Tk).documentService.getDocument(t);if(!s)return Cu.warning(e,i,void 0,wu.DOC_NOT_EXIST),[];return s.pages.reduce(((t,e)=>(n(this,Tk).annotationService.getAnnotationUidsByLayer(e).forEach((e=>{const i=n(this,kk).get(e);i&&t.push(i);})),t)),[])}bringAnnotationForward(t){const e=`${Pk}.bringAnnotationForward`,i="annotationUid";if(FA(t,1,e,i)||!yT(t,1,e,i,!1)||!xk(n(this,kk),t,1,e,i))return !1;if(this.getAnnotationsByUids([t])[0].flattened)return !0;return n(this,Tk).annotationService.bringForward(t)}sendAnnotationBackward(t){const e=`${Pk}.sendAnnotationBackward`,i="annotationUid";if(FA(t,1,e,i)||!yT(t,1,e,i,!1)||!xk(n(this,kk),t,1,e,i))return !1;if(this.getAnnotationsByUids([t])[0].flattened)return !0;return n(this,Tk).annotationService.sendBackward(t)}bringAnnotationToFront(t){const e=`${Pk}.bringAnnotationToFront`,i="annotationUid";if(FA(t,1,e,i)||!yT(t,1,e,i,!1)||!xk(n(this,kk),t,1,e,i))return !1;if(this.getAnnotationsByUids([t])[0].flattened)return !0;return n(this,Tk).annotationService.bringToFront(t)}sendAnnotationToBack(t){const e=`${Pk}.sendAnnotationToBack`,i="annotationUid";if(FA(t,1,e,i)||!yT(t,1,e,i,!1)||!xk(n(this,kk),t,1,e,i))return !1;if(this.getAnnotationsByUids([t])[0].flattened)return !0;return n(this,Tk).annotationService.sendToBack(t)}on(t,e){const i="AnnotationManager.on",s="eventName",o="listener";!FA(t,1,i,s)&&!FA(e,1,i,o)&&yT(t,1,i,s,!1)&&fT(e,i,o,1)&&(Sk.includes(t)?n(this,Dk).on(t,e):wu.warning(wu.PARAM_NOT_SUPPORT,i,s));}off(t,e){const i="AnnotationManager.off",s="eventName";!FA(t,1,i,s)&&yT(t,1,i,s,!1)&&(zn(e)||fT(e,i,"listener",1))&&(Sk.includes(t)?n(this,Dk).off(t,e):wu.warning(wu.PARAM_NOT_SUPPORT,i,s));}};function Lk(t,e,i,n,s,o){const r=[];let a=!1;if(s)s.forEach(((t,e)=>{const{width:s,height:o}=i.getRealPtPageSize(t);bD(n,s,o)||r.push(`indices[${t}]: ${wu.RECT_EXCEED_PAGE_BOUND.message}`);})),r.length>0&&(a=!0);else {const{width:t,height:e}=i.getRealPtPageSize();bD(n,t,e)||(a=!0);}return !!a&&Cu.output(o,t,e,r.length?r:void 0,wu.RECT_EXCEED_PAGE_BOUND,!0)}function Uk(t,e,i,n){const s=ID.isRectValid(t);return !!s.length&&Cu.output(n,e,i,s,void 0,!0)}const Ok=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle","annotationSelectionStyle"],Nk="EditViewer";var _k=new WeakMap,Wk=new WeakMap,Fk=new WeakMap,Hk=new WeakSet,Vk=new WeakSet,zk=new WeakSet;class jk{constructor(t){var e,o;y(this,zk),y(this,Vk),y(this,Hk),f(this,_k,{writable:!0,value:void 0}),f(this,Wk,{writable:!0,value:!0}),f(this,Fk,{writable:!0,value:new vT}),i(this,"uid",void 0),i(this,"groupUid",void 0),i(this,"postfix",void 0),i(this,"thumbnail",void 0);xp.makeSureCoreLicenseExist(),zn(t)||bT(t,"editViewer",0,"new EditViewer","option");const r=ED(null==t?void 0:t.keyboardInteractionConfig),a=js((null==t?void 0:t.viewerConfig)||{},Vn({...RT,viewerMode:eg.DEFAULT,displayMode:"continuous",enableOptimizePage:!0,enableAnnotationUi:!0}));if(a.minZoom>a.maxZoom){wu.warning(wu.MIN_ZOOM_INVALID);const t=a.maxZoom;a.maxZoom=a.minZoom,a.minZoom=t;}const{maxZoom:l,minZoom:h}=a;a.maxZoom=l>64||l<.01?64:l,a.minZoom=h>64||h<.01?.01:h,qn()&&(aT.toolbarConfig.style={scale:"0.9"}),s(this,_k,kP.createViewer({uiConfig:Vn(qn()?jA:YA),...t,viewerConfig:{...a,...r},annotationToolBarConfig:{...null==aT?void 0:aT.toolbarConfig,...null==t||null===(e=t.annotationConfig)||void 0===e?void 0:e.toolbarConfig},annotationPaletteConfig:{...aT.paletteConfig,...null==t||null===(o=t.annotationConfig)||void 0===o?void 0:o.paletteConfig}})),this.uid=n(this,_k).uid,this.groupUid=n(this,_k).groupUid,this.postfix=n(this,_k).postfix;const d=js(Vn(null==t?void 0:t.annotationConfig)||{},Vn(aT));n(this,_k).updateAnnotationConfig(xD(d)),mD(n(this,_k).getUiConfig()).includes(VA.Filter)&&!n(this,_k).context.core.filterService.enableFilter&&wu.warning(wu.IMG_FILTER_MISS),t&&!1===t.createThumbnail||p(this,Vk,Gk).call(this,null==t?void 0:t.thumbnailConfig,r),t&&!zn(null==t?void 0:t.adaptiveIconSize)&&s(this,Wk,t.adaptiveIconSize),n(this,_k).rootDom&&(n(this,_k).rootDom.style.fontSize="20px",cD(this,n(this,_k).rootDom,n(this,Wk))),tE.forEach((t=>{n(this,_k).addFontToUi(t);})),p(this,zk,Xk).call(this),p(this,Hk,$k).call(this);}get isVisible(){return n(this,Fk).getIsVisible(n(this,_k))}get isBoundContainer(){return n(this,Fk).getIsBoundContainer(n(this,_k))}get currentDocument(){return n(this,Fk).getCurrentDocument(n(this,_k))}get zoom(){return parseFloat(n(this,_k).getViewerConfig().zoom.toFixed(4))}set zoom(t){const{maxZoom:e,minZoom:i}=n(this,_k).getViewerConfig();(function(t,e,i,n,s,o){const r=Cu.formatError(Cu.isNumberAndIsInRange(t));return r?Cu.output(e,i,n,void 0,r):(t<s&&Cu.output(e,i,n,void 0,wu.ZOOM_TOO_SMALL),t>o&&Cu.output(e,i,n,void 0,wu.ZOOM_TOO_LARGE),!0)})(t,1,`${Nk}.zoom`,"zoom",i,e)&&n(this,_k).updateViewerConfig({zoom:t});}get zoomOrigin(){return n(this,_k).getViewerConfig().zoomOrigin}set zoomOrigin(t){(function(t,e,i,n){const s=ID.isZoomOriginValid(t);return !s.length||Cu.output(n,e,i,s)})(t,`${Nk}.zoomOrigin`,"zoomOrigin",1)&&n(this,_k).updateViewerConfig({zoomOrigin:{x:t.x,y:t.y}});}get displayMode(){const{displayMode:t}=n(this,_k).getViewerConfig(),e=n(this,_k).getActiveTab();return e?e.context.displayMode:t}set displayMode(t){const e="displayMode",i=`${Nk}.${e}`;yT(t,1,i,e)&&(["single","continuous"].includes(t)?n(this,_k).updateViewerConfig({displayMode:t}):wu.warning(wu.PARAM_NOT_SUPPORT,i,e));}get toolMode(){const{toolMode:t}=n(this,_k).getViewerConfig();return t}set toolMode(t){const e="toolMode",i=`${Nk}.${e}`;yT(t,1,i,e)&&function(t,e,i,n){return !!["crop","pan","annotation"].includes(t)||Cu.output(e,i,n,void 0,wu.PARAM_NOT_SUPPORT)}(t,1,i,e)&&n(this,_k).updateViewerConfig({toolMode:t});}get annotationMode(){const{annotationMode:t}=n(this,_k).getViewerConfig();return t}set annotationMode(t){const e="annotationMode",i=`${Nk}.${e}`;yT(t,1,i,e)&&function(t,e,i,n){return !!["rectangle","ellipse","line","polygon","polyline","ink","textBox","textTypewriter","stamp","erase","select"].includes(t)||Cu.output(e,i,n,void 0,wu.PARAM_NOT_SUPPORT)}(t,1,i,e)&&n(this,_k).updateViewerConfig({annotationMode:t});}get fitMode(){const{fitMode:t}=n(this,_k).getViewerConfig(),e=n(this,_k).getActiveTab();return e?e.context.fitMode:t}set fitMode(t){const e=`${Nk}.fitMode`,i="fitMode";yT(t,1,e,i)&&function(t,e,i,n){return !!["width","height","window","actualSize"].includes(t)||Cu.output(e,i,n,void 0,wu.PARAM_NOT_SUPPORT)}(t,1,e,i)&&n(this,_k).updateViewerConfig({fitMode:t});}bindContainer(t){n(this,Fk).bindContainer(n(this,_k),t,`${Nk}.bindContainer`);}unbindContainer(){n(this,Fk).unbindContainer(n(this,_k));}show(){n(this,Fk).show(n(this,_k)),cD(this,n(this,_k).rootDom,n(this,Wk));}hide(){n(this,Fk).hide(n(this,_k));}getUiConfig(){return n(this,Fk).getUiConfig(n(this,_k))}updateUiConfig(t){n(this,_k).selectAnnotations([]);return !!n(this,Fk).updateUiConfig(n(this,_k),t,"editViewer",`${Nk}.updateUiConfig`)&&(n(this,_k).emit("thumbnailBind",this.thumbnail.uid),cD(this,n(this,_k).rootDom,n(this,Wk)),!0)}openDocument(t){n(this,Fk).openDocument(t,this.uid,`${Nk}.openDocument`);}closeDocument(){return n(this,Fk).closeDocument(n(this,_k),`${Nk}.closeDocument`)}getStyle(t){return n(this,Fk).getStyle(n(this,_k),"edit",t,Ok,`${Nk}.getStyle`)}updateStyle(t,e){const i=`${Nk}.updateStyle`;return n(this,Fk).updateStyle(n(this,_k),t,e,Ok,i)}setParallelScrollCount(t){const e=`${Nk}.setParallelScrollCount`,i="count",{maxColumns:s,maxRows:o}=n(this,_k).getViewerConfig();return !(FA(t,1,e,i)||!cT(t,e,i,1)||pT(t,1,o,1,e,i)||pT(t,1,s,1,e,i))&&("continuous"!==this.displayMode?(wu.warning(wu.ROW_COLUMN_CAN_NOT_CHANGE,e),!1):n(this,_k).setRowAndColumn(t,t))}setCropRect(t){const e=`${Nk}.setCropRect`,i="rect";return !(FA(t,1,e,i)||Uk(t,e,i,1)||!hT(n(this,_k),1)||dT(void 0,void 0,n(this,_k),1)||Lk(e,i,n(this,_k),t,void 0,1))&&("crop"!==this.toolMode?(wu.warning(wu.TOOL_MODE_NOT_AVAILABLE,e),!1):n(this,_k).setRectBox(t))}getCropRect(){return hT(n(this,_k),1)?n(this,_k).getRectBox():null}crop(t,e){const i=`${Nk}.crop`,s=n(this,_k).getPageCounts(),o="rect";if(FA(t,1,i,o)||Uk(t,i,o,1)||!hT(n(this,_k),1)||dT(void 0,void 0,n(this,_k),1))return !1;if(e&&!mT(e,1,i,"indices",0,s-1))return !1;if(Lk(i,o,n(this,_k),t,e,1))return !1;const r=n(this,_k).getCurrentPageIndex();return n(this,_k).cropPages(t,e||[r])}rotate(t,e){const i=`${Nk}.rotate`;return n(this,Fk).rotate(n(this,_k),t,e,i)}undo(){if(!hT(n(this,_k),1))return !1;const t=n(this,_k).undo();return t||wu.warning(wu.UNDO_NOOP),t}redo(){if(!hT(n(this,_k),1))return !1;const t=n(this,_k).redo();return t||wu.warning(wu.REDO_NOOP),t}saveOperations(){return n(this,Fk).saveOperation(n(this,_k))}indexToUid(t){const e=`${Nk}.indexToUid`;return n(this,Fk).indexToUid(n(this,_k),t,e)}uidToIndex(t){const e=`${Nk}.uidToIndex`;return n(this,Fk).uidToIndex(n(this,_k),t,e)}getCurrentPageUid(){return n(this,Fk).getCurrentPageUid(n(this,_k))}getCurrentPageIndex(){return n(this,Fk).getCurrentPageIndex(n(this,_k))}getPageCount(){return n(this,Fk).getPageCount(n(this,_k))}goToPage(t){const e=`${Nk}.goToPage`;return n(this,Fk).gotoPage(n(this,_k),t,e)}selectAnnotations(t){const e=`${Nk}.selectAnnotations`,i="annotationUids";if(!hT(n(this,_k),1)||dT(void 0,void 0,n(this,_k),1)||FA(t,1,e,i)||!mk(t,1,e,i,void 0,!1))return !1;if("crop"===this.toolMode)return wu.warning(wu.TOOL_MODE_NOT_AVAILABLE,e),!1;t=[...new Set(t)];const s=[],o=[],r=[],a=[],l=this.getCurrentPageUid(),h=t.reduce(((t,e,n)=>{const h=kP.annotationService.getAnnotationByUid(e);return h?h.pageUid!==l?s.push(`${i}[${n}]: The specified annotation is not on the current page.`):"incomplete"===h.type||"unknown"===h.type?o.push(`${i}[${n}]: ${wu.UNSELECTED_UNKNOWN.message}`):h.flags.includes("readOnly")||h.flags.includes("noView")?r.push(`${i}[${n}]: ${wu.UNSELECTED_READONLY.message}`):h.flattened?a.push(`${i}[${n}]: ${wu.UNSELECTED_FLATTENED.message}`):t.push(e):s.push(`${i}[${n}]: The specified annotation does not exist.`),t}),[]),d=[{result:s,exceptionType:wu.ANNOTATION_SELECT},{result:o,exceptionType:wu.UNSELECTED_UNKNOWN},{result:r,exceptionType:wu.UNSELECTED_READONLY},{result:a,exceptionType:wu.UNSELECTED_FLATTENED}];for(const{result:t,exceptionType:n}of d)if(t.length){const s=n;return s.details=t,wu.warning(s,e,i),!1}const c=n(this,_k).getSelectedAnnotations().map((t=>t.uid));return c.length===h.length&&function(t,e){if(t.length!==e.length)return !1;const i=t.slice().sort(),n=e.slice().sort();for(let t=0;t<i.length;t++)if(i[t]!==n[t])return !1;return !0}(c,h)||n(this,_k).selectAnnotations(h),!0}getSelectedAnnotations(){if(!hT(n(this,_k),1)||dT(void 0,void 0,n(this,_k),1))return [];return n(this,_k).getSelectedAnnotations().length?Bk.getAnnotationsByUids(n(this,_k).getSelectedAnnotations().map((t=>t.uid))):[]}on(t,e){n(this,Fk).on(n(this,_k),`${Nk}.on`,t,e);}off(t,e){n(this,Fk).off(n(this,_k),`${Nk}.off`,t,e);}destroy(){n(this,Fk).destroy(n(this,_k));}setAnnotationDrawingStyle(t){var e,i;const s=`${Nk}.setAnnotationDrawingStyle`,o="config";if(FA(t,1,s,o)||!HA(t,1,s,o))return !1;const r=ID.isAnnotationDrawingStyleValid(t,o);if(r.length){const t=wu.PARAM_INVALID;return t.details=r,wu.warning(t,s,o),!1}(null==t||null===(e=t.textBox)||void 0===e||null===(e=e.textContent)||void 0===e?void 0:e.fontSize)<=0&&(t.textBox.textContent.fontSize=1),(null==t||null===(i=t.textTypewriter)||void 0===i||null===(i=i.textContent)||void 0===i?void 0:i.fontSize)<=0&&(t.textTypewriter.textContent.fontSize=1);const a=n(this,_k).getAnnotationConfig().defaultStyleConfig;if(null!=t&&t.line){const e=zT(a.line.lineEnding,"user");t.line.lineEnding={...e,...t.line.lineEnding};}if(null!=t&&t.polyline){const e=zT(a.polyline.lineEnding,"user");t.polyline.lineEnding={...e,...t.polyline.lineEnding};}const l=xD({defaultStyleConfig:t});return n(this,_k).updateAnnotationConfig(l),!0}}function $k(){n(this,_k).hooks.destroy.on((()=>{var t;null===(t=this.thumbnail)||void 0===t||t.vCommon.destroy(this.thumbnail.v),this.thumbnail=null,s(this,_k,null),Object.setPrototypeOf(this,null);}));}function Gk(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t||{},s=Vn(IT);qn()&&(s.size="100%",s.rows=3,s.columns=2,s.canvasStyle.background="#4B4B4B",s.pageNumberStyle.color="white",s.enableOptimizePage=!0),js(i,s);const{mainAndThbContainer:o,mainContainer:r,thumbnailContainer:a}=n(this,_k).context.viewService,{size:l,position:h,visibility:d}=s,c=Vn(qA);let u="row",p=l,g="100%",f="left"===h?"-1":"1";"top"!==h&&"bottom"!==h||(u="column",p="100%",g=l,f="top"===h?"-1":"1");const y=`ddv-edit-viewer-thumb-${h}`;c.className=y,Object.assign(a.style,{width:p,height:g,order:f,display:"visible"===d?"block":"none"}),o.style.flexDirection=u,o.insertBefore(a,r),n(this,_k).context.resize(),n(this,_k).context.viewerConfig.hasThb=!0;const m=new LT({container:a,viewerConfig:{...s,...e},groupUid:this.groupUid,uiConfig:c},`${Nk}.thumbnail`);this.thumbnail=m,n(this,_k).emit("thumbnailBind",m.uid),m.on("click",(()=>{n(this,_k).emit("ui_hidePopup",null);}));}function Xk(){this.on("resized",(t=>{t.newWidth<1200&&t.newWidth>800&&cD(this,n(this,_k).rootDom,n(this,Wk));}));}const Yk={canvasStyle:{...tT},pageStyle:{...eT},quadSelectionStyle:{...iT},enableSlide:!0,enableMagnifier:!0};function qk(t,e,i,n){const s=ID.isQuadValid(t);return s.length?Cu.output(e,i,n,s):!!vs(t.flat())||Cu.output(e,i,n,void 0,wu.PARAM_INVALID)}function Jk(t,e,i,n){return !!function(t,e,i){for(let n=0;n<t.length;n++)if(t[n][0]>e||t[n][1]>i)return !0;return !1}(t,i,n)&&(Cu.output(e,void 0,void 0,void 0,wu.QUAD_EXCEED_PAGE_BOUND),!0)}const Zk=["canvasStyle","pageStyle","quadSelectionStyle"],Qk="PerspectiveViewer";var Kk=new WeakMap,tD=new WeakMap,eD=new WeakSet;class iD{constructor(t){y(this,eD),f(this,Kk,{writable:!0,value:void 0}),f(this,tD,{writable:!0,value:new vT}),i(this,"uid",void 0),i(this,"groupUid",void 0),i(this,"postfix",void 0),xp.makeSureCoreLicenseExist(),zn(t)||bT(t,"perspectiveViewer",0,`new ${Qk}`,"option");const e=js((null==t?void 0:t.viewerConfig)||{},Vn({...Yk,viewerMode:eg.PERSPECTIVE,toolMode:"crop"})),o=qn()?$A:XA;s(this,Kk,kP.createViewer({uiConfig:Vn(o),...t,viewerConfig:e})),this.uid=n(this,Kk).uid,this.groupUid=n(this,Kk).groupUid,this.postfix=n(this,Kk).postfix,p(this,eD,nD).call(this);}get isVisible(){return n(this,tD).getIsVisible(n(this,Kk))}get isBoundContainer(){return n(this,tD).getIsBoundContainer(n(this,Kk))}get currentDocument(){return n(this,tD).getCurrentDocument(n(this,Kk))}bindContainer(t){n(this,tD).bindContainer(n(this,Kk),t,`${Qk}.bindContainer`);}unbindContainer(){n(this,tD).unbindContainer(n(this,Kk));}show(){n(this,tD).show(n(this,Kk));}hide(){n(this,tD).hide(n(this,Kk));}getUiConfig(){return n(this,tD).getUiConfig(n(this,Kk))}updateUiConfig(t){return n(this,tD).updateUiConfig(n(this,Kk),t,"perspectiveViewer",`${Qk}.updateUiConfig`)}openDocument(t){n(this,tD).openDocument(t,this.uid,`${Qk}.openDocument`);}closeDocument(){return n(this,tD).closeDocument(n(this,Kk),`${Qk}.closeDocument`)}getStyle(t){return n(this,tD).getStyle(n(this,Kk),"perspective",t,Zk,`${Qk}.getStyle`)}updateStyle(t,e){const i=`${Qk}.updateStyle`;return n(this,tD).updateStyle(n(this,Kk),t,e,Zk,i)}setQuadSelection(t){const e=`${Qk}.setQuadSelection`,i="quad";if(FA(t,1,e,i)||!qk(t,1,e,i)||!hT(n(this,Kk),1)||dT(e,void 0,n(this,Kk),1))return !1;const{width:s,height:o}=n(this,Kk).getRealPixelSize();return !Jk(t,1,s,o)&&n(this,Kk).setQuadBox(t)}getQuadSelection(){const t=`${Qk}.getQuadSelection`;return !hT(n(this,Kk),1)||dT(t,void 0,n(this,Kk),1)?null:n(this,Kk).getQuadBox()}resetQuadSelection(t){const e=`${Qk}.resetQuadSelection`;if(!hT(n(this,Kk),1)||dT(e,void 0,n(this,Kk),1))return !1;if(!zn(t)){if(!mT(t,1,e,"indices",0,n(this,Kk).getPageCounts()-1))return !1}return n(this,Kk).resetQuadBox(t)}applyPerspective(t){const e=`${Qk}.applyPerspective`,i="quad";FA(t,0,e,i),qk(t,0,e,i),hT(n(this,Kk),0),dT(e,void 0,n(this,Kk),0);const{width:s,height:o}=n(this,Kk).getRealPixelSize();return Jk(t,0,s,o),n(this,Kk).perspectivePage(t)}rotate(t,e){const i=`${Qk}.rotate`;return n(this,tD).rotate(n(this,Kk),t,e,i)}saveOperations(){return n(this,tD).saveOperation(n(this,Kk))}goToPage(t){const e=`${Qk}.goToPage`;return n(this,tD).gotoPage(n(this,Kk),t,e)}indexToUid(t){const e=`${Qk}.indexToUid`;return n(this,tD).indexToUid(n(this,Kk),t,e)}uidToIndex(t){const e=`${Qk}.uidToIndex`;return n(this,tD).uidToIndex(n(this,Kk),t,e)}getCurrentPageUid(){return n(this,tD).getCurrentPageUid(n(this,Kk))}getCurrentPageIndex(){return n(this,tD).getCurrentPageIndex(n(this,Kk))}getPageCount(){return n(this,tD).getPageCount(n(this,Kk))}on(t,e){n(this,tD).on(n(this,Kk),`${Qk}.on`,t,e);}off(t,e){n(this,tD).off(n(this,Kk),`${Qk}.off`,t,e);}destroy(){n(this,tD).destroy(n(this,Kk));}}function nD(){n(this,Kk).hooks.destroy.on((()=>{s(this,Kk,null),Object.setPrototypeOf(this,null);}));}class sD extends LT{constructor(t){super(t,"BrowseViewer");}get currentDocument(){return this.vCommon.getCurrentDocument(this.v)}bindContainer(t){this.vCommon.bindContainer(this.v,t,`${this.errorPrefix}.bindContainer`);}unbindContainer(){this.vCommon.unbindContainer(this.v);}openDocument(t){this.vCommon.openDocument(t,this.uid,`${this.errorPrefix}.openDocument`);}closeDocument(){return this.vCommon.closeDocument(this.v,`${this.errorPrefix}.closeDocument`)}rotate(t,e){const i=`${this.errorPrefix}.rotate`;return this.vCommon.rotate(this.v,t,e,i)}indexToUid(t){const e=`${this.errorPrefix}.indexToUid`;return this.vCommon.indexToUid(this.v,t,e)}uidToIndex(t){const e=`${this.errorPrefix}.uidToIndex`;return this.vCommon.uidToIndex(this.v,t,e)}getCurrentPageUid(){return this.vCommon.getCurrentPageUid(this.v)}getCurrentPageIndex(){return this.vCommon.getCurrentPageIndex(this.v)}getPageCount(){return this.vCommon.getPageCount(this.v)}goToPage(t){const e=`${this.errorPrefix}.goToPage`;return this.vCommon.gotoPage(this.v,t,e)}saveOperations(){return this.vCommon.saveOperation(this.v)}destroy(){this.vCommon.destroy(this.v);}}var oD=new WeakMap,rD=new WeakMap,aD=new WeakMap,lD=new WeakSet;class hD{constructor(t){y(this,lD),f(this,oD,{writable:!0,value:void 0}),f(this,rD,{writable:!0,value:void 0}),f(this,aD,{writable:!0,value:!1}),i(this,"uid",void 0),i(this,"isDestroyed",!1),i(this,"postfix",void 0);this.uid=ts(),this.postfix=`-${this.uid}`,s(this,rD,new ns),zn(t)||bT(t,"customViewer",0,"new CustomViewer","option");let e=null==t?void 0:t.uiConfig;(!e||Hn(e)&&0===Object.keys(e).length)&&(e={type:"Layout"}),p(this,lD,dD).call(this),s(this,oD,new ow({container:null==t?void 0:t.container,emitter:n(this,rD),postfix:this.uid,uiConfig:e,injection:{viewer:{postfix:this.postfix}}})),null!=t&&t.container&&e&&n(this,oD).bindContainer(t.container);}get isBoundContainer(){return n(this,aD)}get isVisible(){return "none"!==n(this,oD).rootDom.style.display}bindContainer(t){const e="CustomViewer.bindContainer";FA(t,0,e,"container");const i=ID.isContainerParamValid(t);i&&Cu.error(e,"container",void 0,i);n(this,oD).bindContainer(t)&&s(this,aD,!0);}unbindContainer(){n(this,oD).unbindContainer(),s(this,aD,!1);}hide(){n(this,oD).rootDom.style.display="none";}show(){n(this,oD).rootDom.style.display="flex";}getUiConfig(){return n(this,oD).uiConfig}updateUiConfig(t){const e="CustomViewer.updateUiConfig",i="uiConfig";return !(FA(t,1,e,i)||!uT(t,"customViewer",e,i,1))&&n(this,oD).updateUiConfig(t)}on(t,e){const i="CustomViewer.on";!FA(t,1,i,"eventName")&&!FA(e,1,i,"listener")&&yT(t,1,i,"eventName",!1)&&fT(e,i,"listener",1)&&n(this,rD).on(t,e);}off(t,e){const i="CustomViewer.off";!FA(t,1,i,"eventName")&&yT(t,1,i,"eventName",!1)&&(zn(e)||fT(e,i,"listener",1))&&n(this,rD).off(t,e);}destroy(){this.isDestroyed||(n(this,oD).dispose(),n(this,rD).destroy(),s(this,oD,null),s(this,rD,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null);}}function dD(){ow.registerComponent({Root:dw,Layout:aw,Button:rw,Blank:qb,SeparatorLine:cw,Close:Jb,Done:Qb,Back:Zb});}function cD(t,e,i){if(!i||qn()||!t.isVisible)return;const n=e,s=n.clientWidth;if(t instanceof jk){let t=20;s<1280&&(t=Math.max(13.5,s/1280*20)),n.style.fontSize=`${t}px`;}}function uD(t){if(t instanceof Blob)return !0;if(Zn(t)){const e=t=>{try{new URL(t);return !0}catch(t){return !1}};return !(!(t=>/^data:image\/([a-zA-Z]*);base64,/.test(t))(t)&&!e(t))}return !1}function pD(t){return !![QA.REJECTED,QA.ACCEPTED,QA.INITIAL_HERE,QA.SIGN_HERE,QA.WITNESS,QA.APPROVED,QA.NOT_APPROVED,QA.DRAFT,QA.FINAL,QA.COMPLETED,QA.CONFIDENTIAL,QA.VOID].includes(t)}function gD(t){return !!pD(t)||(!!Gn(t)||!!DD(t))}function fD(t){return !!Hn(t)&&!(null!=t&&t.content&&!Zn(t.content)||null!=t&&t.color&&!Zn(t.color)||null!=t&&t.fontFamily&&!Zn(t.fontFamily)||null!=t&&t.fontSize&&!Jn(t.fontSize)||null!=t&&t.lineThrough&&!Xn(t.lineThrough)||null!=t&&t.underline&&!Xn(t.underline)||null!=t&&t.fontWeight&&!["normal","bold"].includes(t.fontWeight)||null!=t&&t.fontStyle&&!["normal","italic"].includes(t.fontStyle))}function yD(t,e){const i=["Load","Download","Print"],n=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],s=[...n,"MainView"],o=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],r=[...s,...o,...i,"PerspectiveAll","FullQuad"],a=[...s,...o,...i],l=[...s,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],h=[...s,...o,...i,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage","AnnotationSet","EllipseAnnotation","EraseAnnotation","InkAnnotation","LineAnnotation","PolygonAnnotation","PolylineAnnotation","RectAnnotation","SelectAnnotation","StampIconAnnotation","StampImageAnnotation","TextBoxAnnotation","TextTypewriterAnnotation","BringForward","BringToFront","SendBackward","SendToBack"];let d;switch(e){case"captureViewer":d=l;break;case"editViewer":d=h;break;case"perspectiveViewer":d=r;break;case"customViewer":d=n;break;case"browseViewer":d=a;}const c=[];return null!=t&&t.type&&!d.includes(null==t?void 0:t.type)&&c.push(t.type),null!=t&&t.children&&t.children.forEach((t=>{Zn(t)&&!d.includes(t)&&c.push(t),Hn(t)&&c.push(...yD(t,e));})),c}function mD(t){const e=[];return null!=t&&t.type&&e.push(t.type),null!=t&&t.children&&t.children.forEach((t=>{Zn(t)&&e.push(t),Hn(t)&&e.push(...mD(t));})),[...new Set(e)]}function vD(t,e){const i=yD(t,e);if(i.length>0){let t="";return i.forEach(((e,n)=>{n===i.length-1?t+=`${e}`:t+=`${e} `;})),t}return !1}function xD(t){const{defaultStyleConfig:e}=t;Object.keys(e).forEach((t=>{const i=e[t];"object"==typeof i&&null!==i&&((t=>{if("lineEnding"in t&&"object"==typeof t.lineEnding&&null!==t.lineEnding){const e=zT(t.lineEnding,"date");delete t.lineEnding,t.lineEnding=e;}})(i),(t=>{"borderWidth"in t&&(t.borderWidth=Ys(Jn(null==t?void 0:t.borderWidth)?t.borderWidth:1,Do.dataResolution,Do.displayResolution));})(i),(t=>{if("textContent"in t)if(Hn(t.textContent)){var e,i,n,s,o,r,a;Jn(null==t||null===(e=t.textContent)||void 0===e?void 0:e.fontSize)&&(t.textContent.fontSize=Ys(null==t||null===(a=t.textContent)||void 0===a?void 0:a.fontSize,Do.dataResolution,Do.displayResolution)),null!=t&&null!==(i=t.textContent)&&void 0!==i&&i.fontStyle&&!["normal","italic"].includes(null==t||null===(n=t.textContent)||void 0===n?void 0:n.fontStyle)&&(t.textContent.fontStyle="normal"),null!=t&&null!==(s=t.textContent)&&void 0!==s&&s.fontWeight&&!["normal","bold"].includes(null==t||null===(o=t.textContent)||void 0===o?void 0:o.fontWeight)&&(t.textContent.fontWeight="normal"),""===(null==t||null===(r=t.textContent)||void 0===r?void 0:r.fontFamily)&&(t.textContent.fontFamily="Helvetica");}else t.textContent={};})(i),(t=>{"lineDash"in t&&t.lineDash.length&&(t.lineDash=Ys(t.lineDash,Do.dataResolution,Do.displayResolution));})(i),(t=>{"textAlign"in t&&!["left","right","center","justify"].includes(null==t?void 0:t.textAlign)&&(t.textAlign="left");})(i),(t=>{"opacity"in t&&(!Jn(null==t?void 0:t.opacity)||(null==t?void 0:t.opacity)<0||(null==t?void 0:t.opacity)>1)&&(t.opacity=1);})(i),"stamp"===t&&(t=>{t.stamp instanceof Blob&&(t.imageData=t.stamp),Zn(t.stamp)&&(uD(t.stamp)?t.imageData=t.stamp:t.stampIcon=pD(t.stamp)?jT(t.stamp,"date"):jT(QA.DRAFT,"date")),DD(t.stamp)&&(t.stampConfig=t.stamp),delete t.stamp;})(i));}));return {...t,controlsStyle:t.annotationSelectionStyle}}function wD(t){if(""===t)return !0;const e=document.createElement("div");e.style.border=t;const i=t=>""===t||"initial"===t,{borderWidth:n,borderColor:s,borderStyle:o}=e.style;return !(i(n)||i(s)||i(o))}function bD(t,e,i){const{left:n,top:s,width:o,height:r}=t;return !(n>e||n+o>e||s>i||s+r>i)}function CD(t,e){return Object.keys(t).filter((i=>t[i]===e))}function SD(t,e){if(t===e)return !0;if(Hn(t)&&Hn(e)&&Object.keys(t).length===Object.keys(e).length)for(const i in t){if(!Object.prototype.hasOwnProperty.call(e,i))return !1;if(!SD(t[i],e[i]))return !1}else {if(!Fn(t)||!Fn(e)||t.length!==e.length)return !1;for(let i=0;i<t.length;i++)if(!SD(t[i],e[i]))return !1}return !0}function PD(t,e){let i;switch(t){case"canvasStyle":i=function(t,e){const i=[];i.push(...TD(t,{border:(null==e?void 0:e.border)||"",background:(null==e?void 0:e.background)||""})),zn(null==e?void 0:e.cursor)||Zn(e.cursor)||i.push(`${t}.cursor is invalid`);return i}(t,e);break;case"pageNumberStyle":i=function(t,e){const i=[],n=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zn(e[s])||i.push(`${t}.${s} is invalid.`)),"border"===s&&Zn(e[s])&&!wD(e[s])&&i.push(`${t}.border is invalid.`),("onPage"===s&&!Xn(e[s])||"opacity"===s&&!Jn(e[s])||"visibility"===s&&-1===["visible","hidden"].indexOf(e[s]))&&i.push(`${t}.${s} is invalid.`);})),i}(t,e);break;case"checkBoxStyle":i=function(t,e){const i=[],n=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zn(e[s])||i.push(`${t}.${s} is invalid.`)),"border"===s&&Zn(e[s])&&!wD(e[s])&&i.push(`${t}.border is invalid.`),("opacity"===s&&!Jn(e[s])||"visibility"===s&&-1===["visible","hidden"].indexOf(e[s]))&&i.push(`${t}.${s} is invalid.`);})),i}(t,e);break;case"quadSelectionStyle":i=function(t,e){const i=[],n=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zn(e[s])||i.push(`${t}.${s} is invalid`)),"border"!==s&&"ctrlBorder"!==s||!Zn(e[s])||wD(e[s])||i.push(`${t}.${s} is invalid`);})),i}(t,e);break;case"annotationSelectionStyle":i=function(t,e){const i=[],n=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zn(e[s])||i.push(`${t}.${s} is invalid.`)),"border"!==s&&"ctrlBorder"!==s||!Zn(e[s])||wD(e[s])||i.push(`${t}.${s} is invalid.`);})),i}(t,e);break;default:i=TD(t,e);}return i}function AD(t){return !!Jn(t)&&t>=0}function TD(t,e){const i=[];return Object.keys(e).forEach((n=>{-1!==["background","border"].indexOf(n)&&(Zn(e[n])||i.push(`${t}.${n} is invalid.`),"border"===n&&e[n]&&Zn(e[n])&&!wD(e[n])&&i.push(`${t}.border is invalid.`));})),i}function kD(t,e){const i=t.flat(2),n=e.flat(2);if(i.length!==n.length)return !1;const s=n[0].x-i[0].x,o=n[1].y-i[1].y;for(let t=1;t<i.length;t++){if(n[t].x-i[t].x!==s)return !1;if(n[t].y-i[t].y!==o)return !1}return !0}function DD(t){return Array.isArray(t)&&t.every((t=>"object"==typeof t&&null!==t))}function ED(t){const e={};return !1===(null==t?void 0:t.enableZoom)&&(e.enableZoomInWithKeyboard=!1,e.enableZoomOutWithKeyboard=!1),!1===(null==t?void 0:t.enableUndoRedo)&&(e.enableUndoWithKeyboard=!1,e.enableRedoWithKeyboard=!1),!1===(null==t?void 0:t.enableAnnotationClipboard)&&(e.enableCopyCutPasteWithKeyboard=!1),!1===(null==t?void 0:t.enableMoveAnnotation)&&(e.enableMoveAnnotationWithKeyboard=!1),!1===(null==t?void 0:t.enableDeleteAnnotation)&&(e.enableDeleteWithKeyboard=!1),!1===(null==t?void 0:t.enablePageNavigation)&&(e.enableSelectPageWithKeyboard=!1),!1===(null==t?void 0:t.enableMultiplePagesSelection)&&(e.enableSelectWithShift=!1,e.enableSelectWithCtrl=!1),!1===(null==t?void 0:t.enableMultipleAnnotationsSelection)&&(e.enableMultipleSelectAnnotationWithKeyboard=!1),e}class ID{static isLicenseValid(t){if(Zn(t)){const e=t.trim();return 0===e.length||e.startsWith("DLS")||(e.startsWith("f")||e.startsWith("t"))&&e.length>50}return !1}static isQuadValid(t,e){const i=[],n=bu("Quad",e);if(zn(t))return i.push(`${n} is missing.`),i;const s=Cu.isArrayAndMeetMinLength(t,4),o=Cu.formatDetails(n,s);return o.length?(i.push(...o),i):(t.forEach(((t,n)=>{const s=bu("Quad",e,`[${n}]`,!0),o=Cu.isArrayAndMeetMinLength(t,2),r=Cu.formatDetails(bu("Array",s),o);r.length?i.push(...r):t.forEach(((t,e)=>{const n=Cu.isNumberAndIsInRange(t),o=Cu.formatDetails(bu("Array",s,`[${e}]`,!0),n);o.length&&i.push(...o);}));})),i)}static isRectValid(t,e){const i=[],n=bu("Rect",e);if(zn(t))return i.push(`${n} is missing.`),i;const s=Cu.formatDetails(n,Hn(t));return s.length?(i.push(...s),i):(["left","top","width","height"].forEach((n=>{const s=Cu.formatDetails(bu("Rect",e,n),Cu.isNumberAndIsInRange(t[n]));s.length&&i.push(...s);})),i)}static isSourceValid(t,e,i){const n=[],s="Source",o=Cu.formatDetails(bu(s,e),Hn(t));if(o.length)return n.push(...o),n;const r=Cu.formatDetails(bu(s,e,"fileData"),Gn(t.fileData));if(r.length)return n.push(...r),n;if(!zn(t.extraPageData)){const o=Cu.formatDetails(bu(s,e,"extraPageData"),Cu.isArrayAndMeetMinLength(t.extraPageData));if(o.length)return n.push(...o),n;t.extraPageData.forEach(((t,o)=>{const r=this.isExtraPageDataValid(t,bu(s,e,`extraPageData[${o}]`,!0),i);r.length&&n.push(...r);}));}return n}static isExtraPageDataValid(t,e,i){const n=[],s="ExtraPageData",o=Cu.formatDetails(bu(s,e),Hn(t));if(o.length)return n.push(...o),n;const r=Cu.formatDetails(bu(s,e,"index"),Cu.isNumberAndIsInRange(t.index));if(n.push(...r),!zn(t.rotation)){const i=this.isRotationValid(t.rotation,bu(s,e));n.push(...i);}if(!zn(t.filter)){const o=this.isFilterTypeValid(t.filter,i,bu(s,e));n.push(...o);}return zn(t.perspectiveQuad)||n.push(...this.isQuadValid(t.perspectiveQuad,bu(s,e,"perspectiveQuad"))),n}static isSourcesValid(t,e,i){const n=[],s="Source[]",o=Cu.formatDetails(bu(s,e),Cu.isArrayAndMeetMinLength(t));return o.length?(n.push(...o),n):(t.forEach(((t,o)=>{n.push(...this.isSourceValid(t,bu(s,e,`[${o}]`,!0),i));})),n)}static isLoadSourceOptionsValid(t,e){const i=[],n="LoadSourceOptions",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(!zn(t.insertBeforeIndex)){const s=Cu.formatDetails(bu(n,e,"insertBeforeIndex"),Cu.isNumberAndIsInRange(t.insertBeforeIndex));i.push(...s);}if(!zn(t.exception)){const s=Cu.formatDetails(bu(n,e,"exception"),Cu.isStringAndNotEmpty(t.exception,!1));i.push(...s);}return i}static isHandlerTypeValid(t){return {isValid:Zn(t)&&["documentBoundariesDetect","imageFilter"].includes(t)}}static isContainerKeyValid(t,e){const i="container";let n;if(is(t)&&(n=t),Zn(t)){const e=document.getElementById(t);is(e)&&(n=e);}const s=[];return n||s.push(`${bu(i,e,i)}: ${wu.CONTAINER_NOT_EXIST.message}`),s}static isContainerParamValid(t){return Zn(t)||is(t)?this.isContainerKeyValid(t).length>0?wu.CONTAINER_NOT_EXIST:null:wu.PARAM_INVALID}static isUiConfigValid(t,e){const i="UiConfig",n=[],s=Cu.formatDetails(bu(i,e),Hn(t));if(s.length)return n.push(...s),n;const o=Cu.formatDetails(bu(i,e,"type"),Cu.isStringAndNotEmpty(t.type,!1));if(n.push(...o),["id","name","flexDirection","tooltip","className","label"].forEach((s=>{if(!zn(t[s])){const o=Cu.formatDetails(bu(i,e,s),Cu.isStringAndNotEmpty(t[s]));n.push(...o);}})),["style","events"].forEach((s=>{if(!zn(t[s])){const o=Cu.formatDetails(bu(i,e,s),Hn(t[s]));n.push(...o);}})),!zn(t.children)){const s=Cu.formatDetails(bu(i,e,"children"),Cu.isArrayAndMeetMinLength(t.children));if(s.length)return n.push(...s),n;t.children.forEach(((t,s)=>{if(Zn(t)||Hn(t)||n.push(`${i}.children[${s}] is invalid.`),Hn(t)){const o=this.isUiConfigValid(t,bu(i,e,`children[${s}]`));n.push(...o);}}));}return n}static isDocOptionsValid(t,e){const i=[],n=e||"CreateDocumentOptions",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(!zn(t.name)){const s=Cu.formatDetails(bu(n,e,"name"),Cu.isStringAndNotEmpty(t.name,!1));i.push(...s);}if(!zn(t.author)){const s=Cu.formatDetails(bu(n,e,"author"),Cu.isStringAndNotEmpty(t.author,!1));i.push(...s);}if(!zn(t.creationDate)){const s=Cu.formatDetails(bu(n,e,"creationDate"),Cu.isPdfDate(t.creationDate));i.push(...s);}if(!zn(t.deleteOriginal)){const s=Cu.formatDetails(bu(n,e,"deleteOriginal"),Xn(t.deleteOriginal));i.push(...s);}return i}static isTransferOptionsValid(t,e,i,n){const s=[],o="TransferOptions",r=Cu.formatDetails(bu(o,n),Hn(t));if(r.length)return s.push(...r),s;if(!zn(t.sourceIndices)){const r=this.isNumberArrayValid(t.sourceIndices,e,i,bu(o,n,"sourceIndices"));s.push(...r);}if(!zn(t.insertBeforeIndex)){const e=Cu.formatDetails(bu(o,n,"insertBeforeIndex"),Cu.isNumberAndIsInRange(t.insertBeforeIndex,0));s.push(...e);}return s}static isNumberArrayValid(t,e,i,n){return this.isTypeArrayValid("number",t,e,i,n)}static isStringArrayValid(t,e){return this.isTypeArrayValid("string",t,void 0,void 0,e)}static isBlobArrayValid(t,e){return this.isTypeArrayValid("blob",t,void 0,void 0,e)}static isTypeArrayValid(t,e,i,n,s){const o=[],r=Cu.formatDetails(bu("Array",s),Cu.isArrayAndMeetMinLength(e));return r.length?(o.push(...r),o):(e.forEach(((e,r)=>{let a=null;"blob"===t?a=Gn(e):"number"===t?a=Cu.isNumberAndIsInRange(e,i,n):"string"===t&&(a=Cu.isStringAndNotEmpty(e));const l=Cu.formatDetails(bu("Array",s,`[${r}]`,!0),a);o.push(...l);})),o)}static isUpdatePageOptionsValid(t,e,i){const n=[],s="UpdatePageOptions",o=Cu.formatDetails(bu(s,i),Hn(t));if(o.length)return n.push(...o),n;if(["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth"].forEach((e=>{const o=t[e];if(!zn(o)){const t=Cu.formatDetails(bu(s,i,e),Cu.isNumberAndIsInRange(o,0));n.push(...t);}})),!zn(t.rotation)){const e=this.isRotationValid(t.rotation,bu(s,i));n.push(...e);}if(!zn(t.filter)){const o=this.isFilterTypeValid(t.filter,e,bu(s,i));n.push(...o);}return n}static isRotationValid(t,e){const i=[],n=bu("",e,"rotation"),s=Cu.formatDetails(n,Cu.isNumberAndIsInRange(t));return s.length?(i.push(...s),i):(i.length||t%90==0||i.push(`'${n}' is not supported.`),i)}static isFilterTypeValid(t,e,i){const n=[],s=bu("",i,"filter"),o=Cu.formatDetails(s,Cu.isStringAndNotEmpty(t,!1));return o.length?(n.push(...o),n):(!n.length&&"none"!==t&&Fn(e)&&e.length>0&&!e.includes(t)&&n.push(`'${s}' is not supported.`),n)}static isSaveJpegSettingsValid(t,e){const i=[],n="SaveJpegSettings",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(!zn(t.quality)){const s=Cu.formatDetails(bu(n,e,"quality"),Cu.isNumberAndIsInRange(t.quality,0,100));i.push(...s);}if(!zn(t.saveAnnotation)){const s=Cu.formatDetails(bu(n,e,"saveAnnotation"),Xn(t.saveAnnotation));i.push(...s);}return i}static isSavePngSettingsValid(t,e){const i=[],n="SavePngSettings",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(!zn(t.saveAnnotation)){const s=Cu.formatDetails(bu(n,e,"saveAnnotation"),Xn(t.saveAnnotation));i.push(...s);}return i}static isSavePdfSettingsValid(t,e){const i=[],n="SavePdfSettings",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(["author","creator","keyWords","producer","subject","title"].forEach((s=>{const o=t[s];if(!zn(o)){const t=Cu.formatDetails(bu(n,e,s),Cu.isStringAndNotEmpty(o,!1));i.push(...t);}})),!zn(t.compression)){const s=Cu.formatDetails(bu(n,e,"compression"),Fo.has(t.compression));i.push(...s);}if(!zn(t.creationDate)){const s=Cu.formatDetails(bu(n,e,"creationDate"),Cu.isPdfDate(t.creationDate));i.push(...s);}if(!zn(t.modifiedDate)){const s=Cu.formatDetails(bu(n,e,"modifiedDate"),Cu.isPdfDate(t.modifiedDate));i.push(...s);}if(!zn(t.pageType)){const s=Cu.formatDetails(bu(n,e,"pageType"),Wo.has(t.pageType));i.push(...s);}if(!zn(t.version)){const s=Cu.formatDetails(bu(n,e,"version"),this.isPdfVersionValid(t.version));i.push(...s);}if(!zn(t.mimeType)){const s=Cu.formatDetails(bu(n,e,"mimeType"),Cu.isStringAndNotEmpty(t.mimeType));i.push(...s);}if(!zn(t.quality)){const s=Cu.formatDetails(bu(n,e,"quality"),Cu.isNumberAndIsInRange(t.quality,0,100));i.push(...s);}if(!zn(t.password)){const s=Cu.formatDetails(bu(n,e,"password"),Cu.isStringAndNotEmpty(t.password));i.push(...s),!s.length&&t.password.length>32&&i.push("The specified password exceeds 32 characters.");}if(!zn(t.saveAnnotation)){const s=Cu.formatDetails(bu(n,e,"saveAnnotation"),["none","image","annotation","flatten"].includes(t.saveAnnotation));i.push(...s);}if(!zn(t.imageScaleFactor)){const s=Cu.formatDetails(bu(n,e,"imageScaleFactor"),Cu.isNumberAndIsInRange(t.imageScaleFactor,Number.MIN_VALUE,1));i.push(...s);}return i}static isPdfVersionValid(t){return !!Zn(t)&&["1.1","1.2","1.3","1.4","1.5","1.6","1.7"].includes(t.trim())}static isSaveTiffSettingsValid(t,e){const i=[],n="SaveTiffSettings",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(!zn(t.compression)){const s=Cu.formatDetails(bu(n,e,"compression"),Ho.has(t.compression));i.push(...s);}if(!zn(t.customTag)){const s=Cu.formatDetails(bu(n,e,"customTag"),Cu.isArrayAndMeetMinLength(t.customTag));i.push(...s),s.length||t.customTag.forEach(((t,s)=>{const o=this.isTiffCustomTagValid(t,bu(n,e,`customTag[${s}]`));i.push(...o);}));}if(!zn(t.quality)){const s=Cu.formatDetails(bu(n,e,"quality"),Cu.isNumberAndIsInRange(t.quality,0,100));i.push(...s);}return i}static isTiffCustomTagValid(t,e){const i=[],n="CustomTag",s=Cu.formatDetails(bu(n,e),Hn(t));if(s.length)return i.push(...s),i;if(!zn(t.content)){const s=Cu.formatDetails(bu(n,e,"content"),Cu.isStringAndNotEmpty(t.content,!1));i.push(...s);}if(!zn(t.contentIsBase64)){const s=Cu.formatDetails(bu(n,e,"contentIsBase64"),Xn(t.contentIsBase64));i.push(...s);}if(!zn(t.id)){const s=Cu.formatDetails(bu(n,e,"id"),Cu.isNumberAndIsInRange(t.id));i.push(...s);}return i}static isVideoDeviceInfo(t,e){const i=[],n=Cu.formatDetails(e,Hn(t));i.push(...n);const s=Cu.formatDetails(bu(e,void 0,"deviceId"),Cu.isStringAndNotEmpty(t.deviceId,!1));i.push(...s);const o=Cu.formatDetails(bu(e,void 0,"label"),Cu.isStringAndNotEmpty(t.label,!1));return i.push(...o),i}static isVideoConfig(t,e){const i=[],n=Cu.formatDetails(e,Hn(t));if(n.length)return i.push(...n),i;if(!zn(t.fill)){const n=Cu.formatDetails(bu(e,void 0,"fill"),Xn(t.fill));i.push(...n);}if(!zn(t.resolution)){const n=ID.isNumberArrayValid(t.resolution,0,void 0,bu(e,void 0,"resolution"));i.push(...n);}return i}static isZoomOriginValid(t){const e=[],i=Cu.formatDetails("zoomOrigin",Hn(t));return i.length?(e.push(...i),e):(["x","y"].forEach((i=>{const n=t[i];zn(n)?e.push(`ZoomOrigin.${i} is missing.`):["start","center","end"].includes(n)||e.push(`ZoomOrigin.${i} is valid.`);})),e)}static isAnnotationOptionsValid(t,e,i){const n=[],s=["x","y","rotation"],o=["width","height","borderWidth","opacity","miterLimit","fontSize"],r=["borderColor","background","icon","lineCap","lineJoin","textAlign","content","color","fontFamily","fontWeight","fontStyle"],a=["points"],l=["textContents"],h=["startPoint","endPoint"],d=["flags"],c=["stamp"],u=["lineDash"];if("textTypewriter"===i){const{textContents:i}=t;if(i&&(!Fn(i)||!i.length||i.find((t=>!Hn(t)))||i.every((t=>""===t.content||void 0===t.content||null===t.content))))return n.push(`${e}.textContents is invalid`),n}const p=t=>!!Hn(t)&&(!!Jn(null==t?void 0:t.x)&&!!Jn(null==t?void 0:t.y)),g=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Fn(t))return !1;if(e&&t.length<2)return !1;for(let e=0;e<t.length;e++)if(!p(t[e]))return !1;return !0};return Object.keys(t).forEach((f=>{const y=t[f];let m=!0;(s.includes(f)&&!Jn(y)||o.includes(f)&&!AD(y)||r.includes(f)&&!Zn(y)||l.includes(f)&&!(t=>{if(!Fn(t))return !1;for(let e=0;e<t.length;e++){const i=t[e];if(!Hn(i))return !1;if(!fD(i))return !1}return !0})(y)||h.includes(f)&&!p(y)||d.includes(f)&&!Hn(y)||c.includes(f)&&!gD(y)||u.includes(f)&&!(t=>{if(!Fn(t))return !1;for(let e=0;e<t.length;e++)if(!AD(t[e]))return !1;return !0})(y))&&(m=!1),a.includes(f)&&("ink"===i?(t=>{if(!Fn(t))return !1;if(!t.length)return !1;for(let e=0;e<t.length;e++)if(!g(t[e],!1))return !1;return !0})(t[f])||(m=!1):g(t[f])||(m=!1)),m||n.push(`${e}.${f} is invalid`);})),n}static isAnnotationDrawingStyleValid(t,e){const i=["opacity","borderWidth"],n=["borderColor","background","textAlign"],s=["lineEnding","textContent"],o=[];return Object.keys(t).forEach((r=>{if(["rectangle","ellipse","polygon","polyline","line","ink","textBox","textTypewriter","stamp"].includes(r)){const a=t[r];Object.keys(a).forEach((t=>{const l=a[t];let h=!0;(i.includes(t)&&!Jn(l)||n.includes(t)&&!Zn(l)||s.includes(t)&&!Hn(l))&&(h=!1),"stamp"!==t||gD(l)||(h=!1),"textContent"===t&&h&&(null!=l&&l.content&&!Zn(l.content)||null!=l&&l.color&&!Zn(l.color)||null!=l&&l.fontFamily&&!Zn(l.fontFamily)||null!=l&&l.fontSize&&!Jn(l.fontSize)||null!=l&&l.lineThrough&&!Xn(l.lineThrough)||null!=l&&l.underline&&!Xn(l.underline)||null!=l&&l.fontWeight&&!["normal","bold"].includes(l.fontWeight)||null!=l&&l.fontStyle&&!["normal","italic"].includes(l.fontStyle))&&(h=!1),h||o.push(`${e}[${r}].${t} is invalid`);}));}})),o}}var RD=new WeakMap,MD=new WeakMap,BD=new WeakMap;class LD{constructor(t,e){f(this,BD,{get:UD,set:void 0}),f(this,RD,{writable:!0,value:void 0}),f(this,MD,{writable:!0,value:void 0}),s(this,RD,t),s(this,MD,e);}get name(){return n(this,MD).name}get uid(){return n(this,MD).uid}get pages(){return n(this,MD).pages.slice()}get creationDate(){return n(this,MD).creationDate}get author(){return n(this,MD).author}async loadSource(t,e){const i="IDocument.loadSource",s="sources";xp.makeSureLoadLicenseExist(),FA(t,0,i,s);!function(t,e,i,n,s){let o=[];if(Fn(t)){for(let i=0;i<t.length;i++)if(!Gn(t[i]))if(Hn(t[i])){const n=ID.isSourceValid(t[i],bu("Source",void 0,`[${i}]`,!0),e);n.length&&o.push(...n);}else {const t=Cu.formatDetails(bu("Source",s,`[${i}]`,!0),!1);o.push(...t);}}else Gn(t)||(o=ID.isSourceValid(t,void 0,e));!o.length||Cu.output(i,n,s,o);}(t,n(this,RD).filterService.getSupportedFilters().map((t=>t.type)),0,i,s),Hn(e)?function(t,e,i,n){const s=ID.isLoadSourceOptionsValid(t,void 0);!s.length||Cu.output(e,i,n,s);}(e,0,i,"loadSourceOptions"):zn(e)||wT(e,0,i,"index",0),Fn(t)||(t=[t]),t=t.map((t=>Gn(t)?{fileData:t}:t));const o=wu.buildInfo("loadSource",{docUid:this.uid,current:0,total:t.length});return wu.info(o),n(this,RD).loadSource(t,this.uid,e,o).catch((t=>(o.status="Failed",wu.info(o),wu.reject(t,i))))}async getPageData(t){const e="IDocument.getPageData",i="pageUid";FA(t,0,e,i),yT(t,0,e,i,!1),this.pages.includes(t)||Cu.error(e,i,void 0,wu.PAGE_NOT_EXIST);const s=await n(this,RD).getPageData(t);if(s.raw){const t={data:s.raw.data,width:s.raw.width,height:s.raw.height};s.raw=t;}if(s.display){const t={data:s.display.data,width:s.display.width,height:s.display.height};s.display=t;}if(s.thumbnail){const t={data:s.thumbnail.data,width:s.thumbnail.width,height:s.thumbnail.height};s.thumbnail=t;}s.rotation&&(s.rotation%=360);const{displayResolution:o,dataResolution:r}=Do;return s.mediaBox=OD(Ys(s.mediaBox,o,r),2),s.cropBox=OD(Ys(s.cropBox,o,r),2),s}async updatePage(t,e,i){const s="IDocument.updatePage",o="pageUid",r="data";if(FA(t,0,s,o),FA(e,0,s,r),yT(t,0,s,o,!1),gT(this.pages,t,0,s),function(t,e,i,n){!!Gn(t)||Cu.output(e,i,n,void 0,wu.PARAM_INVALID);}(e,0,s,r),!zn(i)){!function(t,e,i,n){const s=ID.isUpdatePageOptionsValid(t,e,"updatePageOptions");!s.length||Cu.output(i,n,"options",s);}(i,n(this,RD).filterService.getSupportedFilters().map((t=>t.type)),0,s);}return n(this,RD).updatePage(t,e,i)}deletePages(t){const e="IDocument.deletePages",i="indices";if(FA(t,1,e,i)||!mT(t,1,e,i,0,n(this,BD)-1))return !1;const s=t.map((t=>n(this,MD).pages[t]));return n(this,RD).deletePages(this.uid,s)}deleteAllPages(){return n(this,MD).pages.slice(),n(this,RD).deleteAllPages(this.uid)}movePages(t,e){const i="IDocument.movePages",s="indices";FA(t,0,i,s),mT(t,0,i,s,0,n(this,BD)-1),zn(e)||wT(e,0,i,"insertBeforeIndex",0),e=e>n(this,BD)-1?void 0:e,n(this,RD).movePages(this.uid,t,e);}switchPage(t,e){const i="IDocument.switchPage",s="oneIndex",o="anotherIndex";FA(t,0,i,s),FA(e,0,i,o),wT(t,0,i,s,0,n(this,BD)-1),wT(e,0,i,o,0,n(this,BD)-1),n(this,RD).documentService.swapPages(this.uid,t,e);}rename(t){const e="IDocument.rename",i="name";return !FA(t,1,e,i)&&(!!yT(t,1,e,i)&&n(this,RD).documentService.renameDocument(this.uid,t))}setPageCustomData(t,e){const i="IDocument.setPageCustomData",s="pageUid";return FA(t,0,i,s),FA(e,0,i,"data"),yT(t,0,i,s,!1),gT(this.pages,t,0,i),n(this,RD).setCustomData(t,e)}getPageCustomData(t){const e="IDocument.getPageCustomData",i="pageUid";return FA(t,0,e,i),yT(t,0,e,i,!1),gT(this.pages,t,0,e),n(this,RD).getCustomData(t)}async saveToJpeg(t,e){const i="IDocument.saveToJpeg",s="index";FA(t,0,i,s),wT(t,0,i,s,0,n(this,BD)-1),zn(e)||function(t,e,i){const n=ID.isSaveJpegSettingsValid(t);!n.length||Cu.output(e,i,"saveJpegSettings",n);}(e,0,i);const o=this.pages[t],r=wu.buildInfo("save",{docUid:this.uid,pageUids:[o],current:0,total:1});return wu.info(r),n(this,RD).fileSaveService.saveToJpeg(o,e,r).catch((t=>{r.status="Failed",wu.info(r),wu.reject(t,i);}))}saveToPng(t,e){const i="IDocument.saveToPng",s="index";FA(t,0,i,s),wT(t,0,i,s,0,n(this,BD)-1),zn(e)||function(t,e,i){const n=ID.isSavePngSettingsValid(t);n.length&&Cu.output(e,i,"savePngSettings",n);}(e,0,i);const o=this.pages[t],r=wu.buildInfo("save",{docUid:this.uid,pageUids:[o],current:0,total:1});return wu.info(r),n(this,RD).fileSaveService.saveToPng(o,e,r).catch((t=>(r.status="Failed",wu.info(r),wu.reject(t,i))))}saveToPdf(t,e){const i="IDocument.saveToPdf";0===this.pages.length&&wu.throw(wu.DOC_NO_IMAGE),Fn(t)?mT(t,0,i,"indices",0,n(this,BD)-1):(e=t,t=Array.from(Array(this.pages.length).keys())),zn(e)||function(t,e,i){const n=ID.isSavePdfSettingsValid(t);!n.length||Cu.output(e,i,"savePdfSettings",n);}(e,0,i);const s=[];t.forEach((t=>{s.push(this.pages[t]);}));try{!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation||xp.makeSureAnnotationLicenseExist();}catch(t){return Promise.reject(t)}const o=wu.buildInfo("save",{docUid:this.uid,pageUids:s,current:0,total:s.length});return wu.info(o),n(this,RD).fileSaveService.saveToPdf(s,e,o).catch((t=>(o.status="Failed",wu.info(o),wu.reject(t,i))))}saveToTiff(t,e){const i="IDocument.saveToTiff";0===this.pages.length&&wu.throw(wu.DOC_NO_IMAGE),Fn(t)?mT(t,0,i,"indices",0,n(this,BD)-1):(e=t,t=Array.from(Array(this.pages.length).keys())),zn(e)||function(t,e,i){const n=ID.isSaveTiffSettingsValid(t);!n.length||Cu.output(e,i,"saveTiffSettings",n);}(e,0,i);const s=[];t.forEach((t=>{s.push(this.pages[t]);}));const o=wu.buildInfo("save",{docUid:this.uid,pageUids:s,current:0,total:s.length});return wu.info(o),n(this,RD).fileSaveService.saveToTiff(s,e,o).catch((t=>(o.status="Failed",wu.info(o),wu.reject(t,i))))}print(t,e){const i="IDocument.print";let s,o=e;var r;(Fn(t)?(mT(t,0,i,"indices",0,n(this,BD)-1),s=t):o=t,zn(o))||(zn(null===(r=o)||void 0===r?void 0:r.printAnnotation)||Xn(o.printAnnotation)||Cu.error(i,"setting.printAnnotation",void 0,wu.PARAM_INVALID));0===this.pages.length&&wu.throw(wu.DOC_NO_IMAGE),n(this,RD).printPages(this.uid,s,o);}insertBlankPage(t,e,i){const s="IDocument.insertBlankPage",o="pageWidth",r="pageHeight";xp.makeSureLoadLicenseExist(),FA(t,0,s,o),FA(e,0,s,r),wT(t,0,s,o,.72,7200),wT(e,0,s,r,.72,7200),zn(i)||wT(i,0,s,"insertBeforeIndex",0);return n(this,RD).insertBlankPage(this.uid,Math.floor(Ys(t,Do.dataResolution,72))||1,Math.floor(Ys(e,Do.dataResolution,72))||1,72,72,i)}}function UD(){return n(this,MD).pages.length}function OD(t,e){let i=!0;const n=Js(t.left,e),s=Js(t.top,e),o=Js(t.width,e),r=Js(t.height,e),a=1e-7;return (Math.abs(n-t.left)>a||Math.abs(s-t.top)>a||Math.abs(o-t.width)>a||Math.abs(r-t.height)>a)&&(i=!1),i?{left:n,top:s,width:o,height:r}:t}function ND(t,e,i,n,s){if(!zn(t)){const o="transferOptions",r=ID.isTransferOptionsValid(t,e,i,o);if(r.length)return Cu.output(n,s,o,r)}return !0}function _D(t,e,i,n){if(!zn(t)){const s=ID.isDocOptionsValid(t);if(s.length)return Cu.output(e,i,n,s)}return !0}function WD(t,e,i,n,s){const o=e.reduce(((e,i,n)=>(t.has(i)||e.push(`${s}[${n}]:The specified document(s) do not exist.`),e)),[]);return !o.length||Cu.output(i,n,s,o,wu.DOC_NOT_EXIST,!0)}const FD=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var HD=new WeakMap,VD=new WeakMap,zD=new WeakMap;const jD=new class extends Qs{constructor(){super(),f(this,HD,{writable:!0,value:void 0}),f(this,VD,{writable:!0,value:void 0}),f(this,zD,{writable:!0,value:void 0}),s(this,zD,new ns),s(this,HD,kP),s(this,VD,new Map),kP.onUnload.on((()=>{n(this,VD).clear(),n(this,zD).removeAllEventListeners();}),this);const{documentService:t}=kP;t.onDocumentCreated.on((t=>{const e=n(this,HD).getDocument(t.docUid),i=new LD(n(this,HD),e);n(this,VD).set(i.uid,i),n(this,zD).emit("documentCreated",t);}),this),t.onDocumentDeleted.on((t=>{n(this,VD).has(t.docUid)&&n(this,VD).delete(t.docUid),n(this,zD).emit("documentDeleted",t);}),this),t.onPagesAddedOut.on((t=>{t.indices.length&&t.pageUids.length&&n(this,zD).emit("pagesAdded",t);}),this),t.onDeletePagesFromDoc.on((t=>{n(this,zD).emit("pagesDeleted",t);}),this),t.onDeleteAllPagesFromDoc.on((t=>{n(this,zD).emit("pagesDeleted",t);}),this);}createDocument(t){_D(t,0,"DocumentManager.createDocument","createDocumentOptions");const e=n(this,HD).createDocument(t);return n(this,VD).get(e.uid)}getDocument(t){const e="DocumentManager.getDocument",i="docUid";if(FA(t,1,e,i)||!yT(t,1,e,i))return null;const s=n(this,VD).get(t);return s||(Cu.warning(e,i,void 0,wu.DOC_NOT_EXIST),null)}getAllDocuments(){return Array.from(n(this,VD).values())}deleteDocuments(t){const e="DocumentManager.deleteDocuments",i="docUids";return !(FA(t,1,e,i)||!mk(t,1,e,i,void 0,!1)||!WD(n(this,VD),t,1,e,i))&&n(this,HD).deleteDocuments([...new Set(t)])}deleteAllDocuments(){const t=n(this,HD).documentService.getAllDocuments();return n(this,HD).deleteDocuments(t.map((t=>t.uid)))}copyPagesToDocument(t,e,i){const s="DocumentManager.copyPagesToDocument",o="sourceDocUid",r="targetDocUid";FA(t,0,s,o),FA(e,0,s,r),yT(t,0,s,o),yT(e,0,s,r);const a=n(this,VD).get(t),l=n(this,VD).get(e);return a&&l||wu.throw(wu.DOC_NOT_EXIST,s),ND(i,0,a.pages.length-1,0,s),n(this,HD).transferDocument(t,e,{...i,copy:!0})}movePagesToDocument(t,e,i){const s="DocumentManager.movePagesToDocument",o="sourceDocUid",r="targetDocUid";FA(t,0,s,o),FA(e,0,s,r),yT(t,0,s,o),yT(e,0,s,r);const a=n(this,VD).get(t),l=n(this,VD).get(e);return a&&l||wu.throw(wu.DOC_NOT_EXIST,s),ND(i,0,a.pages.length-1,0,s),n(this,HD).transferDocument(t,e,i)}mergeDocuments(t,e){const i="DocumentManager.mergeDocuments",s="docUids";FA(t,0,i,s),mk(t,0,i,s,void 0,!1),function(t){return new Set(t).size!==t.length}(t)&&Cu.error(void 0,void 0,void 0,wu.DOC_UID_DUPLICATE),WD(n(this,VD),t,0,i,s),_D(e,0,i,"mergeDocumentOptions");const o=n(this,HD).mergeDocuments(t,e);return n(this,VD).get(o.uid)}on(t,e){const i="DocumentManager.on";!FA(t,1,i,"eventName")&&!FA(e,1,i,"listener")&&yT(t,1,i,"eventName",!1)&&fT(e,i,"listener",1)&&(FD.includes(t)?n(this,zD).on(t,e):wu.warning(wu.PARAM_NOT_SUPPORT,i,"eventName"));}off(t,e){const i="DocumentManager.off";!FA(t,1,i,"eventName")&&yT(t,1,i,"eventName",!1)&&(zn(e)||fT(e,i,"listener",1))&&(FD.includes(t)?n(this,zD).off(t,e):wu.warning(wu.PARAM_NOT_SUPPORT,i,"eventName"));}},$D=document.currentScript;function GD(){return `${(()=>{if(!un&&$D){let{src:t}=$D;const e=t.indexOf("?");if(-1!==e)t=t.substring(0,e);else {const e=t.indexOf("#");-1!==e&&(t=t.substring(0,e));}return t.substring(0,t.lastIndexOf("/")+1)}return "./"})()}engine`}let XD="";function YD(){let t,i;var n;if(""===XD&&(dynamsoftCore.CoreModule&&dynamsoftCore.CoreModule.engineResourcePaths?(t=dynamsoftCore.CoreModule.engineResourcePaths.ddv,i=dynamsoftCore.CoreModule.engineResourcePaths.rootDirectory):null!==(n=window)&&void 0!==n&&null!==(n=n.Dynamsoft)&&void 0!==n&&null!==(n=n.Core)&&void 0!==n&&null!==(n=n.CoreModule)&&void 0!==n&&null!==(n=n.engineResourcePaths)&&void 0!==n&&n.ddv&&(t=window.Dynamsoft.Core.CoreModule.engineResourcePaths.ddv,window.Dynamsoft.Core.CoreModule.engineResourcePaths.rootDirectory&&(i=window.Dynamsoft.Core.CoreModule.engineResourcePaths.rootDirectory)),t))if(Zn(t)&&(XD=t),Zn(XD)){if(XD.startsWith("https://")||XD.startsWith("http://"));else if(XD.startsWith("@engineRootDirectory/")){let t=i;i&&Zn(i)&&i.length>0?"/"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)):t="",XD=XD.replace("@engineRootDirectory",t);}else if("@engineRootDirectory"===XD&&(XD=""),i&&Zn(i)&&i.length>0){let t="";"/"==i.charAt(i.length-1)||(t="/"),XD=[i,t,XD].join("");}}else XD="";return XD}var qD=new WeakMap,JD=new WeakMap,ZD=new WeakMap;const QD=new class{constructor(){f(this,qD,{writable:!0,value:""}),f(this,JD,{writable:!0,value:""}),f(this,ZD,{writable:!0,value:""});}get versionInfo(){return {viewer:kp,engine:so.version}}set engineResourcePath(t){Zn(t)?s(this,ZD,t):wu.throw(wu.PARAM_INVALID,"Core.engineResourcePath","engineResourcePath");}get engineResourcePath(){const t=YD();return ""!==t?(s(this,ZD,t),t):(""===n(this,ZD)&&s(this,ZD,GD()),n(this,ZD))}set license(t){!function(t,e,i,n){const s=Cu.formatError({isValid:ID.isLicenseValid(t)});!s||Cu.output(e,i,n,void 0,s);}(t,0,"Core.license","license"),s(this,JD,t);}get license(){return n(this,JD)}set deviceFriendlyName(t){Zn(t)?s(this,qD,t):wu.throw(wu.PARAM_INVALID,"Core.deviceFriendlyName","deviceFriendlyName");}get deviceFriendlyName(){return n(this,qD)}loadWasm(){return async function(t){let e=t.trim();e.endsWith("/")||(e=`${e}/`);const i=wu.buildInfo("loadWasm",{});if(wu.info(i),so.resourceDir=e,!await so.isResourceDirValid())return i.status="Failed",wu.info(i),wu.reject(wu.RESOURCE_NOT_FOUND,"DDV.Core.loadWasm");await so.preloadModule("core");const n=so.preloadModule("proc"),s=so.preloadModule("pdf");await Promise.all([n,s]),i.status="Completed",wu.info(i);}(this.engineResourcePath)}init(){return Zp({license:n(this,JD),engineResourcePath:this.engineResourcePath,deviceFriendlyName:n(this,qD)})}};exports.EnumImageFilterType = void 0;!function(t){t.NONE="none",t.BLACK_AND_WHITE="blackAndWhite",t.GRAY="gray",t.REMOVE_SHADOW="removeShadow",t.SAVE_INK="saveInk",t.ENHANCE="enhance",t.INVERT="invert";}(exports.EnumImageFilterType||(exports.EnumImageFilterType={}));const tE=[],eE={documentManager:jD,Core:QD,Elements:VA,DocumentDetect:Jc,ImageFilter:class{constructor(){y(this,mu),y(this,yu);}get defaultFilterType(){return Wc.NONE}async applyFilter(t,e,i,n){const s=new wo,o=p(this,yu,vu).call(this,e,i),r=p(this,mu,xu).call(this,{outputType:t.type,...n||{}});let a;try{const i=await s.initImage({source:t.data,isRGBA:t.type===exports.EnumImageDataType.RGBA,width:t.width,height:t.height,isBGRA:t.type===exports.EnumImageDataType.BGRA});let n;i.srcBuffer&&(t.data=i.srcBuffer),e===Wc.NONE?(n=await s.getImage({jpegQuality:r.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===exports.EnumImageDataType.RGBA,bitDepth:r.bitDepth,xDpi:r.xdpi,yDpi:r.ydpi,returnBlob:!1,returnType:To[r.outputType]}),s.freeReservedData()):n=await s.filter(gu.get(e),o,r),a=new Blob([n.imageData],{type:n.blobType});}finally{s.terminate();}return a}querySupported(){return [{type:Wc.NONE,label:"Original"},{type:Wc.BLACK_AND_WHITE,label:"B&W"},{type:Wc.GRAY,label:"Grayscale"},{type:Wc.SAVE_INK,label:"Save Toner"}]}destroy(){}},BrowseViewer:sD,CaptureViewer:kT,CustomViewer:hD,EditViewer:jk,PerspectiveViewer:iD,get lastError(){return wu.getLastError()},clearLastError(){wu.lastError=void 0;},Experiments:{get(t,e){switch(t){case"WasmEnv":return so;case"ImageProcess":return new Au;case"FileParser.Options":return kP.getFileParserDefaultOptions(e);case"InnerViewer":return kP.getViewer(e);case"PageSourceInfo":return kP.getPageSourceInfo(e);case"AnnotationInkSignatureBoard":return lv;case"AnnotationCustomStampBoard":return wv;default:return}},set(t,e){switch(t){case"FileParser.Options":return kP.setFileParserDefaultOptions(e.type,e.options);case"ClearExternalHandler":return kP.clearExternalHandler(e.type);default:return}}},async addFonts(t){const e="DDV.addFonts",i=FA(t,2,e,"fonts");if(i)return i;const n=function(t,e,i,n,s){const o=Cu.formatError({isValid:Fn(t)});if(o)return Cu.output(e,i,n,void 0,o);const r=[];return t.forEach(((t,e)=>{const i=Cu.formatDetails(bu("Array",s,`[${e}]`,!0),Gn(t));r.push(...i);})),!!r.length&&Cu.output(e,i,n,r)}(t,2,e,"fonts","font");if(n)return n;try{for(let e=0;e<t.length;e++){const i=t[e],n=new Po,s=await n.getFontInfo(i).catch((t=>{throw n.terminate(),t}));n.terminate();for(let t=0;t<s.fontInfo.length;t++){const e=s.fontInfo[t];if(!tE.includes(e.family)){new FontFace(e.family,s.srcBuffer,{style:"normal",weight:"normal",display:"swap"}).load().then((t=>{document.fonts.add(t),tE.push(e.family),kP.getViewers().forEach((t=>{t.addFontToUi(e.family),t.context.render();}));}));}const i=`${e.family}${e.isBold?"Blob":""}${e.isItalic?"Italic":""}`;So.addPdfFont(i,s.srcBuffer);}}}catch(t){return wu.reject(wu.PARAM_INVALID,e,"fonts")}return Promise.resolve()},getDefaultUiConfig(t,e){const i="DDV.getDefaultUiConfig",n="viewerType";if(FA(t,1,n,i)||!yT(t,1,i,n)||!function(t,e,i,n){return !!["editViewer","perspectiveViewer","captureViewer","browseViewer"].includes(t)||Cu.output(n,e,i,void 0,wu.PARAM_NOT_SUPPORT)}(t,i,n,1))return null;let s=null;if(qn()){s={editViewer:jA,perspectiveViewer:$A,captureViewer:zA,browseViewer:qA}[t],"editViewer"===t&&null!=e&&e.includeAnnotationSet&&(s=JA);}else {s={editViewer:YA,perspectiveViewer:XA,captureViewer:GA,browseViewer:qA}[t],"editViewer"===t&&null!=e&&e.includeAnnotationSet&&(s=ZA);}return Vn(s)},setProcessingHandler(t,e){const i="DDV.setProcessingHandler",n="type",s="handler";switch(FA(t,0,i,n),FA(e,0,i,s),function(t,e,i,n){const s=Cu.formatError(ID.isHandlerTypeValid(t));s&&Cu.output(e,i,n,void 0,s);}(t,0,i,n),t){case"documentBoundariesDetect":("function"!=typeof(o=e).detect||"function"!=typeof o.destroy)&&Cu.error(i,s);break;case"imageFilter":(function(t){return "function"==typeof t.querySupported&&"defaultFilterType"in t&&"function"==typeof t.applyFilter&&"function"==typeof t.destroy})(e)||Cu.error(i,s);}var o;try{switch(t){case"documentBoundariesDetect":kP.setDetectHandler(t,e);break;case"imageFilter":kP.setImageFilterHandler(e);}}catch(t){wu.throw(t,i);}},setFileParser(t,e){kP.setFileParser(t,e);},unload(){this.Core.deviceFriendlyName="",this.Core.engineResourcePath=YD(),this.Core.license="",kP.unload(),kP.onUnload.emit(),Ak.clear(),this.off("error"),this.off("warning"),this.off("verbose"),this.off("info");},on(t,e){const i="DDV.on";if(FA(t,1,i,"eventName")||FA(e,1,i,"listener")||!yT(t,1,i,"eventName",!1)||!fT(e,i,"listener",1))return;const n={error:"error",warning:"warning",verbose:"verbose",info:"info"}[t];n?wu.on(n,e):wu.throw(wu.PARAM_NOT_SUPPORT,i,"eventName");},off(t,e){const i="DDV.off";if(FA(t,1,i,"eventName")||!yT(t,1,i,"eventName",!1))return;if(!zn(e)&&!fT(e,i,"listener",1))return;const n={error:"error",warning:"warning",verbose:"verbose",info:"info"}[t];n?wu.off(n,e):wu.throw(wu.PARAM_NOT_SUPPORT,i,"eventName");},EnumImageDataType:exports.EnumImageDataType,EnumConvertMode:exports.EnumConvertMode,EnumDocumentDetectionStatus:exports.EnumDocumentDetectionStatus,EnumImageFilterType:exports.EnumImageFilterType,EnumPDFCompressionType:exports.EnumPDFCompressionType,EnumPDFPageType:exports.EnumPDFPageType,EnumTIFFCompressionType:exports.EnumTIFFCompressionType,EnumStampIcon:QA,EnumLineEnding:KA,EnumAnnotationRenderMode:exports.EnumAnnotationRenderMode,annotationManager:Bk};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=eE;

	exports.BrowseViewer = sD;
	exports.CaptureViewer = kT;
	exports.CustomViewer = hD;
	exports.DDV = eE;
	exports.EditViewer = jk;
	exports.PerspectiveViewer = iD;

	return exports;

})({}, {});
